import{g as getDefaultExportFromCjs,r as require$$0,P as Path,c as commonjsRequire,a as commonjsGlobal}from"./index-DWFB8OMH.js";function isNodePattern(e){if(typeof e>"u")return!1;if(typeof e!="function")throw new TypeError("Callback must be a function");return!0}function throwError(e,t){if(typeof e=="string"&&(e=new Error(e)),typeof t=="function")return t.call(this,e);throw e}function scan(e,t,r,n,a,l){t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a);for(let o=r;o<r+a;o++)for(let s=t;s<t+n;s++){const h=e.bitmap.width*o+s<<2;l.call(e,s,o,h)}return e}function*scanIterator(e,t,r,n,a){t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a);for(let l=r;l<r+a;l++)for(let o=t;o<t+n;o++){const s=e.bitmap.width*l+o<<2;yield{x:o,y:l,idx:s,image:e}}}function Converter$1(e,t){if(!e||!t||!e.length||!t.length)throw new Error("Bad alphabet");this.srcAlphabet=e,this.dstAlphabet=t}Converter$1.prototype.convert=function(e){var t,r,n,a={},l=this.srcAlphabet.length,o=this.dstAlphabet.length,s=e.length,h=typeof e=="string"?"":[];if(!this.isValid(e))throw new Error('Number "'+e+'" contains of non-alphabetic digits ('+this.srcAlphabet+")");if(this.srcAlphabet===this.dstAlphabet)return e;for(t=0;t<s;t++)a[t]=this.srcAlphabet.indexOf(e[t]);do{for(r=0,n=0,t=0;t<s;t++)r=r*l+a[t],r>=o?(a[n++]=parseInt(r/o,10),r=r%o):n>0&&(a[n++]=0);s=n,h=this.dstAlphabet.slice(r,r+1).concat(h)}while(n!==0);return h};Converter$1.prototype.isValid=function(e){for(var t=0;t<e.length;++t)if(this.srcAlphabet.indexOf(e[t])===-1)return!1;return!0};var converter=Converter$1,Converter=converter;function anyBase(e,t){var r=new Converter(e,t);return function(n){return r.convert(n)}}anyBase.BIN="01";anyBase.OCT="01234567";anyBase.DEC="0123456789";anyBase.HEX="0123456789abcdef";var anyBase_1=anyBase;const anyBase$1=getDefaultExportFromCjs(anyBase_1);var pixelmatch_1=pixelmatch;function pixelmatch(e,t,r,n,a,l){l||(l={});for(var o=l.threshold===void 0?.1:l.threshold,s=35215*o*o,h=0,f=0;f<a;f++)for(var u=0;u<n;u++){var d=(f*n+u)*4,p=colorDelta(e,t,d,d);if(p>s)!l.includeAA&&(antialiased(e,u,f,n,a,t)||antialiased(t,u,f,n,a,e))?r&&drawPixel(r,d,255,255,0):(r&&drawPixel(r,d,255,0,0),h++);else if(r){var m=blend(grayPixel(e,d),.1);drawPixel(r,d,m,m,m)}}return h}function antialiased(e,t,r,n,a,l){for(var o=Math.max(t-1,0),s=Math.max(r-1,0),h=Math.min(t+1,n-1),f=Math.min(r+1,a-1),u=(r*n+t)*4,d=0,p=0,m=0,A=0,k=0,I,B,M,T,U=o;U<=h;U++)for(var C=s;C<=f;C++)if(!(U===t&&C===r)){var w=colorDelta(e,e,u,(C*n+U)*4,!0);if(w===0?d++:w<0?m++:w>0&&p++,d>2)return!1;l&&(w<A&&(A=w,I=U,B=C),w>k&&(k=w,M=U,T=C))}return l?m===0||p===0?!1:!antialiased(e,I,B,n,a)&&!antialiased(l,I,B,n,a)||!antialiased(e,M,T,n,a)&&!antialiased(l,M,T,n,a):!0}function colorDelta(e,t,r,n,a){var l=e[r+3]/255,o=t[n+3]/255,s=blend(e[r+0],l),h=blend(e[r+1],l),f=blend(e[r+2],l),u=blend(t[n+0],o),d=blend(t[n+1],o),p=blend(t[n+2],o),m=rgb2y(s,h,f)-rgb2y(u,d,p);if(a)return m;var A=rgb2i(s,h,f)-rgb2i(u,d,p),k=rgb2q(s,h,f)-rgb2q(u,d,p);return .5053*m*m+.299*A*A+.1957*k*k}function rgb2y(e,t,r){return e*.29889531+t*.58662247+r*.11448223}function rgb2i(e,t,r){return e*.59597799-t*.2741761-r*.32180189}function rgb2q(e,t,r){return e*.21147017-t*.52261711+r*.31114694}function blend(e,t){return 255+(e-255)*t}function drawPixel(e,t,r,n,a){e[t+0]=r,e[t+1]=n,e[t+2]=a,e[t+3]=255}function grayPixel(e,t){var r=e[t+3]/255,n=blend(e[t+0],r),a=blend(e[t+1],r),l=blend(e[t+2],r);return rgb2y(n,a,l)}const pixelMatch=getDefaultExportFromCjs(pixelmatch_1);function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var r=inputToRGB(e);this._originalInput=e,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||r.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb(),r,n,a,l,o,s;return r=t.r/255,n=t.g/255,a=t.b/255,r<=.03928?l=r/12.92:l=Math.pow((r+.055)/1.055,2.4),n<=.03928?o=n/12.92:o=Math.pow((n+.055)/1.055,2.4),a<=.03928?s=a/12.92:s=Math.pow((a+.055)/1.055,2.4),.2126*l+.7152*o+.0722*s},setAlpha:function(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=rgbToHsv(this._r,this._g,this._b),r=Math.round(t.h*360),n=Math.round(t.s*100),a=Math.round(t.v*100);return this._a==1?"hsv("+r+", "+n+"%, "+a+"%)":"hsva("+r+", "+n+"%, "+a+"%, "+this._roundA+")"},toHsl:function(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=rgbToHsl(this._r,this._g,this._b),r=Math.round(t.h*360),n=Math.round(t.s*100),a=Math.round(t.l*100);return this._a==1?"hsl("+r+", "+n+"%, "+a+"%)":"hsla("+r+", "+n+"%, "+a+"%, "+this._roundA+")"},toHex:function(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var r="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),n=r,a=this._gradientType?"GradientType = 1, ":"";if(t){var l=tinycolor(t);n="#"+rgbaToArgbHex(l._r,l._g,l._b,l._a)}return"progid:DXImageTransform.Microsoft.gradient("+a+"startColorstr="+r+",endColorstr="+n+")"},toString:function(t){var r=!!t;t=t||this._format;var n=!1,a=this._a<1&&this._a>=0,l=!r&&a&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return l?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(n=this.toRgbString()),t==="prgb"&&(n=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(n=this.toHexString()),t==="hex3"&&(n=this.toHexString(!0)),t==="hex4"&&(n=this.toHex8String(!0)),t==="hex8"&&(n=this.toHex8String()),t==="name"&&(n=this.toName()),t==="hsl"&&(n=this.toHslString()),t==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return tinycolor(this.toString())},_applyModification:function(t,r){var n=t.apply(null,[this].concat([].slice.call(r)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(_lighten,arguments)},brighten:function(){return this._applyModification(_brighten,arguments)},darken:function(){return this._applyModification(_darken,arguments)},desaturate:function(){return this._applyModification(_desaturate,arguments)},saturate:function(){return this._applyModification(_saturate,arguments)},greyscale:function(){return this._applyModification(_greyscale,arguments)},spin:function(){return this._applyModification(_spin,arguments)},_applyCombination:function(t,r){return t.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(_analogous,arguments)},complement:function(){return this._applyCombination(_complement,arguments)},monochromatic:function(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(_splitcomplement,arguments)},triad:function(){return this._applyCombination(polyad,[3])},tetrad:function(){return this._applyCombination(polyad,[4])}};tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var r={};for(var n in e)e.hasOwnProperty(n)&&(n==="a"?r[n]=e[n]:r[n]=convertToPercentage(e[n]));e=r}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},r=1,n=null,a=null,l=null,o=!1,s=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),o=!0,s=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(n=convertToPercentage(e.s),a=convertToPercentage(e.v),t=hsvToRgb(e.h,n,a),o=!0,s="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(n=convertToPercentage(e.s),l=convertToPercentage(e.l),t=hslToRgb(e.h,n,l),o=!0,s="hsl"),e.hasOwnProperty("a")&&(r=e.a)),r=boundAlpha(r),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}function rgbToRgb(e,t,r){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(r,255)*255}}function rgbToHsl(e,t,r){e=bound01(e,255),t=bound01(t,255),r=bound01(r,255);var n=Math.max(e,t,r),a=Math.min(e,t,r),l,o,s=(n+a)/2;if(n==a)l=o=0;else{var h=n-a;switch(o=s>.5?h/(2-n-a):h/(n+a),n){case e:l=(t-r)/h+(t<r?6:0);break;case t:l=(r-e)/h+2;break;case r:l=(e-t)/h+4;break}l/=6}return{h:l,s:o,l:s}}function hslToRgb(e,t,r){var n,a,l;e=bound01(e,360),t=bound01(t,100),r=bound01(r,100);function o(f,u,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?f+(u-f)*6*d:d<1/2?u:d<2/3?f+(u-f)*(2/3-d)*6:f}if(t===0)n=a=l=r;else{var s=r<.5?r*(1+t):r+t-r*t,h=2*r-s;n=o(h,s,e+1/3),a=o(h,s,e),l=o(h,s,e-1/3)}return{r:n*255,g:a*255,b:l*255}}function rgbToHsv(e,t,r){e=bound01(e,255),t=bound01(t,255),r=bound01(r,255);var n=Math.max(e,t,r),a=Math.min(e,t,r),l,o,s=n,h=n-a;if(o=n===0?0:h/n,n==a)l=0;else{switch(n){case e:l=(t-r)/h+(t<r?6:0);break;case t:l=(r-e)/h+2;break;case r:l=(e-t)/h+4;break}l/=6}return{h:l,s:o,v:s}}function hsvToRgb(e,t,r){e=bound01(e,360)*6,t=bound01(t,100),r=bound01(r,100);var n=Math.floor(e),a=e-n,l=r*(1-t),o=r*(1-a*t),s=r*(1-(1-a)*t),h=n%6,f=[r,o,l,l,s,r][h],u=[s,r,r,o,l,l][h],d=[l,l,s,r,r,o][h];return{r:f*255,g:u*255,b:d*255}}function rgbToHex(e,t,r,n){var a=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function rgbaToHex(e,t,r,n,a){var l=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16)),pad2(convertDecimalToHex(n))];return a&&l[0].charAt(0)==l[0].charAt(1)&&l[1].charAt(0)==l[1].charAt(1)&&l[2].charAt(0)==l[2].charAt(1)&&l[3].charAt(0)==l[3].charAt(1)?l[0].charAt(0)+l[1].charAt(0)+l[2].charAt(0)+l[3].charAt(0):l.join("")}function rgbaToArgbHex(e,t,r,n){var a=[pad2(convertDecimalToHex(n)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(r).toString(16))];return a.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()};tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var r=tinycolor(e).toHsl();return r.s-=t/100,r.s=clamp01(r.s),tinycolor(r)}function _saturate(e,t){t=t===0?0:t||10;var r=tinycolor(e).toHsl();return r.s+=t/100,r.s=clamp01(r.s),tinycolor(r)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var r=tinycolor(e).toHsl();return r.l+=t/100,r.l=clamp01(r.l),tinycolor(r)}function _brighten(e,t){t=t===0?0:t||10;var r=tinycolor(e).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(t/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(t/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(t/100)))),tinycolor(r)}function _darken(e,t){t=t===0?0:t||10;var r=tinycolor(e).toHsl();return r.l-=t/100,r.l=clamp01(r.l),tinycolor(r)}function _spin(e,t){var r=tinycolor(e).toHsl(),n=(r.h+t)%360;return r.h=n<0?360+n:n,tinycolor(r)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var r=tinycolor(e).toHsl(),n=[tinycolor(e)],a=360/t,l=1;l<t;l++)n.push(tinycolor({h:(r.h+l*a)%360,s:r.s,l:r.l}));return n}function _splitcomplement(e){var t=tinycolor(e).toHsl(),r=t.h;return[tinycolor(e),tinycolor({h:(r+72)%360,s:t.s,l:t.l}),tinycolor({h:(r+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,r){t=t||6,r=r||30;var n=tinycolor(e).toHsl(),a=360/r,l=[tinycolor(e)];for(n.h=(n.h-(a*t>>1)+720)%360;--t;)n.h=(n.h+a)%360,l.push(tinycolor(n));return l}function _monochromatic(e,t){t=t||6;for(var r=tinycolor(e).toHsv(),n=r.h,a=r.s,l=r.v,o=[],s=1/t;t--;)o.push(tinycolor({h:n,s:a,v:l})),l=(l+s)%1;return o}tinycolor.mix=function(e,t,r){r=r===0?0:r||50;var n=tinycolor(e).toRgb(),a=tinycolor(t).toRgb(),l=r/100,o={r:(a.r-n.r)*l+n.r,g:(a.g-n.g)*l+n.g,b:(a.b-n.b)*l+n.b,a:(a.a-n.a)*l+n.a};return tinycolor(o)};tinycolor.readability=function(e,t){var r=tinycolor(e),n=tinycolor(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)};tinycolor.isReadable=function(e,t,r){var n=tinycolor.readability(e,t),a,l;switch(l=!1,a=validateWCAG2Parms(r),a.level+a.size){case"AAsmall":case"AAAlarge":l=n>=4.5;break;case"AAlarge":l=n>=3;break;case"AAAsmall":l=n>=7;break}return l};tinycolor.mostReadable=function(e,t,r){var n=null,a=0,l,o,s,h;r=r||{},o=r.includeFallbackColors,s=r.level,h=r.size;for(var f=0;f<t.length;f++)l=tinycolor.readability(e,t[f]),l>a&&(a=l,n=tinycolor(t[f]));return tinycolor.isReadable(e,n,{level:s,size:h})||!o?n:(r.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],r))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip$1(names);function flip$1(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var r=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",r="(?:"+t+")|(?:"+e+")",n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",a="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{CSS_UNIT:new RegExp(r),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+a),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+a),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+a),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=matchers.rgb.exec(e))?{r:r[1],g:r[2],b:r[3]}:(r=matchers.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=matchers.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=matchers.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=matchers.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=matchers.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=matchers.hex8.exec(e))?{r:parseIntFromHex(r[1]),g:parseIntFromHex(r[2]),b:parseIntFromHex(r[3]),a:convertHexToDecimal(r[4]),format:t?"name":"hex8"}:(r=matchers.hex6.exec(e))?{r:parseIntFromHex(r[1]),g:parseIntFromHex(r[2]),b:parseIntFromHex(r[3]),format:t?"name":"hex"}:(r=matchers.hex4.exec(e))?{r:parseIntFromHex(r[1]+""+r[1]),g:parseIntFromHex(r[2]+""+r[2]),b:parseIntFromHex(r[3]+""+r[3]),a:convertHexToDecimal(r[4]+""+r[4]),format:t?"name":"hex8"}:(r=matchers.hex3.exec(e))?{r:parseIntFromHex(r[1]+""+r[1]),g:parseIntFromHex(r[2]+""+r[2]),b:parseIntFromHex(r[3]+""+r[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,r;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),r!=="small"&&r!=="large"&&(r="small"),{level:t,size:r}}function ImagePHash(e,t){this.size=this.size||e,this.smallerSize=this.smallerSize||t,initCoefficients(this.size)}ImagePHash.prototype.size=32;ImagePHash.prototype.smallerSize=8;ImagePHash.prototype.distance=function(e,t){let r=0;for(let n=0;n<e.length;n++)e[n]!==t[n]&&r++;return r/e.length};ImagePHash.prototype.getHash=function(e){e=e.clone().resize(this.size,this.size),e.grayscale();const t=[];for(let o=0;o<e.bitmap.width;o++){t[o]=[];for(let s=0;s<e.bitmap.height;s++)t[o][s]=intToRGBA(e.getPixelColor(o,s)).b}const r=applyDCT(t,this.size);let n=0;for(let o=0;o<this.smallerSize;o++)for(let s=0;s<this.smallerSize;s++)n+=r[o][s];const a=n/(this.smallerSize*this.smallerSize);let l="";for(let o=0;o<this.smallerSize;o++)for(let s=0;s<this.smallerSize;s++)l+=r[o][s]>a?"1":"0";return l};function intToRGBA(e){const t=e&255;e>>>=8;const r=e&255;e>>>=8;const n=e&255;return e>>>=8,{r:e&255,g:n,b:r,a:t}}const c=[];function initCoefficients(e){for(let t=1;t<e;t++)c[t]=1;c[0]=1/Math.sqrt(2)}function applyDCT(e,t){const r=t,n=[];for(let a=0;a<r;a++){n[a]=[];for(let l=0;l<r;l++){let o=0;for(let s=0;s<r;s++)for(let h=0;h<r;h++)o+=Math.cos((2*s+1)/(2*r)*a*Math.PI)*Math.cos((2*h+1)/(2*r)*l*Math.PI)*e[s][h];o*=c[a]*c[l]/4,n[a][l]=o}}return n}var g=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},support={searchParams:"URLSearchParams"in g,iterable:"Symbol"in g&&"iterator"in Symbol,blob:"FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in g,arrayBuffer:"ArrayBuffer"in g};function isDataView(e){return e&&DataView.prototype.isPrototypeOf(e)}if(support.arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(e){return e&&viewClasses.indexOf(Object.prototype.toString.call(e))>-1};function normalizeName(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function normalizeValue(e){return typeof e!="string"&&(e=String(e)),e}function iteratorFor(e){var t={next:function(){var r=e.shift();return{done:r===void 0,value:r}}};return support.iterable&&(t[Symbol.iterator]=function(){return t}),t}function Headers(e){this.map={},e instanceof Headers?e.forEach(function(t,r){this.append(r,t)},this):Array.isArray(e)?e.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}Headers.prototype.append=function(e,t){e=normalizeName(e),t=normalizeValue(t);var r=this.map[e];this.map[e]=r?r+", "+t:t};Headers.prototype.delete=function(e){delete this.map[normalizeName(e)]};Headers.prototype.get=function(e){return e=normalizeName(e),this.has(e)?this.map[e]:null};Headers.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))};Headers.prototype.set=function(e,t){this.map[normalizeName(e)]=normalizeValue(t)};Headers.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)};Headers.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),iteratorFor(e)};Headers.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),iteratorFor(e)};Headers.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),iteratorFor(e)};support.iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);function consumed(e){if(!e._noBody){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}}function fileReaderReady(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function readBlobAsArrayBuffer(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsArrayBuffer(e),r}function readBlobAsText(e){var t=new FileReader,r=fileReaderReady(t),n=/charset=([A-Za-z0-9_-]+)/.exec(e.type),a=n?n[1]:"utf-8";return t.readAsText(e,a),r}function readArrayBufferAsText(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function bufferClone(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:support.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:support.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:support.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():support.arrayBuffer&&support.blob&&isDataView(e)?(this._bodyArrayBuffer=bufferClone(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||isArrayBufferView(e))?this._bodyArrayBuffer=bufferClone(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support.blob&&(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=consumed(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(support.blob)return this.blob().then(readBlobAsArrayBuffer);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return readBlobAsText(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support.formData&&(this.formData=function(){return this.text().then(decode$3)}),this.json=function(){return this.text().then(JSON.parse)},this}var methods=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function normalizeMethod(e){var t=e.toUpperCase();return methods.indexOf(t)>-1?t:e}function Request(e,t){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var r=t.body;if(e instanceof Request){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Headers(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!r&&e._bodyInit!=null&&(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new Headers(t.headers)),this.method=normalizeMethod(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in g){var l=new AbortController;return l.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var n=/([?&])_=[^&]*/;if(n.test(this.url))this.url=this.url.replace(n,"$1_="+new Date().getTime());else{var a=/\?/;this.url+=(a.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode$3(e){var t=new FormData;return e.trim().split("&").forEach(function(r){if(r){var n=r.split("="),a=n.shift().replace(/\+/g," "),l=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(l))}}),t}function parseHeaders$2(e){var t=new Headers,r=e.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(n){return n.indexOf(`
`)===0?n.substr(1,n.length):n}).forEach(function(n){var a=n.split(":"),l=a.shift().trim();if(l){var o=a.join(":").trim();try{t.append(l,o)}catch(s){console.warn("Response "+s.message)}}}),t}Body.call(Request.prototype);function Response(e,t){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new Headers(t.headers),this.url=t.url||"",this._initBody(e)}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var e=new Response(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(e,t){if(redirectStatuses.indexOf(t)===-1)throw new RangeError("Invalid status code");return new Response(null,{status:t,headers:{location:e}})};var DOMException=g.DOMException;try{new DOMException}catch{DOMException=function(t,r){this.message=t,this.name=r;var n=Error(t);this.stack=n.stack},DOMException.prototype=Object.create(Error.prototype),DOMException.prototype.constructor=DOMException}function fetch$1(e,t){return new Promise(function(r,n){var a=new Request(e,t);if(a.signal&&a.signal.aborted)return n(new DOMException("Aborted","AbortError"));var l=new XMLHttpRequest;function o(){l.abort()}l.onload=function(){var f={statusText:l.statusText,headers:parseHeaders$2(l.getAllResponseHeaders()||"")};a.url.indexOf("file://")===0&&(l.status<200||l.status>599)?f.status=200:f.status=l.status,f.url="responseURL"in l?l.responseURL:f.headers.get("X-Request-URL");var u="response"in l?l.response:l.responseText;setTimeout(function(){r(new Response(u,f))},0)},l.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"))},0)},l.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request timed out"))},0)},l.onabort=function(){setTimeout(function(){n(new DOMException("Aborted","AbortError"))},0)};function s(f){try{return f===""&&g.location.href?g.location.href:f}catch{return f}}if(l.open(a.method,s(a.url),!0),a.credentials==="include"?l.withCredentials=!0:a.credentials==="omit"&&(l.withCredentials=!1),"responseType"in l&&(support.blob?l.responseType="blob":support.arrayBuffer&&(l.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof Headers||g.Headers&&t.headers instanceof g.Headers)){var h=[];Object.getOwnPropertyNames(t.headers).forEach(function(f){h.push(normalizeName(f)),l.setRequestHeader(f,normalizeValue(t.headers[f]))}),a.headers.forEach(function(f,u){h.indexOf(u)===-1&&l.setRequestHeader(u,f)})}else a.headers.forEach(function(f,u){l.setRequestHeader(u,f)});a.signal&&(a.signal.addEventListener("abort",o),l.onreadystatechange=function(){l.readyState===4&&a.signal.removeEventListener("abort",o)}),l.send(typeof a._bodyInit>"u"?null:a._bodyInit)})}fetch$1.polyfill=!0;g.fetch||(g.fetch=fetch$1,g.Headers=Headers,g.Request=Request,g.Response=Response);self.fetch.bind(self);const request=(e,t)=>{let{url:r,...n}=e;fetch(r,n).then(a=>{if(a.ok)return a.arrayBuffer().catch(l=>{throw new Error(`Response is not a buffer for url ${r}. Error: ${l.message}`)});throw new Error(`HTTP Status ${a.status} for url ${r}`)}).then(a=>t(null,a)).catch(a=>t(a))},AUTO=-1,HORIZONTAL_ALIGN_LEFT=1,HORIZONTAL_ALIGN_CENTER=2,HORIZONTAL_ALIGN_RIGHT=4,VERTICAL_ALIGN_TOP=8,VERTICAL_ALIGN_MIDDLE=16,VERTICAL_ALIGN_BOTTOM=32,BLEND_SOURCE_OVER="srcOver",BLEND_DESTINATION_OVER="dstOver",BLEND_MULTIPLY="multiply",BLEND_ADD="add",BLEND_SCREEN="screen",BLEND_OVERLAY="overlay",BLEND_DARKEN="darken",BLEND_LIGHTEN="lighten",BLEND_HARDLIGHT="hardLight",BLEND_DIFFERENCE="difference",BLEND_EXCLUSION="exclusion",EDGE_EXTEND=1,EDGE_WRAP=2,EDGE_CROP=3,constants$7=Object.freeze(Object.defineProperty({__proto__:null,AUTO,BLEND_ADD,BLEND_DARKEN,BLEND_DESTINATION_OVER,BLEND_DIFFERENCE,BLEND_EXCLUSION,BLEND_HARDLIGHT,BLEND_LIGHTEN,BLEND_MULTIPLY,BLEND_OVERLAY,BLEND_SCREEN,BLEND_SOURCE_OVER,EDGE_CROP,EDGE_EXTEND,EDGE_WRAP,HORIZONTAL_ALIGN_CENTER,HORIZONTAL_ALIGN_LEFT,HORIZONTAL_ALIGN_RIGHT,VERTICAL_ALIGN_BOTTOM,VERTICAL_ALIGN_MIDDLE,VERTICAL_ALIGN_TOP},Symbol.toStringTag,{value:"Module"}));function srcOver(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=(e.r*e.a+t.r*t.a*(1-e.a))/n,l=(e.g*e.a+t.g*t.a*(1-e.a))/n,o=(e.b*e.a+t.b*t.a*(1-e.a))/n;return{r:a,g:l,b:o,a:n}}function dstOver(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=(t.r*t.a+e.r*e.a*(1-t.a))/n,l=(t.g*t.a+e.g*e.a*(1-t.a))/n,o=(t.b*t.a+e.b*e.a*(1-t.a))/n;return{r:a,g:l,b:o,a:n}}function multiply(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(a*s+a*(1-t.a)+s*(1-e.a))/n,d=(l*h+l*(1-t.a)+h*(1-e.a))/n,p=(o*f+o*(1-t.a)+f*(1-e.a))/n;return{r:u,g:d,b:p,a:n}}function add(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(a+s)/n,d=(l+h)/n,p=(o+f)/n;return{r:u,g:d,b:p,a:n}}function screen(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(a*t.a+s*e.a-a*s+a*(1-t.a)+s*(1-e.a))/n,d=(l*t.a+h*e.a-l*h+l*(1-t.a)+h*(1-e.a))/n,p=(o*t.a+f*e.a-o*f+o*(1-t.a)+f*(1-e.a))/n;return{r:u,g:d,b:p,a:n}}function overlay(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(2*s<=t.a?2*a*s+a*(1-t.a)+s*(1-e.a):a*(1+t.a)+s*(1+e.a)-2*s*a-t.a*e.a)/n,d=(2*h<=t.a?2*l*h+l*(1-t.a)+h*(1-e.a):l*(1+t.a)+h*(1+e.a)-2*h*l-t.a*e.a)/n,p=(2*f<=t.a?2*o*f+o*(1-t.a)+f*(1-e.a):o*(1+t.a)+f*(1+e.a)-2*f*o-t.a*e.a)/n;return{r:u,g:d,b:p,a:n}}function darken(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(Math.min(a*t.a,s*e.a)+a*(1-t.a)+s*(1-e.a))/n,d=(Math.min(l*t.a,h*e.a)+l*(1-t.a)+h*(1-e.a))/n,p=(Math.min(o*t.a,f*e.a)+o*(1-t.a)+f*(1-e.a))/n;return{r:u,g:d,b:p,a:n}}function lighten(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(Math.max(a*t.a,s*e.a)+a*(1-t.a)+s*(1-e.a))/n,d=(Math.max(l*t.a,h*e.a)+l*(1-t.a)+h*(1-e.a))/n,p=(Math.max(o*t.a,f*e.a)+o*(1-t.a)+f*(1-e.a))/n;return{r:u,g:d,b:p,a:n}}function hardLight(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(2*a<=e.a?2*a*s+a*(1-t.a)+s*(1-e.a):a*(1+t.a)+s*(1+e.a)-2*s*a-t.a*e.a)/n,d=(2*l<=e.a?2*l*h+l*(1-t.a)+h*(1-e.a):l*(1+t.a)+h*(1+e.a)-2*h*l-t.a*e.a)/n,p=(2*o<=e.a?2*o*f+o*(1-t.a)+f*(1-e.a):o*(1+t.a)+f*(1+e.a)-2*f*o-t.a*e.a)/n;return{r:u,g:d,b:p,a:n}}function difference(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(a+s-2*Math.min(a*t.a,s*e.a))/n,d=(l+h-2*Math.min(l*t.a,h*e.a))/n,p=(o+f-2*Math.min(o*t.a,f*e.a))/n;return{r:u,g:d,b:p,a:n}}function exclusion(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;e.a*=r;const n=t.a+e.a-t.a*e.a,a=e.r*e.a,l=e.g*e.a,o=e.b*e.a,s=t.r*t.a,h=t.g*t.a,f=t.b*t.a,u=(a*t.a+s*e.a-2*a*s+a*(1-t.a)+s*(1-e.a))/n,d=(l*t.a+h*e.a-2*l*h+l*(1-t.a)+h*(1-e.a))/n,p=(o*t.a+f*e.a-2*o*f+o*(1-t.a)+f*(1-e.a))/n;return{r:u,g:d,b:p,a:n}}const compositeModes=Object.freeze(Object.defineProperty({__proto__:null,add,darken,difference,dstOver,exclusion,hardLight,lighten,multiply,overlay,screen,srcOver},Symbol.toStringTag,{value:"Module"}));function composite(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;if(typeof n=="function"&&(a=n,n={}),!(e instanceof this.constructor))return throwError.call(this,"The source must be a Jimp image",a);if(typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",a);let{mode:l,opacitySource:o,opacityDest:s}=n;l||(l=BLEND_SOURCE_OVER),(typeof o!="number"||o<0||o>1)&&(o=1),(typeof s!="number"||s<0||s>1)&&(s=1);const h=compositeModes[l];t=Math.round(t),r=Math.round(r);const f=this;return s!==1&&f.opacity(s),e.scanQuiet(0,0,e.bitmap.width,e.bitmap.height,function(u,d,p){const m=f.getPixelIndex(t+u,r+d,EDGE_CROP);if(m===-1)return;const A=h({r:this.bitmap.data[p+0]/255,g:this.bitmap.data[p+1]/255,b:this.bitmap.data[p+2]/255,a:this.bitmap.data[p+3]/255},{r:f.bitmap.data[m+0]/255,g:f.bitmap.data[m+1]/255,b:f.bitmap.data[m+2]/255,a:f.bitmap.data[m+3]/255},o);f.bitmap.data[m+0]=this.constructor.limit255(A.r*255),f.bitmap.data[m+1]=this.constructor.limit255(A.g*255),f.bitmap.data[m+2]=this.constructor.limit255(A.b*255),f.bitmap.data[m+3]=this.constructor.limit255(A.a*255)}),isNodePattern(a)&&a.call(this,null,this),this}const promisify=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return new Promise((l,o)=>{n.push((s,h)=>{s&&o(s),l(h)}),e.bind(t)(...n)})},mimeTypes={},findType=e=>Object.entries(mimeTypes).find(t=>t[1].includes(e))||[],addType=(e,t)=>{mimeTypes[e]=t},getType=e=>{const t=e.split("/").slice(-1),r=t[t.length-1].split(".").pop();return findType(r)[0]},getExtension=e=>(mimeTypes[e.toLowerCase()]||[])[0];var lib$2={},FsPromise={};Object.defineProperty(FsPromise,"__esModule",{value:!0});FsPromise.readFile=FsPromise.writeFileSync=FsPromise.writeFile=FsPromise.read=FsPromise.open=FsPromise.close=FsPromise.stat=FsPromise.createReadStream=FsPromise.pathExists=void 0;const fs$1=require$$0;FsPromise.pathExists=fs$1.existsSync;FsPromise.createReadStream=fs$1.createReadStream;async function stat(e){return new Promise((t,r)=>{fs$1.stat(e,(n,a)=>{n?r(n):t(a)})})}FsPromise.stat=stat;async function close(e){return new Promise((t,r)=>{fs$1.close(e,n=>{n?r(n):t()})})}FsPromise.close=close;async function open(e,t){return new Promise((r,n)=>{fs$1.open(e,t,(a,l)=>{a?n(a):r(l)})})}FsPromise.open=open;async function read(e,t,r,n,a){return new Promise((l,o)=>{fs$1.read(e,t,r,n,a,(s,h,f)=>{s?o(s):l({bytesRead:h,buffer:f})})})}FsPromise.read=read;async function writeFile(e,t){return new Promise((r,n)=>{fs$1.writeFile(e,t,a=>{a?n(a):r()})})}FsPromise.writeFile=writeFile;function writeFileSync(e,t){fs$1.writeFileSync(e,t)}FsPromise.writeFileSync=writeFileSync;async function readFile(e){return new Promise((t,r)=>{fs$1.readFile(e,(n,a)=>{n?r(n):t(a)})})}FsPromise.readFile=readFile;var core$2={},ReadStreamTokenizer$1={},AbstractTokenizer$1={},lib$1={},EndOfFileStream={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EndOfStreamError=e.defaultMessages=void 0,e.defaultMessages="End-Of-Stream";class t extends Error{constructor(){super(e.defaultMessages)}}e.EndOfStreamError=t})(EndOfFileStream);var StreamReader={},Deferred$1={};Object.defineProperty(Deferred$1,"__esModule",{value:!0});Deferred$1.Deferred=void 0;class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((t,r)=>{this.reject=r,this.resolve=t})}}Deferred$1.Deferred=Deferred;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;const t=EndOfFileStream,r=Deferred$1;var n=EndOfFileStream;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return n.EndOfStreamError}});const a=1*1024*1024;class l{constructor(s){if(this.s=s,this.deferred=null,this.endOfStream=!1,this.peekQueue=[],!s.read||!s.once)throw new Error("Expected an instance of stream.Readable");this.s.once("end",()=>this.reject(new t.EndOfStreamError)),this.s.once("error",h=>this.reject(h)),this.s.once("close",()=>this.reject(new Error("Stream closed")))}async peek(s,h,f){const u=await this.read(s,h,f);return this.peekQueue.push(s.subarray(h,h+u)),u}async read(s,h,f){if(f===0)return 0;if(this.peekQueue.length===0&&this.endOfStream)throw new t.EndOfStreamError;let u=f,d=0;for(;this.peekQueue.length>0&&u>0;){const p=this.peekQueue.pop();if(!p)throw new Error("peekData should be defined");const m=Math.min(p.length,u);s.set(p.subarray(0,m),h+d),d+=m,u-=m,m<p.length&&this.peekQueue.push(p.subarray(m))}for(;u>0&&!this.endOfStream;){const p=Math.min(u,a),m=await this.readFromStream(s,h+d,p);if(d+=m,m<p)break;u-=m}return d}async readFromStream(s,h,f){const u=this.s.read(f);if(u)return s.set(u,h),u.length;{const d={buffer:s,offset:h,length:f,deferred:new r.Deferred};return this.deferred=d.deferred,this.s.once("readable",()=>{this.readDeferred(d)}),d.deferred.promise}}readDeferred(s){const h=this.s.read(s.length);h?(s.buffer.set(h,s.offset),s.deferred.resolve(h.length),this.deferred=null):this.s.once("readable",()=>{this.readDeferred(s)})}reject(s){this.endOfStream=!0,this.deferred&&(this.deferred.reject(s),this.deferred=null)}}e.StreamReader=l})(StreamReader);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.StreamReader=e.EndOfStreamError=void 0;var t=EndOfFileStream;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return t.EndOfStreamError}});var r=StreamReader;Object.defineProperty(e,"StreamReader",{enumerable:!0,get:function(){return r.StreamReader}})})(lib$1);Object.defineProperty(AbstractTokenizer$1,"__esModule",{value:!0});AbstractTokenizer$1.AbstractTokenizer=void 0;const peek_readable_1$3=lib$1;class AbstractTokenizer{constructor(t){this.position=0,this.numBuffer=new Uint8Array(8),this.fileInfo=t||{}}async readToken(t,r=this.position){const n=Buffer.alloc(t.len);if(await this.readBuffer(n,{position:r})<t.len)throw new peek_readable_1$3.EndOfStreamError;return t.get(n,0)}async peekToken(t,r=this.position){const n=Buffer.alloc(t.len);if(await this.peekBuffer(n,{position:r})<t.len)throw new peek_readable_1$3.EndOfStreamError;return t.get(n,0)}async readNumber(t){if(await this.readBuffer(this.numBuffer,{length:t.len})<t.len)throw new peek_readable_1$3.EndOfStreamError;return t.get(this.numBuffer,0)}async peekNumber(t){if(await this.peekBuffer(this.numBuffer,{length:t.len})<t.len)throw new peek_readable_1$3.EndOfStreamError;return t.get(this.numBuffer,0)}async ignore(t){if(this.fileInfo.size!==void 0){const r=this.fileInfo.size-this.position;if(t>r)return this.position+=r,r}return this.position+=t,t}async close(){}normalizeOptions(t,r){if(r&&r.position!==void 0&&r.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return r?{mayBeLess:r.mayBeLess===!0,offset:r.offset?r.offset:0,length:r.length?r.length:t.length-(r.offset?r.offset:0),position:r.position?r.position:this.position}:{mayBeLess:!1,offset:0,length:t.length,position:this.position}}}AbstractTokenizer$1.AbstractTokenizer=AbstractTokenizer;Object.defineProperty(ReadStreamTokenizer$1,"__esModule",{value:!0});ReadStreamTokenizer$1.ReadStreamTokenizer=void 0;const AbstractTokenizer_1$2=AbstractTokenizer$1,peek_readable_1$2=lib$1,maxBufferSize=256e3;class ReadStreamTokenizer extends AbstractTokenizer_1$2.AbstractTokenizer{constructor(t,r){super(r),this.streamReader=new peek_readable_1$2.StreamReader(t)}async getFileInfo(){return this.fileInfo}async readBuffer(t,r){const n=this.normalizeOptions(t,r),a=n.position-this.position;if(a>0)return await this.ignore(a),this.readBuffer(t,r);if(a<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(n.length===0)return 0;const l=await this.streamReader.read(t,n.offset,n.length);if(this.position+=l,(!r||!r.mayBeLess)&&l<n.length)throw new peek_readable_1$2.EndOfStreamError;return l}async peekBuffer(t,r){const n=this.normalizeOptions(t,r);let a=0;if(n.position){const l=n.position-this.position;if(l>0){const o=new Uint8Array(n.length+l);return a=await this.peekBuffer(o,{mayBeLess:n.mayBeLess}),t.set(o.subarray(l),n.offset),a-l}else if(l<0)throw new Error("Cannot peek from a negative offset in a stream")}if(n.length>0){try{a=await this.streamReader.peek(t,n.offset,n.length)}catch(l){if(r&&r.mayBeLess&&l instanceof peek_readable_1$2.EndOfStreamError)return 0;throw l}if(!n.mayBeLess&&a<n.length)throw new peek_readable_1$2.EndOfStreamError}return a}async ignore(t){const r=Math.min(maxBufferSize,t),n=new Uint8Array(r);let a=0;for(;a<t;){const l=t-a,o=await this.readBuffer(n,{length:Math.min(r,l)});if(o<0)return o;a+=o}return a}}ReadStreamTokenizer$1.ReadStreamTokenizer=ReadStreamTokenizer;var BufferTokenizer$1={};Object.defineProperty(BufferTokenizer$1,"__esModule",{value:!0});BufferTokenizer$1.BufferTokenizer=void 0;const peek_readable_1$1=lib$1,AbstractTokenizer_1$1=AbstractTokenizer$1;class BufferTokenizer extends AbstractTokenizer_1$1.AbstractTokenizer{constructor(t,r){super(r),this.uint8Array=t,this.fileInfo.size=this.fileInfo.size?this.fileInfo.size:t.length}async readBuffer(t,r){if(r&&r.position){if(r.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=r.position}const n=await this.peekBuffer(t,r);return this.position+=n,n}async peekBuffer(t,r){const n=this.normalizeOptions(t,r),a=Math.min(this.uint8Array.length-n.position,n.length);if(!n.mayBeLess&&a<n.length)throw new peek_readable_1$1.EndOfStreamError;return t.set(this.uint8Array.subarray(n.position,n.position+a),n.offset),a}async close(){}}BufferTokenizer$1.BufferTokenizer=BufferTokenizer;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromBuffer=e.fromStream=e.EndOfStreamError=void 0;const t=ReadStreamTokenizer$1,r=BufferTokenizer$1;var n=lib$1;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return n.EndOfStreamError}});function a(o,s){return s=s||{},new t.ReadStreamTokenizer(o,s)}e.fromStream=a;function l(o,s){return new r.BufferTokenizer(o,s)}e.fromBuffer=l})(core$2);var FileTokenizer$1={};Object.defineProperty(FileTokenizer$1,"__esModule",{value:!0});FileTokenizer$1.fromFile=FileTokenizer$1.FileTokenizer=void 0;const AbstractTokenizer_1=AbstractTokenizer$1,peek_readable_1=lib$1,fs=FsPromise;class FileTokenizer extends AbstractTokenizer_1.AbstractTokenizer{constructor(t,r){super(r),this.fd=t}async readBuffer(t,r){const n=this.normalizeOptions(t,r);this.position=n.position;const a=await fs.read(this.fd,t,n.offset,n.length,n.position);if(this.position+=a.bytesRead,a.bytesRead<n.length&&(!r||!r.mayBeLess))throw new peek_readable_1.EndOfStreamError;return a.bytesRead}async peekBuffer(t,r){const n=this.normalizeOptions(t,r),a=await fs.read(this.fd,t,n.offset,n.length,n.position);if(!n.mayBeLess&&a.bytesRead<n.length)throw new peek_readable_1.EndOfStreamError;return a.bytesRead}async close(){return fs.close(this.fd)}}FileTokenizer$1.FileTokenizer=FileTokenizer;async function fromFile$1(e){const t=await fs.stat(e);if(!t.isFile)throw new Error(`File not a file: ${e}`);const r=await fs.open(e,"r");return new FileTokenizer(r,{path:e,size:t.size})}FileTokenizer$1.fromFile=fromFile$1;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.fromStream=e.fromBuffer=e.EndOfStreamError=e.fromFile=void 0;const t=FsPromise,r=core$2;var n=FileTokenizer$1;Object.defineProperty(e,"fromFile",{enumerable:!0,get:function(){return n.fromFile}});var a=core$2;Object.defineProperty(e,"EndOfStreamError",{enumerable:!0,get:function(){return a.EndOfStreamError}}),Object.defineProperty(e,"fromBuffer",{enumerable:!0,get:function(){return a.fromBuffer}});async function l(o,s){if(s=s||{},o.path){const h=await t.stat(o.path);s.path=o.path,s.size=h.size}return r.fromStream(o,s)}e.fromStream=l})(lib$2);var lib={},ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(e,t,r,n,a){var l,o,s=a*8-n-1,h=(1<<s)-1,f=h>>1,u=-7,d=r?a-1:0,p=r?-1:1,m=e[t+d];for(d+=p,l=m&(1<<-u)-1,m>>=-u,u+=s;u>0;l=l*256+e[t+d],d+=p,u-=8);for(o=l&(1<<-u)-1,l>>=-u,u+=n;u>0;o=o*256+e[t+d],d+=p,u-=8);if(l===0)l=1-f;else{if(l===h)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),l=l-f}return(m?-1:1)*o*Math.pow(2,l-n)};ieee754.write=function(e,t,r,n,a,l){var o,s,h,f=l*8-a-1,u=(1<<f)-1,d=u>>1,p=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:l-1,A=n?1:-1,k=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+d>=1?t+=p/h:t+=p*Math.pow(2,1-d),t*h>=2&&(o++,h/=2),o+d>=u?(s=0,o=u):o+d>=1?(s=(t*h-1)*Math.pow(2,a),o=o+d):(s=t*Math.pow(2,d-1)*Math.pow(2,a),o=0));a>=8;e[r+m]=s&255,m+=A,s/=256,a-=8);for(o=o<<a|s,f+=a;f>0;e[r+m]=o&255,m+=A,o/=256,f-=8);e[r+m-A]|=k*128};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AnsiStringType=e.StringType=e.BufferType=e.Uint8ArrayType=e.IgnoreType=e.Float80_LE=e.Float80_BE=e.Float64_LE=e.Float64_BE=e.Float32_LE=e.Float32_BE=e.Float16_LE=e.Float16_BE=e.INT64_BE=e.UINT64_BE=e.INT64_LE=e.UINT64_LE=e.INT32_LE=e.INT32_BE=e.INT24_BE=e.INT24_LE=e.INT16_LE=e.INT16_BE=e.INT8=e.UINT32_BE=e.UINT32_LE=e.UINT24_BE=e.UINT24_LE=e.UINT16_BE=e.UINT16_LE=e.UINT8=void 0;const t=ieee754;function r(h){return new DataView(h.buffer,h.byteOffset)}e.UINT8={len:1,get(h,f){return r(h).getUint8(f)},put(h,f,u){return r(h).setUint8(f,u),f+1}},e.UINT16_LE={len:2,get(h,f){return r(h).getUint16(f,!0)},put(h,f,u){return r(h).setUint16(f,u,!0),f+2}},e.UINT16_BE={len:2,get(h,f){return r(h).getUint16(f)},put(h,f,u){return r(h).setUint16(f,u),f+2}},e.UINT24_LE={len:3,get(h,f){const u=r(h);return u.getUint8(f)+(u.getUint16(f+1,!0)<<8)},put(h,f,u){const d=r(h);return d.setUint8(f,u&255),d.setUint16(f+1,u>>8,!0),f+3}},e.UINT24_BE={len:3,get(h,f){const u=r(h);return(u.getUint16(f)<<8)+u.getUint8(f+2)},put(h,f,u){const d=r(h);return d.setUint16(f,u>>8),d.setUint8(f+2,u&255),f+3}},e.UINT32_LE={len:4,get(h,f){return r(h).getUint32(f,!0)},put(h,f,u){return r(h).setUint32(f,u,!0),f+4}},e.UINT32_BE={len:4,get(h,f){return r(h).getUint32(f)},put(h,f,u){return r(h).setUint32(f,u),f+4}},e.INT8={len:1,get(h,f){return r(h).getInt8(f)},put(h,f,u){return r(h).setInt8(f,u),f+1}},e.INT16_BE={len:2,get(h,f){return r(h).getInt16(f)},put(h,f,u){return r(h).setInt16(f,u),f+2}},e.INT16_LE={len:2,get(h,f){return r(h).getInt16(f,!0)},put(h,f,u){return r(h).setInt16(f,u,!0),f+2}},e.INT24_LE={len:3,get(h,f){const u=e.UINT24_LE.get(h,f);return u>8388607?u-16777216:u},put(h,f,u){const d=r(h);return d.setUint8(f,u&255),d.setUint16(f+1,u>>8,!0),f+3}},e.INT24_BE={len:3,get(h,f){const u=e.UINT24_BE.get(h,f);return u>8388607?u-16777216:u},put(h,f,u){const d=r(h);return d.setUint16(f,u>>8),d.setUint8(f+2,u&255),f+3}},e.INT32_BE={len:4,get(h,f){return r(h).getInt32(f)},put(h,f,u){return r(h).setInt32(f,u),f+4}},e.INT32_LE={len:4,get(h,f){return r(h).getInt32(f,!0)},put(h,f,u){return r(h).setInt32(f,u,!0),f+4}},e.UINT64_LE={len:8,get(h,f){return r(h).getBigUint64(f,!0)},put(h,f,u){return r(h).setBigUint64(f,u,!0),f+8}},e.INT64_LE={len:8,get(h,f){return r(h).getBigInt64(f,!0)},put(h,f,u){return r(h).setBigInt64(f,u,!0),f+8}},e.UINT64_BE={len:8,get(h,f){return r(h).getBigUint64(f)},put(h,f,u){return r(h).setBigUint64(f,u),f+8}},e.INT64_BE={len:8,get(h,f){return r(h).getBigInt64(f)},put(h,f,u){return r(h).setBigInt64(f,u),f+8}},e.Float16_BE={len:2,get(h,f){return t.read(h,f,!1,10,this.len)},put(h,f,u){return t.write(h,u,f,!1,10,this.len),f+this.len}},e.Float16_LE={len:2,get(h,f){return t.read(h,f,!0,10,this.len)},put(h,f,u){return t.write(h,u,f,!0,10,this.len),f+this.len}},e.Float32_BE={len:4,get(h,f){return r(h).getFloat32(f)},put(h,f,u){return r(h).setFloat32(f,u),f+4}},e.Float32_LE={len:4,get(h,f){return r(h).getFloat32(f,!0)},put(h,f,u){return r(h).setFloat32(f,u,!0),f+4}},e.Float64_BE={len:8,get(h,f){return r(h).getFloat64(f)},put(h,f,u){return r(h).setFloat64(f,u),f+8}},e.Float64_LE={len:8,get(h,f){return r(h).getFloat64(f,!0)},put(h,f,u){return r(h).setFloat64(f,u,!0),f+8}},e.Float80_BE={len:10,get(h,f){return t.read(h,f,!1,63,this.len)},put(h,f,u){return t.write(h,u,f,!1,63,this.len),f+this.len}},e.Float80_LE={len:10,get(h,f){return t.read(h,f,!0,63,this.len)},put(h,f,u){return t.write(h,u,f,!0,63,this.len),f+this.len}};class n{constructor(f){this.len=f}get(f,u){}}e.IgnoreType=n;class a{constructor(f){this.len=f}get(f,u){return f.subarray(u,u+this.len)}}e.Uint8ArrayType=a;class l{constructor(f){this.len=f}get(f,u){return Buffer.from(f.subarray(u,u+this.len))}}e.BufferType=l;class o{constructor(f,u){this.len=f,this.encoding=u}get(f,u){return Buffer.from(f).toString(this.encoding,u,u+this.len)}}e.StringType=o;class s{constructor(f){this.len=f}static decode(f,u,d){let p="";for(let m=u;m<d;++m)p+=s.codePointToString(s.singleByteDecoder(f[m]));return p}static inRange(f,u,d){return u<=f&&f<=d}static codePointToString(f){return f<=65535?String.fromCharCode(f):(f-=65536,String.fromCharCode((f>>10)+55296,(f&1023)+56320))}static singleByteDecoder(f){if(s.inRange(f,0,127))return f;const u=s.windows1252[f-128];if(u===null)throw Error("invaliding encoding");return u}get(f,u=0){return s.decode(f,u,u+this.len)}}e.AnsiStringType=s,s.windows1252=[8364,129,8218,402,8222,8230,8224,8225,710,8240,352,8249,338,141,381,143,144,8216,8217,8220,8221,8226,8211,8212,732,8482,353,8250,339,157,382,376,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]})(lib);var util$5={};util$5.stringToBytes=e=>[...e].map(t=>t.charCodeAt(0));util$5.tarHeaderChecksumMatches=(e,t=0)=>{const r=parseInt(e.toString("utf8",148,154).replace(/\0.*$/,"").trim(),8);if(isNaN(r))return!1;let n=8*32;for(let a=t;a<t+148;a++)n+=e[a];for(let a=t+156;a<t+512;a++)n+=e[a];return r===n};util$5.uint32SyncSafeToken={get:(e,t)=>e[t+3]&127|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4};var supported$1={extensions:["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf"],mimeTypes:["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/vnd.wave","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","audio/opus","video/ogg","audio/ogg","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd"]};const Token=lib,strtok3$1=core$2,{stringToBytes,tarHeaderChecksumMatches,uint32SyncSafeToken}=util$5,supported=supported$1,minimumBytes=4100;async function fromStream(e){const t=await strtok3$1.fromStream(e);try{return await fromTokenizer(t)}finally{await t.close()}}async function fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer||Buffer.isBuffer(e)))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`Buffer\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Buffer?e:Buffer.from(e);if(!(t&&t.length>1))return;const r=strtok3$1.fromBuffer(t);return fromTokenizer(r)}function _check(e,t,r){r={offset:0,...r};for(const[n,a]of t.entries())if(r.mask){if(a!==(r.mask[n]&e[n+r.offset]))return!1}else if(a!==e[n+r.offset])return!1;return!0}async function fromTokenizer(e){try{return _fromTokenizer(e)}catch(t){if(!(t instanceof strtok3$1.EndOfStreamError))throw t}}async function _fromTokenizer(e){let t=Buffer.alloc(minimumBytes);const r=12,n=(l,o)=>_check(t,l,o),a=(l,o)=>n(stringToBytes(l),o);if(e.fileInfo.size||(e.fileInfo.size=Number.MAX_SAFE_INTEGER),await e.peekBuffer(t,{length:r,mayBeLess:!0}),n([66,77]))return{ext:"bmp",mime:"image/bmp"};if(n([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(n([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(n([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(n([37,33]))return await e.peekBuffer(t,{length:24,mayBeLess:!0}),a("PS-Adobe-",{offset:2})&&a(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(n([31,160])||n([31,157]))return{ext:"Z",mime:"application/x-compress"};if(n([255,216,255]))return{ext:"jpg",mime:"image/jpeg"};if(n([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(n([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(n([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(a("ID3")){await e.ignore(6);const l=await e.readToken(uint32SyncSafeToken);return e.position+l>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(l),fromTokenizer(e))}if(a("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((t[0]===67||t[0]===70)&&n([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(n([71,73,70]))return{ext:"gif",mime:"image/gif"};if(a("FLIF"))return{ext:"flif",mime:"image/flif"};if(a("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(a("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(a("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(a("FORM"))return{ext:"aif",mime:"audio/aiff"};if(a("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(n([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(t,{length:30});const l={compressedSize:t.readUInt32LE(18),uncompressedSize:t.readUInt32LE(22),filenameLength:t.readUInt16LE(26),extraFieldLength:t.readUInt16LE(28)};if(l.filename=await e.readToken(new Token.StringType(l.filenameLength,"utf-8")),await e.ignore(l.extraFieldLength),l.filename==="META-INF/mozilla.rsa")return{ext:"xpi",mime:"application/x-xpinstall"};if(l.filename.endsWith(".rels")||l.filename.endsWith(".xml"))switch(l.filename.split("/")[0]){case"_rels":break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};default:break}if(l.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(l.filename.startsWith("3D/")&&l.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if(l.filename==="mimetype"&&l.compressedSize===l.uncompressedSize)switch(await e.readToken(new Token.StringType(l.compressedSize,"utf-8"))){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"};default:}if(l.compressedSize===0){let o=-1;for(;o<0&&e.position<e.fileInfo.size;)await e.peekBuffer(t,{mayBeLess:!0}),o=t.indexOf("504B0304",0,"hex"),await e.ignore(o>=0?o:t.length)}else await e.ignore(l.compressedSize)}}catch(l){if(!(l instanceof strtok3$1.EndOfStreamError))throw l}return{ext:"zip",mime:"application/zip"}}if(a("OggS")){await e.ignore(28);const l=Buffer.alloc(8);return await e.readBuffer(l),_check(l,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/opus"}:_check(l,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:_check(l,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:_check(l,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:_check(l,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:_check(l,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(n([80,75])&&(t[2]===3||t[2]===5||t[2]===7)&&(t[3]===4||t[3]===6||t[3]===8))return{ext:"zip",mime:"application/zip"};if(a("ftyp",{offset:4})&&t[8]&96){const l=t.toString("binary",8,12).replace("\0"," ").trim();switch(l){case"avif":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return l.startsWith("3g")?l.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(a("MThd"))return{ext:"mid",mime:"audio/midi"};if(a("wOFF")&&(n([0,1,0,0],{offset:4})||a("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(a("wOF2")&&(n([0,1,0,0],{offset:4})||a("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(n([212,195,178,161])||n([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(a("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(a("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(a("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(n([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(a("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(a("%PDF")){await e.ignore(1350);const l=10*1024*1024,o=Buffer.alloc(Math.min(l,e.fileInfo.size));return await e.readBuffer(o,{mayBeLess:!0}),o.includes(Buffer.from("AIPrivateData"))?{ext:"ai",mime:"application/postscript"}:{ext:"pdf",mime:"application/pdf"}}if(n([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(n([73,73,42,0]))return a("CR",{offset:8})?{ext:"cr2",mime:"image/x-canon-cr2"}:n([28,0,254,0],{offset:8})||n([31,0,11,0],{offset:8})?{ext:"nef",mime:"image/x-nikon-nef"}:n([8,0,0,0],{offset:4})&&(n([45,0,254,0],{offset:8})||n([39,0,254,0],{offset:8}))?{ext:"dng",mime:"image/x-adobe-dng"}:(t=Buffer.alloc(24),await e.peekBuffer(t),(n([16,251,134,1],{offset:4})||n([8,0,0,0],{offset:4}))&&n([0,254,0,4,0,1,0,0,0,1,0,0,0,3,1],{offset:9})?{ext:"arw",mime:"image/x-sony-arw"}:{ext:"tif",mime:"image/tiff"});if(n([77,77,0,42]))return{ext:"tif",mime:"image/tiff"};if(a("MAC "))return{ext:"ape",mime:"audio/ape"};if(n([26,69,223,163])){async function l(){const u=await e.peekNumber(Token.UINT8);let d=128,p=0;for(;!(u&d)&&d!==0;)++p,d>>=1;const m=Buffer.alloc(p+1);return await e.readBuffer(m),m}async function o(){const u=await l(),d=await l();d[0]^=128>>d.length-1;const p=Math.min(6,d.length);return{id:u.readUIntBE(0,u.length),len:d.readUIntBE(d.length-p,p)}}async function s(u,d){for(;d>0;){const p=await o();if(p.id===17026)return e.readToken(new Token.StringType(p.len,"utf-8"));await e.ignore(p.len),--d}}const h=await o();switch(await s(1,h.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(n([82,73,70,70])){if(n([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(n([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/vnd.wave"};if(n([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(a("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(n([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(a("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(a("MSCF")||a("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(n([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(n([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(n([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(n([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(a("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(a("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(n([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(a("IMPM"))return{ext:"it",mime:"audio/x-it"};if(a("-lh0-",{offset:2})||a("-lh1-",{offset:2})||a("-lh2-",{offset:2})||a("-lh3-",{offset:2})||a("-lh4-",{offset:2})||a("-lh5-",{offset:2})||a("-lh6-",{offset:2})||a("-lh7-",{offset:2})||a("-lzs-",{offset:2})||a("-lz4-",{offset:2})||a("-lz5-",{offset:2})||a("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(n([0,0,1,186])){if(n([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(n([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(a("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(n([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(a("<?xml "))return{ext:"xml",mime:"application/xml"};if(n([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(n([82,97,114,33,26,7])&&(t[6]===0||t[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(a("solid "))return{ext:"stl",mime:"model/stl"};if(a("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(a("!<arch>"))return await e.ignore(8),await e.readToken(new Token.StringType(13,"ascii"))==="debian-binary"?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(n([137,80,78,71,13,10,26,10])){await e.ignore(8);async function l(){return{length:await e.readToken(Token.INT32_BE),type:await e.readToken(new Token.StringType(4,"binary"))}}do{const o=await l();if(o.length<0)return;switch(o.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(o.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(n([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(n([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(n([102,114,101,101],{offset:4})||n([109,100,97,116],{offset:4})||n([109,111,111,118],{offset:4})||n([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(n([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(a("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(n([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(n([48,38,178,117,142,102,207,17,166,217])){async function l(){const o=Buffer.alloc(16);return await e.readBuffer(o),{id:o,size:Number(await e.readToken(Token.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const o=await l();let s=o.size-24;if(_check(o.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const h=Buffer.alloc(16);if(s-=await e.readBuffer(h),_check(h,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(h,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(s)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(n([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((n([126,16,4])||n([126,24,4]))&&n([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(n([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(n([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new Token.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(n([255,10])||n([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(n([0,0,1,186])||n([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(n([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(n([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(n([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(n([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(t,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),a("BEGIN:")){if(a("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(a("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(a("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(a("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(a("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(n([4,0,0,0])&&t.length>=16){const l=t.readUInt32LE(12);if(l>12&&t.length>=l+16)try{const o=t.slice(16,l+16).toString();if(JSON.parse(o).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(n([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(a("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(n([71],{offset:4})&&(n([71],{offset:192})||n([71],{offset:196})))return{ext:"mts",mime:"video/mp2t"};if(n([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(n([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(n([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(n([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(n([76,80],{offset:34})&&(n([0,0,1],{offset:8})||n([1,0,2],{offset:8})||n([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(n([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(t,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),tarHeaderChecksumMatches(t))return{ext:"tar",mime:"application/x-tar"};if(n([255,254,255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0]))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(a("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(t.length>=2&&n([255,224],{offset:0,mask:[255,224]})){if(n([16],{offset:1,mask:[22]}))return n([8],{offset:1,mask:[8]})?{ext:"aac",mime:"audio/aac"}:{ext:"aac",mime:"audio/aac"};if(n([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(n([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(n([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}const stream=readableStream=>new Promise((resolve,reject)=>{const stream=eval("require")("stream");readableStream.on("error",reject),readableStream.once("readable",async()=>{const e=new stream.PassThrough;let t;stream.pipeline?t=stream.pipeline(readableStream,e,()=>{}):t=readableStream.pipe(e);const r=readableStream.read(minimumBytes)||readableStream.read()||Buffer.alloc(0);try{const n=await fromBuffer(r);e.fileType=n}catch(n){reject(n)}resolve(t)})}),fileType$1={fromStream,fromTokenizer,fromBuffer,stream};Object.defineProperty(fileType$1,"extensions",{get(){return new Set(supported.extensions)}});Object.defineProperty(fileType$1,"mimeTypes",{get(){return new Set(supported.mimeTypes)}});var core$1=fileType$1;const strtok3=lib$2,core=core$1;async function fromFile(e){const t=await strtok3.fromFile(e);try{return await core.fromTokenizer(t)}finally{await t.close()}}const fileType={fromFile};Object.assign(fileType,core);Object.defineProperty(fileType,"extensions",{get(){return core.extensions}});Object.defineProperty(fileType,"mimeTypes",{get(){return core.mimeTypes}});var fileType_1=fileType;const FileType=getDefaultExportFromCjs(fileType_1);var jpeg$2={parseSections:function(e,t){var r,n;for(e.setBigEndian(!0);e.remainingLength()>0&&n!==218;){if(e.nextUInt8()!==255)throw new Error("Invalid JPEG section offset");n=e.nextUInt8(),n>=208&&n<=217||n===218?r=0:r=e.nextUInt16()-2,t(n,e.branch(0,r)),e.skip(r)}},getSizeFromSOFSection:function(e){return e.skip(1),{height:e.nextUInt16(),width:e.nextUInt16()}},getSectionName:function(e){var t,r;switch(e){case 216:t="SOI";break;case 196:t="DHT";break;case 219:t="DQT";break;case 221:t="DRI";break;case 218:t="SOS";break;case 254:t="COM";break;case 217:t="EOI";break;default:e>=224&&e<=239?(t="APP",r=e-224):e>=192&&e<=207&&e!==196&&e!==200&&e!==204?(t="SOF",r=e-192):e>=208&&e<=215&&(t="RST",r=e-208);break}var n={name:t};return typeof r=="number"&&(n.index=r),n}};function readExifValue(e,t){switch(e){case 1:return t.nextUInt8();case 3:return t.nextUInt16();case 4:return t.nextUInt32();case 5:return[t.nextUInt32(),t.nextUInt32()];case 6:return t.nextInt8();case 8:return t.nextUInt16();case 9:return t.nextUInt32();case 10:return[t.nextInt32(),t.nextInt32()];case 11:return t.nextFloat();case 12:return t.nextDouble();default:throw new Error("Invalid format while decoding: "+e)}}function getBytesPerComponent(e){switch(e){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}}function readExifTag(e,t){var r=t.nextUInt16(),n=t.nextUInt16(),a=getBytesPerComponent(n),l=t.nextUInt32(),o=a*l,s,h;if(o>4&&(t=e.openWithOffset(t.nextUInt32())),n===2){s=t.nextString(l);var f=s.indexOf("\0");f!==-1&&(s=s.substr(0,f))}else if(n===7)s=t.nextBuffer(l);else if(n!==0)for(s=[],h=0;h<l;++h)s.push(readExifValue(n,t));return o<4&&t.skip(4-o),[r,s,n]}function readIFDSection(e,t,r){var n=t.nextUInt16(),a,l;for(l=0;l<n;++l)a=readExifTag(e,t),r(a[0],a[1],a[2])}function readHeader(e){var t=e.nextString(6);if(t!=="Exif\0\0")throw new Error("Invalid EXIF header");var r=e.mark(),n=e.nextUInt16();if(n===18761)e.setBigEndian(!1);else if(n===19789)e.setBigEndian(!0);else throw new Error("Invalid TIFF header");if(e.nextUInt16()!==42)throw new Error("Invalid TIFF data");return r}var exif$2={IFD0:1,IFD1:2,GPSIFD:3,SubIFD:4,InteropIFD:5,parseTags:function(e,t){var r;try{r=readHeader(e)}catch{return!1}var n,a,l,o=r.openWithOffset(e.nextUInt32()),s=this.IFD0;readIFDSection(r,o,function(A,k,I){switch(A){case 34853:a=k[0];break;case 34665:n=k[0];break;default:t(s,A,k,I);break}});var h=o.nextUInt32();if(h!==0){var f=r.openWithOffset(h);readIFDSection(r,f,t.bind(null,this.IFD1))}if(a){var u=r.openWithOffset(a);readIFDSection(r,u,t.bind(null,this.GPSIFD))}if(n){var d=r.openWithOffset(n),p=this.InteropIFD;readIFDSection(r,d,function(A,k,I){A===40965?l=k[0]:t(p,A,k,I)})}if(l){var m=r.openWithOffset(l);readIFDSection(r,m,t.bind(null,this.InteropIFD))}return!0}};function parseNumber(e){return parseInt(e,10)}var hours=3600,minutes=60;function parseDateTimeParts(e,t){e=e.map(parseNumber),t=t.map(parseNumber);var r=e[0],n=e[1]-1,a=e[2],l=t[0],o=t[1],s=t[2],h=Date.UTC(r,n,a,l,o,s,0),f=h/1e3;return f}function parseDateWithTimezoneFormat(e){var t=e.substr(0,10).split("-"),r=e.substr(11,8).split(":"),n=e.substr(19,6),a=n.split(":").map(parseNumber),l=a[0]*hours+a[1]*minutes,o=parseDateTimeParts(t,r);if(o-=l,typeof o=="number"&&!isNaN(o))return o}function parseDateWithSpecFormat(e){var t=e.split(" "),r=t[0].split(":"),n=t[1].split(":"),a=parseDateTimeParts(r,n);if(typeof a=="number"&&!isNaN(a))return a}function parseExifDate(e){var t=e.length===19&&e.charAt(4)===":",r=e.length===25&&e.charAt(10)==="T";if(r)return parseDateWithTimezoneFormat(e);if(t)return parseDateWithSpecFormat(e)}var date$1={parseDateWithSpecFormat,parseDateWithTimezoneFormat,parseExifDate},exif$1=exif$2,date=date$1,degreeTags=[{section:exif$1.GPSIFD,type:2,name:"GPSLatitude",refType:1,refName:"GPSLatitudeRef",posVal:"N"},{section:exif$1.GPSIFD,type:4,name:"GPSLongitude",refType:3,refName:"GPSLongitudeRef",posVal:"E"}],dateTags=[{section:exif$1.SubIFD,type:306,name:"ModifyDate"},{section:exif$1.SubIFD,type:36867,name:"DateTimeOriginal"},{section:exif$1.SubIFD,type:36868,name:"CreateDate"},{section:exif$1.SubIFD,type:306,name:"ModifyDate"}],simplify$1={castDegreeValues:function(e,t){degreeTags.forEach(function(r){var n=e(r);if(n){var a=e({section:r.section,type:r.refType,name:r.refName}),l=a===r.posVal?1:-1,o=(n[0]+n[1]/60+n[2]/3600)*l;t(r,o)}})},castDateValues:function(e,t){dateTags.forEach(function(r){var n=e(r);if(n){var a=date.parseExifDate(n);typeof a<"u"&&t(r,a)}})},simplifyValue:function(e,t){return Array.isArray(e)&&(e=e.map(function(r){return t===10||t===5?r[0]/r[1]:r}),e.length===1&&(e=e[0])),e}},exifTags,hasRequiredExifTags;function requireExifTags(){return hasRequiredExifTags||(hasRequiredExifTags=1,exifTags={exif:{1:"InteropIndex",2:"InteropVersion",11:"ProcessingSoftware",254:"SubfileType",255:"OldSubfileType",256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",263:"Thresholding",264:"CellWidth",265:"CellLength",266:"FillOrder",269:"DocumentName",270:"ImageDescription",271:"Make",272:"Model",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",280:"MinSampleValue",281:"MaxSampleValue",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",285:"PageName",286:"XPosition",287:"YPosition",288:"FreeOffsets",289:"FreeByteCounts",290:"GrayResponseUnit",291:"GrayResponseCurve",292:"T4Options",293:"T6Options",296:"ResolutionUnit",297:"PageNumber",300:"ColorResponseUnit",301:"TransferFunction",305:"Software",306:"ModifyDate",315:"Artist",316:"HostComputer",317:"Predictor",318:"WhitePoint",319:"PrimaryChromaticities",320:"ColorMap",321:"HalftoneHints",322:"TileWidth",323:"TileLength",324:"TileOffsets",325:"TileByteCounts",326:"BadFaxLines",327:"CleanFaxData",328:"ConsecutiveBadFaxLines",330:"SubIFD",332:"InkSet",333:"InkNames",334:"NumberofInks",336:"DotRange",337:"TargetPrinter",338:"ExtraSamples",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",342:"TransferRange",343:"ClipPath",344:"XClipPathUnits",345:"YClipPathUnits",346:"Indexed",347:"JPEGTables",351:"OPIProxy",400:"GlobalParametersIFD",401:"ProfileType",402:"FaxProfile",403:"CodingMethods",404:"VersionYear",405:"ModeNumber",433:"Decode",434:"DefaultImageColor",435:"T82Options",437:"JPEGTables",512:"JPEGProc",513:"ThumbnailOffset",514:"ThumbnailLength",515:"JPEGRestartInterval",517:"JPEGLosslessPredictors",518:"JPEGPointTransforms",519:"JPEGQTables",520:"JPEGDCTables",521:"JPEGACTables",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite",559:"StripRowCounts",700:"ApplicationNotes",999:"USPTOMiscellaneous",4096:"RelatedImageFileFormat",4097:"RelatedImageWidth",4098:"RelatedImageHeight",18246:"Rating",18247:"XP_DIP_XML",18248:"StitchInfo",18249:"RatingPercent",32781:"ImageID",32931:"WangTag1",32932:"WangAnnotation",32933:"WangTag3",32934:"WangTag4",32995:"Matteing",32996:"DataType",32997:"ImageDepth",32998:"TileDepth",33405:"Model2",33421:"CFARepeatPatternDim",33422:"CFAPattern2",33423:"BatteryLevel",33424:"KodakIFD",33432:"Copyright",33434:"ExposureTime",33437:"FNumber",33445:"MDFileTag",33446:"MDScalePixel",33447:"MDColorTable",33448:"MDLabName",33449:"MDSampleInfo",33450:"MDPrepDate",33451:"MDPrepTime",33452:"MDFileUnits",33550:"PixelScale",33589:"AdventScale",33590:"AdventRevision",33628:"UIC1Tag",33629:"UIC2Tag",33630:"UIC3Tag",33631:"UIC4Tag",33723:"IPTC-NAA",33918:"IntergraphPacketData",33919:"IntergraphFlagRegisters",33920:"IntergraphMatrix",33921:"INGRReserved",33922:"ModelTiePoint",34016:"Site",34017:"ColorSequence",34018:"IT8Header",34019:"RasterPadding",34020:"BitsPerRunLength",34021:"BitsPerExtendedRunLength",34022:"ColorTable",34023:"ImageColorIndicator",34024:"BackgroundColorIndicator",34025:"ImageColorValue",34026:"BackgroundColorValue",34027:"PixelIntensityRange",34028:"TransparencyIndicator",34029:"ColorCharacterization",34030:"HCUsage",34031:"TrapIndicator",34032:"CMYKEquivalent",34118:"SEMInfo",34152:"AFCP_IPTC",34232:"PixelMagicJBIGOptions",34264:"ModelTransform",34306:"WB_GRGBLevels",34310:"LeafData",34377:"PhotoshopSettings",34665:"ExifOffset",34675:"ICC_Profile",34687:"TIFF_FXExtensions",34688:"MultiProfiles",34689:"SharedData",34690:"T88Options",34732:"ImageLayer",34735:"GeoTiffDirectory",34736:"GeoTiffDoubleParams",34737:"GeoTiffAsciiParams",34850:"ExposureProgram",34852:"SpectralSensitivity",34853:"GPSInfo",34855:"ISO",34856:"Opto-ElectricConvFactor",34857:"Interlace",34858:"TimeZoneOffset",34859:"SelfTimerMode",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",34908:"FaxRecvParams",34909:"FaxSubAddress",34910:"FaxRecvTime",34954:"LeafSubIFD",36864:"ExifVersion",36867:"DateTimeOriginal",36868:"CreateDate",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureCompensation",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",37387:"FlashEnergy",37388:"SpatialFrequencyResponse",37389:"Noise",37390:"FocalPlaneXResolution",37391:"FocalPlaneYResolution",37392:"FocalPlaneResolutionUnit",37393:"ImageNumber",37394:"SecurityClassification",37395:"ImageHistory",37396:"SubjectArea",37397:"ExposureIndex",37398:"TIFF-EPStandardID",37399:"SensingMethod",37434:"CIP3DataFile",37435:"CIP3Sheet",37436:"CIP3Side",37439:"StoNits",37500:"MakerNote",37510:"UserComment",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",37679:"MSDocumentText",37680:"MSPropertySetStorage",37681:"MSDocumentTextPosition",37724:"ImageSourceData",40091:"XPTitle",40092:"XPComment",40093:"XPAuthor",40094:"XPKeywords",40095:"XPSubject",40960:"FlashpixVersion",40961:"ColorSpace",40962:"ExifImageWidth",40963:"ExifImageHeight",40964:"RelatedSoundFile",40965:"InteropOffset",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41485:"Noise",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41489:"ImageNumber",41490:"SecurityClassification",41491:"ImageHistory",41492:"SubjectLocation",41493:"ExposureIndex",41494:"TIFF-EPStandardID",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFormat",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"OwnerName",42033:"SerialNumber",42034:"LensInfo",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",42112:"GDALMetadata",42113:"GDALNoData",42240:"Gamma",44992:"ExpandSoftware",44993:"ExpandLens",44994:"ExpandFilm",44995:"ExpandFilterLens",44996:"ExpandScanner",44997:"ExpandFlashLamp",48129:"PixelFormat",48130:"Transformation",48131:"Uncompressed",48132:"ImageType",48256:"ImageWidth",48257:"ImageHeight",48258:"WidthResolution",48259:"HeightResolution",48320:"ImageOffset",48321:"ImageByteCount",48322:"AlphaOffset",48323:"AlphaByteCount",48324:"ImageDataDiscard",48325:"AlphaDataDiscard",50215:"OceScanjobDesc",50216:"OceApplicationSelector",50217:"OceIDNumber",50218:"OceImageLogic",50255:"Annotations",50341:"PrintIM",50560:"USPTOOriginalContentType",50706:"DNGVersion",50707:"DNGBackwardVersion",50708:"UniqueCameraModel",50709:"LocalizedCameraModel",50710:"CFAPlaneColor",50711:"CFALayout",50712:"LinearizationTable",50713:"BlackLevelRepeatDim",50714:"BlackLevel",50715:"BlackLevelDeltaH",50716:"BlackLevelDeltaV",50717:"WhiteLevel",50718:"DefaultScale",50719:"DefaultCropOrigin",50720:"DefaultCropSize",50721:"ColorMatrix1",50722:"ColorMatrix2",50723:"CameraCalibration1",50724:"CameraCalibration2",50725:"ReductionMatrix1",50726:"ReductionMatrix2",50727:"AnalogBalance",50728:"AsShotNeutral",50729:"AsShotWhiteXY",50730:"BaselineExposure",50731:"BaselineNoise",50732:"BaselineSharpness",50733:"BayerGreenSplit",50734:"LinearResponseLimit",50735:"CameraSerialNumber",50736:"DNGLensInfo",50737:"ChromaBlurRadius",50738:"AntiAliasStrength",50739:"ShadowScale",50740:"DNGPrivateData",50741:"MakerNoteSafety",50752:"RawImageSegmentation",50778:"CalibrationIlluminant1",50779:"CalibrationIlluminant2",50780:"BestQualityScale",50781:"RawDataUniqueID",50784:"AliasLayerMetadata",50827:"OriginalRawFileName",50828:"OriginalRawFileData",50829:"ActiveArea",50830:"MaskedAreas",50831:"AsShotICCProfile",50832:"AsShotPreProfileMatrix",50833:"CurrentICCProfile",50834:"CurrentPreProfileMatrix",50879:"ColorimetricReference",50898:"PanasonicTitle",50899:"PanasonicTitle2",50931:"CameraCalibrationSig",50932:"ProfileCalibrationSig",50933:"ProfileIFD",50934:"AsShotProfileName",50935:"NoiseReductionApplied",50936:"ProfileName",50937:"ProfileHueSatMapDims",50938:"ProfileHueSatMapData1",50939:"ProfileHueSatMapData2",50940:"ProfileToneCurve",50941:"ProfileEmbedPolicy",50942:"ProfileCopyright",50964:"ForwardMatrix1",50965:"ForwardMatrix2",50966:"PreviewApplicationName",50967:"PreviewApplicationVersion",50968:"PreviewSettingsName",50969:"PreviewSettingsDigest",50970:"PreviewColorSpace",50971:"PreviewDateTime",50972:"RawImageDigest",50973:"OriginalRawFileDigest",50974:"SubTileBlockSize",50975:"RowInterleaveFactor",50981:"ProfileLookTableDims",50982:"ProfileLookTableData",51008:"OpcodeList1",51009:"OpcodeList2",51022:"OpcodeList3",51041:"NoiseProfile",51043:"TimeCodes",51044:"FrameRate",51058:"TStop",51081:"ReelName",51089:"OriginalDefaultFinalSize",51090:"OriginalBestQualitySize",51091:"OriginalDefaultCropSize",51105:"CameraLabel",51107:"ProfileHueSatMapEncoding",51108:"ProfileLookTableEncoding",51109:"BaselineExposureOffset",51110:"DefaultBlackRender",51111:"NewRawImageDigest",51112:"RawToPreviewGain",51125:"DefaultUserCrop",59932:"Padding",59933:"OffsetSchema",65e3:"OwnerName",65001:"SerialNumber",65002:"Lens",65024:"KDC_IFD",65100:"RawFile",65101:"Converter",65102:"WhiteBalance",65105:"Exposure",65106:"Shadows",65107:"Brightness",65108:"Contrast",65109:"Saturation",65110:"Sharpness",65111:"Smoothness",65112:"MoireFilter"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"}}),exifTags}var jpeg$1=jpeg$2,exif=exif$2,simplify=simplify$1;function ExifResult(e,t,r,n,a,l,o){this.startMarker=e,this.tags=t,this.imageSize=r,this.thumbnailOffset=n,this.thumbnailLength=a,this.thumbnailType=l,this.app1Offset=o}ExifResult.prototype={hasThumbnail:function(e){return!this.thumbnailOffset||!this.thumbnailLength?!1:typeof e!="string"?!0:e.toLowerCase().trim()==="image/jpeg"?this.thumbnailType===6:e.toLowerCase().trim()==="image/tiff"?this.thumbnailType===1:!1},getThumbnailOffset:function(){return this.app1Offset+6+this.thumbnailOffset},getThumbnailLength:function(){return this.thumbnailLength},getThumbnailBuffer:function(){return this._getThumbnailStream().nextBuffer(this.thumbnailLength)},_getThumbnailStream:function(){return this.startMarker.openWithOffset(this.getThumbnailOffset())},getImageSize:function(){return this.imageSize},getThumbnailSize:function(){var e=this._getThumbnailStream(),t;return jpeg$1.parseSections(e,function(r,n){jpeg$1.getSectionName(r).name==="SOF"&&(t=jpeg$1.getSizeFromSOFSection(n))}),t}};function Parser$5(e){this.stream=e,this.flags={readBinaryTags:!1,resolveTagNames:!0,simplifyValues:!0,imageSize:!0,hidePointers:!0,returnTags:!0}}Parser$5.prototype={enableBinaryFields:function(e){return this.flags.readBinaryTags=!!e,this},enablePointers:function(e){return this.flags.hidePointers=!e,this},enableTagNames:function(e){return this.flags.resolveTagNames=!!e,this},enableImageSize:function(e){return this.flags.imageSize=!!e,this},enableReturnTags:function(e){return this.flags.returnTags=!!e,this},enableSimpleValues:function(e){return this.flags.simplifyValues=!!e,this},parse:function(){var e=this.stream.mark(),t=e.openWithOffset(0),r=this.flags,n,a,l,o,s,h,f,u,d;return r.resolveTagNames&&(f=requireExifTags()),r.resolveTagNames?(n={},u=function(p){return n[p.name]},d=function(p,m){n[p.name]=m}):(n=[],u=function(p){var m;for(m=0;m<n.length;++m)if(n[m].type===p.type&&n[m].section===p.section)return n.value},d=function(p,m){var A;for(A=0;A<n.length;++A)if(n[A].type===p.type&&n[A].section===p.section){n.value=m;return}}),jpeg$1.parseSections(t,function(p,m){var A,k=m.offsetFrom(e);p===225?(A=exif.parseTags(m,function(I,B,M,T){if(!(!r.readBinaryTags&&T===7)){if(B===513){if(l=M[0],r.hidePointers)return}else if(B===514){if(o=M[0],r.hidePointers)return}else if(B===259&&(s=M[0],r.hidePointers))return;if(r.returnTags)if(r.simplifyValues&&(M=simplify.simplifyValue(M,T)),r.resolveTagNames){var U=I===exif.GPSIFD?f.gps:f.exif,C=U[B];C||(C=f.exif[B]),n.hasOwnProperty(C)||(n[C]=M)}else n.push({section:I,type:B,value:M})}}),A&&(h=k)):r.imageSize&&jpeg$1.getSectionName(p).name==="SOF"&&(a=jpeg$1.getSizeFromSOFSection(m))}),r.simplifyValues&&(simplify.castDegreeValues(u,d),simplify.castDateValues(u,d)),new ExifResult(e,n,a,l,o,s,h)}};var parser$1=Parser$5,domBufferstream,hasRequiredDomBufferstream;function requireDomBufferstream(){if(hasRequiredDomBufferstream)return domBufferstream;hasRequiredDomBufferstream=1;function e(t,r,n,a,l,o){this.global=l,r=r||0,n=n||t.byteLength-r,this.arrayBuffer=t.slice(r,r+n),this.view=new l.DataView(this.arrayBuffer,0,this.arrayBuffer.byteLength),this.setBigEndian(a),this.offset=0,this.parentOffset=(o||0)+r}return e.prototype={setBigEndian:function(t){this.littleEndian=!t},nextUInt8:function(){var t=this.view.getUint8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.view.getInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},nextUInt32:function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},nextInt16:function(){var t=this.view.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},nextInt32:function(){var t=this.view.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},nextFloat:function(){var t=this.view.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},nextDouble:function(){var t=this.view.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},nextBuffer:function(t){var r=this.arrayBuffer.slice(this.offset,this.offset+t);return this.offset+=t,r},remainingLength:function(){return this.arrayBuffer.byteLength-this.offset},nextString:function(t){var r=this.arrayBuffer.slice(this.offset,this.offset+t);return r=String.fromCharCode.apply(null,new this.global.Uint8Array(r)),this.offset+=t,r},mark:function(){var t=this;return{openWithOffset:function(r){return r=(r||0)+this.offset,new e(t.arrayBuffer,r,t.arrayBuffer.byteLength-r,!t.littleEndian,t.global,t.parentOffset)},offset:this.offset,getParentOffset:function(){return t.parentOffset}}},offsetFrom:function(t){return this.parentOffset+this.offset-(t.offset+t.getParentOffset())},skip:function(t){this.offset+=t},branch:function(t,r){return r=typeof r=="number"?r:this.arrayBuffer.byteLength-(this.offset+t),new e(this.arrayBuffer,this.offset+t,r,!this.littleEndian,this.global,this.parentOffset)}},domBufferstream=e,domBufferstream}var bufferstream,hasRequiredBufferstream;function requireBufferstream(){if(hasRequiredBufferstream)return bufferstream;hasRequiredBufferstream=1;function e(t,r,n,a){this.buffer=t,this.offset=r||0,n=typeof n=="number"?n:t.length,this.endPosition=this.offset+n,this.setBigEndian(a)}return e.prototype={setBigEndian:function(t){this.bigEndian=!!t},nextUInt8:function(){var t=this.buffer.readUInt8(this.offset);return this.offset+=1,t},nextInt8:function(){var t=this.buffer.readInt8(this.offset);return this.offset+=1,t},nextUInt16:function(){var t=this.bigEndian?this.buffer.readUInt16BE(this.offset):this.buffer.readUInt16LE(this.offset);return this.offset+=2,t},nextUInt32:function(){var t=this.bigEndian?this.buffer.readUInt32BE(this.offset):this.buffer.readUInt32LE(this.offset);return this.offset+=4,t},nextInt16:function(){var t=this.bigEndian?this.buffer.readInt16BE(this.offset):this.buffer.readInt16LE(this.offset);return this.offset+=2,t},nextInt32:function(){var t=this.bigEndian?this.buffer.readInt32BE(this.offset):this.buffer.readInt32LE(this.offset);return this.offset+=4,t},nextFloat:function(){var t=this.bigEndian?this.buffer.readFloatBE(this.offset):this.buffer.readFloatLE(this.offset);return this.offset+=4,t},nextDouble:function(){var t=this.bigEndian?this.buffer.readDoubleBE(this.offset):this.buffer.readDoubleLE(this.offset);return this.offset+=8,t},nextBuffer:function(t){var r=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,r},remainingLength:function(){return this.endPosition-this.offset},nextString:function(t){var r=this.buffer.toString("utf8",this.offset,this.offset+t);return this.offset+=t,r},mark:function(){var t=this;return{openWithOffset:function(r){return r=(r||0)+this.offset,new e(t.buffer,r,t.endPosition-r,t.bigEndian)},offset:this.offset}},offsetFrom:function(t){return this.offset-t.offset},skip:function(t){this.offset+=t},branch:function(t,r){return r=typeof r=="number"?r:this.endPosition-(this.offset+t),new e(this.buffer,this.offset+t,r,this.bigEndian)}},bufferstream=e,bufferstream}var Parser$4=parser$1;function getGlobal(){return(0,eval)("this")}var exifParser={create:function(e,t){if(t=t||getGlobal(),e instanceof t.ArrayBuffer){var r=requireDomBufferstream();return new Parser$4(new r(e,0,e.byteLength,!0,t))}else{var n=requireBufferstream();return new Parser$4(new n(e,0,e.length,!0))}}};const EXIFParser=getDefaultExportFromCjs(exifParser);async function getMIMEFromBuffer(e,t){const r=await FileType.fromBuffer(e);return r?r.mime:t?getType(t):null}function getExifOrientation(e){return e._exif&&e._exif.tags&&e._exif.tags.Orientation||1}function getExifOrientationTransformation(e){const t=e.getWidth(),r=e.getHeight();switch(getExifOrientation(e)){case 1:return null;case 2:return function(n,a){return[t-n-1,a]};case 3:return function(n,a){return[t-n-1,r-a-1]};case 4:return function(n,a){return[n,r-a-1]};case 5:return function(n,a){return[a,n]};case 6:return function(n,a){return[a,r-n-1]};case 7:return function(n,a){return[t-a-1,r-n-1]};case 8:return function(n,a){return[t-a-1,n]};default:return null}}function transformBitmap(e,t,r,n){const a=e.bitmap.data,l=e.bitmap.width,o=Buffer.alloc(a.length);for(let s=0;s<t;s++)for(let h=0;h<r;h++){const[f,u]=n(s,h),d=t*h+s<<2,p=l*u+f<<2,m=a.readUInt32BE(p);o.writeUInt32BE(m,d)}e.bitmap.data=o,e.bitmap.width=t,e.bitmap.height=r}function exifRotate(e){if(getExifOrientation(e)<2)return;const t=getExifOrientationTransformation(e),r=getExifOrientation(e)>4,n=r?e.bitmap.height:e.bitmap.width,a=r?e.bitmap.width:e.bitmap.height;transformBitmap(e,n,a,t)}async function parseBitmap(e,t,r){const n=await getMIMEFromBuffer(e,t);if(typeof n!="string")return r(new Error("Could not find MIME for Buffer <"+t+">"));this._originalMime=n.toLowerCase();try{const a=this.getMIME();if(this.constructor.decoders[a])this.bitmap=this.constructor.decoders[a](e);else return throwError.call(this,"Unsupported MIME type: "+a,r)}catch(a){return r.call(this,a,this)}try{this._exif=EXIFParser.create(e).parse(),exifRotate(this)}catch{}return r.call(this,null,this),this}function compositeBitmapOverBackground(e,t){return new e(t.bitmap.width,t.bitmap.height,t._background).composite(t,0,0).bitmap}function getBuffer(e,t){if(e===AUTO&&(e=this.getMIME()),typeof e!="string")return throwError.call(this,"mime must be a string",t);if(typeof t!="function")return throwError.call(this,"cb must be a function",t);if(e=e.toLowerCase(),this._rgba&&this.constructor.hasAlpha[e]?this.bitmap.data=Buffer.from(this.bitmap.data):this.bitmap.data=compositeBitmapOverBackground(this.constructor,this).data,this.constructor.encoders[e]){const r=this.constructor.encoders[e](this);r instanceof Promise?r.then(n=>{t.call(this,null,n)}):t.call(this,null,r)}else return throwError.call(this,"Unsupported MIME type: "+e,t);return this}function getBufferAsync(e){return promisify(getBuffer,this,e)}var define_process_env_default$1={};function _defineProperty(e,t,r){return t=_toPropertyKey(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return typeof t=="symbol"?t:String(t)}function _toPrimitive(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}const alphabet="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_",maxHashLength=[NaN,NaN];for(let e=2;e<65;e++){const t=anyBase$1(anyBase$1.BIN,alphabet.slice(0,e))(new Array(65).join("1"));maxHashLength.push(t.length)}function noop$2(){}function isArrayBuffer$1(e){return Object.prototype.toString.call(e).toLowerCase().indexOf("arraybuffer")>-1}function bufferFromArrayBuffer(e){const t=Buffer.alloc(e.byteLength),r=new Uint8Array(e);for(let n=0;n<t.length;++n)t[n]=r[n];return t}function loadFromURL(e,t){request(e,(r,n)=>r?t(r):typeof n=="object"&&Buffer.isBuffer(n)?t(null,n):typeof n=="object"&&isArrayBuffer$1(n)?t(null,bufferFromArrayBuffer(n)):new Error(`Could not load Buffer from <${e.url}>`))}function loadBufferFromPath(e,t){Path&&typeof Path.readFile=="function"&&!e.match(/^(http|ftp)s?:\/\/./)?Path.readFile(e,t):loadFromURL({url:e},t)}function isRawRGBAData(e){return e&&typeof e=="object"&&typeof e.width=="number"&&typeof e.height=="number"&&(Buffer.isBuffer(e.data)||e.data instanceof Uint8Array||typeof Uint8ClampedArray=="function"&&e.data instanceof Uint8ClampedArray)&&(e.data.length===e.width*e.height*4||e.data.length===e.width*e.height*3)}function makeRGBABufferFromRGB(e){if(e.length%3!==0)throw new Error("Buffer length is incorrect");const t=Buffer.allocUnsafe(e.length/3*4);let r=0;for(let n=0;n<e.length;n++)t[r]=e[n],(n+1)%3===0&&(t[++r]=255),r++;return t}const emptyBitmap={data:null,width:null,height:null};class Jimp extends Path{constructor(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];super(),_defineProperty(this,"bitmap",emptyBitmap),_defineProperty(this,"_background",0),_defineProperty(this,"_originalMime",Jimp.MIME_PNG),_defineProperty(this,"_exif",null),_defineProperty(this,"_rgba",!0),_defineProperty(this,"writeAsync",s=>promisify(this.write,this,s)),_defineProperty(this,"getBase64Async",s=>promisify(this.getBase64,this,s)),_defineProperty(this,"getBuffer",getBuffer),_defineProperty(this,"getBufferAsync",getBufferAsync),_defineProperty(this,"getPixelColour",this.getPixelColor),_defineProperty(this,"setPixelColour",this.setPixelColor);const a=this;let l=noop$2;isArrayBuffer$1(r[0])&&(r[0]=bufferFromArrayBuffer(r[0]));function o(){for(var s=arguments.length,h=new Array(s),f=0;f<s;f++)h[f]=arguments[f];const[u]=h,d=u||{};d.methodName="constructor",setTimeout(()=>{u&&l===noop$2?a.emitError("constructor",u):u||a.emitMulti("constructor","initialized"),l.call(a,...h)},1)}if(typeof r[0]=="number"&&typeof r[1]=="number"||parseInt(r[0],10)&&parseInt(r[1],10)){const s=parseInt(r[0],10),h=parseInt(r[1],10);if(l=r[2],typeof r[2]=="number"&&(this._background=r[2],l=r[3]),typeof r[2]=="string"&&(this._background=Jimp.cssColorToHex(r[2]),l=r[3]),typeof l>"u"&&(l=noop$2),typeof l!="function")return throwError.call(this,"cb must be a function",o);this.bitmap={data:Buffer.alloc(s*h*4),width:s,height:h};for(let f=0;f<this.bitmap.data.length;f+=4)this.bitmap.data.writeUInt32BE(this._background,f);o(null,this)}else if(typeof r[0]=="object"&&r[0].url){if(l=r[1]||noop$2,typeof l!="function")return throwError.call(this,"cb must be a function",o);loadFromURL(r[0],(s,h)=>{if(s)return throwError.call(this,s,o);this.parseBitmap(h,r[0].url,o)})}else if(r[0]instanceof Jimp){const[s]=r;if(l=r[1],typeof l>"u"&&(l=noop$2),typeof l!="function")return throwError.call(this,"cb must be a function",o);this.bitmap={data:Buffer.from(s.bitmap.data),width:s.bitmap.width,height:s.bitmap.height},this._quality=s._quality,this._deflateLevel=s._deflateLevel,this._deflateStrategy=s._deflateStrategy,this._filterType=s._filterType,this._rgba=s._rgba,this._background=s._background,this._originalMime=s._originalMime,o(null,this)}else if(isRawRGBAData(r[0])){const[s]=r;l=r[1]||noop$2;const f=s.width*s.height*4===s.data.length?Buffer.from(s.data):makeRGBABufferFromRGB(s.data);this.bitmap={data:f,width:s.width,height:s.height},o(null,this)}else if(typeof r[0]=="string"){const s=r[0];if(l=r[1],typeof l>"u"&&(l=noop$2),typeof l!="function")return throwError.call(this,"cb must be a function",o);loadBufferFromPath(s,(h,f)=>{if(h)return throwError.call(this,h,o);this.parseBitmap(f,s,o)})}else if(typeof r[0]=="object"&&Buffer.isBuffer(r[0])){const s=r[0];if(l=r[1],typeof l!="function")return throwError.call(this,"cb must be a function",o);this.parseBitmap(s,null,o)}else{l=r[r.length-1],typeof l!="function"&&(l=r[r.length-2],typeof l!="function"&&(l=noop$2));const s=Jimp.__extraConstructors.find(h=>h.test(...r));if(s)new Promise((h,f)=>{s.run.call(this,h,f,...r)}).then(()=>o(null,this)).catch(o);else return throwError.call(this,"No matching constructor overloading was found. Please see the docs for how to call the Jimp constructor.",o)}}parseBitmap(t,r,n){parseBitmap.call(this,t,null,n)}rgba(t,r){return typeof t!="boolean"?throwError.call(this,"bool must be a boolean, true for RGBA or false for RGB",r):(this._rgba=t,isNodePattern(r)&&r.call(this,null,this),this)}emitMulti(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n=Object.assign(n,{methodName:t,eventName:r}),this.emit("any",n),t&&this.emit(t,n),this.emit(r,n)}emitError(t,r){this.emitMulti(t,"error",r)}getHeight(){return this.bitmap.height}getWidth(){return this.bitmap.width}inspect(){return"<Jimp "+(this.bitmap===emptyBitmap?"pending...":this.bitmap.width+"x"+this.bitmap.height)+">"}toString(){return"[object Jimp]"}getMIME(){return this._originalMime||Jimp.MIME_PNG}getExtension(){const t=this.getMIME();return getExtension(t)}write(t,r){if(!Path||!Path.createWriteStream)throw new Error("Cant access the filesystem. You can use the getBase64 method.");if(typeof t!="string")return throwError.call(this,"path must be a string",r);if(typeof r>"u"&&(r=noop$2),typeof r!="function")return throwError.call(this,"cb must be a function",r);const n=getType(t)||this.getMIME(),a=Path.parse(t);return a.dir&&Path.mkdirSync(a.dir,{recursive:!0}),this.getBuffer(n,(l,o)=>{if(l)return throwError.call(this,l,r);const s=Path.createWriteStream(t);s.on("open",()=>{s.write(o),s.end()}).on("error",h=>throwError.call(this,h,r)),s.on("finish",()=>{r.call(this,null,this)})}),this}getBase64(t,r){return t===Jimp.AUTO&&(t=this.getMIME()),typeof t!="string"?throwError.call(this,"mime must be a string",r):typeof r!="function"?throwError.call(this,"cb must be a function",r):(this.getBuffer(t,function(n,a){if(n)return throwError.call(this,n,r);const l="data:"+t+";base64,"+a.toString("base64");r.call(this,null,l)}),this)}hash(t,r){if(t=t||64,typeof t=="function"&&(r=t,t=64),typeof t!="number")return throwError.call(this,"base must be a number",r);if(t<2||t>64)return throwError.call(this,"base must be a number between 2 and 64",r);let n=this.pHash();for(n=anyBase$1(anyBase$1.BIN,alphabet.slice(0,t))(n);n.length<maxHashLength[t];)n="0"+n;return isNodePattern(r)&&r.call(this,null,n),n}pHash(){return new ImagePHash().getHash(this)}distanceFromHash(t){const r=new ImagePHash,n=r.getHash(this);return r.distance(n,t)}getPixelIndex(t,r,n,a){let l,o;if(typeof n=="function"&&typeof a>"u"&&(a=n,n=null),n||(n=Jimp.EDGE_EXTEND),typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",a);t=Math.round(t),r=Math.round(r),l=t,o=r,n===Jimp.EDGE_EXTEND&&(t<0&&(l=0),t>=this.bitmap.width&&(l=this.bitmap.width-1),r<0&&(o=0),r>=this.bitmap.height&&(o=this.bitmap.height-1)),n===Jimp.EDGE_WRAP&&(t<0&&(l=this.bitmap.width+t),t>=this.bitmap.width&&(l=t%this.bitmap.width),r<0&&(o=this.bitmap.height+r),r>=this.bitmap.height&&(o=r%this.bitmap.height));let s=this.bitmap.width*o+l<<2;return(l<0||l>=this.bitmap.width)&&(s=-1),(o<0||o>=this.bitmap.height)&&(s=-1),isNodePattern(a)&&a.call(this,null,s),s}getPixelColor(t,r,n){if(typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",n);const a=this.getPixelIndex(t,r),l=this.bitmap.data.readUInt32BE(a);return isNodePattern(n)&&n.call(this,null,l),l}setPixelColor(t,r,n,a){if(typeof t!="number"||typeof r!="number"||typeof n!="number")return throwError.call(this,"hex, x and y must be numbers",a);const l=this.getPixelIndex(r,n);return this.bitmap.data.writeUInt32BE(t,l),isNodePattern(a)&&a.call(this,null,this),this}hasAlpha(){const{width:t,height:r,data:n}=this.bitmap,a=t*r<<2;for(let l=3;l<a;l+=4)if(n[l]!==255)return!0;return!1}scanIterator(t,r,n,a){return typeof t!="number"||typeof r!="number"?throwError.call(this,"x and y must be numbers"):typeof n!="number"||typeof a!="number"?throwError.call(this,"w and h must be numbers"):scanIterator(this,t,r,n,a)}}function addConstants(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jimp;Object.entries(e).forEach(r=>{let[n,a]=r;t[n]=a})}function addJimpMethods(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jimp;Object.entries(e).forEach(r=>{let[n,a]=r;t.prototype[n]=a})}addConstants(constants$7);addJimpMethods({composite});Jimp.__extraConstructors=[];Jimp.appendConstructorOption=function(e,t,r){Jimp.__extraConstructors.push({name:e,test:t,run:r})};Jimp.read=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Promise((n,a)=>{new Jimp(...t,(l,o)=>{l?a(l):n(o)})})};Jimp.create=Jimp.read;Jimp.rgbaToInt=function(e,t,r,n,a){if(typeof e!="number"||typeof t!="number"||typeof r!="number"||typeof n!="number")return throwError.call(this,"r, g, b and a must be numbers",a);if(e<0||e>255)return throwError.call(this,"r must be between 0 and 255",a);if((t<0||t>255)&&throwError.call(this,"g must be between 0 and 255",a),r<0||r>255)return throwError.call(this,"b must be between 0 and 255",a);if(n<0||n>255)return throwError.call(this,"a must be between 0 and 255",a);let l=e&255;return l<<=8,l|=t&255,l<<=8,l|=r&255,l<<=8,l|=n&255,l>>>=0,isNodePattern(a)&&a.call(this,null,l),l};Jimp.intToRGBA=function(e,t){if(typeof e!="number")return throwError.call(this,"i must be a number",t);const r={};return r.r=Math.floor(e/Math.pow(256,3)),r.g=Math.floor((e-r.r*Math.pow(256,3))/Math.pow(256,2)),r.b=Math.floor((e-r.r*Math.pow(256,3)-r.g*Math.pow(256,2))/Math.pow(256,1)),r.a=Math.floor((e-r.r*Math.pow(256,3)-r.g*Math.pow(256,2)-r.b*Math.pow(256,1))/Math.pow(256,0)),isNodePattern(t)&&t.call(this,null,r),r};Jimp.cssColorToHex=function(e){return e=e||0,typeof e=="number"?Number(e):parseInt(tinycolor(e).toHex8(),16)};Jimp.limit255=function(e){return e=Math.max(e,0),e=Math.min(e,255),e};Jimp.diff=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:.1;if(!(e instanceof Jimp)||!(t instanceof Jimp))return throwError.call(this,"img1 and img2 must be an Jimp images");const n=e.bitmap,a=t.bitmap;if((n.width!==a.width||n.height!==a.height)&&(n.width*n.height>a.width*a.height?e=e.cloneQuiet().resize(a.width,a.height):t=t.cloneQuiet().resize(n.width,n.height)),typeof r!="number"||r<0||r>1)return throwError.call(this,"threshold must be a number between 0 and 1");const l=new Jimp(n.width,n.height,4294967295);return{percent:pixelMatch(n.data,a.data,l.bitmap.data,l.bitmap.width,l.bitmap.height,{threshold:r})/(l.bitmap.width*l.bitmap.height),image:l}};Jimp.distance=function(e,t){const r=new ImagePHash,n=r.getHash(e),a=r.getHash(t);return r.distance(n,a)};Jimp.compareHashes=function(e,t){return new ImagePHash().distance(e,t)};Jimp.colorDiff=function(e,t){const r=l=>Math.pow(l,2),{max:n}=Math,a=255*255*3;return e.a!==0&&!e.a&&(e.a=255),t.a!==0&&!t.a&&(t.a=255),(n(r(e.r-t.r),r(e.r-t.r-e.a+t.a))+n(r(e.g-t.g),r(e.g-t.g-e.a+t.a))+n(r(e.b-t.b),r(e.b-t.b-e.a+t.a)))/a};function jimpEvMethod(e,t,r){const n="before-"+t,a=t.replace(/e$/,"")+"ed";Jimp.prototype[e]=function(){let l;for(var o=arguments.length,s=new Array(o),h=0;h<o;h++)s[h]=arguments[h];const f=s[r.length-1],u=this;typeof f=="function"?(l=function(){for(var p=arguments.length,m=new Array(p),A=0;A<p;A++)m[A]=arguments[A];const[k,I]=m;k?u.emitError(e,k):u.emitMulti(e,a,{[e]:I}),f.apply(this,m)},s[s.length-1]=l):l=!1,this.emitMulti(e,n);let d;try{d=r.apply(this,s),l||this.emitMulti(e,a,{[e]:d})}catch(p){p.methodName=e,this.emitError(e,p)}return d},Jimp.prototype[e+"Quiet"]=r}jimpEvMethod("clone","clone",function(e){const t=new Jimp(this);return isNodePattern(e)&&e.call(t,null,t),t});function jimpEvChange(e,t){jimpEvMethod(e,"change",t)}jimpEvChange("background",function(e,t){return typeof e!="number"?throwError.call(this,"hex must be a hexadecimal rgba value",t):(this._background=e,isNodePattern(t)&&t.call(this,null,this),this)});jimpEvChange("scan",function(e,t,r,n,a,l){if(typeof e!="number"||typeof t!="number")return throwError.call(this,"x and y must be numbers",l);if(typeof r!="number"||typeof n!="number")return throwError.call(this,"w and h must be numbers",l);if(typeof a!="function")return throwError.call(this,"f must be a function",l);const o=scan(this,e,t,r,n,a);return isNodePattern(l)&&l.call(this,null,o),o});if(define_process_env_default$1.ENVIRONMENT==="BROWSER"){let e;typeof window<"u"&&typeof window=="object"&&(e=window),typeof self<"u"&&typeof self=="object"&&(e=self),e.Jimp=Jimp,e.Buffer=Buffer}function configure(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jimp;const r={hasAlpha:{},encoders:{},decoders:{},class:{},constants:{}};function n(o){Object.entries(o).forEach(s=>{let[h,f]=s;r[h]={...r[h],...f}})}function a(o){const s=o();Array.isArray(s.mime)?addType(...s.mime):Object.entries(s.mime).forEach(h=>addType(...h)),delete s.mime,n(s)}function l(o){const s=o(jimpEvChange)||{};!s.class&&!s.constants?n({class:s}):n(s)}return e.types&&(e.types.forEach(a),t.decoders={...t.decoders,...r.decoders},t.encoders={...t.encoders,...r.encoders},t.hasAlpha={...t.hasAlpha,...r.hasAlpha}),e.plugins&&e.plugins.forEach(l),addJimpMethods(r.class,t),addConstants(r.constants,t),Jimp}var timm$1={};Object.defineProperty(timm$1,"__esModule",{value:!0});timm$1.clone=clone;timm$1.addLast=addLast;timm$1.addFirst=addFirst;timm$1.removeLast=removeLast;timm$1.removeFirst=removeFirst;timm$1.insert=insert;timm$1.removeAt=removeAt;timm$1.replaceAt=replaceAt;timm$1.getIn=getIn;timm$1.set=set;timm$1.setIn=setIn;timm$1.update=update;timm$1.updateIn=updateIn;timm$1.merge=merge;var mergeDeep_1=timm$1.mergeDeep=mergeDeep;timm$1.mergeIn=mergeIn;timm$1.omit=omit;timm$1.addDefaults=addDefaults;timm$1.default=void 0;/*!
 * Timm
 *
 * Immutability helpers with fast reads and acceptable writes.
 *
 * @copyright Guillermo Grau Panea 2016
 * @license MIT
 */const INVALID_ARGS="INVALID_ARGS";function throwStr(e){throw new Error(e)}function getKeysAndSymbols(e){const t=Object.keys(e);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t}const hasOwnProperty$1={}.hasOwnProperty;function clone(e){if(Array.isArray(e))return e.slice();const t=e,r=getKeysAndSymbols(t),n={};for(let a=0;a<r.length;a++){const l=r[a];n[l]=t[l]}return n}function isObject(e){return e!=null&&typeof e=="object"}function addLast(e,t){return Array.isArray(t)?e.concat(t):e.concat([t])}function addFirst(e,t){return Array.isArray(t)?t.concat(e):[t].concat(e)}function removeLast(e){return e.length?e.slice(0,e.length-1):e}function removeFirst(e){return e.length?e.slice(1):e}function insert(e,t,r){return e.slice(0,t).concat(Array.isArray(r)?r:[r]).concat(e.slice(t))}function removeAt(e,t){return t>=e.length||t<0?e:e.slice(0,t).concat(e.slice(t+1))}function replaceAt(e,t,r){if(e[t]===r)return e;const n=e.length,a=Array(n);for(let l=0;l<n;l++)a[l]=e[l];return a[t]=r,a}function getIn(e,t){if(Array.isArray(t)||throwStr(INVALID_ARGS),e==null)return;let r=e;for(let n=0;n<t.length;n++){const a=t[n];if(r=r!=null?r[a]:void 0,r===void 0)return r}return r}function set(e,t,r){let n=e;if(n==null&&(n=typeof t=="number"?[]:{}),n[t]===r)return n;const a=clone(n);return a[t]=r,a}function setIn(e,t,r){return t.length?doSetIn(e,t,r,0):r}function doSetIn(e,t,r,n){let a;const l=t[n];if(n===t.length-1)a=r;else{const o=isObject(e)&&isObject(e[l])?e[l]:typeof t[n+1]=="number"?[]:{};a=doSetIn(o,t,r,n+1)}return set(e,l,a)}function update(e,t,r){const n=e==null?void 0:e[t],a=r(n);return set(e,t,a)}function updateIn(e,t,r){const n=getIn(e,t),a=r(n);return setIn(e,t,a)}function merge(e,t,r,n,a,l,...o){return o.length?doMerge.call(null,!1,!1,e,t,r,n,a,l,...o):doMerge(!1,!1,e,t,r,n,a,l)}function mergeDeep(e,t,r,n,a,l,...o){return o.length?doMerge.call(null,!1,!0,e,t,r,n,a,l,...o):doMerge(!1,!0,e,t,r,n,a,l)}function mergeIn(e,t,r,n,a,l,o,...s){let h=getIn(e,t);h==null&&(h={});let f;return s.length?f=doMerge.call(null,!1,!1,h,r,n,a,l,o,...s):f=doMerge(!1,!1,h,r,n,a,l,o),setIn(e,t,f)}function omit(e,t){const r=Array.isArray(t)?t:[t];let n=!1;for(let o=0;o<r.length;o++)if(hasOwnProperty$1.call(e,r[o])){n=!0;break}if(!n)return e;const a={},l=getKeysAndSymbols(e);for(let o=0;o<l.length;o++){const s=l[o];r.indexOf(s)>=0||(a[s]=e[s])}return a}function addDefaults(e,t,r,n,a,l,...o){return o.length?doMerge.call(null,!0,!1,e,t,r,n,a,l,...o):doMerge(!0,!1,e,t,r,n,a,l)}function doMerge(e,t,r,...n){let a=r;a==null&&throwStr(INVALID_ARGS);let l=!1;for(let o=0;o<n.length;o++){const s=n[o];if(s==null)continue;const h=getKeysAndSymbols(s);if(h.length)for(let f=0;f<=h.length;f++){const u=h[f];if(e&&a[u]!==void 0)continue;let d=s[u];t&&isObject(a[u])&&isObject(d)&&(d=doMerge(e,t,a[u],d)),!(d===void 0||d===a[u])&&(l||(l=!0,a=clone(a)),a[u]=d)}}return a}const timm={clone,addLast,addFirst,removeLast,removeFirst,insert,removeAt,replaceAt,getIn,set,setIn,update,updateIn,merge,mergeDeep,mergeIn,omit,addDefaults};var _default=timm;timm$1.default=_default;var encoder$1={exports:{}};(function(e){function t(n){var a=Math.floor,l=new Array(64),o=new Array(64),s=new Array(64),h=new Array(64),f,u,d,p,m=new Array(65535),A=new Array(65535),k=new Array(64),I=new Array(64),B=[],M=0,T=7,U=new Array(64),C=new Array(64),w=new Array(64),E=new Array(256),S=new Array(2048),$,G=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],L=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],H=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Q=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],K=[0,1,2,3,4,5,6,7,8,9,10,11],te=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function J(P){for(var W=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],re=0;re<64;re++){var ae=a((W[re]*P+50)/100);ae<1?ae=1:ae>255&&(ae=255),l[G[re]]=ae}for(var Ee=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Ce=0;Ce<64;Ce++){var Pe=a((Ee[Ce]*P+50)/100);Pe<1?Pe=1:Pe>255&&(Pe=255),o[G[Ce]]=Pe}for(var Be=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Se=0,ke=0;ke<8;ke++)for(var Ie=0;Ie<8;Ie++)s[Se]=1/(l[G[Se]]*Be[ke]*Be[Ie]*8),h[Se]=1/(o[G[Se]]*Be[ke]*Be[Ie]*8),Se++}function ie(P,W){for(var re=0,ae=0,Ee=new Array,Ce=1;Ce<=16;Ce++){for(var Pe=1;Pe<=P[Ce];Pe++)Ee[W[ae]]=[],Ee[W[ae]][0]=re,Ee[W[ae]][1]=Ce,ae++,re++;re*=2}return Ee}function de(){f=ie(L,O),u=ie(Q,K),d=ie(z,H),p=ie(te,X)}function me(){for(var P=1,W=2,re=1;re<=15;re++){for(var ae=P;ae<W;ae++)A[32767+ae]=re,m[32767+ae]=[],m[32767+ae][1]=re,m[32767+ae][0]=ae;for(var Ee=-(W-1);Ee<=-P;Ee++)A[32767+Ee]=re,m[32767+Ee]=[],m[32767+Ee][1]=re,m[32767+Ee][0]=W-1+Ee;P<<=1,W<<=1}}function _e(){for(var P=0;P<256;P++)S[P]=19595*P,S[P+256>>0]=38470*P,S[P+512>>0]=7471*P+32768,S[P+768>>0]=-11059*P,S[P+1024>>0]=-21709*P,S[P+1280>>0]=32768*P+8421375,S[P+1536>>0]=-27439*P,S[P+1792>>0]=-5329*P}function q(P){for(var W=P[0],re=P[1]-1;re>=0;)W&1<<re&&(M|=1<<T),re--,T--,T<0&&(M==255?(V(255),V(0)):V(M),T=7,M=0)}function V(P){B.push(P)}function j(P){V(P>>8&255),V(P&255)}function ne(P,W){var re,ae,Ee,Ce,Pe,Be,Se,ke,Ie=0,Le,N=8,pe=64;for(Le=0;Le<N;++Le){re=P[Ie],ae=P[Ie+1],Ee=P[Ie+2],Ce=P[Ie+3],Pe=P[Ie+4],Be=P[Ie+5],Se=P[Ie+6],ke=P[Ie+7];var le=re+ke,Ae=re-ke,Z=ae+Se,ue=ae-Se,F=Ee+Be,ye=Ee-Be,Te=Ce+Pe,_=Ce-Pe,fe=le+Te,ge=le-Te,D=Z+F,ee=Z-F;P[Ie]=fe+D,P[Ie+4]=fe-D;var ce=(ee+ge)*.707106781;P[Ie+2]=ge+ce,P[Ie+6]=ge-ce,fe=_+ye,D=ye+ue,ee=ue+Ae;var De=(fe-ee)*.382683433,Fe=.5411961*fe+De,Re=1.306562965*ee+De,Ne=D*.707106781,qe=Ae+Ne,ze=Ae-Ne;P[Ie+5]=ze+Fe,P[Ie+3]=ze-Fe,P[Ie+1]=qe+Re,P[Ie+7]=qe-Re,Ie+=8}for(Ie=0,Le=0;Le<N;++Le){re=P[Ie],ae=P[Ie+8],Ee=P[Ie+16],Ce=P[Ie+24],Pe=P[Ie+32],Be=P[Ie+40],Se=P[Ie+48],ke=P[Ie+56];var Oe=re+ke,$e=re-ke,He=ae+Se,We=ae-Se,Ve=Ee+Be,Xe=Ee-Be,Ge=Ce+Pe,Qe=Ce-Pe,Ue=Oe+Ge,Ye=Oe-Ge,je=He+Ve,Ze=He-Ve;P[Ie]=Ue+je,P[Ie+32]=Ue-je;var tt=(Ze+Ye)*.707106781;P[Ie+16]=Ye+tt,P[Ie+48]=Ye-tt,Ue=Qe+Xe,je=Xe+We,Ze=We+$e;var rt=(Ue-Ze)*.382683433,it=.5411961*Ue+rt,nt=1.306562965*Ze+rt,at=je*.707106781,st=$e+at,ot=$e-at;P[Ie+40]=ot+it,P[Ie+24]=ot-it,P[Ie+8]=st+nt,P[Ie+56]=st-nt,Ie++}var Je;for(Le=0;Le<pe;++Le)Je=P[Le]*W[Le],k[Le]=Je>0?Je+.5|0:Je-.5|0;return k}function se(){j(65504),j(16),V(74),V(70),V(73),V(70),V(0),V(1),V(1),V(0),j(1),j(1),V(0),V(0)}function xe(P){if(P){j(65505),P[0]===69&&P[1]===120&&P[2]===105&&P[3]===102?j(P.length+2):(j(P.length+5+2),V(69),V(120),V(105),V(102),V(0));for(var W=0;W<P.length;W++)V(P[W])}}function Me(P,W){j(65472),j(17),V(8),j(W),j(P),V(3),V(1),V(17),V(0),V(2),V(17),V(1),V(3),V(17),V(1)}function ve(){j(65499),j(132),V(0);for(var P=0;P<64;P++)V(l[P]);V(1);for(var W=0;W<64;W++)V(o[W])}function he(){j(65476),j(418),V(0);for(var P=0;P<16;P++)V(L[P+1]);for(var W=0;W<=11;W++)V(O[W]);V(16);for(var re=0;re<16;re++)V(z[re+1]);for(var ae=0;ae<=161;ae++)V(H[ae]);V(1);for(var Ee=0;Ee<16;Ee++)V(Q[Ee+1]);for(var Ce=0;Ce<=11;Ce++)V(K[Ce]);V(17);for(var Pe=0;Pe<16;Pe++)V(te[Pe+1]);for(var Be=0;Be<=161;Be++)V(X[Be])}function oe(P){typeof P>"u"||P.constructor!==Array||P.forEach(W=>{if(typeof W=="string"){j(65534);var re=W.length;j(re+2);var ae;for(ae=0;ae<re;ae++)V(W.charCodeAt(ae))}})}function be(){j(65498),j(12),V(3),V(1),V(0),V(2),V(17),V(3),V(17),V(0),V(63),V(0)}function we(P,W,re,ae,Ee){for(var Ce=Ee[0],Pe=Ee[240],Be,Se=16,ke=63,Ie=64,Le=ne(P,W),N=0;N<Ie;++N)I[G[N]]=Le[N];var pe=I[0]-re;re=I[0],pe==0?q(ae[0]):(Be=32767+pe,q(ae[A[Be]]),q(m[Be]));for(var le=63;le>0&&I[le]==0;le--);if(le==0)return q(Ce),re;for(var Ae=1,Z;Ae<=le;){for(var ue=Ae;I[Ae]==0&&Ae<=le;++Ae);var F=Ae-ue;if(F>=Se){Z=F>>4;for(var ye=1;ye<=Z;++ye)q(Pe);F=F&15}Be=32767+I[Ae],q(Ee[(F<<4)+A[Be]]),q(m[Be]),Ae++}return le!=ke&&q(Ce),re}function R(){for(var P=String.fromCharCode,W=0;W<256;W++)E[W]=P(W)}this.encode=function(P,W){new Date().getTime(),W&&v(W),B=new Array,M=0,T=7,j(65496),se(),oe(P.comments),xe(P.exifBuffer),ve(),Me(P.width,P.height),he(),be();var re=0,ae=0,Ee=0;M=0,T=7,this.encode.displayName="_encode_";for(var Ce=P.data,Pe=P.width,Be=P.height,Se=Pe*4,ke,Ie=0,Le,N,pe,le,Ae,Z,ue,F;Ie<Be;){for(ke=0;ke<Se;){for(le=Se*Ie+ke,Ae=le,Z=-1,ue=0,F=0;F<64;F++)ue=F>>3,Z=(F&7)*4,Ae=le+ue*Se+Z,Ie+ue>=Be&&(Ae-=Se*(Ie+1+ue-Be)),ke+Z>=Se&&(Ae-=ke+Z-Se+4),Le=Ce[Ae++],N=Ce[Ae++],pe=Ce[Ae++],U[F]=(S[Le]+S[N+256>>0]+S[pe+512>>0]>>16)-128,C[F]=(S[Le+768>>0]+S[N+1024>>0]+S[pe+1280>>0]>>16)-128,w[F]=(S[Le+1280>>0]+S[N+1536>>0]+S[pe+1792>>0]>>16)-128;re=we(U,s,re,f,d),ae=we(C,h,ae,u,p),Ee=we(w,h,Ee,u,p),ke+=32}Ie+=8}if(T>=0){var ye=[];ye[1]=T+1,ye[0]=(1<<T+1)-1,q(ye)}return j(65497),Buffer.from(B)};function v(P){if(P<=0&&(P=1),P>100&&(P=100),$!=P){var W=0;P<50?W=Math.floor(5e3/P):W=Math.floor(200-P*2),J(W),$=P}}function b(){var P=new Date().getTime();n||(n=50),R(),de(),me(),_e(),v(n),new Date().getTime()-P}b()}e.exports=r;function r(n,a){typeof a>"u"&&(a=50);var l=new t(a),o=l.encode(n,a);return{data:o,width:n.width,height:n.height}}})(encoder$1);var encoderExports=encoder$1.exports,decoder$1={exports:{}};(function(e){var t=function(){var a=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),l=4017,o=799,s=3406,h=2276,f=1567,u=3784,d=5793,p=2896;function m(){}function A(C,w){for(var E=0,S=[],$,G,L=16;L>0&&!C[L-1];)L--;S.push({children:[],index:0});var O=S[0],z;for($=0;$<L;$++){for(G=0;G<C[$];G++){for(O=S.pop(),O.children[O.index]=w[E];O.index>0;){if(S.length===0)throw new Error("Could not recreate Huffman Table");O=S.pop()}for(O.index++,S.push(O);S.length<=$;)S.push(z={children:[],index:0}),O.children[O.index]=z.children,O=z;E++}$+1<L&&(S.push(z={children:[],index:0}),O.children[O.index]=z.children,O=z)}return S[0].children}function k(C,w,E,S,$,G,L,O,z,H){E.precision,E.samplesPerLine,E.scanLines;var Q=E.mcusPerLine,K=E.progressive;E.maxH,E.maxV;var te=w,X=0,J=0;function ie(){if(J>0)return J--,X>>J&1;if(X=C[w++],X==255){var Be=C[w++];if(Be)throw new Error("unexpected marker: "+(X<<8|Be).toString(16))}return J=7,X>>>7}function de(Be){for(var Se=Be,ke;(ke=ie())!==null;){if(Se=Se[ke],typeof Se=="number")return Se;if(typeof Se!="object")throw new Error("invalid huffman sequence")}return null}function me(Be){for(var Se=0;Be>0;){var ke=ie();if(ke===null)return;Se=Se<<1|ke,Be--}return Se}function _e(Be){var Se=me(Be);return Se>=1<<Be-1?Se:Se+(-1<<Be)+1}function q(Be,Se){var ke=de(Be.huffmanTableDC),Ie=ke===0?0:_e(ke);Se[0]=Be.pred+=Ie;for(var Le=1;Le<64;){var N=de(Be.huffmanTableAC),pe=N&15,le=N>>4;if(pe===0){if(le<15)break;Le+=16;continue}Le+=le;var Ae=a[Le];Se[Ae]=_e(pe),Le++}}function V(Be,Se){var ke=de(Be.huffmanTableDC),Ie=ke===0?0:_e(ke)<<z;Se[0]=Be.pred+=Ie}function j(Be,Se){Se[0]|=ie()<<z}var ne=0;function se(Be,Se){if(ne>0){ne--;return}for(var ke=G,Ie=L;ke<=Ie;){var Le=de(Be.huffmanTableAC),N=Le&15,pe=Le>>4;if(N===0){if(pe<15){ne=me(pe)+(1<<pe)-1;break}ke+=16;continue}ke+=pe;var le=a[ke];Se[le]=_e(N)*(1<<z),ke++}}var xe=0,Me;function ve(Be,Se){for(var ke=G,Ie=L,Le=0;ke<=Ie;){var N=a[ke],pe=Se[N]<0?-1:1;switch(xe){case 0:var le=de(Be.huffmanTableAC),Ae=le&15,Le=le>>4;if(Ae===0)Le<15?(ne=me(Le)+(1<<Le),xe=4):(Le=16,xe=1);else{if(Ae!==1)throw new Error("invalid ACn encoding");Me=_e(Ae),xe=Le?2:3}continue;case 1:case 2:Se[N]?Se[N]+=(ie()<<z)*pe:(Le--,Le===0&&(xe=xe==2?3:0));break;case 3:Se[N]?Se[N]+=(ie()<<z)*pe:(Se[N]=Me<<z,xe=0);break;case 4:Se[N]&&(Se[N]+=(ie()<<z)*pe);break}ke++}xe===4&&(ne--,ne===0&&(xe=0))}function he(Be,Se,ke,Ie,Le){var N=ke/Q|0,pe=ke%Q,le=N*Be.v+Ie,Ae=pe*Be.h+Le;Be.blocks[le]===void 0&&H.tolerantDecoding||Se(Be,Be.blocks[le][Ae])}function oe(Be,Se,ke){var Ie=ke/Be.blocksPerLine|0,Le=ke%Be.blocksPerLine;Be.blocks[Ie]===void 0&&H.tolerantDecoding||Se(Be,Be.blocks[Ie][Le])}var be=S.length,we,R,v,b,P,W;K?G===0?W=O===0?V:j:W=O===0?se:ve:W=q;var re=0,ae,Ee;be==1?Ee=S[0].blocksPerLine*S[0].blocksPerColumn:Ee=Q*E.mcusPerColumn,$||($=Ee);for(var Ce,Pe;re<Ee;){for(R=0;R<be;R++)S[R].pred=0;if(ne=0,be==1)for(we=S[0],P=0;P<$;P++)oe(we,W,re),re++;else for(P=0;P<$;P++){for(R=0;R<be;R++)for(we=S[R],Ce=we.h,Pe=we.v,v=0;v<Pe;v++)for(b=0;b<Ce;b++)he(we,W,re,v,b);if(re++,re===Ee)break}if(re===Ee)do{if(C[w]===255&&C[w+1]!==0)break;w+=1}while(w<C.length-2);if(J=0,ae=C[w]<<8|C[w+1],ae<65280)throw new Error("marker was not found");if(ae>=65488&&ae<=65495)w+=2;else break}return w-te}function I(C,w){var E=[],S=w.blocksPerLine,$=w.blocksPerColumn,G=S<<3,L=new Int32Array(64),O=new Uint8Array(64);function z(me,_e,q){var V=w.quantizationTable,j,ne,se,xe,Me,ve,he,oe,be,we=q,R;for(R=0;R<64;R++)we[R]=me[R]*V[R];for(R=0;R<8;++R){var v=8*R;if(we[1+v]==0&&we[2+v]==0&&we[3+v]==0&&we[4+v]==0&&we[5+v]==0&&we[6+v]==0&&we[7+v]==0){be=d*we[0+v]+512>>10,we[0+v]=be,we[1+v]=be,we[2+v]=be,we[3+v]=be,we[4+v]=be,we[5+v]=be,we[6+v]=be,we[7+v]=be;continue}j=d*we[0+v]+128>>8,ne=d*we[4+v]+128>>8,se=we[2+v],xe=we[6+v],Me=p*(we[1+v]-we[7+v])+128>>8,oe=p*(we[1+v]+we[7+v])+128>>8,ve=we[3+v]<<4,he=we[5+v]<<4,be=j-ne+1>>1,j=j+ne+1>>1,ne=be,be=se*u+xe*f+128>>8,se=se*f-xe*u+128>>8,xe=be,be=Me-he+1>>1,Me=Me+he+1>>1,he=be,be=oe+ve+1>>1,ve=oe-ve+1>>1,oe=be,be=j-xe+1>>1,j=j+xe+1>>1,xe=be,be=ne-se+1>>1,ne=ne+se+1>>1,se=be,be=Me*h+oe*s+2048>>12,Me=Me*s-oe*h+2048>>12,oe=be,be=ve*o+he*l+2048>>12,ve=ve*l-he*o+2048>>12,he=be,we[0+v]=j+oe,we[7+v]=j-oe,we[1+v]=ne+he,we[6+v]=ne-he,we[2+v]=se+ve,we[5+v]=se-ve,we[3+v]=xe+Me,we[4+v]=xe-Me}for(R=0;R<8;++R){var b=R;if(we[8+b]==0&&we[16+b]==0&&we[24+b]==0&&we[32+b]==0&&we[40+b]==0&&we[48+b]==0&&we[56+b]==0){be=d*q[R+0]+8192>>14,we[0+b]=be,we[8+b]=be,we[16+b]=be,we[24+b]=be,we[32+b]=be,we[40+b]=be,we[48+b]=be,we[56+b]=be;continue}j=d*we[0+b]+2048>>12,ne=d*we[32+b]+2048>>12,se=we[16+b],xe=we[48+b],Me=p*(we[8+b]-we[56+b])+2048>>12,oe=p*(we[8+b]+we[56+b])+2048>>12,ve=we[24+b],he=we[40+b],be=j-ne+1>>1,j=j+ne+1>>1,ne=be,be=se*u+xe*f+2048>>12,se=se*f-xe*u+2048>>12,xe=be,be=Me-he+1>>1,Me=Me+he+1>>1,he=be,be=oe+ve+1>>1,ve=oe-ve+1>>1,oe=be,be=j-xe+1>>1,j=j+xe+1>>1,xe=be,be=ne-se+1>>1,ne=ne+se+1>>1,se=be,be=Me*h+oe*s+2048>>12,Me=Me*s-oe*h+2048>>12,oe=be,be=ve*o+he*l+2048>>12,ve=ve*l-he*o+2048>>12,he=be,we[0+b]=j+oe,we[56+b]=j-oe,we[8+b]=ne+he,we[48+b]=ne-he,we[16+b]=se+ve,we[40+b]=se-ve,we[24+b]=xe+Me,we[32+b]=xe-Me}for(R=0;R<64;++R){var P=128+(we[R]+8>>4);_e[R]=P<0?0:P>255?255:P}}U(G*$*8);for(var H,Q,K=0;K<$;K++){var te=K<<3;for(H=0;H<8;H++)E.push(new Uint8Array(G));for(var X=0;X<S;X++){z(w.blocks[K][X],O,L);var J=0,ie=X<<3;for(Q=0;Q<8;Q++){var de=E[te+Q];for(H=0;H<8;H++)de[ie+H]=O[J++]}}}return E}function B(C){return C<0?0:C>255?255:C}m.prototype={load:function(w){var E=new XMLHttpRequest;E.open("GET",w,!0),E.responseType="arraybuffer",E.onload=(function(){var S=new Uint8Array(E.response||E.mozResponseArrayBuffer);this.parse(S),this.onload&&this.onload()}).bind(this),E.send(null)},parse:function(w){var E=this.opts.maxResolutionInMP*1e3*1e3,S=0;w.length;function $(){var pe=w[S]<<8|w[S+1];return S+=2,pe}function G(){var pe=$(),le=w.subarray(S,S+pe-2);return S+=le.length,le}function L(pe){var le=1,Ae=1,Z,ue;for(ue in pe.components)pe.components.hasOwnProperty(ue)&&(Z=pe.components[ue],le<Z.h&&(le=Z.h),Ae<Z.v&&(Ae=Z.v));var F=Math.ceil(pe.samplesPerLine/8/le),ye=Math.ceil(pe.scanLines/8/Ae);for(ue in pe.components)if(pe.components.hasOwnProperty(ue)){Z=pe.components[ue];var Te=Math.ceil(Math.ceil(pe.samplesPerLine/8)*Z.h/le),_=Math.ceil(Math.ceil(pe.scanLines/8)*Z.v/Ae),fe=F*Z.h,ge=ye*Z.v,D=ge*fe,ee=[];U(D*256);for(var ce=0;ce<ge;ce++){for(var De=[],Fe=0;Fe<fe;Fe++)De.push(new Int32Array(64));ee.push(De)}Z.blocksPerLine=Te,Z.blocksPerColumn=_,Z.blocks=ee}pe.maxH=le,pe.maxV=Ae,pe.mcusPerLine=F,pe.mcusPerColumn=ye}var O=null,z=null,H,Q,K=[],te=[],X=[],J=[],ie=$(),de=-1;if(this.comments=[],ie!=65496)throw new Error("SOI not found");for(ie=$();ie!=65497;){var me,_e;switch(ie){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var q=G();if(ie===65534){var V=String.fromCharCode.apply(null,q);this.comments.push(V)}ie===65504&&q[0]===74&&q[1]===70&&q[2]===73&&q[3]===70&&q[4]===0&&(O={version:{major:q[5],minor:q[6]},densityUnits:q[7],xDensity:q[8]<<8|q[9],yDensity:q[10]<<8|q[11],thumbWidth:q[12],thumbHeight:q[13],thumbData:q.subarray(14,14+3*q[12]*q[13])}),ie===65505&&q[0]===69&&q[1]===120&&q[2]===105&&q[3]===102&&q[4]===0&&(this.exifBuffer=q.subarray(5,q.length)),ie===65518&&q[0]===65&&q[1]===100&&q[2]===111&&q[3]===98&&q[4]===101&&q[5]===0&&(z={version:q[6],flags0:q[7]<<8|q[8],flags1:q[9]<<8|q[10],transformCode:q[11]});break;case 65499:for(var j=$(),ne=j+S-2;S<ne;){var se=w[S++];U(256);var xe=new Int32Array(64);if(se>>4)if(se>>4===1)for(_e=0;_e<64;_e++){var Me=a[_e];xe[Me]=$()}else throw new Error("DQT: invalid table spec");else for(_e=0;_e<64;_e++){var Me=a[_e];xe[Me]=w[S++]}K[se&15]=xe}break;case 65472:case 65473:case 65474:$(),H={},H.extended=ie===65473,H.progressive=ie===65474,H.precision=w[S++],H.scanLines=$(),H.samplesPerLine=$(),H.components={},H.componentsOrder=[];var ve=H.scanLines*H.samplesPerLine;if(ve>E){var he=Math.ceil((ve-E)/1e6);throw new Error(`maxResolutionInMP limit exceeded by ${he}MP`)}var oe=w[S++],be;for(me=0;me<oe;me++){be=w[S];var we=w[S+1]>>4,R=w[S+1]&15,v=w[S+2];if(we<=0||R<=0)throw new Error("Invalid sampling factor, expected values above 0");H.componentsOrder.push(be),H.components[be]={h:we,v:R,quantizationIdx:v},S+=3}L(H),te.push(H);break;case 65476:var b=$();for(me=2;me<b;){var P=w[S++],W=new Uint8Array(16),re=0;for(_e=0;_e<16;_e++,S++)re+=W[_e]=w[S];U(16+re);var ae=new Uint8Array(re);for(_e=0;_e<re;_e++,S++)ae[_e]=w[S];me+=17+re,(P>>4?X:J)[P&15]=A(W,ae)}break;case 65501:$(),Q=$();break;case 65500:$(),$();break;case 65498:$();var Ee=w[S++],Ce=[],Pe;for(me=0;me<Ee;me++){Pe=H.components[w[S++]];var Be=w[S++];Pe.huffmanTableDC=J[Be>>4],Pe.huffmanTableAC=X[Be&15],Ce.push(Pe)}var Se=w[S++],ke=w[S++],Ie=w[S++],Le=k(w,S,H,Ce,Q,Se,ke,Ie>>4,Ie&15,this.opts);S+=Le;break;case 65535:w[S]!==255&&S--;break;default:if(w[S-3]==255&&w[S-2]>=192&&w[S-2]<=254){S-=3;break}else if(ie===224||ie==225){if(de!==-1)throw new Error(`first unknown JPEG marker at offset ${de.toString(16)}, second unknown JPEG marker ${ie.toString(16)} at offset ${(S-1).toString(16)}`);de=S-1;const pe=$();if(w[S+pe-2]===255){S+=pe-2;break}}throw new Error("unknown JPEG marker "+ie.toString(16))}ie=$()}if(te.length!=1)throw new Error("only single frame JPEGs supported");for(var me=0;me<te.length;me++){var N=te[me].components;for(var _e in N)N[_e].quantizationTable=K[N[_e].quantizationIdx],delete N[_e].quantizationIdx}this.width=H.samplesPerLine,this.height=H.scanLines,this.jfif=O,this.adobe=z,this.components=[];for(var me=0;me<H.componentsOrder.length;me++){var Pe=H.components[H.componentsOrder[me]];this.components.push({lines:I(H,Pe),scaleX:Pe.h/H.maxH,scaleY:Pe.v/H.maxV})}},getData:function(w,E){var S=this.width/w,$=this.height/E,G,L,O,z,H,Q,K,te,X,J,ie=0,de,me,_e,q,V,j,ne,se,xe,Me,ve,he=w*E*this.components.length;U(he);var oe=new Uint8Array(he);switch(this.components.length){case 1:for(G=this.components[0],J=0;J<E;J++)for(H=G.lines[0|J*G.scaleY*$],X=0;X<w;X++)de=H[0|X*G.scaleX*S],oe[ie++]=de;break;case 2:for(G=this.components[0],L=this.components[1],J=0;J<E;J++)for(H=G.lines[0|J*G.scaleY*$],Q=L.lines[0|J*L.scaleY*$],X=0;X<w;X++)de=H[0|X*G.scaleX*S],oe[ie++]=de,de=Q[0|X*L.scaleX*S],oe[ie++]=de;break;case 3:for(ve=!0,this.adobe&&this.adobe.transformCode?ve=!0:typeof this.opts.colorTransform<"u"&&(ve=!!this.opts.colorTransform),G=this.components[0],L=this.components[1],O=this.components[2],J=0;J<E;J++)for(H=G.lines[0|J*G.scaleY*$],Q=L.lines[0|J*L.scaleY*$],K=O.lines[0|J*O.scaleY*$],X=0;X<w;X++)ve?(de=H[0|X*G.scaleX*S],me=Q[0|X*L.scaleX*S],_e=K[0|X*O.scaleX*S],se=B(de+1.402*(_e-128)),xe=B(de-.3441363*(me-128)-.71413636*(_e-128)),Me=B(de+1.772*(me-128))):(se=H[0|X*G.scaleX*S],xe=Q[0|X*L.scaleX*S],Me=K[0|X*O.scaleX*S]),oe[ie++]=se,oe[ie++]=xe,oe[ie++]=Me;break;case 4:if(!this.adobe)throw new Error("Unsupported color mode (4 components)");for(ve=!1,this.adobe&&this.adobe.transformCode?ve=!0:typeof this.opts.colorTransform<"u"&&(ve=!!this.opts.colorTransform),G=this.components[0],L=this.components[1],O=this.components[2],z=this.components[3],J=0;J<E;J++)for(H=G.lines[0|J*G.scaleY*$],Q=L.lines[0|J*L.scaleY*$],K=O.lines[0|J*O.scaleY*$],te=z.lines[0|J*z.scaleY*$],X=0;X<w;X++)ve?(de=H[0|X*G.scaleX*S],me=Q[0|X*L.scaleX*S],_e=K[0|X*O.scaleX*S],q=te[0|X*z.scaleX*S],V=255-B(de+1.402*(_e-128)),j=255-B(de-.3441363*(me-128)-.71413636*(_e-128)),ne=255-B(de+1.772*(me-128))):(V=H[0|X*G.scaleX*S],j=Q[0|X*L.scaleX*S],ne=K[0|X*O.scaleX*S],q=te[0|X*z.scaleX*S]),oe[ie++]=255-V,oe[ie++]=255-j,oe[ie++]=255-ne,oe[ie++]=255-q;break;default:throw new Error("Unsupported color mode")}return oe},copyToImageData:function(w,E){var S=w.width,$=w.height,G=w.data,L=this.getData(S,$),O=0,z=0,H,Q,K,te,X,J,ie,de,me;switch(this.components.length){case 1:for(Q=0;Q<$;Q++)for(H=0;H<S;H++)K=L[O++],G[z++]=K,G[z++]=K,G[z++]=K,E&&(G[z++]=255);break;case 3:for(Q=0;Q<$;Q++)for(H=0;H<S;H++)ie=L[O++],de=L[O++],me=L[O++],G[z++]=ie,G[z++]=de,G[z++]=me,E&&(G[z++]=255);break;case 4:for(Q=0;Q<$;Q++)for(H=0;H<S;H++)X=L[O++],J=L[O++],K=L[O++],te=L[O++],ie=255-B(X*(1-te/255)+te),de=255-B(J*(1-te/255)+te),me=255-B(K*(1-te/255)+te),G[z++]=ie,G[z++]=de,G[z++]=me,E&&(G[z++]=255);break;default:throw new Error("Unsupported color mode")}}};var M=0,T=0;function U(C=0){var w=M+C;if(w>T){var E=Math.ceil((w-T)/1024/1024);throw new Error(`maxMemoryUsageInMB limit exceeded by at least ${E}MB`)}M=w}return m.resetMaxMemoryUsage=function(C){M=0,T=C},m.getBytesAllocated=function(){return M},m.requestMemoryAllocation=U,m}();e.exports=r;function r(n,a={}){var l={colorTransform:void 0,useTArray:!1,formatAsRGBA:!0,tolerantDecoding:!0,maxResolutionInMP:100,maxMemoryUsageInMB:512},o={...l,...a},s=new Uint8Array(n),h=new t;h.opts=o,t.resetMaxMemoryUsage(o.maxMemoryUsageInMB*1024*1024),h.parse(s);var f=o.formatAsRGBA?4:3,u=h.width*h.height*f;try{t.requestMemoryAllocation(u);var d={width:h.width,height:h.height,exifBuffer:h.exifBuffer,data:o.useTArray?new Uint8Array(u):Buffer.alloc(u)};h.comments.length>0&&(d.comments=h.comments)}catch(p){throw p instanceof RangeError?new Error("Could not allocate enough memory for the image. Required: "+u):p instanceof ReferenceError&&p.message==="Buffer is not defined"?new Error("Buffer is not globally defined in this environment. Consider setting useTArray to true"):p}return h.copyToImageData(d,o.formatAsRGBA),d}})(decoder$1);var decoderExports=decoder$1.exports,encode$2=encoderExports,decode$2=decoderExports,jpegJs={encode:encode$2,decode:decode$2};const JPEG=getDefaultExportFromCjs(jpegJs),MIME_TYPE$4="image/jpeg",jpeg=()=>({mime:{[MIME_TYPE$4]:["jpeg","jpg","jpe"]},constants:{MIME_JPEG:MIME_TYPE$4},decoders:{[MIME_TYPE$4]:JPEG.decode},encoders:{[MIME_TYPE$4]:e=>JPEG.encode(e.bitmap,e._quality).data},class:{_quality:100,quality(e,t){return typeof e!="number"?throwError.call(this,"n must be a number",t):e<0||e>100?throwError.call(this,"n must be a number 0 - 100",t):(this._quality=Math.round(e),isNodePattern(t)&&t.call(this,null,this),this)}}});var parserAsync={exports:{}},chunkstream={exports:{}};let util$4=require$$0,Stream$2=require$$0,ChunkStream$2=chunkstream.exports=function(){Stream$2.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};util$4.inherits(ChunkStream$2,Stream$2);ChunkStream$2.prototype.read=function(e,t){this._reads.push({length:Math.abs(e),allowLess:e<0,func:t}),process.nextTick((function(){this._process(),this._paused&&this._reads&&this._reads.length>0&&(this._paused=!1,this.emit("drain"))}).bind(this))};ChunkStream$2.prototype.write=function(e,t){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let r;return Buffer.isBuffer(e)?r=e:r=Buffer.from(e,t||this._encoding),this._buffers.push(r),this._buffered+=r.length,this._process(),this._reads&&this._reads.length===0&&(this._paused=!0),this.writable&&!this._paused};ChunkStream$2.prototype.end=function(e,t){e&&this.write(e,t),this.writable=!1,this._buffers&&(this._buffers.length===0?this._end():(this._buffers.push(null),this._process()))};ChunkStream$2.prototype.destroySoon=ChunkStream$2.prototype.end;ChunkStream$2.prototype._end=function(){this._reads.length>0&&this.emit("error",new Error("Unexpected end of input")),this.destroy()};ChunkStream$2.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))};ChunkStream$2.prototype._processReadAllowingLess=function(e){this._reads.shift();let t=this._buffers[0];t.length>e.length?(this._buffered-=e.length,this._buffers[0]=t.slice(e.length),e.func.call(this,t.slice(0,e.length))):(this._buffered-=t.length,this._buffers.shift(),e.func.call(this,t))};ChunkStream$2.prototype._processRead=function(e){this._reads.shift();let t=0,r=0,n=Buffer.alloc(e.length);for(;t<e.length;){let a=this._buffers[r++],l=Math.min(a.length,e.length-t);a.copy(n,t,0,l),t+=l,l!==a.length&&(this._buffers[--r]=a.slice(l))}r>0&&this._buffers.splice(0,r),this._buffered-=e.length,e.func.call(this,n)};ChunkStream$2.prototype._process=function(){try{for(;this._buffered>0&&this._reads&&this._reads.length>0;){let e=this._reads[0];if(e.allowLess)this._processReadAllowingLess(e);else if(this._buffered>=e.length)this._processRead(e);else break}this._buffers&&!this.writable&&this._end()}catch(e){this.emit("error",e)}};var chunkstreamExports=chunkstream.exports,filterParseAsync={exports:{}},filterParse={exports:{}},interlace={};let imagePasses=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];interlace.getImagePasses=function(e,t){let r=[],n=e%8,a=t%8,l=(e-n)/8,o=(t-a)/8;for(let s=0;s<imagePasses.length;s++){let h=imagePasses[s],f=l*h.x.length,u=o*h.y.length;for(let d=0;d<h.x.length&&h.x[d]<n;d++)f++;for(let d=0;d<h.y.length&&h.y[d]<a;d++)u++;f>0&&u>0&&r.push({width:f,height:u,index:s})}return r};interlace.getInterlaceIterator=function(e){return function(t,r,n){let a=t%imagePasses[n].x.length,l=(t-a)/imagePasses[n].x.length*8+imagePasses[n].x[a],o=r%imagePasses[n].y.length,s=(r-o)/imagePasses[n].y.length*8+imagePasses[n].y[o];return l*4+s*e*4}};var paethPredictor$2=function e(t,r,n){let a=t+r-n,l=Math.abs(a-t),o=Math.abs(a-r),s=Math.abs(a-n);return l<=o&&l<=s?t:o<=s?r:n};let interlaceUtils$1=interlace,paethPredictor$1=paethPredictor$2;function getByteWidth(e,t,r){let n=e*t;return r!==8&&(n=Math.ceil(n/(8/r))),n}let Filter$2=filterParse.exports=function(e,t){let r=e.width,n=e.height,a=e.interlace,l=e.bpp,o=e.depth;if(this.read=t.read,this.write=t.write,this.complete=t.complete,this._imageIndex=0,this._images=[],a){let s=interlaceUtils$1.getImagePasses(r,n);for(let h=0;h<s.length;h++)this._images.push({byteWidth:getByteWidth(s[h].width,l,o),height:s[h].height,lineIndex:0})}else this._images.push({byteWidth:getByteWidth(r,l,o),height:n,lineIndex:0});o===8?this._xComparison=l:o===16?this._xComparison=l*2:this._xComparison=1};Filter$2.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))};Filter$2.prototype._unFilterType1=function(e,t,r){let n=this._xComparison,a=n-1;for(let l=0;l<r;l++){let o=e[1+l],s=l>a?t[l-n]:0;t[l]=o+s}};Filter$2.prototype._unFilterType2=function(e,t,r){let n=this._lastLine;for(let a=0;a<r;a++){let l=e[1+a],o=n?n[a]:0;t[a]=l+o}};Filter$2.prototype._unFilterType3=function(e,t,r){let n=this._xComparison,a=n-1,l=this._lastLine;for(let o=0;o<r;o++){let s=e[1+o],h=l?l[o]:0,f=o>a?t[o-n]:0,u=Math.floor((f+h)/2);t[o]=s+u}};Filter$2.prototype._unFilterType4=function(e,t,r){let n=this._xComparison,a=n-1,l=this._lastLine;for(let o=0;o<r;o++){let s=e[1+o],h=l?l[o]:0,f=o>a?t[o-n]:0,u=o>a&&l?l[o-n]:0,d=paethPredictor$1(f,h,u);t[o]=s+d}};Filter$2.prototype._reverseFilterLine=function(e){let t=e[0],r,n=this._images[this._imageIndex],a=n.byteWidth;if(t===0)r=e.slice(1,a+1);else switch(r=Buffer.alloc(a),t){case 1:this._unFilterType1(e,r,a);break;case 2:this._unFilterType2(e,r,a);break;case 3:this._unFilterType3(e,r,a);break;case 4:this._unFilterType4(e,r,a);break;default:throw new Error("Unrecognised filter type - "+t)}this.write(r),n.lineIndex++,n.lineIndex>=n.height?(this._lastLine=null,this._imageIndex++,n=this._images[this._imageIndex]):this._lastLine=r,n?this.read(n.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())};var filterParseExports=filterParse.exports;let util$3=require$$0,ChunkStream$1=chunkstreamExports,Filter$1=filterParseExports,FilterAsync$1=filterParseAsync.exports=function(e){ChunkStream$1.call(this);let t=[],r=this;this._filter=new Filter$1(e,{read:this.read.bind(this),write:function(n){t.push(n)},complete:function(){r.emit("complete",Buffer.concat(t))}}),this._filter.start()};util$3.inherits(FilterAsync$1,ChunkStream$1);var filterParseAsyncExports=filterParseAsync.exports,parser={exports:{}},constants$6={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5},crc={exports:{}};let crcTable=[];(function(){for(let e=0;e<256;e++){let t=e;for(let r=0;r<8;r++)t&1?t=3988292384^t>>>1:t=t>>>1;crcTable[e]=t}})();let CrcCalculator$1=crc.exports=function(){this._crc=-1};CrcCalculator$1.prototype.write=function(e){for(let t=0;t<e.length;t++)this._crc=crcTable[(this._crc^e[t])&255]^this._crc>>>8;return!0};CrcCalculator$1.prototype.crc32=function(){return this._crc^-1};CrcCalculator$1.crc32=function(e){let t=-1;for(let r=0;r<e.length;r++)t=crcTable[(t^e[r])&255]^t>>>8;return t^-1};var crcExports=crc.exports;let constants$5=constants$6,CrcCalculator=crcExports,Parser$3=parser.exports=function(e,t){this._options=e,e.checkCRC=e.checkCRC!==!1,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[constants$5.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[constants$5.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[constants$5.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[constants$5.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[constants$5.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[constants$5.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=t.read,this.error=t.error,this.metadata=t.metadata,this.gamma=t.gamma,this.transColor=t.transColor,this.palette=t.palette,this.parsed=t.parsed,this.inflateData=t.inflateData,this.finished=t.finished,this.simpleTransparency=t.simpleTransparency,this.headersFinished=t.headersFinished||function(){}};Parser$3.prototype.start=function(){this.read(constants$5.PNG_SIGNATURE.length,this._parseSignature.bind(this))};Parser$3.prototype._parseSignature=function(e){let t=constants$5.PNG_SIGNATURE;for(let r=0;r<t.length;r++)if(e[r]!==t[r]){this.error(new Error("Invalid file signature"));return}this.read(8,this._parseChunkBegin.bind(this))};Parser$3.prototype._parseChunkBegin=function(e){let t=e.readUInt32BE(0),r=e.readUInt32BE(4),n="";for(let l=4;l<8;l++)n+=String.fromCharCode(e[l]);let a=!!(e[4]&32);if(!this._hasIHDR&&r!==constants$5.TYPE_IHDR){this.error(new Error("Expected IHDR on beggining"));return}if(this._crc=new CrcCalculator,this._crc.write(Buffer.from(n)),this._chunks[r])return this._chunks[r](t);if(!a){this.error(new Error("Unsupported critical chunk type "+n));return}this.read(t+4,this._skipChunk.bind(this))};Parser$3.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))};Parser$3.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))};Parser$3.prototype._parseChunkEnd=function(e){let t=e.readInt32BE(0),r=this._crc.crc32();if(this._options.checkCRC&&r!==t){this.error(new Error("Crc error - "+t+" - "+r));return}this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))};Parser$3.prototype._handleIHDR=function(e){this.read(e,this._parseIHDR.bind(this))};Parser$3.prototype._parseIHDR=function(e){this._crc.write(e);let t=e.readUInt32BE(0),r=e.readUInt32BE(4),n=e[8],a=e[9],l=e[10],o=e[11],s=e[12];if(n!==8&&n!==4&&n!==2&&n!==1&&n!==16){this.error(new Error("Unsupported bit depth "+n));return}if(!(a in constants$5.COLORTYPE_TO_BPP_MAP)){this.error(new Error("Unsupported color type"));return}if(l!==0){this.error(new Error("Unsupported compression method"));return}if(o!==0){this.error(new Error("Unsupported filter method"));return}if(s!==0&&s!==1){this.error(new Error("Unsupported interlace method"));return}this._colorType=a;let h=constants$5.COLORTYPE_TO_BPP_MAP[this._colorType];this._hasIHDR=!0,this.metadata({width:t,height:r,depth:n,interlace:!!s,palette:!!(a&constants$5.COLORTYPE_PALETTE),color:!!(a&constants$5.COLORTYPE_COLOR),alpha:!!(a&constants$5.COLORTYPE_ALPHA),bpp:h,colorType:a}),this._handleChunkEnd()};Parser$3.prototype._handlePLTE=function(e){this.read(e,this._parsePLTE.bind(this))};Parser$3.prototype._parsePLTE=function(e){this._crc.write(e);let t=Math.floor(e.length/3);for(let r=0;r<t;r++)this._palette.push([e[r*3],e[r*3+1],e[r*3+2],255]);this.palette(this._palette),this._handleChunkEnd()};Parser$3.prototype._handleTRNS=function(e){this.simpleTransparency(),this.read(e,this._parseTRNS.bind(this))};Parser$3.prototype._parseTRNS=function(e){if(this._crc.write(e),this._colorType===constants$5.COLORTYPE_PALETTE_COLOR){if(this._palette.length===0){this.error(new Error("Transparency chunk must be after palette"));return}if(e.length>this._palette.length){this.error(new Error("More transparent colors than palette size"));return}for(let t=0;t<e.length;t++)this._palette[t][3]=e[t];this.palette(this._palette)}this._colorType===constants$5.COLORTYPE_GRAYSCALE&&this.transColor([e.readUInt16BE(0)]),this._colorType===constants$5.COLORTYPE_COLOR&&this.transColor([e.readUInt16BE(0),e.readUInt16BE(2),e.readUInt16BE(4)]),this._handleChunkEnd()};Parser$3.prototype._handleGAMA=function(e){this.read(e,this._parseGAMA.bind(this))};Parser$3.prototype._parseGAMA=function(e){this._crc.write(e),this.gamma(e.readUInt32BE(0)/constants$5.GAMMA_DIVISION),this._handleChunkEnd()};Parser$3.prototype._handleIDAT=function(e){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-e,this._parseIDAT.bind(this,e))};Parser$3.prototype._parseIDAT=function(e,t){if(this._crc.write(t),this._colorType===constants$5.COLORTYPE_PALETTE_COLOR&&this._palette.length===0)throw new Error("Expected palette not found");this.inflateData(t);let r=e-t.length;r>0?this._handleIDAT(r):this._handleChunkEnd()};Parser$3.prototype._handleIEND=function(e){this.read(e,this._parseIEND.bind(this))};Parser$3.prototype._parseIEND=function(e){this._crc.write(e),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()};var parserExports=parser.exports,bitmapper$2={};let interlaceUtils=interlace,pixelBppMapper=[function(){},function(e,t,r,n){if(n===t.length)throw new Error("Ran out of data");let a=t[n];e[r]=a,e[r+1]=a,e[r+2]=a,e[r+3]=255},function(e,t,r,n){if(n+1>=t.length)throw new Error("Ran out of data");let a=t[n];e[r]=a,e[r+1]=a,e[r+2]=a,e[r+3]=t[n+1]},function(e,t,r,n){if(n+2>=t.length)throw new Error("Ran out of data");e[r]=t[n],e[r+1]=t[n+1],e[r+2]=t[n+2],e[r+3]=255},function(e,t,r,n){if(n+3>=t.length)throw new Error("Ran out of data");e[r]=t[n],e[r+1]=t[n+1],e[r+2]=t[n+2],e[r+3]=t[n+3]}],pixelBppCustomMapper=[function(){},function(e,t,r,n){let a=t[0];e[r]=a,e[r+1]=a,e[r+2]=a,e[r+3]=n},function(e,t,r){let n=t[0];e[r]=n,e[r+1]=n,e[r+2]=n,e[r+3]=t[1]},function(e,t,r,n){e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=n},function(e,t,r){e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3]}];function bitRetriever(e,t){let r=[],n=0;function a(){if(n===e.length)throw new Error("Ran out of data");let l=e[n];n++;let o,s,h,f,u,d,p,m;switch(t){default:throw new Error("unrecognised depth");case 16:p=e[n],n++,r.push((l<<8)+p);break;case 4:p=l&15,m=l>>4,r.push(m,p);break;case 2:u=l&3,d=l>>2&3,p=l>>4&3,m=l>>6&3,r.push(m,p,d,u);break;case 1:o=l&1,s=l>>1&1,h=l>>2&1,f=l>>3&1,u=l>>4&1,d=l>>5&1,p=l>>6&1,m=l>>7&1,r.push(m,p,d,u,f,h,s,o);break}}return{get:function(l){for(;r.length<l;)a();let o=r.slice(0,l);return r=r.slice(l),o},resetAfterLine:function(){r.length=0},end:function(){if(n!==e.length)throw new Error("extra data found")}}}function mapImage8Bit(e,t,r,n,a,l){let o=e.width,s=e.height,h=e.index;for(let f=0;f<s;f++)for(let u=0;u<o;u++){let d=r(u,f,h);pixelBppMapper[n](t,a,d,l),l+=n}return l}function mapImageCustomBit(e,t,r,n,a,l){let o=e.width,s=e.height,h=e.index;for(let f=0;f<s;f++){for(let u=0;u<o;u++){let d=a.get(n),p=r(u,f,h);pixelBppCustomMapper[n](t,d,p,l)}a.resetAfterLine()}}bitmapper$2.dataToBitMap=function(e,t){let r=t.width,n=t.height,a=t.depth,l=t.bpp,o=t.interlace,s;a!==8&&(s=bitRetriever(e,a));let h;a<=8?h=Buffer.alloc(r*n*4):h=new Uint16Array(r*n*4);let f=Math.pow(2,a)-1,u=0,d,p;if(o)d=interlaceUtils.getImagePasses(r,n),p=interlaceUtils.getInterlaceIterator(r,n);else{let m=0;p=function(){let A=m;return m+=4,A},d=[{width:r,height:n}]}for(let m=0;m<d.length;m++)a===8?u=mapImage8Bit(d[m],h,p,l,e,u):mapImageCustomBit(d[m],h,p,l,s,f);if(a===8){if(u!==e.length)throw new Error("extra data found")}else s.end();return h};function dePalette(e,t,r,n,a){let l=0;for(let o=0;o<n;o++)for(let s=0;s<r;s++){let h=a[e[l]];if(!h)throw new Error("index "+e[l]+" not in palette");for(let f=0;f<4;f++)t[l+f]=h[f];l+=4}}function replaceTransparentColor(e,t,r,n,a){let l=0;for(let o=0;o<n;o++)for(let s=0;s<r;s++){let h=!1;if(a.length===1?a[0]===e[l]&&(h=!0):a[0]===e[l]&&a[1]===e[l+1]&&a[2]===e[l+2]&&(h=!0),h)for(let f=0;f<4;f++)t[l+f]=0;l+=4}}function scaleDepth(e,t,r,n,a){let l=255,o=Math.pow(2,a)-1,s=0;for(let h=0;h<n;h++)for(let f=0;f<r;f++){for(let u=0;u<4;u++)t[s+u]=Math.floor(e[s+u]*l/o+.5);s+=4}}var formatNormaliser$2=function(e,t,r=!1){let n=t.depth,a=t.width,l=t.height,o=t.colorType,s=t.transColor,h=t.palette,f=e;return o===3?dePalette(e,f,a,l,h):(s&&replaceTransparentColor(e,f,a,l,s),n!==8&&!r&&(n===16&&(f=Buffer.alloc(a*l*4)),scaleDepth(e,f,a,l,n))),f};let util$2=require$$0,zlib$3=require$$0,ChunkStream=chunkstreamExports,FilterAsync=filterParseAsyncExports,Parser$2=parserExports,bitmapper$1=bitmapper$2,formatNormaliser$1=formatNormaliser$2,ParserAsync=parserAsync.exports=function(e){ChunkStream.call(this),this._parser=new Parser$2(e,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=e,this.writable=!0,this._parser.start()};util$2.inherits(ParserAsync,ChunkStream);ParserAsync.prototype._handleError=function(e){this.emit("error",e),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0};ParserAsync.prototype._inflateData=function(e){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=zlib$3.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{let r=((this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3)+1)*this._bitmapInfo.height,n=Math.max(r,zlib$3.Z_MIN_CHUNK);this._inflate=zlib$3.createInflate({chunkSize:n});let a=r,l=this.emit.bind(this,"error");this._inflate.on("error",function(s){a&&l(s)}),this._filter.on("complete",this._complete.bind(this));let o=this._filter.write.bind(this._filter);this._inflate.on("data",function(s){a&&(s.length>a&&(s=s.slice(0,a)),a-=s.length,o(s))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(e)};ParserAsync.prototype._handleMetaData=function(e){this._metaData=e,this._bitmapInfo=Object.create(e),this._filter=new FilterAsync(this._bitmapInfo)};ParserAsync.prototype._handleTransColor=function(e){this._bitmapInfo.transColor=e};ParserAsync.prototype._handlePalette=function(e){this._bitmapInfo.palette=e};ParserAsync.prototype._simpleTransparency=function(){this._metaData.alpha=!0};ParserAsync.prototype._headersFinished=function(){this.emit("metadata",this._metaData)};ParserAsync.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))};ParserAsync.prototype._complete=function(e){if(this.errord)return;let t;try{let r=bitmapper$1.dataToBitMap(e,this._bitmapInfo);t=formatNormaliser$1(r,this._bitmapInfo,this._options.skipRescale),r=null}catch(r){this._handleError(r);return}this.emit("parsed",t)};var parserAsyncExports=parserAsync.exports,packerAsync={exports:{}},packer={exports:{}};let constants$4=constants$6;var bitpacker=function(e,t,r,n){let a=[constants$4.COLORTYPE_COLOR_ALPHA,constants$4.COLORTYPE_ALPHA].indexOf(n.colorType)!==-1;if(n.colorType===n.inputColorType){let A=function(){let k=new ArrayBuffer(2);return new DataView(k).setInt16(0,256,!0),new Int16Array(k)[0]!==256}();if(n.bitDepth===8||n.bitDepth===16&&A)return e}let l=n.bitDepth!==16?e:new Uint16Array(e.buffer),o=255,s=constants$4.COLORTYPE_TO_BPP_MAP[n.inputColorType];s===4&&!n.inputHasAlpha&&(s=3);let h=constants$4.COLORTYPE_TO_BPP_MAP[n.colorType];n.bitDepth===16&&(o=65535,h*=2);let f=Buffer.alloc(t*r*h),u=0,d=0,p=n.bgColor||{};p.red===void 0&&(p.red=o),p.green===void 0&&(p.green=o),p.blue===void 0&&(p.blue=o);function m(){let A,k,I,B=o;switch(n.inputColorType){case constants$4.COLORTYPE_COLOR_ALPHA:B=l[u+3],A=l[u],k=l[u+1],I=l[u+2];break;case constants$4.COLORTYPE_COLOR:A=l[u],k=l[u+1],I=l[u+2];break;case constants$4.COLORTYPE_ALPHA:B=l[u+1],A=l[u],k=A,I=A;break;case constants$4.COLORTYPE_GRAYSCALE:A=l[u],k=A,I=A;break;default:throw new Error("input color type:"+n.inputColorType+" is not supported at present")}return n.inputHasAlpha&&(a||(B/=o,A=Math.min(Math.max(Math.round((1-B)*p.red+B*A),0),o),k=Math.min(Math.max(Math.round((1-B)*p.green+B*k),0),o),I=Math.min(Math.max(Math.round((1-B)*p.blue+B*I),0),o))),{red:A,green:k,blue:I,alpha:B}}for(let A=0;A<r;A++)for(let k=0;k<t;k++){let I=m();switch(n.colorType){case constants$4.COLORTYPE_COLOR_ALPHA:case constants$4.COLORTYPE_COLOR:n.bitDepth===8?(f[d]=I.red,f[d+1]=I.green,f[d+2]=I.blue,a&&(f[d+3]=I.alpha)):(f.writeUInt16BE(I.red,d),f.writeUInt16BE(I.green,d+2),f.writeUInt16BE(I.blue,d+4),a&&f.writeUInt16BE(I.alpha,d+6));break;case constants$4.COLORTYPE_ALPHA:case constants$4.COLORTYPE_GRAYSCALE:{let B=(I.red+I.green+I.blue)/3;n.bitDepth===8?(f[d]=B,a&&(f[d+1]=I.alpha)):(f.writeUInt16BE(B,d),a&&f.writeUInt16BE(I.alpha,d+2));break}default:throw new Error("unrecognised color Type "+n.colorType)}u+=s,d+=h}return f};let paethPredictor=paethPredictor$2;function filterNone(e,t,r,n,a){for(let l=0;l<r;l++)n[a+l]=e[t+l]}function filterSumNone(e,t,r){let n=0,a=t+r;for(let l=t;l<a;l++)n+=Math.abs(e[l]);return n}function filterSub(e,t,r,n,a,l){for(let o=0;o<r;o++){let s=o>=l?e[t+o-l]:0,h=e[t+o]-s;n[a+o]=h}}function filterSumSub(e,t,r,n){let a=0;for(let l=0;l<r;l++){let o=l>=n?e[t+l-n]:0,s=e[t+l]-o;a+=Math.abs(s)}return a}function filterUp(e,t,r,n,a){for(let l=0;l<r;l++){let o=t>0?e[t+l-r]:0,s=e[t+l]-o;n[a+l]=s}}function filterSumUp(e,t,r){let n=0,a=t+r;for(let l=t;l<a;l++){let o=t>0?e[l-r]:0,s=e[l]-o;n+=Math.abs(s)}return n}function filterAvg(e,t,r,n,a,l){for(let o=0;o<r;o++){let s=o>=l?e[t+o-l]:0,h=t>0?e[t+o-r]:0,f=e[t+o]-(s+h>>1);n[a+o]=f}}function filterSumAvg(e,t,r,n){let a=0;for(let l=0;l<r;l++){let o=l>=n?e[t+l-n]:0,s=t>0?e[t+l-r]:0,h=e[t+l]-(o+s>>1);a+=Math.abs(h)}return a}function filterPaeth(e,t,r,n,a,l){for(let o=0;o<r;o++){let s=o>=l?e[t+o-l]:0,h=t>0?e[t+o-r]:0,f=t>0&&o>=l?e[t+o-(r+l)]:0,u=e[t+o]-paethPredictor(s,h,f);n[a+o]=u}}function filterSumPaeth(e,t,r,n){let a=0;for(let l=0;l<r;l++){let o=l>=n?e[t+l-n]:0,s=t>0?e[t+l-r]:0,h=t>0&&l>=n?e[t+l-(r+n)]:0,f=e[t+l]-paethPredictor(o,s,h);a+=Math.abs(f)}return a}let filters={0:filterNone,1:filterSub,2:filterUp,3:filterAvg,4:filterPaeth},filterSums={0:filterSumNone,1:filterSumSub,2:filterSumUp,3:filterSumAvg,4:filterSumPaeth};var filterPack=function(e,t,r,n,a){let l;if(!("filterType"in n)||n.filterType===-1)l=[0,1,2,3,4];else if(typeof n.filterType=="number")l=[n.filterType];else throw new Error("unrecognised filter types");n.bitDepth===16&&(a*=2);let o=t*a,s=0,h=0,f=Buffer.alloc((o+1)*r),u=l[0];for(let d=0;d<r;d++){if(l.length>1){let p=1/0;for(let m=0;m<l.length;m++){let A=filterSums[l[m]](e,h,o,a);A<p&&(u=l[m],p=A)}}f[s]=u,s++,filters[u](e,h,o,f,s,a),s+=o,h+=o}return f};let constants$3=constants$6,CrcStream=crcExports,bitPacker=bitpacker,filter=filterPack,zlib$2=require$$0,Packer$3=packer.exports=function(e){if(this._options=e,e.deflateChunkSize=e.deflateChunkSize||32*1024,e.deflateLevel=e.deflateLevel!=null?e.deflateLevel:9,e.deflateStrategy=e.deflateStrategy!=null?e.deflateStrategy:3,e.inputHasAlpha=e.inputHasAlpha!=null?e.inputHasAlpha:!0,e.deflateFactory=e.deflateFactory||zlib$2.createDeflate,e.bitDepth=e.bitDepth||8,e.colorType=typeof e.colorType=="number"?e.colorType:constants$3.COLORTYPE_COLOR_ALPHA,e.inputColorType=typeof e.inputColorType=="number"?e.inputColorType:constants$3.COLORTYPE_COLOR_ALPHA,[constants$3.COLORTYPE_GRAYSCALE,constants$3.COLORTYPE_COLOR,constants$3.COLORTYPE_COLOR_ALPHA,constants$3.COLORTYPE_ALPHA].indexOf(e.colorType)===-1)throw new Error("option color type:"+e.colorType+" is not supported at present");if([constants$3.COLORTYPE_GRAYSCALE,constants$3.COLORTYPE_COLOR,constants$3.COLORTYPE_COLOR_ALPHA,constants$3.COLORTYPE_ALPHA].indexOf(e.inputColorType)===-1)throw new Error("option input color type:"+e.inputColorType+" is not supported at present");if(e.bitDepth!==8&&e.bitDepth!==16)throw new Error("option bit depth:"+e.bitDepth+" is not supported at present")};Packer$3.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}};Packer$3.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())};Packer$3.prototype.filterData=function(e,t,r){let n=bitPacker(e,t,r,this._options),a=constants$3.COLORTYPE_TO_BPP_MAP[this._options.colorType];return filter(n,t,r,this._options,a)};Packer$3.prototype._packChunk=function(e,t){let r=t?t.length:0,n=Buffer.alloc(r+12);return n.writeUInt32BE(r,0),n.writeUInt32BE(e,4),t&&t.copy(n,8),n.writeInt32BE(CrcStream.crc32(n.slice(4,n.length-4)),n.length-4),n};Packer$3.prototype.packGAMA=function(e){let t=Buffer.alloc(4);return t.writeUInt32BE(Math.floor(e*constants$3.GAMMA_DIVISION),0),this._packChunk(constants$3.TYPE_gAMA,t)};Packer$3.prototype.packIHDR=function(e,t){let r=Buffer.alloc(13);return r.writeUInt32BE(e,0),r.writeUInt32BE(t,4),r[8]=this._options.bitDepth,r[9]=this._options.colorType,r[10]=0,r[11]=0,r[12]=0,this._packChunk(constants$3.TYPE_IHDR,r)};Packer$3.prototype.packIDAT=function(e){return this._packChunk(constants$3.TYPE_IDAT,e)};Packer$3.prototype.packIEND=function(){return this._packChunk(constants$3.TYPE_IEND,null)};var packerExports=packer.exports;let util$1=require$$0,Stream$1=require$$0,constants$2=constants$6,Packer$2=packerExports,PackerAsync=packerAsync.exports=function(e){Stream$1.call(this);let t=e||{};this._packer=new Packer$2(t),this._deflate=this._packer.createDeflate(),this.readable=!0};util$1.inherits(PackerAsync,Stream$1);PackerAsync.prototype.pack=function(e,t,r,n){this.emit("data",Buffer.from(constants$2.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(t,r)),n&&this.emit("data",this._packer.packGAMA(n));let a=this._packer.filterData(e,t,r);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",(function(l){this.emit("data",this._packer.packIDAT(l))}).bind(this)),this._deflate.on("end",(function(){this.emit("data",this._packer.packIEND()),this.emit("end")}).bind(this)),this._deflate.end(a)};var packerAsyncExports=packerAsync.exports,pngSync={},syncInflate={exports:{}},buffer={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup[45]=62;revLookup[95]=63;function getLens(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");r===-1&&(r=t);var n=r===t?0:4-r%4;return[r,n]}function byteLength(e){var t=getLens(e),r=t[0],n=t[1];return(r+n)*3/4-n}function _byteLength(e,t,r){return(t+r)*3/4-r}function toByteArray(e){var t,r=getLens(e),n=r[0],a=r[1],l=new Arr(_byteLength(e,n,a)),o=0,s=a>0?n-4:n,h;for(h=0;h<s;h+=4)t=revLookup[e.charCodeAt(h)]<<18|revLookup[e.charCodeAt(h+1)]<<12|revLookup[e.charCodeAt(h+2)]<<6|revLookup[e.charCodeAt(h+3)],l[o++]=t>>16&255,l[o++]=t>>8&255,l[o++]=t&255;return a===2&&(t=revLookup[e.charCodeAt(h)]<<2|revLookup[e.charCodeAt(h+1)]>>4,l[o++]=t&255),a===1&&(t=revLookup[e.charCodeAt(h)]<<10|revLookup[e.charCodeAt(h+1)]<<4|revLookup[e.charCodeAt(h+2)]>>2,l[o++]=t>>8&255,l[o++]=t&255),l}function tripletToBase64(e){return lookup[e>>18&63]+lookup[e>>12&63]+lookup[e>>6&63]+lookup[e&63]}function encodeChunk(e,t,r){for(var n,a=[],l=t;l<r;l+=3)n=(e[l]<<16&16711680)+(e[l+1]<<8&65280)+(e[l+2]&255),a.push(tripletToBase64(n));return a.join("")}function fromByteArray(e){for(var t,r=e.length,n=r%3,a=[],l=16383,o=0,s=r-n;o<s;o+=l)a.push(encodeChunk(e,o,o+l>s?s:o+l));return n===1?(t=e[r-1],a.push(lookup[t>>2]+lookup[t<<4&63]+"==")):n===2&&(t=(e[r-2]<<8)+e[r-1],a.push(lookup[t>>10]+lookup[t>>4&63]+lookup[t<<2&63]+"=")),a.join("")}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(e){var t=base64Js,r=ieee754,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=M,e.INSPECT_MAX_BYTES=50;var a=2147483647;e.kMaxLength=a,s.TYPED_ARRAY_SUPPORT=l(),!s.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function l(){try{var R=new Uint8Array(1),v={foo:function(){return 42}};return Object.setPrototypeOf(v,Uint8Array.prototype),Object.setPrototypeOf(R,v),R.foo()===42}catch{return!1}}Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}});function o(R){if(R>a)throw new RangeError('The value "'+R+'" is invalid for option "size"');var v=new Uint8Array(R);return Object.setPrototypeOf(v,s.prototype),v}function s(R,v,b){if(typeof R=="number"){if(typeof v=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return d(R)}return h(R,v,b)}s.poolSize=8192;function h(R,v,b){if(typeof R=="string")return p(R,v);if(ArrayBuffer.isView(R))return A(R);if(R==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R);if(oe(R,ArrayBuffer)||R&&oe(R.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(oe(R,SharedArrayBuffer)||R&&oe(R.buffer,SharedArrayBuffer)))return k(R,v,b);if(typeof R=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var P=R.valueOf&&R.valueOf();if(P!=null&&P!==R)return s.from(P,v,b);var W=I(R);if(W)return W;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof R[Symbol.toPrimitive]=="function")return s.from(R[Symbol.toPrimitive]("string"),v,b);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof R)}s.from=function(R,v,b){return h(R,v,b)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array);function f(R){if(typeof R!="number")throw new TypeError('"size" argument must be of type number');if(R<0)throw new RangeError('The value "'+R+'" is invalid for option "size"')}function u(R,v,b){return f(R),R<=0?o(R):v!==void 0?typeof b=="string"?o(R).fill(v,b):o(R).fill(v):o(R)}s.alloc=function(R,v,b){return u(R,v,b)};function d(R){return f(R),o(R<0?0:B(R)|0)}s.allocUnsafe=function(R){return d(R)},s.allocUnsafeSlow=function(R){return d(R)};function p(R,v){if((typeof v!="string"||v==="")&&(v="utf8"),!s.isEncoding(v))throw new TypeError("Unknown encoding: "+v);var b=T(R,v)|0,P=o(b),W=P.write(R,v);return W!==b&&(P=P.slice(0,W)),P}function m(R){for(var v=R.length<0?0:B(R.length)|0,b=o(v),P=0;P<v;P+=1)b[P]=R[P]&255;return b}function A(R){if(oe(R,Uint8Array)){var v=new Uint8Array(R);return k(v.buffer,v.byteOffset,v.byteLength)}return m(R)}function k(R,v,b){if(v<0||R.byteLength<v)throw new RangeError('"offset" is outside of buffer bounds');if(R.byteLength<v+(b||0))throw new RangeError('"length" is outside of buffer bounds');var P;return v===void 0&&b===void 0?P=new Uint8Array(R):b===void 0?P=new Uint8Array(R,v):P=new Uint8Array(R,v,b),Object.setPrototypeOf(P,s.prototype),P}function I(R){if(s.isBuffer(R)){var v=B(R.length)|0,b=o(v);return b.length===0||R.copy(b,0,0,v),b}if(R.length!==void 0)return typeof R.length!="number"||be(R.length)?o(0):m(R);if(R.type==="Buffer"&&Array.isArray(R.data))return m(R.data)}function B(R){if(R>=a)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a.toString(16)+" bytes");return R|0}function M(R){return+R!=R&&(R=0),s.alloc(+R)}s.isBuffer=function(v){return v!=null&&v._isBuffer===!0&&v!==s.prototype},s.compare=function(v,b){if(oe(v,Uint8Array)&&(v=s.from(v,v.offset,v.byteLength)),oe(b,Uint8Array)&&(b=s.from(b,b.offset,b.byteLength)),!s.isBuffer(v)||!s.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(v===b)return 0;for(var P=v.length,W=b.length,re=0,ae=Math.min(P,W);re<ae;++re)if(v[re]!==b[re]){P=v[re],W=b[re];break}return P<W?-1:W<P?1:0},s.isEncoding=function(v){switch(String(v).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(v,b){if(!Array.isArray(v))throw new TypeError('"list" argument must be an Array of Buffers');if(v.length===0)return s.alloc(0);var P;if(b===void 0)for(b=0,P=0;P<v.length;++P)b+=v[P].length;var W=s.allocUnsafe(b),re=0;for(P=0;P<v.length;++P){var ae=v[P];if(oe(ae,Uint8Array))re+ae.length>W.length?s.from(ae).copy(W,re):Uint8Array.prototype.set.call(W,ae,re);else if(s.isBuffer(ae))ae.copy(W,re);else throw new TypeError('"list" argument must be an Array of Buffers');re+=ae.length}return W};function T(R,v){if(s.isBuffer(R))return R.length;if(ArrayBuffer.isView(R)||oe(R,ArrayBuffer))return R.byteLength;if(typeof R!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof R);var b=R.length,P=arguments.length>2&&arguments[2]===!0;if(!P&&b===0)return 0;for(var W=!1;;)switch(v){case"ascii":case"latin1":case"binary":return b;case"utf8":case"utf-8":return se(R).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b*2;case"hex":return b>>>1;case"base64":return ve(R).length;default:if(W)return P?-1:se(R).length;v=(""+v).toLowerCase(),W=!0}}s.byteLength=T;function U(R,v,b){var P=!1;if((v===void 0||v<0)&&(v=0),v>this.length||((b===void 0||b>this.length)&&(b=this.length),b<=0)||(b>>>=0,v>>>=0,b<=v))return"";for(R||(R="utf8");;)switch(R){case"hex":return J(this,v,b);case"utf8":case"utf-8":return H(this,v,b);case"ascii":return te(this,v,b);case"latin1":case"binary":return X(this,v,b);case"base64":return z(this,v,b);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ie(this,v,b);default:if(P)throw new TypeError("Unknown encoding: "+R);R=(R+"").toLowerCase(),P=!0}}s.prototype._isBuffer=!0;function C(R,v,b){var P=R[v];R[v]=R[b],R[b]=P}s.prototype.swap16=function(){var v=this.length;if(v%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<v;b+=2)C(this,b,b+1);return this},s.prototype.swap32=function(){var v=this.length;if(v%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<v;b+=4)C(this,b,b+3),C(this,b+1,b+2);return this},s.prototype.swap64=function(){var v=this.length;if(v%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<v;b+=8)C(this,b,b+7),C(this,b+1,b+6),C(this,b+2,b+5),C(this,b+3,b+4);return this},s.prototype.toString=function(){var v=this.length;return v===0?"":arguments.length===0?H(this,0,v):U.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(v){if(!s.isBuffer(v))throw new TypeError("Argument must be a Buffer");return this===v?!0:s.compare(this,v)===0},s.prototype.inspect=function(){var v="",b=e.INSPECT_MAX_BYTES;return v=this.toString("hex",0,b).replace(/(.{2})/g,"$1 ").trim(),this.length>b&&(v+=" ... "),"<Buffer "+v+">"},n&&(s.prototype[n]=s.prototype.inspect),s.prototype.compare=function(v,b,P,W,re){if(oe(v,Uint8Array)&&(v=s.from(v,v.offset,v.byteLength)),!s.isBuffer(v))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof v);if(b===void 0&&(b=0),P===void 0&&(P=v?v.length:0),W===void 0&&(W=0),re===void 0&&(re=this.length),b<0||P>v.length||W<0||re>this.length)throw new RangeError("out of range index");if(W>=re&&b>=P)return 0;if(W>=re)return-1;if(b>=P)return 1;if(b>>>=0,P>>>=0,W>>>=0,re>>>=0,this===v)return 0;for(var ae=re-W,Ee=P-b,Ce=Math.min(ae,Ee),Pe=this.slice(W,re),Be=v.slice(b,P),Se=0;Se<Ce;++Se)if(Pe[Se]!==Be[Se]){ae=Pe[Se],Ee=Be[Se];break}return ae<Ee?-1:Ee<ae?1:0};function w(R,v,b,P,W){if(R.length===0)return-1;if(typeof b=="string"?(P=b,b=0):b>2147483647?b=2147483647:b<-2147483648&&(b=-2147483648),b=+b,be(b)&&(b=W?0:R.length-1),b<0&&(b=R.length+b),b>=R.length){if(W)return-1;b=R.length-1}else if(b<0)if(W)b=0;else return-1;if(typeof v=="string"&&(v=s.from(v,P)),s.isBuffer(v))return v.length===0?-1:E(R,v,b,P,W);if(typeof v=="number")return v=v&255,typeof Uint8Array.prototype.indexOf=="function"?W?Uint8Array.prototype.indexOf.call(R,v,b):Uint8Array.prototype.lastIndexOf.call(R,v,b):E(R,[v],b,P,W);throw new TypeError("val must be string, number or Buffer")}function E(R,v,b,P,W){var re=1,ae=R.length,Ee=v.length;if(P!==void 0&&(P=String(P).toLowerCase(),P==="ucs2"||P==="ucs-2"||P==="utf16le"||P==="utf-16le")){if(R.length<2||v.length<2)return-1;re=2,ae/=2,Ee/=2,b/=2}function Ce(Ie,Le){return re===1?Ie[Le]:Ie.readUInt16BE(Le*re)}var Pe;if(W){var Be=-1;for(Pe=b;Pe<ae;Pe++)if(Ce(R,Pe)===Ce(v,Be===-1?0:Pe-Be)){if(Be===-1&&(Be=Pe),Pe-Be+1===Ee)return Be*re}else Be!==-1&&(Pe-=Pe-Be),Be=-1}else for(b+Ee>ae&&(b=ae-Ee),Pe=b;Pe>=0;Pe--){for(var Se=!0,ke=0;ke<Ee;ke++)if(Ce(R,Pe+ke)!==Ce(v,ke)){Se=!1;break}if(Se)return Pe}return-1}s.prototype.includes=function(v,b,P){return this.indexOf(v,b,P)!==-1},s.prototype.indexOf=function(v,b,P){return w(this,v,b,P,!0)},s.prototype.lastIndexOf=function(v,b,P){return w(this,v,b,P,!1)};function S(R,v,b,P){b=Number(b)||0;var W=R.length-b;P?(P=Number(P),P>W&&(P=W)):P=W;var re=v.length;P>re/2&&(P=re/2);for(var ae=0;ae<P;++ae){var Ee=parseInt(v.substr(ae*2,2),16);if(be(Ee))return ae;R[b+ae]=Ee}return ae}function $(R,v,b,P){return he(se(v,R.length-b),R,b,P)}function G(R,v,b,P){return he(xe(v),R,b,P)}function L(R,v,b,P){return he(ve(v),R,b,P)}function O(R,v,b,P){return he(Me(v,R.length-b),R,b,P)}s.prototype.write=function(v,b,P,W){if(b===void 0)W="utf8",P=this.length,b=0;else if(P===void 0&&typeof b=="string")W=b,P=this.length,b=0;else if(isFinite(b))b=b>>>0,isFinite(P)?(P=P>>>0,W===void 0&&(W="utf8")):(W=P,P=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var re=this.length-b;if((P===void 0||P>re)&&(P=re),v.length>0&&(P<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");W||(W="utf8");for(var ae=!1;;)switch(W){case"hex":return S(this,v,b,P);case"utf8":case"utf-8":return $(this,v,b,P);case"ascii":case"latin1":case"binary":return G(this,v,b,P);case"base64":return L(this,v,b,P);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,v,b,P);default:if(ae)throw new TypeError("Unknown encoding: "+W);W=(""+W).toLowerCase(),ae=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function z(R,v,b){return v===0&&b===R.length?t.fromByteArray(R):t.fromByteArray(R.slice(v,b))}function H(R,v,b){b=Math.min(R.length,b);for(var P=[],W=v;W<b;){var re=R[W],ae=null,Ee=re>239?4:re>223?3:re>191?2:1;if(W+Ee<=b){var Ce,Pe,Be,Se;switch(Ee){case 1:re<128&&(ae=re);break;case 2:Ce=R[W+1],(Ce&192)===128&&(Se=(re&31)<<6|Ce&63,Se>127&&(ae=Se));break;case 3:Ce=R[W+1],Pe=R[W+2],(Ce&192)===128&&(Pe&192)===128&&(Se=(re&15)<<12|(Ce&63)<<6|Pe&63,Se>2047&&(Se<55296||Se>57343)&&(ae=Se));break;case 4:Ce=R[W+1],Pe=R[W+2],Be=R[W+3],(Ce&192)===128&&(Pe&192)===128&&(Be&192)===128&&(Se=(re&15)<<18|(Ce&63)<<12|(Pe&63)<<6|Be&63,Se>65535&&Se<1114112&&(ae=Se))}}ae===null?(ae=65533,Ee=1):ae>65535&&(ae-=65536,P.push(ae>>>10&1023|55296),ae=56320|ae&1023),P.push(ae),W+=Ee}return K(P)}var Q=4096;function K(R){var v=R.length;if(v<=Q)return String.fromCharCode.apply(String,R);for(var b="",P=0;P<v;)b+=String.fromCharCode.apply(String,R.slice(P,P+=Q));return b}function te(R,v,b){var P="";b=Math.min(R.length,b);for(var W=v;W<b;++W)P+=String.fromCharCode(R[W]&127);return P}function X(R,v,b){var P="";b=Math.min(R.length,b);for(var W=v;W<b;++W)P+=String.fromCharCode(R[W]);return P}function J(R,v,b){var P=R.length;(!v||v<0)&&(v=0),(!b||b<0||b>P)&&(b=P);for(var W="",re=v;re<b;++re)W+=we[R[re]];return W}function ie(R,v,b){for(var P=R.slice(v,b),W="",re=0;re<P.length-1;re+=2)W+=String.fromCharCode(P[re]+P[re+1]*256);return W}s.prototype.slice=function(v,b){var P=this.length;v=~~v,b=b===void 0?P:~~b,v<0?(v+=P,v<0&&(v=0)):v>P&&(v=P),b<0?(b+=P,b<0&&(b=0)):b>P&&(b=P),b<v&&(b=v);var W=this.subarray(v,b);return Object.setPrototypeOf(W,s.prototype),W};function de(R,v,b){if(R%1!==0||R<0)throw new RangeError("offset is not uint");if(R+v>b)throw new RangeError("Trying to access beyond buffer length")}s.prototype.readUintLE=s.prototype.readUIntLE=function(v,b,P){v=v>>>0,b=b>>>0,P||de(v,b,this.length);for(var W=this[v],re=1,ae=0;++ae<b&&(re*=256);)W+=this[v+ae]*re;return W},s.prototype.readUintBE=s.prototype.readUIntBE=function(v,b,P){v=v>>>0,b=b>>>0,P||de(v,b,this.length);for(var W=this[v+--b],re=1;b>0&&(re*=256);)W+=this[v+--b]*re;return W},s.prototype.readUint8=s.prototype.readUInt8=function(v,b){return v=v>>>0,b||de(v,1,this.length),this[v]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(v,b){return v=v>>>0,b||de(v,2,this.length),this[v]|this[v+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(v,b){return v=v>>>0,b||de(v,2,this.length),this[v]<<8|this[v+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(v,b){return v=v>>>0,b||de(v,4,this.length),(this[v]|this[v+1]<<8|this[v+2]<<16)+this[v+3]*16777216},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(v,b){return v=v>>>0,b||de(v,4,this.length),this[v]*16777216+(this[v+1]<<16|this[v+2]<<8|this[v+3])},s.prototype.readIntLE=function(v,b,P){v=v>>>0,b=b>>>0,P||de(v,b,this.length);for(var W=this[v],re=1,ae=0;++ae<b&&(re*=256);)W+=this[v+ae]*re;return re*=128,W>=re&&(W-=Math.pow(2,8*b)),W},s.prototype.readIntBE=function(v,b,P){v=v>>>0,b=b>>>0,P||de(v,b,this.length);for(var W=b,re=1,ae=this[v+--W];W>0&&(re*=256);)ae+=this[v+--W]*re;return re*=128,ae>=re&&(ae-=Math.pow(2,8*b)),ae},s.prototype.readInt8=function(v,b){return v=v>>>0,b||de(v,1,this.length),this[v]&128?(255-this[v]+1)*-1:this[v]},s.prototype.readInt16LE=function(v,b){v=v>>>0,b||de(v,2,this.length);var P=this[v]|this[v+1]<<8;return P&32768?P|4294901760:P},s.prototype.readInt16BE=function(v,b){v=v>>>0,b||de(v,2,this.length);var P=this[v+1]|this[v]<<8;return P&32768?P|4294901760:P},s.prototype.readInt32LE=function(v,b){return v=v>>>0,b||de(v,4,this.length),this[v]|this[v+1]<<8|this[v+2]<<16|this[v+3]<<24},s.prototype.readInt32BE=function(v,b){return v=v>>>0,b||de(v,4,this.length),this[v]<<24|this[v+1]<<16|this[v+2]<<8|this[v+3]},s.prototype.readFloatLE=function(v,b){return v=v>>>0,b||de(v,4,this.length),r.read(this,v,!0,23,4)},s.prototype.readFloatBE=function(v,b){return v=v>>>0,b||de(v,4,this.length),r.read(this,v,!1,23,4)},s.prototype.readDoubleLE=function(v,b){return v=v>>>0,b||de(v,8,this.length),r.read(this,v,!0,52,8)},s.prototype.readDoubleBE=function(v,b){return v=v>>>0,b||de(v,8,this.length),r.read(this,v,!1,52,8)};function me(R,v,b,P,W,re){if(!s.isBuffer(R))throw new TypeError('"buffer" argument must be a Buffer instance');if(v>W||v<re)throw new RangeError('"value" argument is out of bounds');if(b+P>R.length)throw new RangeError("Index out of range")}s.prototype.writeUintLE=s.prototype.writeUIntLE=function(v,b,P,W){if(v=+v,b=b>>>0,P=P>>>0,!W){var re=Math.pow(2,8*P)-1;me(this,v,b,P,re,0)}var ae=1,Ee=0;for(this[b]=v&255;++Ee<P&&(ae*=256);)this[b+Ee]=v/ae&255;return b+P},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(v,b,P,W){if(v=+v,b=b>>>0,P=P>>>0,!W){var re=Math.pow(2,8*P)-1;me(this,v,b,P,re,0)}var ae=P-1,Ee=1;for(this[b+ae]=v&255;--ae>=0&&(Ee*=256);)this[b+ae]=v/Ee&255;return b+P},s.prototype.writeUint8=s.prototype.writeUInt8=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,1,255,0),this[b]=v&255,b+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,2,65535,0),this[b]=v&255,this[b+1]=v>>>8,b+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,2,65535,0),this[b]=v>>>8,this[b+1]=v&255,b+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,4,4294967295,0),this[b+3]=v>>>24,this[b+2]=v>>>16,this[b+1]=v>>>8,this[b]=v&255,b+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,4,4294967295,0),this[b]=v>>>24,this[b+1]=v>>>16,this[b+2]=v>>>8,this[b+3]=v&255,b+4},s.prototype.writeIntLE=function(v,b,P,W){if(v=+v,b=b>>>0,!W){var re=Math.pow(2,8*P-1);me(this,v,b,P,re-1,-re)}var ae=0,Ee=1,Ce=0;for(this[b]=v&255;++ae<P&&(Ee*=256);)v<0&&Ce===0&&this[b+ae-1]!==0&&(Ce=1),this[b+ae]=(v/Ee>>0)-Ce&255;return b+P},s.prototype.writeIntBE=function(v,b,P,W){if(v=+v,b=b>>>0,!W){var re=Math.pow(2,8*P-1);me(this,v,b,P,re-1,-re)}var ae=P-1,Ee=1,Ce=0;for(this[b+ae]=v&255;--ae>=0&&(Ee*=256);)v<0&&Ce===0&&this[b+ae+1]!==0&&(Ce=1),this[b+ae]=(v/Ee>>0)-Ce&255;return b+P},s.prototype.writeInt8=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,1,127,-128),v<0&&(v=255+v+1),this[b]=v&255,b+1},s.prototype.writeInt16LE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,2,32767,-32768),this[b]=v&255,this[b+1]=v>>>8,b+2},s.prototype.writeInt16BE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,2,32767,-32768),this[b]=v>>>8,this[b+1]=v&255,b+2},s.prototype.writeInt32LE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,4,2147483647,-2147483648),this[b]=v&255,this[b+1]=v>>>8,this[b+2]=v>>>16,this[b+3]=v>>>24,b+4},s.prototype.writeInt32BE=function(v,b,P){return v=+v,b=b>>>0,P||me(this,v,b,4,2147483647,-2147483648),v<0&&(v=4294967295+v+1),this[b]=v>>>24,this[b+1]=v>>>16,this[b+2]=v>>>8,this[b+3]=v&255,b+4};function _e(R,v,b,P,W,re){if(b+P>R.length)throw new RangeError("Index out of range");if(b<0)throw new RangeError("Index out of range")}function q(R,v,b,P,W){return v=+v,b=b>>>0,W||_e(R,v,b,4),r.write(R,v,b,P,23,4),b+4}s.prototype.writeFloatLE=function(v,b,P){return q(this,v,b,!0,P)},s.prototype.writeFloatBE=function(v,b,P){return q(this,v,b,!1,P)};function V(R,v,b,P,W){return v=+v,b=b>>>0,W||_e(R,v,b,8),r.write(R,v,b,P,52,8),b+8}s.prototype.writeDoubleLE=function(v,b,P){return V(this,v,b,!0,P)},s.prototype.writeDoubleBE=function(v,b,P){return V(this,v,b,!1,P)},s.prototype.copy=function(v,b,P,W){if(!s.isBuffer(v))throw new TypeError("argument should be a Buffer");if(P||(P=0),!W&&W!==0&&(W=this.length),b>=v.length&&(b=v.length),b||(b=0),W>0&&W<P&&(W=P),W===P||v.length===0||this.length===0)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(P<0||P>=this.length)throw new RangeError("Index out of range");if(W<0)throw new RangeError("sourceEnd out of bounds");W>this.length&&(W=this.length),v.length-b<W-P&&(W=v.length-b+P);var re=W-P;return this===v&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(b,P,W):Uint8Array.prototype.set.call(v,this.subarray(P,W),b),re},s.prototype.fill=function(v,b,P,W){if(typeof v=="string"){if(typeof b=="string"?(W=b,b=0,P=this.length):typeof P=="string"&&(W=P,P=this.length),W!==void 0&&typeof W!="string")throw new TypeError("encoding must be a string");if(typeof W=="string"&&!s.isEncoding(W))throw new TypeError("Unknown encoding: "+W);if(v.length===1){var re=v.charCodeAt(0);(W==="utf8"&&re<128||W==="latin1")&&(v=re)}}else typeof v=="number"?v=v&255:typeof v=="boolean"&&(v=Number(v));if(b<0||this.length<b||this.length<P)throw new RangeError("Out of range index");if(P<=b)return this;b=b>>>0,P=P===void 0?this.length:P>>>0,v||(v=0);var ae;if(typeof v=="number")for(ae=b;ae<P;++ae)this[ae]=v;else{var Ee=s.isBuffer(v)?v:s.from(v,W),Ce=Ee.length;if(Ce===0)throw new TypeError('The value "'+v+'" is invalid for argument "value"');for(ae=0;ae<P-b;++ae)this[ae+b]=Ee[ae%Ce]}return this};var j=/[^+/0-9A-Za-z-_]/g;function ne(R){if(R=R.split("=")[0],R=R.trim().replace(j,""),R.length<2)return"";for(;R.length%4!==0;)R=R+"=";return R}function se(R,v){v=v||1/0;for(var b,P=R.length,W=null,re=[],ae=0;ae<P;++ae){if(b=R.charCodeAt(ae),b>55295&&b<57344){if(!W){if(b>56319){(v-=3)>-1&&re.push(239,191,189);continue}else if(ae+1===P){(v-=3)>-1&&re.push(239,191,189);continue}W=b;continue}if(b<56320){(v-=3)>-1&&re.push(239,191,189),W=b;continue}b=(W-55296<<10|b-56320)+65536}else W&&(v-=3)>-1&&re.push(239,191,189);if(W=null,b<128){if((v-=1)<0)break;re.push(b)}else if(b<2048){if((v-=2)<0)break;re.push(b>>6|192,b&63|128)}else if(b<65536){if((v-=3)<0)break;re.push(b>>12|224,b>>6&63|128,b&63|128)}else if(b<1114112){if((v-=4)<0)break;re.push(b>>18|240,b>>12&63|128,b>>6&63|128,b&63|128)}else throw new Error("Invalid code point")}return re}function xe(R){for(var v=[],b=0;b<R.length;++b)v.push(R.charCodeAt(b)&255);return v}function Me(R,v){for(var b,P,W,re=[],ae=0;ae<R.length&&!((v-=2)<0);++ae)b=R.charCodeAt(ae),P=b>>8,W=b%256,re.push(W),re.push(P);return re}function ve(R){return t.toByteArray(ne(R))}function he(R,v,b,P){for(var W=0;W<P&&!(W+b>=v.length||W>=R.length);++W)v[W+b]=R[W];return W}function oe(R,v){return R instanceof v||R!=null&&R.constructor!=null&&R.constructor.name!=null&&R.constructor.name===v.name}function be(R){return R!==R}var we=function(){for(var R="0123456789abcdef",v=new Array(256),b=0;b<16;++b)for(var P=b*16,W=0;W<16;++W)v[P+W]=R[b]+R[W];return v}()})(buffer);(function(e,t){let r=require$$0.ok,n=require$$0,a=require$$0,l=buffer.kMaxLength;function o(d){if(!(this instanceof o))return new o(d);d&&d.chunkSize<n.Z_MIN_CHUNK&&(d.chunkSize=n.Z_MIN_CHUNK),n.Inflate.call(this,d),this._offset=this._offset===void 0?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,d&&d.maxLength!=null&&(this._maxLength=d.maxLength)}function s(d){return new o(d)}function h(d,p){d._handle&&(d._handle.close(),d._handle=null)}o.prototype._processChunk=function(d,p,m){if(typeof m=="function")return n.Inflate._processChunk.call(this,d,p,m);let A=this,k=d&&d.length,I=this._chunkSize-this._offset,B=this._maxLength,M=0,T=[],U=0,C;this.on("error",function($){C=$});function w($,G){if(A._hadError)return;let L=I-G;if(r(L>=0,"have should not go down"),L>0){let O=A._buffer.slice(A._offset,A._offset+L);if(A._offset+=L,O.length>B&&(O=O.slice(0,B)),T.push(O),U+=O.length,B-=O.length,B===0)return!1}return(G===0||A._offset>=A._chunkSize)&&(I=A._chunkSize,A._offset=0,A._buffer=Buffer.allocUnsafe(A._chunkSize)),G===0?(M+=k-$,k=$,!0):!1}r(this._handle,"zlib binding closed");let E;do E=this._handle.writeSync(p,d,M,k,this._buffer,this._offset,I),E=E||this._writeState;while(!this._hadError&&w(E[0],E[1]));if(this._hadError)throw C;if(U>=l)throw h(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+l.toString(16)+" bytes");let S=Buffer.concat(T,U);return h(this),S},a.inherits(o,n.Inflate);function f(d,p){if(typeof p=="string"&&(p=Buffer.from(p)),!(p instanceof Buffer))throw new TypeError("Not a string or buffer");let m=d._finishFlushFlag;return m==null&&(m=n.Z_FINISH),d._processChunk(p,m)}function u(d,p){return f(new o(p),d)}e.exports=t=u,t.Inflate=o,t.createInflate=s,t.inflateSync=u})(syncInflate,syncInflate.exports);var syncInflateExports=syncInflate.exports,syncReader={exports:{}};let SyncReader$2=syncReader.exports=function(e){this._buffer=e,this._reads=[]};SyncReader$2.prototype.read=function(e,t){this._reads.push({length:Math.abs(e),allowLess:e<0,func:t})};SyncReader$2.prototype.process=function(){for(;this._reads.length>0&&this._buffer.length;){let e=this._reads[0];if(this._buffer.length&&(this._buffer.length>=e.length||e.allowLess)){this._reads.shift();let t=this._buffer;this._buffer=t.slice(e.length),e.func.call(this,t.slice(0,e.length))}else break}if(this._reads.length>0)throw new Error("There are some read requests waitng on finished stream");if(this._buffer.length>0)throw new Error("unrecognised content at end of stream")};var syncReaderExports=syncReader.exports,filterParseSync={};let SyncReader$1=syncReaderExports,Filter=filterParseExports;filterParseSync.process=function(e,t){let r=[],n=new SyncReader$1(e);return new Filter(t,{read:n.read.bind(n),write:function(l){r.push(l)},complete:function(){}}).start(),n.process(),Buffer.concat(r)};let hasSyncZlib$1=!0,zlib$1=require$$0,inflateSync=syncInflateExports;zlib$1.deflateSync||(hasSyncZlib$1=!1);let SyncReader=syncReaderExports,FilterSync=filterParseSync,Parser$1=parserExports,bitmapper=bitmapper$2,formatNormaliser=formatNormaliser$2;var parserSync=function(e,t){if(!hasSyncZlib$1)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let r;function n(U){r=U}let a;function l(U){a=U}function o(U){a.transColor=U}function s(U){a.palette=U}function h(){a.alpha=!0}let f;function u(U){f=U}let d=[];function p(U){d.push(U)}let m=new SyncReader(e);if(new Parser$1(t,{read:m.read.bind(m),error:n,metadata:l,gamma:u,palette:s,transColor:o,inflateData:p,simpleTransparency:h}).start(),m.process(),r)throw r;let k=Buffer.concat(d);d.length=0;let I;if(a.interlace)I=zlib$1.inflateSync(k);else{let C=((a.width*a.bpp*a.depth+7>>3)+1)*a.height;I=inflateSync(k,{chunkSize:C,maxLength:C})}if(k=null,!I||!I.length)throw new Error("bad png - invalid inflate data response");let B=FilterSync.process(I,a);k=null;let M=bitmapper.dataToBitMap(B,a);B=null;let T=formatNormaliser(M,a,t.skipRescale);return a.data=T,a.gamma=f||0,a};let hasSyncZlib=!0,zlib=require$$0;zlib.deflateSync||(hasSyncZlib=!1);let constants$1=constants$6,Packer$1=packerExports;var packerSync=function(e,t){if(!hasSyncZlib)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let r=t||{},n=new Packer$1(r),a=[];a.push(Buffer.from(constants$1.PNG_SIGNATURE)),a.push(n.packIHDR(e.width,e.height)),e.gamma&&a.push(n.packGAMA(e.gamma));let l=n.filterData(e.data,e.width,e.height),o=zlib.deflateSync(l,n.getDeflateOptions());if(l=null,!o||!o.length)throw new Error("bad png - invalid compressed data response");return a.push(n.packIDAT(o)),a.push(n.packIEND()),Buffer.concat(a)};let parse=parserSync,pack=packerSync;pngSync.read=function(e,t){return parse(e,t||{})};pngSync.write=function(e,t){return pack(e,t)};var PNG_1;let util=require$$0,Stream=require$$0,Parser=parserAsyncExports,Packer=packerAsyncExports,PNGSync=pngSync,PNG=PNG_1=function(e){Stream.call(this),e=e||{},this.width=e.width|0,this.height=e.height|0,this.data=this.width>0&&this.height>0?Buffer.alloc(4*this.width*this.height):null,e.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new Parser(e),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",(function(t){this.data=t,this.emit("parsed",t)}).bind(this)),this._packer=new Packer(e),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};util.inherits(PNG,Stream);PNG.sync=PNGSync;PNG.prototype.pack=function(){return!this.data||!this.data.length?(this.emit("error","No data provided"),this):(process.nextTick((function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}).bind(this)),this)};PNG.prototype.parse=function(e,t){if(t){let r,n;r=(function(a){this.removeListener("error",n),this.data=a,t(null,this)}).bind(this),n=(function(a){this.removeListener("parsed",r),t(a,null)}).bind(this),this.once("parsed",r),this.once("error",n)}return this.end(e),this};PNG.prototype.write=function(e){return this._parser.write(e),!0};PNG.prototype.end=function(e){this._parser.end(e)};PNG.prototype._metadata=function(e){this.width=e.width,this.height=e.height,this.emit("metadata",e)};PNG.prototype._gamma=function(e){this.gamma=e};PNG.prototype._handleClose=function(){!this._parser.writable&&!this._packer.readable&&this.emit("close")};PNG.bitblt=function(e,t,r,n,a,l,o,s){if(r|=0,n|=0,a|=0,l|=0,o|=0,s|=0,r>e.width||n>e.height||r+a>e.width||n+l>e.height)throw new Error("bitblt reading outside image");if(o>t.width||s>t.height||o+a>t.width||s+l>t.height)throw new Error("bitblt writing outside image");for(let h=0;h<l;h++)e.data.copy(t.data,(s+h)*t.width+o<<2,(n+h)*e.width+r<<2,(n+h)*e.width+r+a<<2)};PNG.prototype.bitblt=function(e,t,r,n,a,l,o){return PNG.bitblt(this,e,t,r,n,a,l,o),this};PNG.adjustGamma=function(e){if(e.gamma){for(let t=0;t<e.height;t++)for(let r=0;r<e.width;r++){let n=e.width*t+r<<2;for(let a=0;a<3;a++){let l=e.data[n+a]/255;l=Math.pow(l,1/2.2/e.gamma),e.data[n+a]=Math.round(l*255)}}e.gamma=0}};PNG.prototype.adjustGamma=function(){PNG.adjustGamma(this)};const MIME_TYPE$3="image/png",PNG_FILTER_AUTO=-1,PNG_FILTER_NONE=0,PNG_FILTER_SUB=1,PNG_FILTER_UP=2,PNG_FILTER_AVERAGE=3,PNG_FILTER_PATH=4,png=()=>({mime:{[MIME_TYPE$3]:["png"]},constants:{MIME_PNG:MIME_TYPE$3,PNG_FILTER_AUTO,PNG_FILTER_NONE,PNG_FILTER_SUB,PNG_FILTER_UP,PNG_FILTER_AVERAGE,PNG_FILTER_PATH},hasAlpha:{[MIME_TYPE$3]:!0},decoders:{[MIME_TYPE$3]:PNG_1.sync.read},encoders:{[MIME_TYPE$3](e){const t=new PNG_1({width:e.bitmap.width,height:e.bitmap.height});return t.data=e.bitmap.data,PNG_1.sync.write(t,{deflateLevel:e._deflateLevel,deflateStrategy:e._deflateStrategy,filterType:e._filterType,colorType:typeof e._colorType=="number"?e._colorType:e._rgba?6:2,inputHasAlpha:e._rgba})}},class:{_deflateLevel:9,_deflateStrategy:3,_filterType:PNG_FILTER_AUTO,_colorType:null,deflateLevel(e,t){return typeof e!="number"?throwError.call(this,"l must be a number",t):e<0||e>9?throwError.call(this,"l must be a number 0 - 9",t):(this._deflateLevel=Math.round(e),isNodePattern(t)&&t.call(this,null,this),this)},deflateStrategy(e,t){return typeof e!="number"?throwError.call(this,"s must be a number",t):e<0||e>3?throwError.call(this,"s must be a number 0 - 3",t):(this._deflateStrategy=Math.round(e),isNodePattern(t)&&t.call(this,null,this),this)},filterType(e,t){return typeof e!="number"?throwError.call(this,"n must be a number",t):e<-1||e>4?throwError.call(this,"n must be -1 (auto) or a number 0 - 4",t):(this._filterType=Math.round(e),isNodePattern(t)&&t.call(this,null,this),this)},colorType(e,t){return typeof e!="number"?throwError.call(this,"s must be a number",t):e!==0&&e!==2&&e!==4&&e!==6?throwError.call(this,"s must be a number 0, 2, 4, 6.",t):(this._colorType=Math.round(e),isNodePattern(t)&&t.call(this,null,this),this)}}});function BmpEncoder(e){this.buffer=e.data,this.width=e.width,this.height=e.height,this.extraBytes=this.width%4,this.rgbSize=this.height*(3*this.width+this.extraBytes),this.headerInfoSize=40,this.data=[],this.flag="BM",this.reserved=0,this.offset=54,this.fileSize=this.rgbSize+this.offset,this.planes=1,this.bitPP=24,this.compress=0,this.hr=0,this.vr=0,this.colors=0,this.importantColors=0}BmpEncoder.prototype.encode=function(){var e=new Buffer(this.offset+this.rgbSize);this.pos=0,e.write(this.flag,this.pos,2),this.pos+=2,e.writeUInt32LE(this.fileSize,this.pos),this.pos+=4,e.writeUInt32LE(this.reserved,this.pos),this.pos+=4,e.writeUInt32LE(this.offset,this.pos),this.pos+=4,e.writeUInt32LE(this.headerInfoSize,this.pos),this.pos+=4,e.writeUInt32LE(this.width,this.pos),this.pos+=4,e.writeInt32LE(-this.height,this.pos),this.pos+=4,e.writeUInt16LE(this.planes,this.pos),this.pos+=2,e.writeUInt16LE(this.bitPP,this.pos),this.pos+=2,e.writeUInt32LE(this.compress,this.pos),this.pos+=4,e.writeUInt32LE(this.rgbSize,this.pos),this.pos+=4,e.writeUInt32LE(this.hr,this.pos),this.pos+=4,e.writeUInt32LE(this.vr,this.pos),this.pos+=4,e.writeUInt32LE(this.colors,this.pos),this.pos+=4,e.writeUInt32LE(this.importantColors,this.pos),this.pos+=4;for(var t=0,r=3*this.width+this.extraBytes,n=0;n<this.height;n++){for(var a=0;a<this.width;a++){var l=this.pos+n*r+a*3;t++,e[l]=this.buffer[t++],e[l+1]=this.buffer[t++],e[l+2]=this.buffer[t++]}if(this.extraBytes>0){var o=this.pos+n*r+this.width*3;e.fill(0,o,o+this.extraBytes)}}return e};var encoder=function(e,t){var r=new BmpEncoder(e),n=r.encode();return{data:n,width:e.width,height:e.height}};function BmpDecoder(e,t){if(this.pos=0,this.buffer=e,this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=this.buffer.toString("utf-8",0,this.pos+=2),this.flag!="BM")throw new Error("Invalid BMP File");this.parseHeader(),this.parseRGBA()}BmpDecoder.prototype.parseHeader=function(){if(this.fileSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.reserved=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.offset=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.headerSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.width=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.height=this.buffer.readInt32LE(this.pos),this.pos+=4,this.planes=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.bitPP=this.buffer.readUInt16LE(this.pos),this.pos+=2,this.compress=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.rawSize=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.hr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.vr=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.colors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.importantColors=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var e=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(e);for(var t=0;t<e;t++){var r=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),l=this.buffer.readUInt8(this.pos++);this.palette[t]={red:a,green:n,blue:r,quad:l}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)};BmpDecoder.prototype.parseRGBA=function(){var e="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Buffer(t),this[e]()};BmpDecoder.prototype.bit1=function(){for(var e=Math.ceil(this.width/8),t=e%4,r=this.height>=0?this.height-1:-this.height,r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,a=0;a<e;a++)for(var l=this.buffer.readUInt8(this.pos++),o=n*this.width*4+a*8*4,s=0;s<8&&a*8+s<this.width;s++){var h=this.palette[l>>7-s&1];this.data[o+s*4]=0,this.data[o+s*4+1]=h.blue,this.data[o+s*4+2]=h.green,this.data[o+s*4+3]=h.red}t!=0&&(this.pos+=4-t)}};BmpDecoder.prototype.bit4=function(){if(this.compress==2){let k=function(I){var B=this.palette[I];this.data[e]=0,this.data[e+1]=B.blue,this.data[e+2]=B.green,this.data[e+3]=B.red,e+=4};this.data.fill(255);for(var e=0,t=this.bottom_up?this.height-1:0,r=!1;e<this.data.length;){var n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++);if(n==0)if(a==0){this.bottom_up?t--:t++,e=t*this.width*4,r=!1;continue}else{if(a==1)break;if(a==2){var l=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++);this.bottom_up?t-=o:t+=o,e+=o*this.width*4+l*4}else{for(var s=this.buffer.readUInt8(this.pos++),h=0;h<a;h++)r?k.call(this,s&15):k.call(this,(s&240)>>4),h&1&&h+1<a&&(s=this.buffer.readUInt8(this.pos++)),r=!r;(a+1>>1&1)==1&&this.pos++}}else for(var h=0;h<n;h++)r?k.call(this,a&15):k.call(this,(a&240)>>4),r=!r}}else for(var f=Math.ceil(this.width/2),u=f%4,o=this.height-1;o>=0;o--){for(var d=this.bottom_up?o:this.height-1-o,l=0;l<f;l++){var a=this.buffer.readUInt8(this.pos++),e=d*this.width*4+l*2*4,p=a>>4,m=a&15,A=this.palette[p];if(this.data[e]=0,this.data[e+1]=A.blue,this.data[e+2]=A.green,this.data[e+3]=A.red,l*2+1>=this.width)break;A=this.palette[m],this.data[e+4]=0,this.data[e+4+1]=A.blue,this.data[e+4+2]=A.green,this.data[e+4+3]=A.red}u!=0&&(this.pos+=4-u)}};BmpDecoder.prototype.bit8=function(){if(this.compress==1){let d=function(p){var m=this.palette[p];this.data[e]=0,this.data[e+1]=m.blue,this.data[e+2]=m.green,this.data[e+3]=m.red,e+=4};this.data.fill(255);for(var e=0,t=this.bottom_up?this.height-1:0;e<this.data.length;){var r=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++);if(r==0)if(n==0){this.bottom_up?t--:t++,e=t*this.width*4;continue}else{if(n==1)break;if(n==2){var a=this.buffer.readUInt8(this.pos++),l=this.buffer.readUInt8(this.pos++);this.bottom_up?t-=l:t+=l,e+=l*this.width*4+a*4}else{for(var o=0;o<n;o++){var s=this.buffer.readUInt8(this.pos++);d.call(this,s)}n&!0&&this.pos++}}else for(var o=0;o<r;o++)d.call(this,n)}}else for(var h=this.width%4,l=this.height-1;l>=0;l--){for(var f=this.bottom_up?l:this.height-1-l,a=0;a<this.width;a++){var n=this.buffer.readUInt8(this.pos++),e=f*this.width*4+a*4;if(n<this.palette.length){var u=this.palette[n];this.data[e]=0,this.data[e+1]=u.blue,this.data[e+2]=u.green,this.data[e+3]=u.red}else this.data[e]=0,this.data[e+1]=255,this.data[e+2]=255,this.data[e+3]=255}h!=0&&(this.pos+=4-h)}};BmpDecoder.prototype.bit15=function(){for(var e=this.width%3,t=parseInt("11111",2),r=t,n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,l=0;l<this.width;l++){var o=this.buffer.readUInt16LE(this.pos);this.pos+=2;var s=(o&r)/r*255|0,h=(o>>5&r)/r*255|0,f=(o>>10&r)/r*255|0,u=o>>15?255:0,d=a*this.width*4+l*4;this.data[d]=u,this.data[d+1]=s,this.data[d+2]=h,this.data[d+3]=f}this.pos+=e}};BmpDecoder.prototype.bit16=function(){var e=this.width%2*2;this.maskRed=31744,this.maskGreen=992,this.maskBlue=31,this.mask0=0,this.compress==3&&(this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4);for(var t=[0,0,0],r=0;r<16;r++)this.maskRed>>r&1&&t[0]++,this.maskGreen>>r&1&&t[1]++,this.maskBlue>>r&1&&t[2]++;t[1]+=t[0],t[2]+=t[1],t[0]=8-t[0],t[1]-=8,t[2]-=8;for(var n=this.height-1;n>=0;n--){for(var a=this.bottom_up?n:this.height-1-n,l=0;l<this.width;l++){var o=this.buffer.readUInt16LE(this.pos);this.pos+=2;var s=(o&this.maskBlue)<<t[0],h=(o&this.maskGreen)>>t[1],f=(o&this.maskRed)>>t[2],u=a*this.width*4+l*4;this.data[u]=0,this.data[u+1]=s,this.data[u+2]=h,this.data[u+3]=f}this.pos+=e}};BmpDecoder.prototype.bit24=function(){for(var e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),l=this.buffer.readUInt8(this.pos++),o=t*this.width*4+r*4;this.data[o]=0,this.data[o+1]=n,this.data[o+2]=a,this.data[o+3]=l}this.pos+=this.width%4}};BmpDecoder.prototype.bit32=function(){if(this.compress==3){this.maskRed=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskGreen=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.maskBlue=this.buffer.readUInt32LE(this.pos),this.pos+=4,this.mask0=this.buffer.readUInt32LE(this.pos),this.pos+=4;for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.buffer.readUInt8(this.pos++),a=this.buffer.readUInt8(this.pos++),l=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++),s=t*this.width*4+r*4;this.data[s]=n,this.data[s+1]=a,this.data[s+2]=l,this.data[s+3]=o}}else for(var e=this.height-1;e>=0;e--)for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var a=this.buffer.readUInt8(this.pos++),l=this.buffer.readUInt8(this.pos++),o=this.buffer.readUInt8(this.pos++),n=this.buffer.readUInt8(this.pos++),s=t*this.width*4+r*4;this.data[s]=n,this.data[s+1]=a,this.data[s+2]=l,this.data[s+3]=o}};BmpDecoder.prototype.getData=function(){return this.data};var decoder=function(e){var t=new BmpDecoder(e);return t},encode$1=encoder,decode$1=decoder,bmpJs={encode:encode$1,decode:decode$1};const BMP=getDefaultExportFromCjs(bmpJs),MIME_TYPE$2="image/bmp",MIME_TYPE_SECOND="image/x-ms-bmp";function toAGBR(e){return scan(e,0,0,e.bitmap.width,e.bitmap.height,function(t,r,n){const a=this.bitmap.data[n+0],l=this.bitmap.data[n+1],o=this.bitmap.data[n+2],s=this.bitmap.data[n+3];this.bitmap.data[n+0]=s,this.bitmap.data[n+1]=o,this.bitmap.data[n+2]=l,this.bitmap.data[n+3]=a}).bitmap}function fromAGBR(e){return scan({bitmap:e},0,0,e.width,e.height,function(t,r,n){const a=this.bitmap.data[n+0],l=this.bitmap.data[n+1],o=this.bitmap.data[n+2],s=this.bitmap.data[n+3];this.bitmap.data[n+0]=s,this.bitmap.data[n+1]=o,this.bitmap.data[n+2]=l,this.bitmap.data[n+3]=e.is_with_alpha?a:255}).bitmap}const decode=e=>fromAGBR(BMP.decode(e)),encode=e=>BMP.encode(toAGBR(e)).data,bmp=()=>({mime:{[MIME_TYPE$2]:["bmp"]},constants:{MIME_BMP:MIME_TYPE$2,MIME_X_MS_BMP:MIME_TYPE_SECOND},decoders:{[MIME_TYPE$2]:decode,[MIME_TYPE_SECOND]:decode},encoders:{[MIME_TYPE$2]:encode,[MIME_TYPE_SECOND]:encode}});var UTIF={exports:{}},common={},hasRequiredCommon;function requireCommon(){return hasRequiredCommon||(hasRequiredCommon=1,function(e){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function r(l,o){return Object.prototype.hasOwnProperty.call(l,o)}e.assign=function(l){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var s=o.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(var h in s)r(s,h)&&(l[h]=s[h])}}return l},e.shrinkBuf=function(l,o){return l.length===o?l:l.subarray?l.subarray(0,o):(l.length=o,l)};var n={arraySet:function(l,o,s,h,f){if(o.subarray&&l.subarray){l.set(o.subarray(s,s+h),f);return}for(var u=0;u<h;u++)l[f+u]=o[s+u]},flattenChunks:function(l){var o,s,h,f,u,d;for(h=0,o=0,s=l.length;o<s;o++)h+=l[o].length;for(d=new Uint8Array(h),f=0,o=0,s=l.length;o<s;o++)u=l[o],d.set(u,f),f+=u.length;return d}},a={arraySet:function(l,o,s,h,f){for(var u=0;u<h;u++)l[f+u]=o[s+u]},flattenChunks:function(l){return[].concat.apply([],l)}};e.setTyped=function(l){l?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,a))},e.setTyped(t)}(common)),common}var deflate$1={},deflate={},trees={},hasRequiredTrees;function requireTrees(){if(hasRequiredTrees)return trees;hasRequiredTrees=1;var e=requireCommon(),t=4,r=0,n=1,a=2;function l(N){for(var pe=N.length;--pe>=0;)N[pe]=0}var o=0,s=1,h=2,f=3,u=258,d=29,p=256,m=p+1+d,A=30,k=19,I=2*m+1,B=15,M=16,T=7,U=256,C=16,w=17,E=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=512,z=new Array((m+2)*2);l(z);var H=new Array(A*2);l(H);var Q=new Array(O);l(Q);var K=new Array(u-f+1);l(K);var te=new Array(d);l(te);var X=new Array(A);l(X);function J(N,pe,le,Ae,Z){this.static_tree=N,this.extra_bits=pe,this.extra_base=le,this.elems=Ae,this.max_length=Z,this.has_stree=N&&N.length}var ie,de,me;function _e(N,pe){this.dyn_tree=N,this.max_code=0,this.stat_desc=pe}function q(N){return N<256?Q[N]:Q[256+(N>>>7)]}function V(N,pe){N.pending_buf[N.pending++]=pe&255,N.pending_buf[N.pending++]=pe>>>8&255}function j(N,pe,le){N.bi_valid>M-le?(N.bi_buf|=pe<<N.bi_valid&65535,V(N,N.bi_buf),N.bi_buf=pe>>M-N.bi_valid,N.bi_valid+=le-M):(N.bi_buf|=pe<<N.bi_valid&65535,N.bi_valid+=le)}function ne(N,pe,le){j(N,le[pe*2],le[pe*2+1])}function se(N,pe){var le=0;do le|=N&1,N>>>=1,le<<=1;while(--pe>0);return le>>>1}function xe(N){N.bi_valid===16?(V(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):N.bi_valid>=8&&(N.pending_buf[N.pending++]=N.bi_buf&255,N.bi_buf>>=8,N.bi_valid-=8)}function Me(N,pe){var le=pe.dyn_tree,Ae=pe.max_code,Z=pe.stat_desc.static_tree,ue=pe.stat_desc.has_stree,F=pe.stat_desc.extra_bits,ye=pe.stat_desc.extra_base,Te=pe.stat_desc.max_length,_,fe,ge,D,ee,ce,De=0;for(D=0;D<=B;D++)N.bl_count[D]=0;for(le[N.heap[N.heap_max]*2+1]=0,_=N.heap_max+1;_<I;_++)fe=N.heap[_],D=le[le[fe*2+1]*2+1]+1,D>Te&&(D=Te,De++),le[fe*2+1]=D,!(fe>Ae)&&(N.bl_count[D]++,ee=0,fe>=ye&&(ee=F[fe-ye]),ce=le[fe*2],N.opt_len+=ce*(D+ee),ue&&(N.static_len+=ce*(Z[fe*2+1]+ee)));if(De!==0){do{for(D=Te-1;N.bl_count[D]===0;)D--;N.bl_count[D]--,N.bl_count[D+1]+=2,N.bl_count[Te]--,De-=2}while(De>0);for(D=Te;D!==0;D--)for(fe=N.bl_count[D];fe!==0;)ge=N.heap[--_],!(ge>Ae)&&(le[ge*2+1]!==D&&(N.opt_len+=(D-le[ge*2+1])*le[ge*2],le[ge*2+1]=D),fe--)}}function ve(N,pe,le){var Ae=new Array(B+1),Z=0,ue,F;for(ue=1;ue<=B;ue++)Ae[ue]=Z=Z+le[ue-1]<<1;for(F=0;F<=pe;F++){var ye=N[F*2+1];ye!==0&&(N[F*2]=se(Ae[ye]++,ye))}}function he(){var N,pe,le,Ae,Z,ue=new Array(B+1);for(le=0,Ae=0;Ae<d-1;Ae++)for(te[Ae]=le,N=0;N<1<<S[Ae];N++)K[le++]=Ae;for(K[le-1]=Ae,Z=0,Ae=0;Ae<16;Ae++)for(X[Ae]=Z,N=0;N<1<<$[Ae];N++)Q[Z++]=Ae;for(Z>>=7;Ae<A;Ae++)for(X[Ae]=Z<<7,N=0;N<1<<$[Ae]-7;N++)Q[256+Z++]=Ae;for(pe=0;pe<=B;pe++)ue[pe]=0;for(N=0;N<=143;)z[N*2+1]=8,N++,ue[8]++;for(;N<=255;)z[N*2+1]=9,N++,ue[9]++;for(;N<=279;)z[N*2+1]=7,N++,ue[7]++;for(;N<=287;)z[N*2+1]=8,N++,ue[8]++;for(ve(z,m+1,ue),N=0;N<A;N++)H[N*2+1]=5,H[N*2]=se(N,5);ie=new J(z,S,p+1,m,B),de=new J(H,$,0,A,B),me=new J(new Array(0),G,0,k,T)}function oe(N){var pe;for(pe=0;pe<m;pe++)N.dyn_ltree[pe*2]=0;for(pe=0;pe<A;pe++)N.dyn_dtree[pe*2]=0;for(pe=0;pe<k;pe++)N.bl_tree[pe*2]=0;N.dyn_ltree[U*2]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0}function be(N){N.bi_valid>8?V(N,N.bi_buf):N.bi_valid>0&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0}function we(N,pe,le,Ae){be(N),V(N,le),V(N,~le),e.arraySet(N.pending_buf,N.window,pe,le,N.pending),N.pending+=le}function R(N,pe,le,Ae){var Z=pe*2,ue=le*2;return N[Z]<N[ue]||N[Z]===N[ue]&&Ae[pe]<=Ae[le]}function v(N,pe,le){for(var Ae=N.heap[le],Z=le<<1;Z<=N.heap_len&&(Z<N.heap_len&&R(pe,N.heap[Z+1],N.heap[Z],N.depth)&&Z++,!R(pe,Ae,N.heap[Z],N.depth));)N.heap[le]=N.heap[Z],le=Z,Z<<=1;N.heap[le]=Ae}function b(N,pe,le){var Ae,Z,ue=0,F,ye;if(N.last_lit!==0)do Ae=N.pending_buf[N.d_buf+ue*2]<<8|N.pending_buf[N.d_buf+ue*2+1],Z=N.pending_buf[N.l_buf+ue],ue++,Ae===0?ne(N,Z,pe):(F=K[Z],ne(N,F+p+1,pe),ye=S[F],ye!==0&&(Z-=te[F],j(N,Z,ye)),Ae--,F=q(Ae),ne(N,F,le),ye=$[F],ye!==0&&(Ae-=X[F],j(N,Ae,ye)));while(ue<N.last_lit);ne(N,U,pe)}function P(N,pe){var le=pe.dyn_tree,Ae=pe.stat_desc.static_tree,Z=pe.stat_desc.has_stree,ue=pe.stat_desc.elems,F,ye,Te=-1,_;for(N.heap_len=0,N.heap_max=I,F=0;F<ue;F++)le[F*2]!==0?(N.heap[++N.heap_len]=Te=F,N.depth[F]=0):le[F*2+1]=0;for(;N.heap_len<2;)_=N.heap[++N.heap_len]=Te<2?++Te:0,le[_*2]=1,N.depth[_]=0,N.opt_len--,Z&&(N.static_len-=Ae[_*2+1]);for(pe.max_code=Te,F=N.heap_len>>1;F>=1;F--)v(N,le,F);_=ue;do F=N.heap[1],N.heap[1]=N.heap[N.heap_len--],v(N,le,1),ye=N.heap[1],N.heap[--N.heap_max]=F,N.heap[--N.heap_max]=ye,le[_*2]=le[F*2]+le[ye*2],N.depth[_]=(N.depth[F]>=N.depth[ye]?N.depth[F]:N.depth[ye])+1,le[F*2+1]=le[ye*2+1]=_,N.heap[1]=_++,v(N,le,1);while(N.heap_len>=2);N.heap[--N.heap_max]=N.heap[1],Me(N,pe),ve(le,Te,N.bl_count)}function W(N,pe,le){var Ae,Z=-1,ue,F=pe[0*2+1],ye=0,Te=7,_=4;for(F===0&&(Te=138,_=3),pe[(le+1)*2+1]=65535,Ae=0;Ae<=le;Ae++)ue=F,F=pe[(Ae+1)*2+1],!(++ye<Te&&ue===F)&&(ye<_?N.bl_tree[ue*2]+=ye:ue!==0?(ue!==Z&&N.bl_tree[ue*2]++,N.bl_tree[C*2]++):ye<=10?N.bl_tree[w*2]++:N.bl_tree[E*2]++,ye=0,Z=ue,F===0?(Te=138,_=3):ue===F?(Te=6,_=3):(Te=7,_=4))}function re(N,pe,le){var Ae,Z=-1,ue,F=pe[0*2+1],ye=0,Te=7,_=4;for(F===0&&(Te=138,_=3),Ae=0;Ae<=le;Ae++)if(ue=F,F=pe[(Ae+1)*2+1],!(++ye<Te&&ue===F)){if(ye<_)do ne(N,ue,N.bl_tree);while(--ye!==0);else ue!==0?(ue!==Z&&(ne(N,ue,N.bl_tree),ye--),ne(N,C,N.bl_tree),j(N,ye-3,2)):ye<=10?(ne(N,w,N.bl_tree),j(N,ye-3,3)):(ne(N,E,N.bl_tree),j(N,ye-11,7));ye=0,Z=ue,F===0?(Te=138,_=3):ue===F?(Te=6,_=3):(Te=7,_=4)}}function ae(N){var pe;for(W(N,N.dyn_ltree,N.l_desc.max_code),W(N,N.dyn_dtree,N.d_desc.max_code),P(N,N.bl_desc),pe=k-1;pe>=3&&N.bl_tree[L[pe]*2+1]===0;pe--);return N.opt_len+=3*(pe+1)+5+5+4,pe}function Ee(N,pe,le,Ae){var Z;for(j(N,pe-257,5),j(N,le-1,5),j(N,Ae-4,4),Z=0;Z<Ae;Z++)j(N,N.bl_tree[L[Z]*2+1],3);re(N,N.dyn_ltree,pe-1),re(N,N.dyn_dtree,le-1)}function Ce(N){var pe=4093624447,le;for(le=0;le<=31;le++,pe>>>=1)if(pe&1&&N.dyn_ltree[le*2]!==0)return r;if(N.dyn_ltree[9*2]!==0||N.dyn_ltree[10*2]!==0||N.dyn_ltree[13*2]!==0)return n;for(le=32;le<p;le++)if(N.dyn_ltree[le*2]!==0)return n;return r}var Pe=!1;function Be(N){Pe||(he(),Pe=!0),N.l_desc=new _e(N.dyn_ltree,ie),N.d_desc=new _e(N.dyn_dtree,de),N.bl_desc=new _e(N.bl_tree,me),N.bi_buf=0,N.bi_valid=0,oe(N)}function Se(N,pe,le,Ae){j(N,(o<<1)+(Ae?1:0),3),we(N,pe,le)}function ke(N){j(N,s<<1,3),ne(N,U,z),xe(N)}function Ie(N,pe,le,Ae){var Z,ue,F=0;N.level>0?(N.strm.data_type===a&&(N.strm.data_type=Ce(N)),P(N,N.l_desc),P(N,N.d_desc),F=ae(N),Z=N.opt_len+3+7>>>3,ue=N.static_len+3+7>>>3,ue<=Z&&(Z=ue)):Z=ue=le+5,le+4<=Z&&pe!==-1?Se(N,pe,le,Ae):N.strategy===t||ue===Z?(j(N,(s<<1)+(Ae?1:0),3),b(N,z,H)):(j(N,(h<<1)+(Ae?1:0),3),Ee(N,N.l_desc.max_code+1,N.d_desc.max_code+1,F+1),b(N,N.dyn_ltree,N.dyn_dtree)),oe(N),Ae&&be(N)}function Le(N,pe,le){return N.pending_buf[N.d_buf+N.last_lit*2]=pe>>>8&255,N.pending_buf[N.d_buf+N.last_lit*2+1]=pe&255,N.pending_buf[N.l_buf+N.last_lit]=le&255,N.last_lit++,pe===0?N.dyn_ltree[le*2]++:(N.matches++,pe--,N.dyn_ltree[(K[le]+p+1)*2]++,N.dyn_dtree[q(pe)*2]++),N.last_lit===N.lit_bufsize-1}return trees._tr_init=Be,trees._tr_stored_block=Se,trees._tr_flush_block=Ie,trees._tr_tally=Le,trees._tr_align=ke,trees}var adler32_1,hasRequiredAdler32;function requireAdler32(){if(hasRequiredAdler32)return adler32_1;hasRequiredAdler32=1;function e(t,r,n,a){for(var l=t&65535|0,o=t>>>16&65535|0,s=0;n!==0;){s=n>2e3?2e3:n,n-=s;do l=l+r[a++]|0,o=o+l|0;while(--s);l%=65521,o%=65521}return l|o<<16|0}return adler32_1=e,adler32_1}var crc32_1,hasRequiredCrc32;function requireCrc32(){if(hasRequiredCrc32)return crc32_1;hasRequiredCrc32=1;function e(){for(var n,a=[],l=0;l<256;l++){n=l;for(var o=0;o<8;o++)n=n&1?3988292384^n>>>1:n>>>1;a[l]=n}return a}var t=e();function r(n,a,l,o){var s=t,h=o+l;n^=-1;for(var f=o;f<h;f++)n=n>>>8^s[(n^a[f])&255];return n^-1}return crc32_1=r,crc32_1}var messages,hasRequiredMessages;function requireMessages(){return hasRequiredMessages||(hasRequiredMessages=1,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),messages}var hasRequiredDeflate$1;function requireDeflate$1(){if(hasRequiredDeflate$1)return deflate;hasRequiredDeflate$1=1;var e=requireCommon(),t=requireTrees(),r=requireAdler32(),n=requireCrc32(),a=requireMessages(),l=0,o=1,s=3,h=4,f=5,u=0,d=1,p=-2,m=-3,A=-5,k=-1,I=1,B=2,M=3,T=4,U=0,C=2,w=8,E=9,S=15,$=8,G=29,L=256,O=L+1+G,z=30,H=19,Q=2*O+1,K=15,te=3,X=258,J=X+te+1,ie=32,de=42,me=69,_e=73,q=91,V=103,j=113,ne=666,se=1,xe=2,Me=3,ve=4,he=3;function oe(_,fe){return _.msg=a[fe],fe}function be(_){return(_<<1)-(_>4?9:0)}function we(_){for(var fe=_.length;--fe>=0;)_[fe]=0}function R(_){var fe=_.state,ge=fe.pending;ge>_.avail_out&&(ge=_.avail_out),ge!==0&&(e.arraySet(_.output,fe.pending_buf,fe.pending_out,ge,_.next_out),_.next_out+=ge,fe.pending_out+=ge,_.total_out+=ge,_.avail_out-=ge,fe.pending-=ge,fe.pending===0&&(fe.pending_out=0))}function v(_,fe){t._tr_flush_block(_,_.block_start>=0?_.block_start:-1,_.strstart-_.block_start,fe),_.block_start=_.strstart,R(_.strm)}function b(_,fe){_.pending_buf[_.pending++]=fe}function P(_,fe){_.pending_buf[_.pending++]=fe>>>8&255,_.pending_buf[_.pending++]=fe&255}function W(_,fe,ge,D){var ee=_.avail_in;return ee>D&&(ee=D),ee===0?0:(_.avail_in-=ee,e.arraySet(fe,_.input,_.next_in,ee,ge),_.state.wrap===1?_.adler=r(_.adler,fe,ee,ge):_.state.wrap===2&&(_.adler=n(_.adler,fe,ee,ge)),_.next_in+=ee,_.total_in+=ee,ee)}function re(_,fe){var ge=_.max_chain_length,D=_.strstart,ee,ce,De=_.prev_length,Fe=_.nice_match,Re=_.strstart>_.w_size-J?_.strstart-(_.w_size-J):0,Ne=_.window,qe=_.w_mask,ze=_.prev,Oe=_.strstart+X,$e=Ne[D+De-1],He=Ne[D+De];_.prev_length>=_.good_match&&(ge>>=2),Fe>_.lookahead&&(Fe=_.lookahead);do if(ee=fe,!(Ne[ee+De]!==He||Ne[ee+De-1]!==$e||Ne[ee]!==Ne[D]||Ne[++ee]!==Ne[D+1])){D+=2,ee++;do;while(Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&Ne[++D]===Ne[++ee]&&D<Oe);if(ce=X-(Oe-D),D=Oe-X,ce>De){if(_.match_start=fe,De=ce,ce>=Fe)break;$e=Ne[D+De-1],He=Ne[D+De]}}while((fe=ze[fe&qe])>Re&&--ge!==0);return De<=_.lookahead?De:_.lookahead}function ae(_){var fe=_.w_size,ge,D,ee,ce,De;do{if(ce=_.window_size-_.lookahead-_.strstart,_.strstart>=fe+(fe-J)){e.arraySet(_.window,_.window,fe,fe,0),_.match_start-=fe,_.strstart-=fe,_.block_start-=fe,D=_.hash_size,ge=D;do ee=_.head[--ge],_.head[ge]=ee>=fe?ee-fe:0;while(--D);D=fe,ge=D;do ee=_.prev[--ge],_.prev[ge]=ee>=fe?ee-fe:0;while(--D);ce+=fe}if(_.strm.avail_in===0)break;if(D=W(_.strm,_.window,_.strstart+_.lookahead,ce),_.lookahead+=D,_.lookahead+_.insert>=te)for(De=_.strstart-_.insert,_.ins_h=_.window[De],_.ins_h=(_.ins_h<<_.hash_shift^_.window[De+1])&_.hash_mask;_.insert&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[De+te-1])&_.hash_mask,_.prev[De&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=De,De++,_.insert--,!(_.lookahead+_.insert<te)););}while(_.lookahead<J&&_.strm.avail_in!==0)}function Ee(_,fe){var ge=65535;for(ge>_.pending_buf_size-5&&(ge=_.pending_buf_size-5);;){if(_.lookahead<=1){if(ae(_),_.lookahead===0&&fe===l)return se;if(_.lookahead===0)break}_.strstart+=_.lookahead,_.lookahead=0;var D=_.block_start+ge;if((_.strstart===0||_.strstart>=D)&&(_.lookahead=_.strstart-D,_.strstart=D,v(_,!1),_.strm.avail_out===0)||_.strstart-_.block_start>=_.w_size-J&&(v(_,!1),_.strm.avail_out===0))return se}return _.insert=0,fe===h?(v(_,!0),_.strm.avail_out===0?Me:ve):(_.strstart>_.block_start&&(v(_,!1),_.strm.avail_out===0),se)}function Ce(_,fe){for(var ge,D;;){if(_.lookahead<J){if(ae(_),_.lookahead<J&&fe===l)return se;if(_.lookahead===0)break}if(ge=0,_.lookahead>=te&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+te-1])&_.hash_mask,ge=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),ge!==0&&_.strstart-ge<=_.w_size-J&&(_.match_length=re(_,ge)),_.match_length>=te)if(D=t._tr_tally(_,_.strstart-_.match_start,_.match_length-te),_.lookahead-=_.match_length,_.match_length<=_.max_lazy_match&&_.lookahead>=te){_.match_length--;do _.strstart++,_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+te-1])&_.hash_mask,ge=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart;while(--_.match_length!==0);_.strstart++}else _.strstart+=_.match_length,_.match_length=0,_.ins_h=_.window[_.strstart],_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+1])&_.hash_mask;else D=t._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++;if(D&&(v(_,!1),_.strm.avail_out===0))return se}return _.insert=_.strstart<te-1?_.strstart:te-1,fe===h?(v(_,!0),_.strm.avail_out===0?Me:ve):_.last_lit&&(v(_,!1),_.strm.avail_out===0)?se:xe}function Pe(_,fe){for(var ge,D,ee;;){if(_.lookahead<J){if(ae(_),_.lookahead<J&&fe===l)return se;if(_.lookahead===0)break}if(ge=0,_.lookahead>=te&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+te-1])&_.hash_mask,ge=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart),_.prev_length=_.match_length,_.prev_match=_.match_start,_.match_length=te-1,ge!==0&&_.prev_length<_.max_lazy_match&&_.strstart-ge<=_.w_size-J&&(_.match_length=re(_,ge),_.match_length<=5&&(_.strategy===I||_.match_length===te&&_.strstart-_.match_start>4096)&&(_.match_length=te-1)),_.prev_length>=te&&_.match_length<=_.prev_length){ee=_.strstart+_.lookahead-te,D=t._tr_tally(_,_.strstart-1-_.prev_match,_.prev_length-te),_.lookahead-=_.prev_length-1,_.prev_length-=2;do++_.strstart<=ee&&(_.ins_h=(_.ins_h<<_.hash_shift^_.window[_.strstart+te-1])&_.hash_mask,ge=_.prev[_.strstart&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=_.strstart);while(--_.prev_length!==0);if(_.match_available=0,_.match_length=te-1,_.strstart++,D&&(v(_,!1),_.strm.avail_out===0))return se}else if(_.match_available){if(D=t._tr_tally(_,0,_.window[_.strstart-1]),D&&v(_,!1),_.strstart++,_.lookahead--,_.strm.avail_out===0)return se}else _.match_available=1,_.strstart++,_.lookahead--}return _.match_available&&(D=t._tr_tally(_,0,_.window[_.strstart-1]),_.match_available=0),_.insert=_.strstart<te-1?_.strstart:te-1,fe===h?(v(_,!0),_.strm.avail_out===0?Me:ve):_.last_lit&&(v(_,!1),_.strm.avail_out===0)?se:xe}function Be(_,fe){for(var ge,D,ee,ce,De=_.window;;){if(_.lookahead<=X){if(ae(_),_.lookahead<=X&&fe===l)return se;if(_.lookahead===0)break}if(_.match_length=0,_.lookahead>=te&&_.strstart>0&&(ee=_.strstart-1,D=De[ee],D===De[++ee]&&D===De[++ee]&&D===De[++ee])){ce=_.strstart+X;do;while(D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&D===De[++ee]&&ee<ce);_.match_length=X-(ce-ee),_.match_length>_.lookahead&&(_.match_length=_.lookahead)}if(_.match_length>=te?(ge=t._tr_tally(_,1,_.match_length-te),_.lookahead-=_.match_length,_.strstart+=_.match_length,_.match_length=0):(ge=t._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++),ge&&(v(_,!1),_.strm.avail_out===0))return se}return _.insert=0,fe===h?(v(_,!0),_.strm.avail_out===0?Me:ve):_.last_lit&&(v(_,!1),_.strm.avail_out===0)?se:xe}function Se(_,fe){for(var ge;;){if(_.lookahead===0&&(ae(_),_.lookahead===0)){if(fe===l)return se;break}if(_.match_length=0,ge=t._tr_tally(_,0,_.window[_.strstart]),_.lookahead--,_.strstart++,ge&&(v(_,!1),_.strm.avail_out===0))return se}return _.insert=0,fe===h?(v(_,!0),_.strm.avail_out===0?Me:ve):_.last_lit&&(v(_,!1),_.strm.avail_out===0)?se:xe}function ke(_,fe,ge,D,ee){this.good_length=_,this.max_lazy=fe,this.nice_length=ge,this.max_chain=D,this.func=ee}var Ie;Ie=[new ke(0,0,0,0,Ee),new ke(4,4,8,4,Ce),new ke(4,5,16,8,Ce),new ke(4,6,32,32,Ce),new ke(4,4,16,16,Pe),new ke(8,16,32,32,Pe),new ke(8,16,128,128,Pe),new ke(8,32,128,256,Pe),new ke(32,128,258,1024,Pe),new ke(32,258,258,4096,Pe)];function Le(_){_.window_size=2*_.w_size,we(_.head),_.max_lazy_match=Ie[_.level].max_lazy,_.good_match=Ie[_.level].good_length,_.nice_match=Ie[_.level].nice_length,_.max_chain_length=Ie[_.level].max_chain,_.strstart=0,_.block_start=0,_.lookahead=0,_.insert=0,_.match_length=_.prev_length=te-1,_.match_available=0,_.ins_h=0}function N(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(Q*2),this.dyn_dtree=new e.Buf16((2*z+1)*2),this.bl_tree=new e.Buf16((2*H+1)*2),we(this.dyn_ltree),we(this.dyn_dtree),we(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(K+1),this.heap=new e.Buf16(2*O+1),we(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*O+1),we(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(_){var fe;return!_||!_.state?oe(_,p):(_.total_in=_.total_out=0,_.data_type=C,fe=_.state,fe.pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?de:j,_.adler=fe.wrap===2?0:1,fe.last_flush=l,t._tr_init(fe),u)}function le(_){var fe=pe(_);return fe===u&&Le(_.state),fe}function Ae(_,fe){return!_||!_.state||_.state.wrap!==2?p:(_.state.gzhead=fe,u)}function Z(_,fe,ge,D,ee,ce){if(!_)return p;var De=1;if(fe===k&&(fe=6),D<0?(De=0,D=-D):D>15&&(De=2,D-=16),ee<1||ee>E||ge!==w||D<8||D>15||fe<0||fe>9||ce<0||ce>T)return oe(_,p);D===8&&(D=9);var Fe=new N;return _.state=Fe,Fe.strm=_,Fe.wrap=De,Fe.gzhead=null,Fe.w_bits=D,Fe.w_size=1<<Fe.w_bits,Fe.w_mask=Fe.w_size-1,Fe.hash_bits=ee+7,Fe.hash_size=1<<Fe.hash_bits,Fe.hash_mask=Fe.hash_size-1,Fe.hash_shift=~~((Fe.hash_bits+te-1)/te),Fe.window=new e.Buf8(Fe.w_size*2),Fe.head=new e.Buf16(Fe.hash_size),Fe.prev=new e.Buf16(Fe.w_size),Fe.lit_bufsize=1<<ee+6,Fe.pending_buf_size=Fe.lit_bufsize*4,Fe.pending_buf=new e.Buf8(Fe.pending_buf_size),Fe.d_buf=1*Fe.lit_bufsize,Fe.l_buf=3*Fe.lit_bufsize,Fe.level=fe,Fe.strategy=ce,Fe.method=ge,le(_)}function ue(_,fe){return Z(_,fe,w,S,$,U)}function F(_,fe){var ge,D,ee,ce;if(!_||!_.state||fe>f||fe<0)return _?oe(_,p):p;if(D=_.state,!_.output||!_.input&&_.avail_in!==0||D.status===ne&&fe!==h)return oe(_,_.avail_out===0?A:p);if(D.strm=_,ge=D.last_flush,D.last_flush=fe,D.status===de)if(D.wrap===2)_.adler=0,b(D,31),b(D,139),b(D,8),D.gzhead?(b(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),b(D,D.gzhead.time&255),b(D,D.gzhead.time>>8&255),b(D,D.gzhead.time>>16&255),b(D,D.gzhead.time>>24&255),b(D,D.level===9?2:D.strategy>=B||D.level<2?4:0),b(D,D.gzhead.os&255),D.gzhead.extra&&D.gzhead.extra.length&&(b(D,D.gzhead.extra.length&255),b(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(_.adler=n(_.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=me):(b(D,0),b(D,0),b(D,0),b(D,0),b(D,0),b(D,D.level===9?2:D.strategy>=B||D.level<2?4:0),b(D,he),D.status=j);else{var De=w+(D.w_bits-8<<4)<<8,Fe=-1;D.strategy>=B||D.level<2?Fe=0:D.level<6?Fe=1:D.level===6?Fe=2:Fe=3,De|=Fe<<6,D.strstart!==0&&(De|=ie),De+=31-De%31,D.status=j,P(D,De),D.strstart!==0&&(P(D,_.adler>>>16),P(D,_.adler&65535)),_.adler=1}if(D.status===me)if(D.gzhead.extra){for(ee=D.pending;D.gzindex<(D.gzhead.extra.length&65535)&&!(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),R(_),ee=D.pending,D.pending===D.pending_buf_size));)b(D,D.gzhead.extra[D.gzindex]&255),D.gzindex++;D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=_e)}else D.status=_e;if(D.status===_e)if(D.gzhead.name){ee=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),R(_),ee=D.pending,D.pending===D.pending_buf_size)){ce=1;break}D.gzindex<D.gzhead.name.length?ce=D.gzhead.name.charCodeAt(D.gzindex++)&255:ce=0,b(D,ce)}while(ce!==0);D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),ce===0&&(D.gzindex=0,D.status=q)}else D.status=q;if(D.status===q)if(D.gzhead.comment){ee=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),R(_),ee=D.pending,D.pending===D.pending_buf_size)){ce=1;break}D.gzindex<D.gzhead.comment.length?ce=D.gzhead.comment.charCodeAt(D.gzindex++)&255:ce=0,b(D,ce)}while(ce!==0);D.gzhead.hcrc&&D.pending>ee&&(_.adler=n(_.adler,D.pending_buf,D.pending-ee,ee)),ce===0&&(D.status=V)}else D.status=V;if(D.status===V&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&R(_),D.pending+2<=D.pending_buf_size&&(b(D,_.adler&255),b(D,_.adler>>8&255),_.adler=0,D.status=j)):D.status=j),D.pending!==0){if(R(_),_.avail_out===0)return D.last_flush=-1,u}else if(_.avail_in===0&&be(fe)<=be(ge)&&fe!==h)return oe(_,A);if(D.status===ne&&_.avail_in!==0)return oe(_,A);if(_.avail_in!==0||D.lookahead!==0||fe!==l&&D.status!==ne){var Re=D.strategy===B?Se(D,fe):D.strategy===M?Be(D,fe):Ie[D.level].func(D,fe);if((Re===Me||Re===ve)&&(D.status=ne),Re===se||Re===Me)return _.avail_out===0&&(D.last_flush=-1),u;if(Re===xe&&(fe===o?t._tr_align(D):fe!==f&&(t._tr_stored_block(D,0,0,!1),fe===s&&(we(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),R(_),_.avail_out===0))return D.last_flush=-1,u}return fe!==h?u:D.wrap<=0?d:(D.wrap===2?(b(D,_.adler&255),b(D,_.adler>>8&255),b(D,_.adler>>16&255),b(D,_.adler>>24&255),b(D,_.total_in&255),b(D,_.total_in>>8&255),b(D,_.total_in>>16&255),b(D,_.total_in>>24&255)):(P(D,_.adler>>>16),P(D,_.adler&65535)),R(_),D.wrap>0&&(D.wrap=-D.wrap),D.pending!==0?u:d)}function ye(_){var fe;return!_||!_.state?p:(fe=_.state.status,fe!==de&&fe!==me&&fe!==_e&&fe!==q&&fe!==V&&fe!==j&&fe!==ne?oe(_,p):(_.state=null,fe===j?oe(_,m):u))}function Te(_,fe){var ge=fe.length,D,ee,ce,De,Fe,Re,Ne,qe;if(!_||!_.state||(D=_.state,De=D.wrap,De===2||De===1&&D.status!==de||D.lookahead))return p;for(De===1&&(_.adler=r(_.adler,fe,ge,0)),D.wrap=0,ge>=D.w_size&&(De===0&&(we(D.head),D.strstart=0,D.block_start=0,D.insert=0),qe=new e.Buf8(D.w_size),e.arraySet(qe,fe,ge-D.w_size,D.w_size,0),fe=qe,ge=D.w_size),Fe=_.avail_in,Re=_.next_in,Ne=_.input,_.avail_in=ge,_.next_in=0,_.input=fe,ae(D);D.lookahead>=te;){ee=D.strstart,ce=D.lookahead-(te-1);do D.ins_h=(D.ins_h<<D.hash_shift^D.window[ee+te-1])&D.hash_mask,D.prev[ee&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=ee,ee++;while(--ce);D.strstart=ee,D.lookahead=te-1,ae(D)}return D.strstart+=D.lookahead,D.block_start=D.strstart,D.insert=D.lookahead,D.lookahead=0,D.match_length=D.prev_length=te-1,D.match_available=0,_.next_in=Re,_.input=Ne,_.avail_in=Fe,D.wrap=De,u}return deflate.deflateInit=ue,deflate.deflateInit2=Z,deflate.deflateReset=le,deflate.deflateResetKeep=pe,deflate.deflateSetHeader=Ae,deflate.deflate=F,deflate.deflateEnd=ye,deflate.deflateSetDictionary=Te,deflate.deflateInfo="pako deflate (from Nodeca project)",deflate}var strings={},hasRequiredStrings;function requireStrings(){if(hasRequiredStrings)return strings;hasRequiredStrings=1;var e=requireCommon(),t=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var n=new e.Buf8(256),a=0;a<256;a++)n[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;n[254]=n[254]=1,strings.string2buf=function(o){var s,h,f,u,d,p=o.length,m=0;for(u=0;u<p;u++)h=o.charCodeAt(u),(h&64512)===55296&&u+1<p&&(f=o.charCodeAt(u+1),(f&64512)===56320&&(h=65536+(h-55296<<10)+(f-56320),u++)),m+=h<128?1:h<2048?2:h<65536?3:4;for(s=new e.Buf8(m),d=0,u=0;d<m;u++)h=o.charCodeAt(u),(h&64512)===55296&&u+1<p&&(f=o.charCodeAt(u+1),(f&64512)===56320&&(h=65536+(h-55296<<10)+(f-56320),u++)),h<128?s[d++]=h:h<2048?(s[d++]=192|h>>>6,s[d++]=128|h&63):h<65536?(s[d++]=224|h>>>12,s[d++]=128|h>>>6&63,s[d++]=128|h&63):(s[d++]=240|h>>>18,s[d++]=128|h>>>12&63,s[d++]=128|h>>>6&63,s[d++]=128|h&63);return s};function l(o,s){if(s<65534&&(o.subarray&&r||!o.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(o,s));for(var h="",f=0;f<s;f++)h+=String.fromCharCode(o[f]);return h}return strings.buf2binstring=function(o){return l(o,o.length)},strings.binstring2buf=function(o){for(var s=new e.Buf8(o.length),h=0,f=s.length;h<f;h++)s[h]=o.charCodeAt(h);return s},strings.buf2string=function(o,s){var h,f,u,d,p=s||o.length,m=new Array(p*2);for(f=0,h=0;h<p;){if(u=o[h++],u<128){m[f++]=u;continue}if(d=n[u],d>4){m[f++]=65533,h+=d-1;continue}for(u&=d===2?31:d===3?15:7;d>1&&h<p;)u=u<<6|o[h++]&63,d--;if(d>1){m[f++]=65533;continue}u<65536?m[f++]=u:(u-=65536,m[f++]=55296|u>>10&1023,m[f++]=56320|u&1023)}return l(m,f)},strings.utf8border=function(o,s){var h;for(s=s||o.length,s>o.length&&(s=o.length),h=s-1;h>=0&&(o[h]&192)===128;)h--;return h<0||h===0?s:h+n[o[h]]>s?h:s},strings}var zstream,hasRequiredZstream;function requireZstream(){if(hasRequiredZstream)return zstream;hasRequiredZstream=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return zstream=e,zstream}var hasRequiredDeflate;function requireDeflate(){if(hasRequiredDeflate)return deflate$1;hasRequiredDeflate=1;var e=requireDeflate$1(),t=requireCommon(),r=requireStrings(),n=requireMessages(),a=requireZstream(),l=Object.prototype.toString,o=0,s=4,h=0,f=1,u=2,d=-1,p=0,m=8;function A(M){if(!(this instanceof A))return new A(M);this.options=t.assign({level:d,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},M||{});var T=this.options;T.raw&&T.windowBits>0?T.windowBits=-T.windowBits:T.gzip&&T.windowBits>0&&T.windowBits<16&&(T.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var U=e.deflateInit2(this.strm,T.level,T.method,T.windowBits,T.memLevel,T.strategy);if(U!==h)throw new Error(n[U]);if(T.header&&e.deflateSetHeader(this.strm,T.header),T.dictionary){var C;if(typeof T.dictionary=="string"?C=r.string2buf(T.dictionary):l.call(T.dictionary)==="[object ArrayBuffer]"?C=new Uint8Array(T.dictionary):C=T.dictionary,U=e.deflateSetDictionary(this.strm,C),U!==h)throw new Error(n[U]);this._dict_set=!0}}A.prototype.push=function(M,T){var U=this.strm,C=this.options.chunkSize,w,E;if(this.ended)return!1;E=T===~~T?T:T===!0?s:o,typeof M=="string"?U.input=r.string2buf(M):l.call(M)==="[object ArrayBuffer]"?U.input=new Uint8Array(M):U.input=M,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new t.Buf8(C),U.next_out=0,U.avail_out=C),w=e.deflate(U,E),w!==f&&w!==h)return this.onEnd(w),this.ended=!0,!1;(U.avail_out===0||U.avail_in===0&&(E===s||E===u))&&(this.options.to==="string"?this.onData(r.buf2binstring(t.shrinkBuf(U.output,U.next_out))):this.onData(t.shrinkBuf(U.output,U.next_out)))}while((U.avail_in>0||U.avail_out===0)&&w!==f);return E===s?(w=e.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):(E===u&&(this.onEnd(h),U.avail_out=0),!0)},A.prototype.onData=function(M){this.chunks.push(M)},A.prototype.onEnd=function(M){M===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=M,this.msg=this.strm.msg};function k(M,T){var U=new A(T);if(U.push(M,!0),U.err)throw U.msg||n[U.err];return U.result}function I(M,T){return T=T||{},T.raw=!0,k(M,T)}function B(M,T){return T=T||{},T.gzip=!0,k(M,T)}return deflate$1.Deflate=A,deflate$1.deflate=k,deflate$1.deflateRaw=I,deflate$1.gzip=B,deflate$1}var inflate$1={},inflate={},inffast,hasRequiredInffast;function requireInffast(){if(hasRequiredInffast)return inffast;hasRequiredInffast=1;var e=30,t=12;return inffast=function(n,a){var l,o,s,h,f,u,d,p,m,A,k,I,B,M,T,U,C,w,E,S,$,G,L,O,z;l=n.state,o=n.next_in,O=n.input,s=o+(n.avail_in-5),h=n.next_out,z=n.output,f=h-(a-n.avail_out),u=h+(n.avail_out-257),d=l.dmax,p=l.wsize,m=l.whave,A=l.wnext,k=l.window,I=l.hold,B=l.bits,M=l.lencode,T=l.distcode,U=(1<<l.lenbits)-1,C=(1<<l.distbits)-1;e:do{B<15&&(I+=O[o++]<<B,B+=8,I+=O[o++]<<B,B+=8),w=M[I&U];t:for(;;){if(E=w>>>24,I>>>=E,B-=E,E=w>>>16&255,E===0)z[h++]=w&65535;else if(E&16){S=w&65535,E&=15,E&&(B<E&&(I+=O[o++]<<B,B+=8),S+=I&(1<<E)-1,I>>>=E,B-=E),B<15&&(I+=O[o++]<<B,B+=8,I+=O[o++]<<B,B+=8),w=T[I&C];r:for(;;){if(E=w>>>24,I>>>=E,B-=E,E=w>>>16&255,E&16){if($=w&65535,E&=15,B<E&&(I+=O[o++]<<B,B+=8,B<E&&(I+=O[o++]<<B,B+=8)),$+=I&(1<<E)-1,$>d){n.msg="invalid distance too far back",l.mode=e;break e}if(I>>>=E,B-=E,E=h-f,$>E){if(E=$-E,E>m&&l.sane){n.msg="invalid distance too far back",l.mode=e;break e}if(G=0,L=k,A===0){if(G+=p-E,E<S){S-=E;do z[h++]=k[G++];while(--E);G=h-$,L=z}}else if(A<E){if(G+=p+A-E,E-=A,E<S){S-=E;do z[h++]=k[G++];while(--E);if(G=0,A<S){E=A,S-=E;do z[h++]=k[G++];while(--E);G=h-$,L=z}}}else if(G+=A-E,E<S){S-=E;do z[h++]=k[G++];while(--E);G=h-$,L=z}for(;S>2;)z[h++]=L[G++],z[h++]=L[G++],z[h++]=L[G++],S-=3;S&&(z[h++]=L[G++],S>1&&(z[h++]=L[G++]))}else{G=h-$;do z[h++]=z[G++],z[h++]=z[G++],z[h++]=z[G++],S-=3;while(S>2);S&&(z[h++]=z[G++],S>1&&(z[h++]=z[G++]))}}else if(E&64){n.msg="invalid distance code",l.mode=e;break e}else{w=T[(w&65535)+(I&(1<<E)-1)];continue r}break}}else if(E&64)if(E&32){l.mode=t;break e}else{n.msg="invalid literal/length code",l.mode=e;break e}else{w=M[(w&65535)+(I&(1<<E)-1)];continue t}break}}while(o<s&&h<u);S=B>>3,o-=S,B-=S<<3,I&=(1<<B)-1,n.next_in=o,n.next_out=h,n.avail_in=o<s?5+(s-o):5-(o-s),n.avail_out=h<u?257+(u-h):257-(h-u),l.hold=I,l.bits=B},inffast}var inftrees,hasRequiredInftrees;function requireInftrees(){if(hasRequiredInftrees)return inftrees;hasRequiredInftrees=1;var e=requireCommon(),t=15,r=852,n=592,a=0,l=1,o=2,s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return inftrees=function(p,m,A,k,I,B,M,T){var U=T.bits,C=0,w=0,E=0,S=0,$=0,G=0,L=0,O=0,z=0,H=0,Q,K,te,X,J,ie=null,de=0,me,_e=new e.Buf16(t+1),q=new e.Buf16(t+1),V=null,j=0,ne,se,xe;for(C=0;C<=t;C++)_e[C]=0;for(w=0;w<k;w++)_e[m[A+w]]++;for($=U,S=t;S>=1&&_e[S]===0;S--);if($>S&&($=S),S===0)return I[B++]=1<<24|64<<16|0,I[B++]=1<<24|64<<16|0,T.bits=1,0;for(E=1;E<S&&_e[E]===0;E++);for($<E&&($=E),O=1,C=1;C<=t;C++)if(O<<=1,O-=_e[C],O<0)return-1;if(O>0&&(p===a||S!==1))return-1;for(q[1]=0,C=1;C<t;C++)q[C+1]=q[C]+_e[C];for(w=0;w<k;w++)m[A+w]!==0&&(M[q[m[A+w]]++]=w);if(p===a?(ie=V=M,me=19):p===l?(ie=s,de-=257,V=h,j-=257,me=256):(ie=f,V=u,me=-1),H=0,w=0,C=E,J=B,G=$,L=0,te=-1,z=1<<$,X=z-1,p===l&&z>r||p===o&&z>n)return 1;for(;;){ne=C-L,M[w]<me?(se=0,xe=M[w]):M[w]>me?(se=V[j+M[w]],xe=ie[de+M[w]]):(se=96,xe=0),Q=1<<C-L,K=1<<G,E=K;do K-=Q,I[J+(H>>L)+K]=ne<<24|se<<16|xe|0;while(K!==0);for(Q=1<<C-1;H&Q;)Q>>=1;if(Q!==0?(H&=Q-1,H+=Q):H=0,w++,--_e[C]===0){if(C===S)break;C=m[A+M[w]]}if(C>$&&(H&X)!==te){for(L===0&&(L=$),J+=E,G=C-L,O=1<<G;G+L<S&&(O-=_e[G+L],!(O<=0));)G++,O<<=1;if(z+=1<<G,p===l&&z>r||p===o&&z>n)return 1;te=H&X,I[te]=$<<24|G<<16|J-B|0}}return H!==0&&(I[J+H]=C-L<<24|64<<16|0),T.bits=$,0},inftrees}var hasRequiredInflate$1;function requireInflate$1(){if(hasRequiredInflate$1)return inflate;hasRequiredInflate$1=1;var e=requireCommon(),t=requireAdler32(),r=requireCrc32(),n=requireInffast(),a=requireInftrees(),l=0,o=1,s=2,h=4,f=5,u=6,d=0,p=1,m=2,A=-2,k=-3,I=-4,B=-5,M=8,T=1,U=2,C=3,w=4,E=5,S=6,$=7,G=8,L=9,O=10,z=11,H=12,Q=13,K=14,te=15,X=16,J=17,ie=18,de=19,me=20,_e=21,q=22,V=23,j=24,ne=25,se=26,xe=27,Me=28,ve=29,he=30,oe=31,be=32,we=852,R=592,v=15,b=v;function P(Z){return(Z>>>24&255)+(Z>>>8&65280)+((Z&65280)<<8)+((Z&255)<<24)}function W(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function re(Z){var ue;return!Z||!Z.state?A:(ue=Z.state,Z.total_in=Z.total_out=ue.total=0,Z.msg="",ue.wrap&&(Z.adler=ue.wrap&1),ue.mode=T,ue.last=0,ue.havedict=0,ue.dmax=32768,ue.head=null,ue.hold=0,ue.bits=0,ue.lencode=ue.lendyn=new e.Buf32(we),ue.distcode=ue.distdyn=new e.Buf32(R),ue.sane=1,ue.back=-1,d)}function ae(Z){var ue;return!Z||!Z.state?A:(ue=Z.state,ue.wsize=0,ue.whave=0,ue.wnext=0,re(Z))}function Ee(Z,ue){var F,ye;return!Z||!Z.state||(ye=Z.state,ue<0?(F=0,ue=-ue):(F=(ue>>4)+1,ue<48&&(ue&=15)),ue&&(ue<8||ue>15))?A:(ye.window!==null&&ye.wbits!==ue&&(ye.window=null),ye.wrap=F,ye.wbits=ue,ae(Z))}function Ce(Z,ue){var F,ye;return Z?(ye=new W,Z.state=ye,ye.window=null,F=Ee(Z,ue),F!==d&&(Z.state=null),F):A}function Pe(Z){return Ce(Z,b)}var Be=!0,Se,ke;function Ie(Z){if(Be){var ue;for(Se=new e.Buf32(512),ke=new e.Buf32(32),ue=0;ue<144;)Z.lens[ue++]=8;for(;ue<256;)Z.lens[ue++]=9;for(;ue<280;)Z.lens[ue++]=7;for(;ue<288;)Z.lens[ue++]=8;for(a(o,Z.lens,0,288,Se,0,Z.work,{bits:9}),ue=0;ue<32;)Z.lens[ue++]=5;a(s,Z.lens,0,32,ke,0,Z.work,{bits:5}),Be=!1}Z.lencode=Se,Z.lenbits=9,Z.distcode=ke,Z.distbits=5}function Le(Z,ue,F,ye){var Te,_=Z.state;return _.window===null&&(_.wsize=1<<_.wbits,_.wnext=0,_.whave=0,_.window=new e.Buf8(_.wsize)),ye>=_.wsize?(e.arraySet(_.window,ue,F-_.wsize,_.wsize,0),_.wnext=0,_.whave=_.wsize):(Te=_.wsize-_.wnext,Te>ye&&(Te=ye),e.arraySet(_.window,ue,F-ye,Te,_.wnext),ye-=Te,ye?(e.arraySet(_.window,ue,F-ye,ye,0),_.wnext=ye,_.whave=_.wsize):(_.wnext+=Te,_.wnext===_.wsize&&(_.wnext=0),_.whave<_.wsize&&(_.whave+=Te))),0}function N(Z,ue){var F,ye,Te,_,fe,ge,D,ee,ce,De,Fe,Re,Ne,qe,ze=0,Oe,$e,He,We,Ve,Xe,Ge,Qe,Ue=new e.Buf8(4),Ye,je,Ze=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Z||!Z.state||!Z.output||!Z.input&&Z.avail_in!==0)return A;F=Z.state,F.mode===H&&(F.mode=Q),fe=Z.next_out,Te=Z.output,D=Z.avail_out,_=Z.next_in,ye=Z.input,ge=Z.avail_in,ee=F.hold,ce=F.bits,De=ge,Fe=D,Qe=d;e:for(;;)switch(F.mode){case T:if(F.wrap===0){F.mode=Q;break}for(;ce<16;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(F.wrap&2&&ee===35615){F.check=0,Ue[0]=ee&255,Ue[1]=ee>>>8&255,F.check=r(F.check,Ue,2,0),ee=0,ce=0,F.mode=U;break}if(F.flags=0,F.head&&(F.head.done=!1),!(F.wrap&1)||(((ee&255)<<8)+(ee>>8))%31){Z.msg="incorrect header check",F.mode=he;break}if((ee&15)!==M){Z.msg="unknown compression method",F.mode=he;break}if(ee>>>=4,ce-=4,Ge=(ee&15)+8,F.wbits===0)F.wbits=Ge;else if(Ge>F.wbits){Z.msg="invalid window size",F.mode=he;break}F.dmax=1<<Ge,Z.adler=F.check=1,F.mode=ee&512?O:H,ee=0,ce=0;break;case U:for(;ce<16;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(F.flags=ee,(F.flags&255)!==M){Z.msg="unknown compression method",F.mode=he;break}if(F.flags&57344){Z.msg="unknown header flags set",F.mode=he;break}F.head&&(F.head.text=ee>>8&1),F.flags&512&&(Ue[0]=ee&255,Ue[1]=ee>>>8&255,F.check=r(F.check,Ue,2,0)),ee=0,ce=0,F.mode=C;case C:for(;ce<32;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.head&&(F.head.time=ee),F.flags&512&&(Ue[0]=ee&255,Ue[1]=ee>>>8&255,Ue[2]=ee>>>16&255,Ue[3]=ee>>>24&255,F.check=r(F.check,Ue,4,0)),ee=0,ce=0,F.mode=w;case w:for(;ce<16;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.head&&(F.head.xflags=ee&255,F.head.os=ee>>8),F.flags&512&&(Ue[0]=ee&255,Ue[1]=ee>>>8&255,F.check=r(F.check,Ue,2,0)),ee=0,ce=0,F.mode=E;case E:if(F.flags&1024){for(;ce<16;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.length=ee,F.head&&(F.head.extra_len=ee),F.flags&512&&(Ue[0]=ee&255,Ue[1]=ee>>>8&255,F.check=r(F.check,Ue,2,0)),ee=0,ce=0}else F.head&&(F.head.extra=null);F.mode=S;case S:if(F.flags&1024&&(Re=F.length,Re>ge&&(Re=ge),Re&&(F.head&&(Ge=F.head.extra_len-F.length,F.head.extra||(F.head.extra=new Array(F.head.extra_len)),e.arraySet(F.head.extra,ye,_,Re,Ge)),F.flags&512&&(F.check=r(F.check,ye,Re,_)),ge-=Re,_+=Re,F.length-=Re),F.length))break e;F.length=0,F.mode=$;case $:if(F.flags&2048){if(ge===0)break e;Re=0;do Ge=ye[_+Re++],F.head&&Ge&&F.length<65536&&(F.head.name+=String.fromCharCode(Ge));while(Ge&&Re<ge);if(F.flags&512&&(F.check=r(F.check,ye,Re,_)),ge-=Re,_+=Re,Ge)break e}else F.head&&(F.head.name=null);F.length=0,F.mode=G;case G:if(F.flags&4096){if(ge===0)break e;Re=0;do Ge=ye[_+Re++],F.head&&Ge&&F.length<65536&&(F.head.comment+=String.fromCharCode(Ge));while(Ge&&Re<ge);if(F.flags&512&&(F.check=r(F.check,ye,Re,_)),ge-=Re,_+=Re,Ge)break e}else F.head&&(F.head.comment=null);F.mode=L;case L:if(F.flags&512){for(;ce<16;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(ee!==(F.check&65535)){Z.msg="header crc mismatch",F.mode=he;break}ee=0,ce=0}F.head&&(F.head.hcrc=F.flags>>9&1,F.head.done=!0),Z.adler=F.check=0,F.mode=H;break;case O:for(;ce<32;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}Z.adler=F.check=P(ee),ee=0,ce=0,F.mode=z;case z:if(F.havedict===0)return Z.next_out=fe,Z.avail_out=D,Z.next_in=_,Z.avail_in=ge,F.hold=ee,F.bits=ce,m;Z.adler=F.check=1,F.mode=H;case H:if(ue===f||ue===u)break e;case Q:if(F.last){ee>>>=ce&7,ce-=ce&7,F.mode=xe;break}for(;ce<3;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}switch(F.last=ee&1,ee>>>=1,ce-=1,ee&3){case 0:F.mode=K;break;case 1:if(Ie(F),F.mode=me,ue===u){ee>>>=2,ce-=2;break e}break;case 2:F.mode=J;break;case 3:Z.msg="invalid block type",F.mode=he}ee>>>=2,ce-=2;break;case K:for(ee>>>=ce&7,ce-=ce&7;ce<32;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if((ee&65535)!==(ee>>>16^65535)){Z.msg="invalid stored block lengths",F.mode=he;break}if(F.length=ee&65535,ee=0,ce=0,F.mode=te,ue===u)break e;case te:F.mode=X;case X:if(Re=F.length,Re){if(Re>ge&&(Re=ge),Re>D&&(Re=D),Re===0)break e;e.arraySet(Te,ye,_,Re,fe),ge-=Re,_+=Re,D-=Re,fe+=Re,F.length-=Re;break}F.mode=H;break;case J:for(;ce<14;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(F.nlen=(ee&31)+257,ee>>>=5,ce-=5,F.ndist=(ee&31)+1,ee>>>=5,ce-=5,F.ncode=(ee&15)+4,ee>>>=4,ce-=4,F.nlen>286||F.ndist>30){Z.msg="too many length or distance symbols",F.mode=he;break}F.have=0,F.mode=ie;case ie:for(;F.have<F.ncode;){for(;ce<3;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.lens[Ze[F.have++]]=ee&7,ee>>>=3,ce-=3}for(;F.have<19;)F.lens[Ze[F.have++]]=0;if(F.lencode=F.lendyn,F.lenbits=7,Ye={bits:F.lenbits},Qe=a(l,F.lens,0,19,F.lencode,0,F.work,Ye),F.lenbits=Ye.bits,Qe){Z.msg="invalid code lengths set",F.mode=he;break}F.have=0,F.mode=de;case de:for(;F.have<F.nlen+F.ndist;){for(;ze=F.lencode[ee&(1<<F.lenbits)-1],Oe=ze>>>24,$e=ze>>>16&255,He=ze&65535,!(Oe<=ce);){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(He<16)ee>>>=Oe,ce-=Oe,F.lens[F.have++]=He;else{if(He===16){for(je=Oe+2;ce<je;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(ee>>>=Oe,ce-=Oe,F.have===0){Z.msg="invalid bit length repeat",F.mode=he;break}Ge=F.lens[F.have-1],Re=3+(ee&3),ee>>>=2,ce-=2}else if(He===17){for(je=Oe+3;ce<je;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}ee>>>=Oe,ce-=Oe,Ge=0,Re=3+(ee&7),ee>>>=3,ce-=3}else{for(je=Oe+7;ce<je;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}ee>>>=Oe,ce-=Oe,Ge=0,Re=11+(ee&127),ee>>>=7,ce-=7}if(F.have+Re>F.nlen+F.ndist){Z.msg="invalid bit length repeat",F.mode=he;break}for(;Re--;)F.lens[F.have++]=Ge}}if(F.mode===he)break;if(F.lens[256]===0){Z.msg="invalid code -- missing end-of-block",F.mode=he;break}if(F.lenbits=9,Ye={bits:F.lenbits},Qe=a(o,F.lens,0,F.nlen,F.lencode,0,F.work,Ye),F.lenbits=Ye.bits,Qe){Z.msg="invalid literal/lengths set",F.mode=he;break}if(F.distbits=6,F.distcode=F.distdyn,Ye={bits:F.distbits},Qe=a(s,F.lens,F.nlen,F.ndist,F.distcode,0,F.work,Ye),F.distbits=Ye.bits,Qe){Z.msg="invalid distances set",F.mode=he;break}if(F.mode=me,ue===u)break e;case me:F.mode=_e;case _e:if(ge>=6&&D>=258){Z.next_out=fe,Z.avail_out=D,Z.next_in=_,Z.avail_in=ge,F.hold=ee,F.bits=ce,n(Z,Fe),fe=Z.next_out,Te=Z.output,D=Z.avail_out,_=Z.next_in,ye=Z.input,ge=Z.avail_in,ee=F.hold,ce=F.bits,F.mode===H&&(F.back=-1);break}for(F.back=0;ze=F.lencode[ee&(1<<F.lenbits)-1],Oe=ze>>>24,$e=ze>>>16&255,He=ze&65535,!(Oe<=ce);){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if($e&&!($e&240)){for(We=Oe,Ve=$e,Xe=He;ze=F.lencode[Xe+((ee&(1<<We+Ve)-1)>>We)],Oe=ze>>>24,$e=ze>>>16&255,He=ze&65535,!(We+Oe<=ce);){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}ee>>>=We,ce-=We,F.back+=We}if(ee>>>=Oe,ce-=Oe,F.back+=Oe,F.length=He,$e===0){F.mode=se;break}if($e&32){F.back=-1,F.mode=H;break}if($e&64){Z.msg="invalid literal/length code",F.mode=he;break}F.extra=$e&15,F.mode=q;case q:if(F.extra){for(je=F.extra;ce<je;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.length+=ee&(1<<F.extra)-1,ee>>>=F.extra,ce-=F.extra,F.back+=F.extra}F.was=F.length,F.mode=V;case V:for(;ze=F.distcode[ee&(1<<F.distbits)-1],Oe=ze>>>24,$e=ze>>>16&255,He=ze&65535,!(Oe<=ce);){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(!($e&240)){for(We=Oe,Ve=$e,Xe=He;ze=F.distcode[Xe+((ee&(1<<We+Ve)-1)>>We)],Oe=ze>>>24,$e=ze>>>16&255,He=ze&65535,!(We+Oe<=ce);){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}ee>>>=We,ce-=We,F.back+=We}if(ee>>>=Oe,ce-=Oe,F.back+=Oe,$e&64){Z.msg="invalid distance code",F.mode=he;break}F.offset=He,F.extra=$e&15,F.mode=j;case j:if(F.extra){for(je=F.extra;ce<je;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}F.offset+=ee&(1<<F.extra)-1,ee>>>=F.extra,ce-=F.extra,F.back+=F.extra}if(F.offset>F.dmax){Z.msg="invalid distance too far back",F.mode=he;break}F.mode=ne;case ne:if(D===0)break e;if(Re=Fe-D,F.offset>Re){if(Re=F.offset-Re,Re>F.whave&&F.sane){Z.msg="invalid distance too far back",F.mode=he;break}Re>F.wnext?(Re-=F.wnext,Ne=F.wsize-Re):Ne=F.wnext-Re,Re>F.length&&(Re=F.length),qe=F.window}else qe=Te,Ne=fe-F.offset,Re=F.length;Re>D&&(Re=D),D-=Re,F.length-=Re;do Te[fe++]=qe[Ne++];while(--Re);F.length===0&&(F.mode=_e);break;case se:if(D===0)break e;Te[fe++]=F.length,D--,F.mode=_e;break;case xe:if(F.wrap){for(;ce<32;){if(ge===0)break e;ge--,ee|=ye[_++]<<ce,ce+=8}if(Fe-=D,Z.total_out+=Fe,F.total+=Fe,Fe&&(Z.adler=F.check=F.flags?r(F.check,Te,Fe,fe-Fe):t(F.check,Te,Fe,fe-Fe)),Fe=D,(F.flags?ee:P(ee))!==F.check){Z.msg="incorrect data check",F.mode=he;break}ee=0,ce=0}F.mode=Me;case Me:if(F.wrap&&F.flags){for(;ce<32;){if(ge===0)break e;ge--,ee+=ye[_++]<<ce,ce+=8}if(ee!==(F.total&4294967295)){Z.msg="incorrect length check",F.mode=he;break}ee=0,ce=0}F.mode=ve;case ve:Qe=p;break e;case he:Qe=k;break e;case oe:return I;case be:default:return A}return Z.next_out=fe,Z.avail_out=D,Z.next_in=_,Z.avail_in=ge,F.hold=ee,F.bits=ce,(F.wsize||Fe!==Z.avail_out&&F.mode<he&&(F.mode<xe||ue!==h))&&Le(Z,Z.output,Z.next_out,Fe-Z.avail_out),De-=Z.avail_in,Fe-=Z.avail_out,Z.total_in+=De,Z.total_out+=Fe,F.total+=Fe,F.wrap&&Fe&&(Z.adler=F.check=F.flags?r(F.check,Te,Fe,Z.next_out-Fe):t(F.check,Te,Fe,Z.next_out-Fe)),Z.data_type=F.bits+(F.last?64:0)+(F.mode===H?128:0)+(F.mode===me||F.mode===te?256:0),(De===0&&Fe===0||ue===h)&&Qe===d&&(Qe=B),Qe}function pe(Z){if(!Z||!Z.state)return A;var ue=Z.state;return ue.window&&(ue.window=null),Z.state=null,d}function le(Z,ue){var F;return!Z||!Z.state||(F=Z.state,!(F.wrap&2))?A:(F.head=ue,ue.done=!1,d)}function Ae(Z,ue){var F=ue.length,ye,Te,_;return!Z||!Z.state||(ye=Z.state,ye.wrap!==0&&ye.mode!==z)?A:ye.mode===z&&(Te=1,Te=t(Te,ue,F,0),Te!==ye.check)?k:(_=Le(Z,ue,F,F),_?(ye.mode=oe,I):(ye.havedict=1,d))}return inflate.inflateReset=ae,inflate.inflateReset2=Ee,inflate.inflateResetKeep=re,inflate.inflateInit=Pe,inflate.inflateInit2=Ce,inflate.inflate=N,inflate.inflateEnd=pe,inflate.inflateGetHeader=le,inflate.inflateSetDictionary=Ae,inflate.inflateInfo="pako inflate (from Nodeca project)",inflate}var constants,hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,constants={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),constants}var gzheader,hasRequiredGzheader;function requireGzheader(){if(hasRequiredGzheader)return gzheader;hasRequiredGzheader=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return gzheader=e,gzheader}var hasRequiredInflate;function requireInflate(){if(hasRequiredInflate)return inflate$1;hasRequiredInflate=1;var e=requireInflate$1(),t=requireCommon(),r=requireStrings(),n=requireConstants(),a=requireMessages(),l=requireZstream(),o=requireGzheader(),s=Object.prototype.toString;function h(d){if(!(this instanceof h))return new h(d);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},d||{});var p=this.options;p.raw&&p.windowBits>=0&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),p.windowBits>=0&&p.windowBits<16&&!(d&&d.windowBits)&&(p.windowBits+=32),p.windowBits>15&&p.windowBits<48&&(p.windowBits&15||(p.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var m=e.inflateInit2(this.strm,p.windowBits);if(m!==n.Z_OK)throw new Error(a[m]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),p.dictionary&&(typeof p.dictionary=="string"?p.dictionary=r.string2buf(p.dictionary):s.call(p.dictionary)==="[object ArrayBuffer]"&&(p.dictionary=new Uint8Array(p.dictionary)),p.raw&&(m=e.inflateSetDictionary(this.strm,p.dictionary),m!==n.Z_OK)))throw new Error(a[m])}h.prototype.push=function(d,p){var m=this.strm,A=this.options.chunkSize,k=this.options.dictionary,I,B,M,T,U,C=!1;if(this.ended)return!1;B=p===~~p?p:p===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof d=="string"?m.input=r.binstring2buf(d):s.call(d)==="[object ArrayBuffer]"?m.input=new Uint8Array(d):m.input=d,m.next_in=0,m.avail_in=m.input.length;do{if(m.avail_out===0&&(m.output=new t.Buf8(A),m.next_out=0,m.avail_out=A),I=e.inflate(m,n.Z_NO_FLUSH),I===n.Z_NEED_DICT&&k&&(I=e.inflateSetDictionary(this.strm,k)),I===n.Z_BUF_ERROR&&C===!0&&(I=n.Z_OK,C=!1),I!==n.Z_STREAM_END&&I!==n.Z_OK)return this.onEnd(I),this.ended=!0,!1;m.next_out&&(m.avail_out===0||I===n.Z_STREAM_END||m.avail_in===0&&(B===n.Z_FINISH||B===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(M=r.utf8border(m.output,m.next_out),T=m.next_out-M,U=r.buf2string(m.output,M),m.next_out=T,m.avail_out=A-T,T&&t.arraySet(m.output,m.output,M,T,0),this.onData(U)):this.onData(t.shrinkBuf(m.output,m.next_out))),m.avail_in===0&&m.avail_out===0&&(C=!0)}while((m.avail_in>0||m.avail_out===0)&&I!==n.Z_STREAM_END);return I===n.Z_STREAM_END&&(B=n.Z_FINISH),B===n.Z_FINISH?(I=e.inflateEnd(this.strm),this.onEnd(I),this.ended=!0,I===n.Z_OK):(B===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),m.avail_out=0),!0)},h.prototype.onData=function(d){this.chunks.push(d)},h.prototype.onEnd=function(d){d===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg};function f(d,p){var m=new h(p);if(m.push(d,!0),m.err)throw m.msg||a[m.err];return m.result}function u(d,p){return p=p||{},p.raw=!0,f(d,p)}return inflate$1.Inflate=h,inflate$1.inflate=f,inflate$1.inflateRaw=u,inflate$1.ungzip=f,inflate$1}var pako_1,hasRequiredPako;function requirePako(){if(hasRequiredPako)return pako_1;hasRequiredPako=1;var e=requireCommon().assign,t=requireDeflate(),r=requireInflate(),n=requireConstants(),a={};return e(a,t,r,n),pako_1=a,pako_1}(function(e){(function(){var t={};e.exports=t;var r=typeof commonjsRequire=="function"?requirePako():self.pako;function n(){typeof process>"u"&&console.log.apply(console,arguments)}(function(a,l){(function(){var o=function(){function u(d){this.message="JPEG error: "+d}return u.prototype=new Error,u.prototype.name="JpegError",u.constructor=u,u}(),s=function(){var u=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),d=4017,p=799,m=3406,A=2276,k=1567,I=3784,B=5793,M=2896;function T(G){G==null&&(G={}),G.w==null&&(G.w=-1),this.V=G.n,this.N=G.w}function U(G,L){for(var O=0,z=[],H,Q,K=16,te;K>0&&!G[K-1];)K--;z.push({children:[],index:0});var X=z[0];for(H=0;H<K;H++){for(Q=0;Q<G[H];Q++){for(X=z.pop(),X.children[X.index]=L[O];X.index>0;)X=z.pop();for(X.index++,z.push(X);z.length<=H;)z.push(te={children:[],index:0}),X.children[X.index]=te.children,X=te;O++}H+1<K&&(z.push(te={children:[],index:0}),X.children[X.index]=te.children,X=te)}return z[0].children}function C(G,L,O){return 64*((G.P+1)*L+O)}function w(G,L,O,z,H,Q,K,te,X,J){J==null&&(J=!1);var ie=O.m,de=O.Z,me=L,_e=0,q=0,V=0,j=0,ne,se=0,xe,Me,ve,he,oe,be,we=0,R,v,b,P;function W(){if(q>0)return q--,_e>>q&1;if(_e=G[L++],_e===255){var le=G[L++];if(le){if(le===220&&J){L+=2;var Ae=h(G,L);if(L+=2,Ae>0&&Ae!==O.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",Ae)}else if(le===217){if(J){var Z=se*8;if(Z>0&&Z<O.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",Z)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new o("unexpected marker")}}return q=7,_e>>>7}function re(le){for(var Ae=le;;){switch(Ae=Ae[W()],typeof Ae){case"number":return Ae;case"object":continue}throw new o("invalid huffman sequence")}}function ae(le){for(var Ae=0;le>0;)Ae=Ae<<1|W(),le--;return Ae}function Ee(le){if(le===1)return W()===1?1:-1;var Ae=ae(le);return Ae>=1<<le-1?Ae:Ae+(-1<<le)+1}function Ce(le,Ae){var Z=re(le.J),ue=Z===0?0:Ee(Z),F=1;for(le.D[Ae]=le.Q+=ue;F<64;){var ye=re(le.i),Te=ye&15,_=ye>>4;if(Te===0){if(_<15)break;F+=16;continue}F+=_;var fe=u[F];le.D[Ae+fe]=Ee(Te),F++}}function Pe(le,Ae){var Z=re(le.J),ue=Z===0?0:Ee(Z)<<X;le.D[Ae]=le.Q+=ue}function Be(le,Ae){le.D[Ae]|=W()<<X}function Se(le,Ae){if(V>0){V--;return}for(var Z=Q,ue=K;Z<=ue;){var F=re(le.i),ye=F&15,Te=F>>4;if(ye===0){if(Te<15){V=ae(Te)+(1<<Te)-1;break}Z+=16;continue}Z+=Te;var _=u[Z];le.D[Ae+_]=Ee(ye)*(1<<X),Z++}}function ke(le,Ae){for(var Z=Q,ue=K,F=0,ye,Te;Z<=ue;){var _=Ae+u[Z],fe=le.D[_]<0?-1:1;switch(j){case 0:if(Te=re(le.i),ye=Te&15,F=Te>>4,ye===0)F<15?(V=ae(F)+(1<<F),j=4):(F=16,j=1);else{if(ye!==1)throw new o("invalid ACn encoding");ne=Ee(ye),j=F?2:3}continue;case 1:case 2:le.D[_]?le.D[_]+=fe*(W()<<X):(F--,F===0&&(j=j===2?3:0));break;case 3:le.D[_]?le.D[_]+=fe*(W()<<X):(le.D[_]=ne<<X,j=0);break;case 4:le.D[_]&&(le.D[_]+=fe*(W()<<X));break}Z++}j===4&&(V--,V===0&&(j=0))}function Ie(le,Ae,Z,ue,F){var ye=Z/ie|0,Te=Z%ie;se=ye*le.A+ue;var _=Te*le.h+F,fe=C(le,se,_);Ae(le,fe)}function Le(le,Ae,Z){se=Z/le.P|0;var ue=Z%le.P,F=C(le,se,ue);Ae(le,F)}var N=z.length;for(de?Q===0?be=te===0?Pe:Be:be=te===0?Se:ke:be=Ce,N===1?v=z[0].P*z[0].c:v=ie*O.R;we<=v;){var pe=H?Math.min(v-we,H):v;if(pe>0){for(Me=0;Me<N;Me++)z[Me].Q=0;if(V=0,N===1)for(xe=z[0],oe=0;oe<pe;oe++)Le(xe,be,we),we++;else for(oe=0;oe<pe;oe++){for(Me=0;Me<N;Me++)for(xe=z[Me],b=xe.h,P=xe.A,ve=0;ve<P;ve++)for(he=0;he<b;he++)Ie(xe,be,we,ve,he);we++}}if(q=0,R=$(G,L),!R)break;if(R.u&&(L=R.offset),R.M>=65488&&R.M<=65495)L+=2;else break}return L-me}function E(G,L,O){var z=G.$,H=G.D,Q,K,te,X,J,ie,de,me,_e,q,V,j,ne,se,xe,Me,ve;if(!z)throw new o("missing required Quantization Table.");for(var he=0;he<64;he+=8){if(_e=H[L+he],q=H[L+he+1],V=H[L+he+2],j=H[L+he+3],ne=H[L+he+4],se=H[L+he+5],xe=H[L+he+6],Me=H[L+he+7],_e*=z[he],!(q|V|j|ne|se|xe|Me)){ve=B*_e+512>>10,O[he]=ve,O[he+1]=ve,O[he+2]=ve,O[he+3]=ve,O[he+4]=ve,O[he+5]=ve,O[he+6]=ve,O[he+7]=ve;continue}q*=z[he+1],V*=z[he+2],j*=z[he+3],ne*=z[he+4],se*=z[he+5],xe*=z[he+6],Me*=z[he+7],Q=B*_e+128>>8,K=B*ne+128>>8,te=V,X=xe,J=M*(q-Me)+128>>8,me=M*(q+Me)+128>>8,ie=j<<4,de=se<<4,Q=Q+K+1>>1,K=Q-K,ve=te*I+X*k+128>>8,te=te*k-X*I+128>>8,X=ve,J=J+de+1>>1,de=J-de,me=me+ie+1>>1,ie=me-ie,Q=Q+X+1>>1,X=Q-X,K=K+te+1>>1,te=K-te,ve=J*A+me*m+2048>>12,J=J*m-me*A+2048>>12,me=ve,ve=ie*p+de*d+2048>>12,ie=ie*d-de*p+2048>>12,de=ve,O[he]=Q+me,O[he+7]=Q-me,O[he+1]=K+de,O[he+6]=K-de,O[he+2]=te+ie,O[he+5]=te-ie,O[he+3]=X+J,O[he+4]=X-J}for(var oe=0;oe<8;++oe){if(_e=O[oe],q=O[oe+8],V=O[oe+16],j=O[oe+24],ne=O[oe+32],se=O[oe+40],xe=O[oe+48],Me=O[oe+56],!(q|V|j|ne|se|xe|Me)){ve=B*_e+8192>>14,ve<-2040?ve=0:ve>=2024?ve=255:ve=ve+2056>>4,H[L+oe]=ve,H[L+oe+8]=ve,H[L+oe+16]=ve,H[L+oe+24]=ve,H[L+oe+32]=ve,H[L+oe+40]=ve,H[L+oe+48]=ve,H[L+oe+56]=ve;continue}Q=B*_e+2048>>12,K=B*ne+2048>>12,te=V,X=xe,J=M*(q-Me)+2048>>12,me=M*(q+Me)+2048>>12,ie=j,de=se,Q=(Q+K+1>>1)+4112,K=Q-K,ve=te*I+X*k+2048>>12,te=te*k-X*I+2048>>12,X=ve,J=J+de+1>>1,de=J-de,me=me+ie+1>>1,ie=me-ie,Q=Q+X+1>>1,X=Q-X,K=K+te+1>>1,te=K-te,ve=J*A+me*m+2048>>12,J=J*m-me*A+2048>>12,me=ve,ve=ie*p+de*d+2048>>12,ie=ie*d-de*p+2048>>12,de=ve,_e=Q+me,Me=Q-me,q=K+de,xe=K-de,V=te+ie,se=te-ie,j=X+J,ne=X-J,_e<16?_e=0:_e>=4080?_e=255:_e>>=4,q<16?q=0:q>=4080?q=255:q>>=4,V<16?V=0:V>=4080?V=255:V>>=4,j<16?j=0:j>=4080?j=255:j>>=4,ne<16?ne=0:ne>=4080?ne=255:ne>>=4,se<16?se=0:se>=4080?se=255:se>>=4,xe<16?xe=0:xe>=4080?xe=255:xe>>=4,Me<16?Me=0:Me>=4080?Me=255:Me>>=4,H[L+oe]=_e,H[L+oe+8]=q,H[L+oe+16]=V,H[L+oe+24]=j,H[L+oe+32]=ne,H[L+oe+40]=se,H[L+oe+48]=xe,H[L+oe+56]=Me}}function S(G,L){for(var O=L.P,z=L.c,H=new Int16Array(64),Q=0;Q<z;Q++)for(var K=0;K<O;K++){var te=C(L,Q,K);E(L,te,H)}return L.D}function $(G,L,O){O==null&&(O=L);var z=G.length-1,H=O<L?O:L;if(L>=z)return null;var Q=h(G,L);if(Q>=65472&&Q<=65534)return{u:null,M:Q,offset:L};for(var K=h(G,H);!(K>=65472&&K<=65534);){if(++H>=z)return null;K=h(G,H)}return{u:Q.toString(16),M:K,offset:H}}return T.prototype={parse(G,L){L==null&&(L={});var O=L.F,z=0,H=null,Q=null,K,te,X=0;function J(){var _=h(G,z);z+=2;var fe=z+_-2,ge=$(G,fe,z);ge&&ge.u&&(fe=ge.offset);var D=G.subarray(z,fe);return z+=D.length,D}function ie(_){for(var fe=Math.ceil(_.o/8/_.X),ge=Math.ceil(_.s/8/_.B),D=0;D<_.W.length;D++){ke=_.W[D];var ee=Math.ceil(Math.ceil(_.o/8)*ke.h/_.X),ce=Math.ceil(Math.ceil(_.s/8)*ke.A/_.B),De=fe*ke.h,Fe=ge*ke.A,Re=64*Fe*(De+1);ke.D=new Int16Array(Re),ke.P=ee,ke.c=ce}_.m=fe,_.R=ge}var de=[],me=[],_e=[],q=h(G,z);if(z+=2,q!==65496)throw new o("SOI not found");q=h(G,z),z+=2;e:for(;q!==65497;){var V,j,ne;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var se=J();q===65504&&se[0]===74&&se[1]===70&&se[2]===73&&se[3]===70&&se[4]===0&&(H={version:{d:se[5],T:se[6]},K:se[7],j:se[8]<<8|se[9],H:se[10]<<8|se[11],S:se[12],I:se[13],C:se.subarray(14,14+3*se[12]*se[13])}),q===65518&&se[0]===65&&se[1]===100&&se[2]===111&&se[3]===98&&se[4]===101&&(Q={version:se[5]<<8|se[6],k:se[7]<<8|se[8],q:se[9]<<8|se[10],a:se[11]});break;case 65499:var xe=h(G,z),Me;z+=2;for(var ve=xe+z-2;z<ve;){var he=G[z++],oe=new Uint16Array(64);if(he>>4)if(he>>4===1)for(j=0;j<64;j++)Me=u[j],oe[Me]=h(G,z),z+=2;else throw new o("DQT - invalid table spec");else for(j=0;j<64;j++)Me=u[j],oe[Me]=G[z++];de[he&15]=oe}break;case 65472:case 65473:case 65474:if(K)throw new o("Only single frame JPEGs supported");z+=2,K={},K.G=q===65473,K.Z=q===65474,K.precision=G[z++];var be=h(G,z),we,R=0,v=0;z+=2,K.s=O||be,K.o=h(G,z),z+=2,K.W=[],K._={};var b=G[z++];for(V=0;V<b;V++){we=G[z];var P=G[z+1]>>4,W=G[z+1]&15;R<P&&(R=P),v<W&&(v=W);var re=G[z+2];ne=K.W.push({h:P,A:W,L:re,$:null}),K._[we]=ne-1,z+=3}K.X=R,K.B=v,ie(K);break;case 65476:var ae=h(G,z);for(z+=2,V=2;V<ae;){var Ee=G[z++],Ce=new Uint8Array(16),Pe=0;for(j=0;j<16;j++,z++)Pe+=Ce[j]=G[z];var Be=new Uint8Array(Pe);for(j=0;j<Pe;j++,z++)Be[j]=G[z];V+=17+Pe,(Ee>>4?me:_e)[Ee&15]=U(Ce,Be)}break;case 65501:z+=2,te=h(G,z),z+=2;break;case 65498:var Se=++X===1&&!O,ke;z+=2;var Ie=G[z++],Le=[];for(V=0;V<Ie;V++){var N=G[z++],pe=K._[N];ke=K.W[pe],ke.index=N;var le=G[z++];ke.J=_e[le>>4],ke.i=me[le&15],Le.push(ke)}var Ae=G[z++],Z=G[z++],ue=G[z++];try{var F=w(G,z,K,Le,te,Ae,Z,ue>>4,ue&15,Se);z+=F}catch(_){if(_ instanceof DNLMarkerError)return this.parse(G,{F:_.s});if(_ instanceof EOIMarkerError)break e;throw _}break;case 65500:z+=4;break;case 65535:G[z]!==255&&z--;break;default:var ye=$(G,z-2,z-3);if(ye&&ye.u){z=ye.offset;break}if(z>=G.length-1)break e;throw new o("JpegImage.parse - unknown marker: "+q.toString(16))}q=h(G,z),z+=2}for(this.width=K.o,this.height=K.s,this.g=H,this.b=Q,this.W=[],V=0;V<K.W.length;V++){ke=K.W[V];var Te=de[ke.L];Te&&(ke.$=Te),this.W.push({index:ke.index,e:S(K,ke),l:ke.h/K.X,t:ke.A/K.B,P:ke.P,c:ke.c})}this.p=this.W.length},Y(G,L,O){O==null&&(O=!1);var z=this.width/G,H=this.height/L,Q,K,te,X,J,ie,de,me,_e,q,V=0,j,ne=this.W.length,se=G*L*ne,xe=new Uint8ClampedArray(se),Me=new Uint32Array(G),ve=4294967288,he;for(de=0;de<ne;de++){if(Q=this.W[de],K=Q.l*z,te=Q.t*H,V=de,j=Q.e,X=Q.P+1<<3,K!==he){for(J=0;J<G;J++)me=0|J*K,Me[J]=(me&ve)<<3|me&7;he=K}for(ie=0;ie<L;ie++)for(me=0|ie*te,q=X*(me&ve)|(me&7)<<3,J=0;J<G;J++)xe[V]=j[q+Me[J]],V+=ne}var oe=this.V;if(!O&&ne===4&&!oe&&(oe=new Int32Array([-256,255,-256,255,-256,255,-256,255])),oe)for(de=0;de<se;)for(me=0,_e=0;me<ne;me++,de++,_e+=2)xe[de]=(xe[de]*oe[_e]>>8)+oe[_e+1];return xe},get f(){return this.b?!!this.b.a:this.p===3?this.N===0?!1:!(this.W[0].index===82&&this.W[1].index===71&&this.W[2].index===66):this.N===1},z:function(L){for(var O,z,H,Q=0,K=L.length;Q<K;Q+=3)O=L[Q],z=L[Q+1],H=L[Q+2],L[Q]=O-179.456+1.402*H,L[Q+1]=O+135.459-.344*z-.714*H,L[Q+2]=O-226.816+1.772*z;return L},O:function(L){for(var O,z,H,Q,K=0,te=0,X=L.length;te<X;te+=4)O=L[te],z=L[te+1],H=L[te+2],Q=L[te+3],L[K++]=-122.67195406894+z*(-660635669420364e-19*z+.000437130475926232*H-54080610064599e-18*O+.00048449797120281*Q-.154362151871126)+H*(-.000957964378445773*H+.000817076911346625*O-.00477271405408747*Q+1.53380253221734)+O*(.000961250184130688*O-.00266257332283933*Q+.48357088451265)+Q*(-.000336197177618394*Q+.484791561490776),L[K++]=107.268039397724+z*(219927104525741e-19*z-.000640992018297945*H+.000659397001245577*O+.000426105652938837*Q-.176491792462875)+H*(-.000778269941513683*H+.00130872261408275*O+.000770482631801132*Q-.151051492775562)+O*(.00126935368114843*O-.00265090189010898*Q+.25802910206845)+Q*(-.000318913117588328*Q-.213742400323665),L[K++]=-20.810012546947+z*(-.000570115196973677*z-263409051004589e-19*H+.0020741088115012*O-.00288260236853442*Q+.814272968359295)+H*(-153496057440975e-19*H-.000132689043961446*O+.000560833691242812*Q-.195152027534049)+O*(.00174418132927582*O-.00255243321439347*Q+.116935020465145)+Q*(-.000343531996510555*Q+.24165260232407);return L.subarray(0,K)},r:function(L){for(var O,z,H,Q=0,K=L.length;Q<K;Q+=4)O=L[Q],z=L[Q+1],H=L[Q+2],L[Q]=434.456-O-1.402*H,L[Q+1]=119.541-O+.344*z+.714*H,L[Q+2]=481.816-O-1.772*z;return L},U:function(L){for(var O,z,H,Q,K=0,te=0,X=L.length;te<X;te+=4)O=L[te],z=L[te+1],H=L[te+2],Q=L[te+3],L[K++]=255+O*(-6747147073602441e-20*O+.0008379262121013727*z+.0002894718188643294*H+.003264231057537806*Q-1.1185611867203937)+z*(26374107616089405e-21*z-8626949158638572e-20*H-.0002748769067499491*Q-.02155688794978967)+H*(-3878099212869363e-20*H-.0003267808279485286*Q+.0686742238595345)-Q*(.0003361971776183937*Q+.7430659151342254),L[K++]=255+O*(.00013596372813588848*O+.000924537132573585*z+.00010567359618683593*H+.0004791864687436512*Q-.3109689587515875)+z*(-.00023545346108370344*z+.0002702845253534714*H+.0020200308977307156*Q-.7488052167015494)+H*(6834815998235662e-20*H+.00015168452363460973*Q-.09751927774728933)-Q*(.0003189131175883281*Q+.7364883807733168),L[K++]=255+O*(13598650411385307e-21*O+.00012423956175490851*z+.0004751985097583589*H-36729317476630422e-22*Q-.05562186980264034)+z*(.00016141380598724676*z+.0009692239130725186*H+.0007782692450036253*Q-.44015232367526463)+H*(5068882914068769e-22*H+.0017778369011375071*Q-.7591454649749609)-Q*(.0003435319965105553*Q+.7063770186160144);return L.subarray(0,K)},getData:function(G){var L=G.width,O=G.height,z=G.forceRGB,H=G.isSourcePDF;if(this.p>4)throw new o("Unsupported color mode");var Q=this.Y(L,O,H);if(this.p===1&&z){for(var K=Q.length,te=new Uint8ClampedArray(K*3),X=0,J=0;J<K;J++){var ie=Q[J];te[X++]=ie,te[X++]=ie,te[X++]=ie}return te}else{if(this.p===3&&this.f)return this.z(Q);if(this.p===4){if(this.f)return z?this.O(Q):this.r(Q);if(z)return this.U(Q)}}return Q}},T}();function h(f,u){return f[u]<<8|f[u+1]}a.JpegDecoder=s})(),a.encodeImage=function(o,s,h,f){var u={t256:[s],t257:[h],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[h],t279:[s*h*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(f)for(var d in f)u[d]=f[d];for(var p=new Uint8Array(a.encode([u])),m=new Uint8Array(o),A=new Uint8Array(1e3+s*h*4),d=0;d<p.length;d++)A[d]=p[d];for(var d=0;d<m.length;d++)A[1e3+d]=m[d];return A.buffer},a.encode=function(o){var s=new Uint8Array(2e4),h=4,f=a._binBE;s[0]=s[1]=77,f.writeUshort(s,2,42);var u=8;f.writeUint(s,h,u),h+=4;for(var d=0;d<o.length;d++){var p=a._writeIFD(f,a._types.basic,s,u,o[d]);u=p[1],d<o.length-1&&(u&3&&(u+=4-(u&3)),f.writeUint(s,p[0],u))}return s.slice(0,u).buffer},a.decode=function(o,s){s==null&&(s={parseMN:!0,debug:!1});var h=new Uint8Array(o),f=0,u=a._binBE.readASCII(h,f,2);f+=2;var d=u=="II"?a._binLE:a._binBE;d.readUshort(h,f),f+=2;var p=d.readUint(h,f);f+=4;for(var m=[];;){var A=d.readUshort(h,p),k=d.readUshort(h,p+4);if(A!=0&&(k<1||13<k)){n("error in TIFF");break}if(a._readIFD(d,h,p,m,0,s),p=d.readUint(h,p+2+A*12),p==0)break}return m},a.decodeImage=function(o,s,h){if(!s.data){var f=new Uint8Array(o),u=a._binBE.readASCII(f,0,2);if(s.t256!=null){s.isLE=u=="II",s.width=s.t256[0],s.height=s.t257[0];var d=s.t259?s.t259[0]:1,p=s.t266?s.t266[0]:1;s.t284&&s.t284[0]==2&&n("PlanarConfiguration 2 should not be used!"),d==7&&s.t258&&s.t258.length>3&&(s.t258=s.t258.slice(0,3));var m=s.t277?s.t277[0]:1,A=s.t258?s.t258[0]:1,k=A*m;d==1&&s.t279!=null&&s.t278&&s.t262[0]==32803&&(k=Math.round(s.t279[0]*8/(s.width*s.t278[0]))),s.t50885&&s.t50885[0]==4&&(k=s.t258[0]*3);var I=Math.ceil(s.width*k/8)*8,B=s.t273;(B==null||s.t322)&&(B=s.t324);var M=s.t279;d==1&&B.length==1&&(M=[s.height*(I>>>3)]),(M==null||s.t322)&&(M=s.t325);var T=new Uint8Array(s.height*(I>>>3)),U=0;if(s.t322!=null){var C=s.t322[0],w=s.t323[0],E=Math.floor((s.width+C-1)/C),S=Math.floor((s.height+w-1)/w),$=new Uint8Array(Math.ceil(C*w*k/8)|0);console.log("====",E,S);for(var G=0;G<S;G++)for(var L=0;L<E;L++){var O=G*E+L;$.fill(0),a.decode._decompress(s,h,f,B[O],M[O],d,$,0,p,C,w),d==6?T=$:a._copyTile($,Math.ceil(C*k/8)|0,w,T,Math.ceil(s.width*k/8)|0,s.height,Math.ceil(L*C*k/8)|0,G*w)}U=T.length*8}else{if(B==null)return;var z=s.t278?s.t278[0]:s.height;z=Math.min(z,s.height);for(var O=0;O<B.length;O++)a.decode._decompress(s,h,f,B[O],M[O],d,T,Math.ceil(U/8)|0,p,s.width,z),U+=I*z;U=Math.min(U,T.length*8)}s.data=new Uint8Array(T.buffer,0,Math.ceil(U/8)|0)}}},a.decode._decompress=function(o,s,h,f,u,d,p,m,A,k,I){if(o.t271&&o.t271[0]=="Panasonic"&&o.t45&&o.t45[0]==6&&(d=34316),d==1)for(var B=0;B<u;B++)p[m+B]=h[f+B];else if(d==2)a.decode._decodeG2(h,f,u,p,m,k,A);else if(d==3)a.decode._decodeG3(h,f,u,p,m,k,A,o.t292?(o.t292[0]&1)==1:!1);else if(d==4)a.decode._decodeG4(h,f,u,p,m,k,A);else if(d==5)a.decode._decodeLZW(h,f,u,p,m,8);else if(d==6)a.decode._decodeOldJPEG(o,h,f,u,p,m);else if(d==7||d==34892)a.decode._decodeNewJPEG(o,h,f,u,p,m);else if(d==8||d==32946){var M=new Uint8Array(h.buffer,f+2,u-6),T=l.inflateRaw(M);m+T.length<=p.length&&p.set(T,m)}else d==9?a.decode._decodeVC5(h,f,u,p,m,o.t33422):d==32767?a.decode._decodeARW(o,h,f,u,p,m):d==32773?a.decode._decodePackBits(h,f,u,p,m):d==32809?a.decode._decodeThunder(h,f,u,p,m):d==34316?a.decode._decodePanasonic(o,h,f,u,p,m):d==34713?a.decode._decodeNikon(o,s,h,f,u,p,m):d==34676?a.decode._decodeLogLuv32(o,h,f,u,p,m):n("Unknown compression",d);var U=o.t258?Math.min(32,o.t258[0]):1,C=o.t277?o.t277[0]:1,w=U*C>>>3,E=Math.ceil(U*C*k/8);if(U==16&&!o.isLE&&o.t33422==null)for(var S=0;S<I;S++)for(var $=m+S*E,G=1;G<E;G+=2){var L=p[$+G];p[$+G]=p[$+G-1],p[$+G-1]=L}if(o.t317&&o.t317[0]==2)for(var S=0;S<I;S++){var O=m+S*E;if(U==16)for(var B=w;B<E;B+=2){var z=(p[O+B+1]<<8|p[O+B])+(p[O+B-w+1]<<8|p[O+B-w]);p[O+B]=z&255,p[O+B+1]=z>>>8&255}else if(C==3)for(var B=3;B<E;B+=3)p[O+B]=p[O+B]+p[O+B-3]&255,p[O+B+1]=p[O+B+1]+p[O+B-2]&255,p[O+B+2]=p[O+B+2]+p[O+B-1]&255;else for(var B=w;B<E;B++)p[O+B]=p[O+B]+p[O+B-w]&255}},a.decode._decodePanasonic=function(o,s,h,f,u,d){var p=s.buffer,m=o.t2[0],A=o.t3[0],k=o.t10[0],I=o.t45[0],B=0,M=0,T=0,U=0,C=I==6?new Uint32Array(18):new Uint8Array(16),w,E,S,$=[0,0],G=[0,0],L,O=0,z,H,Q,K,te=new Uint8Array(16384),X=new Uint16Array(u.buffer);function J(W){if(T==0){var re=new Uint8Array(p,h+M+8184,8200),ae=new Uint8Array(p,h+M,8184);te.set(re),te.set(ae,re.length),M+=16384}if(I==5)for(w=0;w<16;w++)C[w]=te[T++],T&=16383;else return T=T-W&131071,U=T>>3^16368,(te[U]|te[U+1]<<8)>>(T&7)&~(-1<<W)}function ie(W){return te[T+15-W]}function de(){C[0]=ie(0)<<6|ie(1)>>2,C[1]=((ie(1)&3)<<12|ie(2)<<4|ie(3)>>4)&16383,C[2]=ie(3)>>2&3,C[3]=(ie(3)&3)<<8|ie(4),C[4]=ie(5)<<2|ie(6)>>6,C[5]=(ie(6)&63)<<4|ie(7)>>4,C[6]=ie(7)>>2&3,C[7]=(ie(7)&3)<<8|ie(8),C[8]=ie(9)<<2&1020|ie(10)>>6,C[9]=(ie(10)<<4|ie(11)>>4)&1023,C[10]=ie(11)>>2&3,C[11]=(ie(11)&3)<<8|ie(12),C[12]=(ie(13)<<2&1020|ie(14)>>6)&1023,C[13]=(ie(14)<<4|ie(15)>>4)&1023,T+=16,U=0}function me(){C[0]=ie(0)<<4|ie(1)>>4,C[1]=((ie(1)&15)<<8|ie(2))&4095,C[2]=ie(3)>>6&3,C[3]=(ie(3)&63)<<2|ie(4)>>6,C[4]=(ie(4)&63)<<2|ie(5)>>6,C[5]=(ie(5)&63)<<2|ie(6)>>6,C[6]=ie(6)>>4&3,C[7]=(ie(6)&15)<<4|ie(7)>>4,C[8]=(ie(7)&15)<<4|ie(8)>>4,C[9]=(ie(8)&15)<<4|ie(9)>>4,C[10]=ie(9)>>2&3,C[11]=(ie(9)&3)<<6|ie(10)>>2,C[12]=(ie(10)&3)<<6|ie(11)>>2,C[13]=(ie(11)&3)<<6|ie(12)>>2,C[14]=ie(12)&3,C[15]=ie(13),C[16]=ie(14),C[17]=ie(15),T+=16,U=0}function _e(){$[0]=0,$[1]=0,G[0]=0,G[1]=0}if(I==7)throw I;if(I==6){var q=k==12,V=q?me:de,j=q?14:11,ne=q?128:512,se=q?2048:8192,xe=q?16383:65535,Me=q?4095:16383,ve=m/j,he=ve*16,oe=q?18:14;for(H=0;H<A-15;H+=16){var be=Math.min(16,A-H),we=he*be;for(te=new Uint8Array(p,h+B,we),T=0,B+=we,K=0,Q=0;K<be;K++,Q=0){O=(H+K)*m;for(var R=0;R<ve;R++)for(V(),_e(),S=0,z=0,w=0;w<j;w++){if(L=w&1,w%3==2){var v=U<oe?C[U++]:0;v==3&&(v=4),z=ne<<v,S=1<<v}var b=U<oe?C[U++]:0;$[L]?(b*=S,z<se&&G[L]>z&&(b+=G[L]-z),G[L]=b):($[L]=b,b?G[L]=b:b=G[L]),X[O+Q++]=b-15<=xe?b-15&xe:b+2147483633>>31&Me}}}}else if(I==5){var P=k==12?10:9;for(H=0;H<A;H++)for(Q=0;Q<m;Q+=P)J(0),k==12?(X[O++]=((C[1]&15)<<8)+C[0],X[O++]=16*C[2]+(C[1]>>4),X[O++]=((C[4]&15)<<8)+C[3],X[O++]=16*C[5]+(C[4]>>4),X[O++]=((C[7]&15)<<8)+C[6],X[O++]=16*C[8]+(C[7]>>4),X[O++]=((C[10]&15)<<8)+C[9],X[O++]=16*C[11]+(C[10]>>4),X[O++]=((C[13]&15)<<8)+C[12],X[O++]=16*C[14]+(C[13]>>4)):k==14&&(X[O++]=C[0]+((C[1]&63)<<8),X[O++]=(C[1]>>6)+4*C[2]+((C[3]&15)<<10),X[O++]=(C[3]>>4)+16*C[4]+((C[5]&3)<<12),X[O++]=((C[5]&252)>>2)+(C[6]<<6),X[O++]=C[7]+((C[8]&63)<<8),X[O++]=(C[8]>>6)+4*C[9]+((C[10]&15)<<10),X[O++]=(C[10]>>4)+16*C[11]+((C[12]&3)<<12),X[O++]=((C[12]&252)>>2)+(C[13]<<6),X[O++]=C[14]+((C[15]&63)<<8))}else if(I==4)for(H=0;H<A;H++)for(Q=0;Q<m;Q++)w=Q%14,L=w&1,w==0&&_e(),w%3==2&&(S=4>>3-J(2)),G[L]?(E=J(8),E!=0&&($[L]-=128<<S,($[L]<0||S==4)&&($[L]&=~(-1<<S)),$[L]+=E<<S)):(G[L]=J(8),(G[L]||w>11)&&($[L]=G[L]<<4|J(4))),X[O++]=$[Q&1];else throw I},a.decode._decodeVC5=function(){var o=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],s,h,f,u=[3,3,3,3,2,2,2,1,1,1],d=24576,p=16384,m=8192,A=p|m;function k(S){var $=S[1],G=S[0][$>>>3]>>>7-($&7)&1;return S[1]++,G}function I(S,$){if(s==null){s={};for(var G=0;G<o.length;G+=4)s[o[G+1]]=o.slice(G,G+4)}for(var L=k(S),O=s[L];O==null;)L=L<<1|k(S),O=s[L];var z=O[3];z!=0&&(z=k(S)==0?z:-z),$[0]=O[2],$[1]=z}function B(S,$){for(var G=0;G<$;G++)(S&1)==1&&S++,S=S>>>1;return S}function M(S,$){return S>>$}function T(S,$,G,L,O,z){$[G]=M(M(11*S[O]-4*S[O+z]+S[O+z+z]+4,3)+S[L],1),$[G+z]=M(M(5*S[O]+4*S[O+z]-S[O+z+z]+4,3)-S[L],1)}function U(S,$,G,L,O,z){var H=S[O-z]-S[O+z],Q=S[O],K=S[L];$[G]=M(M(H+4,3)+Q+K,1),$[G+z]=M(M(-H+4,3)+Q-K,1)}function C(S,$,G,L,O,z){$[G]=M(M(5*S[O]+4*S[O-z]-S[O-z-z]+4,3)+S[L],1),$[G+z]=M(M(11*S[O]-4*S[O-z]+S[O-z-z]+4,3)-S[L],1)}function w(S){return S=S<0?0:S>4095?4095:S,S=f[S]>>>2,S}function E(S,$,G,L,O,z){L=new Uint16Array(L.buffer);var H=Date.now(),Q=a._binBE,K=$+G,te,X,J,ie,de,me,_e,q,V,j;$+=4;for(var ne=z[0]==1;$<K;){var se=Q.readShort(S,$),xe=Q.readUshort(S,$+2);if($+=4,se==12)te=xe;else if(se==20)X=xe;else if(se==21)J=xe;else if(se==48)ie=xe;else if(se==53)de=xe;else if(se!=35){if(se==62)me=xe;else if(se!=101){if(se==109)_e=xe;else if(se!=84){if(se!=106){if(se!=107){if(se!=108){if(se!=102){if(se==104)q=xe;else if(se!=105){var Me=se<0?-se:se,ve=Me&65280,he=0;if(Me&A&&(Me&m?(he=xe&65535,he+=(Me&255)<<16):he=xe&65535),(Me&d)==d){if(V==null){V=[];for(var oe=0;oe<4;oe++)V[oe]=new Int16Array((X>>>1)*(J>>>1));j=new Int16Array((X>>>1)*(J>>>1)),h=new Int16Array(1024);for(var oe=0;oe<1024;oe++){var be=oe-512,we=Math.abs(be),te=Math.floor(768*we*we*we/(255*255*255))+we;h[oe]=Math.sign(be)*te}f=new Uint16Array(4096);for(var R=65535,oe=0;oe<4096;oe++){var v=oe,b=R*(Math.pow(113,v/4095)-1)/112;f[oe]=Math.min(b,R)}}var P=V[me],W=B(X,1+u[ie]),re=B(J,1+u[ie]);if(ie==0)for(var ae=0;ae<re;ae++)for(var Ee=0;Ee<W;Ee++){var Ce=$+(ae*W+Ee)*2;P[ae*(X>>>1)+Ee]=S[Ce]<<8|S[Ce+1]}else{for(var Pe=[S,$*8],Be=[],Se=0,ke=W*re,Ie=[0,0],Le=0,xe=0;Se<ke;)for(I(Pe,Ie),Le=Ie[0],xe=Ie[1];Le>0;)Be[Se++]=xe,Le--;for(var N=(ie-1)%3,pe=N!=1?W:0,le=N!=0?re:0,ae=0;ae<re;ae++)for(var Ae=(ae+le)*(X>>>1)+pe,Z=ae*W,Ee=0;Ee<W;Ee++)P[Ae+Ee]=h[Be[Z+Ee]+512]*de;if(N==2){for(var q=X>>>1,ue=W*2,F=re*2,ae=0;ae<re;ae++)for(var Ee=0;Ee<ue;Ee++){var oe=ae*2*q+Ee,ye=ae*q+Ee,Te=re*q+ye;ae==0?T(P,j,oe,Te,ye,q):ae==re-1?C(P,j,oe,Te,ye,q):U(P,j,oe,Te,ye,q)}var _=P;P=j,j=_;for(var ae=0;ae<F;ae++)for(var Ee=0;Ee<W;Ee++){var oe=ae*q+2*Ee,ye=ae*q+Ee,Te=W+ye;Ee==0?T(P,j,oe,Te,ye,1):Ee==W-1?C(P,j,oe,Te,ye,1):U(P,j,oe,Te,ye,1)}var _=P;P=j,j=_;for(var fe=[],ge=2-~~((ie-1)/3),D=0;D<3;D++)fe[D]=_e>>14-D*2&3;var ee=fe[ge];if(ee!=0)for(var ae=0;ae<F;ae++)for(var Ee=0;Ee<ue;Ee++){var oe=ae*q+Ee;P[oe]=P[oe]<<ee}}}if(ie==9&&me==3)for(var ce=V[0],De=V[1],Fe=V[2],Re=V[3],ae=0;ae<J;ae+=2)for(var Ee=0;Ee<X;Ee+=2){var Ne=ae*X+Ee,Ce=(ae>>>1)*(X>>>1)+(Ee>>>1),qe=ce[Ce],ze=De[Ce]-2048,Oe=Fe[Ce]-2048,$e=Re[Ce]-2048,He=(ze<<1)+qe,We=(Oe<<1)+qe,Ve=qe+$e,Xe=qe-$e;ne?(L[Ne]=w(Ve),L[Ne+1]=w(We),L[Ne+X]=w(He),L[Ne+X+1]=w(Xe)):(L[Ne]=w(He),L[Ne+1]=w(Ve),L[Ne+X]=w(Xe),L[Ne+X+1]=w(We))}$+=he*4}else if(Me==16388)$+=he*4;else if(!(ve==8192||ve==8448||ve==9216))throw Me.toString(16)}}}}}}}}}console.log(Date.now()-H)}return E}(),a.decode._decodeLogLuv32=function(o,s,h,f,u,d){for(var p=o.width,m=p*4,A=0,k=new Uint8Array(m);A<f;){for(var I=0;I<m;){var B=s[h+A];if(A++,B<128){for(var M=0;M<B;M++)k[I+M]=s[h+A+M];I+=B,A+=B}else{B=B-126;for(var M=0;M<B;M++)k[I+M]=s[h+A];I+=B,A++}}for(var T=0;T<p;T++)u[d+0]=k[T],u[d+1]=k[T+p],u[d+2]=k[T+p*2],u[d+4]=k[T+p*3],d+=6}},a.decode._ljpeg_diff=function(o,s,h){var f=a.decode._getbithuff,u,d;return u=f(o,s,h[0],h),d=f(o,s,u,0),d&1<<u-1||(d-=(1<<u)-1),d},a.decode._decodeARW=function(o,s,h,f,u,d){var p=o.t256[0],m=o.t257[0],A=o.t258[0],k=o.isLE?a._binLE:a._binBE,I=p*m==f||p*m*1.5==f;if(!I){m+=8;var B=[h,0,0,0],M=new Uint16Array(32770),T=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],_e,U,C,Q,H,w=0,E=a.decode._ljpeg_diff;for(M[0]=15,C=_e=0;_e<18;_e++)for(var S=32768>>>(T[_e]>>>8),U=0;U<S;U++)M[++C]=T[_e];for(Q=p;Q--;)for(H=0;H<m+1;H+=2)if(H==m&&(H=1),w+=E(s,B,M),H<m){var $=w&4095;a.decode._putsF(u,(H*p+Q)*A,$<<16-A)}return}if(p*m*1.5==f){for(var _e=0;_e<f;_e+=3){var G=s[h+_e+0],L=s[h+_e+1],O=s[h+_e+2];u[d+_e]=L<<4|G>>>4,u[d+_e+1]=G<<4|O>>>4,u[d+_e+2]=O<<4|L>>>4}return}var z=new Uint16Array(16),H,Q,K,te,X,J,ie,de,me,_e,q,V=new Uint8Array(p+1);for(H=0;H<m;H++){for(var j=0;j<p;j++)V[j]=s[h++];for(q=0,Q=0;Q<p-30;q+=16){for(te=2047&(K=k.readUint(V,q)),X=2047&K>>>11,J=15&K>>>22,ie=15&K>>>26,de=0;de<4&&128<<de<=te-X;de++);for(me=30,_e=0;_e<16;_e++)_e==J?z[_e]=te:_e==ie?z[_e]=X:(z[_e]=((k.readUshort(V,q+(me>>3))>>>(me&7)&127)<<de)+X,z[_e]>2047&&(z[_e]=2047),me+=7);for(_e=0;_e<16;_e++,Q+=2){var $=z[_e]<<1;a.decode._putsF(u,(H*p+Q)*A,$<<16-A)}Q-=Q&1?1:31}}},a.decode._decodeNikon=function(o,s,h,f,u,d,p){var m=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],A=o.t256[0],k=o.t257[0],I=o.t258[0],B=0,M=0,T=a.decode._make_decoder,U=a.decode._getbithuff,C=s[0].exifIFD.makerNote,w=C.t150?C.t150:C.t140,E=0,S=w[E++],$=w[E++];(S==73||$==88)&&(E+=2110),S==70&&(B=2),I==14&&(B+=3);for(var G=[[0,0],[0,0]],L=o.isLE?a._binLE:a._binBE,K=0;K<2;K++)for(var O=0;O<2;O++)G[K][O]=L.readShort(w,E),E+=2;var z=1<<I&32767,H=0,Q=L.readShort(w,E);E+=2,Q>1&&(H=Math.floor(z/(Q-1))),S==68&&$==32&&H>0&&(M=L.readShort(w,562));var K,te,X,J,ie,de,me=[0,0],_e=T(m[B]),q=[f,0,0,0];for(te=0;te<k;te++)for(M&&te==M&&(_e=T(m[B+1])),X=0;X<A;X++){K=U(h,q,_e[0],_e),J=K&15,ie=K>>>4,de=(U(h,q,J-ie,0)<<1)+1<<ie>>>1,de&1<<J-1||(de-=(1<<J)-(ie==0?1:0)),X<2?me[X]=G[te&1][X]+=de:me[X&1]+=de;var V=Math.min(Math.max(me[X&1],0),(1<<I)-1),j=(te*A+X)*I;a.decode._putsF(d,j,V<<16-I)}},a.decode._putsF=function(o,s,h){h=h<<8-(s&7);var f=s>>>3;o[f]|=h>>>16,o[f+1]|=h>>>8,o[f+2]|=h},a.decode._getbithuff=function(o,s,h,f){var u=0;a.decode._get_byte;var d,p=s[0],m=s[1],A=s[2],k=s[3];if(h==0||A<0)return 0;for(;!k&&A<h&&(d=o[p++])!=-1&&!(k=u);)m=(m<<8)+d,A+=8;if(d=m<<32-A>>>32-h,f?(A-=f[d+1]>>>8,d=f[d+1]&255):A-=h,A<0)throw"e";return s[0]=p,s[1]=m,s[2]=A,s[3]=k,d},a.decode._make_decoder=function(o){var s,h,f,u,d,p=[];for(s=16;s!=0&&!o[s];s--);var m=17;for(p[0]=s,f=h=1;h<=s;h++)for(u=0;u<o[h];u++,++m)for(d=0;d<1<<s-h;d++)f<=1<<s&&(p[f++]=h<<8|o[m]);return p},a.decode._decodeNewJPEG=function(o,s,h,f,u,d){f=Math.min(f,s.length-h);var p=o.t347,m=p?p.length:0,A=new Uint8Array(m+f);if(p){for(var k=216,I=217,B=0,M=0;M<m-1&&!(p[M]==255&&p[M+1]==I);M++)A[B++]=p[M];var T=s[h],U=s[h+1];(T!=255||U!=k)&&(A[B++]=T,A[B++]=U);for(var M=2;M<f;M++)A[B++]=s[h+M]}else for(var M=0;M<f;M++)A[M]=s[h+M];if(o.t262[0]==32803||o.t259[0]==7&&o.t262[0]==34892){var C=o.t258[0],w=a.LosslessJpegDecode(A),E=w.length;if(C==16)if(o.isLE)for(var M=0;M<E;M++)u[d+(M<<1)]=w[M]&255,u[d+(M<<1)+1]=w[M]>>>8;else for(var M=0;M<E;M++)u[d+(M<<1)]=w[M]>>>8,u[d+(M<<1)+1]=w[M]&255;else if(C==14||C==12||C==10)for(var S=16-C,M=0;M<E;M++)a.decode._putsF(u,M*C,w[M]<<S);else if(C==8)for(var M=0;M<E;M++)u[d+M]=w[M];else throw new Error("unsupported bit depth "+C)}else{var $=new a.JpegDecoder;$.parse(A);for(var G=$.getData({width:$.width,height:$.height,forceRGB:!0,isSourcePDF:!1}),M=0;M<G.length;M++)u[d+M]=G[M]}o.t262[0]==6&&(o.t262[0]=2)},a.decode._decodeOldJPEGInit=function(o,s,h,f){var u=216,d=219,p=196,m=221,A=192,k=218,I=0,B=0,M,T,U=!1,C,w,E,S=o.t513,$=S?S[0]:0,G=o.t514,L=G?G[0]:0,O=o.t324||o.t273||S,z=o.t530,H=0,Q=0,K=o.t277?o.t277[0]:1,te=o.t515;if(O&&(B=O[0],U=O.length>1),!U){if(s[h]==255&&s[h+1]==u)return{jpegOffset:h};if(S!=null&&(s[h+$]==255&&s[h+$+1]==u?I=h+$:n("JPEGInterchangeFormat does not point to SOI"),G==null?n("JPEGInterchangeFormatLength field is missing"):($>=B||$+L<=B)&&n("JPEGInterchangeFormatLength field value is invalid"),I!=null))return{jpegOffset:I}}if(z!=null&&(H=z[0],Q=z[1]),S!=null&&G!=null)if(L>=2&&$+L<=B){for(s[h+$+L-2]==255&&s[h+$+L-1]==u?M=new Uint8Array(L-2):M=new Uint8Array(L),C=0;C<M.length;C++)M[C]=s[h+$+C];n("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else n("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(M==null){var X=0,J=[];J[X++]=255,J[X++]=u;var ie=o.t519;if(ie==null)throw new Error("JPEGQTables tag is missing");for(C=0;C<ie.length;C++)for(J[X++]=255,J[X++]=d,J[X++]=0,J[X++]=67,J[X++]=C,w=0;w<64;w++)J[X++]=s[h+ie[C]+w];for(E=0;E<2;E++){var de=o[E==0?"t520":"t521"];if(de==null)throw new Error((E==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(C=0;C<de.length;C++){J[X++]=255,J[X++]=p;var me=19;for(w=0;w<16;w++)me+=s[h+de[C]+w];for(J[X++]=me>>>8,J[X++]=me&255,J[X++]=C|E<<4,w=0;w<16;w++)J[X++]=s[h+de[C]+w];for(w=0;w<me;w++)J[X++]=s[h+de[C]+16+w]}}if(J[X++]=255,J[X++]=A,J[X++]=0,J[X++]=8+3*K,J[X++]=8,J[X++]=o.height>>>8&255,J[X++]=o.height&255,J[X++]=o.width>>>8&255,J[X++]=o.width&255,J[X++]=K,K==1)J[X++]=1,J[X++]=17,J[X++]=0;else for(C=0;C<3;C++)J[X++]=C+1,J[X++]=C!=0?17:(H&15)<<4|Q&15,J[X++]=C;te!=null&&te[0]!=0&&(J[X++]=255,J[X++]=m,J[X++]=0,J[X++]=4,J[X++]=te[0]>>>8&255,J[X++]=te[0]&255),M=new Uint8Array(J)}var _e=-1;for(C=0;C<M.length-1;){if(M[C]==255&&M[C+1]==A){_e=C;break}C++}if(_e==-1){var q=new Uint8Array(M.length+10+3*K);q.set(M);var V=M.length;if(_e=M.length,M=q,M[V++]=255,M[V++]=A,M[V++]=0,M[V++]=8+3*K,M[V++]=8,M[V++]=o.height>>>8&255,M[V++]=o.height&255,M[V++]=o.width>>>8&255,M[V++]=o.width&255,M[V++]=K,K==1)M[V++]=1,M[V++]=17,M[V++]=0;else for(C=0;C<3;C++)M[V++]=C+1,M[V++]=C!=0?17:(H&15)<<4|Q&15,M[V++]=C}if(s[B]==255&&s[B+1]==k){var j=s[B+2]<<8|s[B+3];for(T=new Uint8Array(j+2),T[0]=s[B],T[1]=s[B+1],T[2]=s[B+2],T[3]=s[B+3],C=0;C<j-2;C++)T[C+4]=s[B+C+4]}else{T=new Uint8Array(8+2*K);var ne=0;if(T[ne++]=255,T[ne++]=k,T[ne++]=0,T[ne++]=6+2*K,T[ne++]=K,K==1)T[ne++]=1,T[ne++]=0;else for(C=0;C<3;C++)T[ne++]=C+1,T[ne++]=C<<4|C;T[ne++]=0,T[ne++]=63,T[ne++]=0}return{jpegOffset:h,tables:M,sosMarker:T,sofPosition:_e}},a.decode._decodeOldJPEG=function(o,s,h,f,u,d){var p,m,A,k,I,B=a.decode._decodeOldJPEGInit(o,s,h,f);if(B.jpegOffset!=null)for(m=h+f-B.jpegOffset,k=new Uint8Array(m),p=0;p<m;p++)k[p]=s[B.jpegOffset+p];else{for(A=B.tables.length,k=new Uint8Array(A+B.sosMarker.length+f+2),k.set(B.tables),I=A,k[B.sofPosition+5]=o.height>>>8&255,k[B.sofPosition+6]=o.height&255,k[B.sofPosition+7]=o.width>>>8&255,k[B.sofPosition+8]=o.width&255,(s[h]!=255||s[h+1]!=SOS)&&(k.set(B.sosMarker,I),I+=sosMarker.length),p=0;p<f;p++)k[I++]=s[h+p];k[I++]=255,k[I++]=EOI}var M=new a.JpegDecoder;M.parse(k);for(var T=M.getData({width:M.width,height:M.height,forceRGB:!0,isSourcePDF:!1}),p=0;p<T.length;p++)u[d+p]=T[p];o.t262&&o.t262[0]==6&&(o.t262[0]=2)},a.decode._decodePackBits=function(o,s,h,f,u){for(var d=new Int8Array(o.buffer),p=new Int8Array(f.buffer),m=s+h;s<m;){var A=d[s];if(s++,A>=0&&A<128)for(var k=0;k<A+1;k++)p[u]=d[s],u++,s++;if(A>=-127&&A<0){for(var k=0;k<-A+1;k++)p[u]=d[s],u++;s++}}return u},a.decode._decodeThunder=function(o,s,h,f,u){for(var d=[0,1,0,-1],p=[0,1,2,3,0,-3,-2,-1],m=s+h,A=u*2,k=0;s<m;){var I=o[s],B=I>>>6,M=I&63;if(s++,B==3&&(k=M&15,f[A>>>1]|=k<<4*(1-A&1),A++),B==0)for(var T=0;T<M;T++)f[A>>>1]|=k<<4*(1-A&1),A++;if(B==2)for(var T=0;T<2;T++){var U=M>>>3*(1-T)&7;U!=4&&(k+=p[U],f[A>>>1]|=k<<4*(1-A&1),A++)}if(B==1)for(var T=0;T<3;T++){var U=M>>>2*(2-T)&3;U!=2&&(k+=d[U],f[A>>>1]|=k<<4*(1-A&1),A++)}}},a.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3},a.decode._lens=function(){var o=function(A,k,I,B){for(var M=0;M<k.length;M++)A[k[M]]=I+M*B},s="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",h="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",f="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",u="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",d="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";s=s.split(","),h=h.split(","),f=f.split(","),u=u.split(","),d=d.split(",");var p={},m={};return o(p,s,0,1),o(p,f,64,64),o(p,d,1792,64),o(m,h,0,1),o(m,u,64,64),o(m,d,1792,64),[p,m]}(),a.decode._decodeG4=function(o,s,h,f,u,d,p){for(var m=a.decode,A=s<<3,k=0,I="",B=[],M=[],T=0;T<d;T++)M.push(0);M=m._makeDiff(M);for(var U=0,C=0,w=0,E=0,S=0,$=0,G="",L=0,O=Math.ceil(d/8)*8;A>>>3<s+h;){w=m._findDiff(M,U+(U==0?0:1),1-S),E=m._findDiff(M,w,S);var z=0;if(p==1&&(z=o[A>>>3]>>>7-(A&7)&1),p==2&&(z=o[A>>>3]>>>(A&7)&1),A++,I+=z,G=="H"){if(m._lens[S][I]!=null){var H=m._lens[S][I];I="",k+=H,H<64&&(m._addNtimes(B,k,S),U+=k,S=1-S,k=0,L--,L==0&&(G=""))}}else I=="0001"&&(I="",m._addNtimes(B,E-U,S),U=E),I=="001"&&(I="",G="H",L=2),m._dmap[I]!=null&&(C=w+m._dmap[I],m._addNtimes(B,C-U,S),U=C,I="",S=1-S);B.length==d&&G==""&&(m._writeBits(B,f,u*8+$*O),S=0,$++,U=0,M=m._makeDiff(B),B=[])}},a.decode._findDiff=function(o,s,h){for(var f=0;f<o.length;f+=2)if(o[f]>=s&&o[f+1]==h)return o[f]},a.decode._makeDiff=function(o){var s=[];o[0]==1&&s.push(0,1);for(var h=1;h<o.length;h++)o[h-1]!=o[h]&&s.push(h,o[h]);return s.push(o.length,0,o.length,1),s},a.decode._decodeG2=function(o,s,h,f,u,d,p){for(var m=a.decode,A=s<<3,k=0,I="",B=[],M=0,T=0,U=Math.ceil(d/8)*8;A>>>3<s+h;){var C=0;p==1&&(C=o[A>>>3]>>>7-(A&7)&1),p==2&&(C=o[A>>>3]>>>(A&7)&1),A++,I+=C,k=m._lens[M][I],k!=null&&(m._addNtimes(B,k,M),I="",k<64&&(M=1-M),B.length==d&&(m._writeBits(B,f,u*8+T*U),B=[],T++,M=0,A&7&&(A+=8-(A&7)),k>=64&&(A+=8)))}},a.decode._decodeG3=function(o,s,h,f,u,d,p,m){for(var A=a.decode,k=s<<3,I=0,B="",M=[],T=[],U=0;U<d;U++)M.push(0);for(var C=0,w=0,E=0,S=0,$=0,G=-1,L="",O=0,z=!0,H=Math.ceil(d/8)*8;k>>>3<s+h;){E=A._findDiff(T,C+(C==0?0:1),1-$),S=A._findDiff(T,E,$);var Q=0;if(p==1&&(Q=o[k>>>3]>>>7-(k&7)&1),p==2&&(Q=o[k>>>3]>>>(k&7)&1),k++,B+=Q,z){if(A._lens[$][B]!=null){var K=A._lens[$][B];B="",I+=K,K<64&&(A._addNtimes(M,I,$),$=1-$,I=0)}}else if(L=="H"){if(A._lens[$][B]!=null){var K=A._lens[$][B];B="",I+=K,K<64&&(A._addNtimes(M,I,$),C+=I,$=1-$,I=0,O--,O==0&&(L=""))}}else B=="0001"&&(B="",A._addNtimes(M,S-C,$),C=S),B=="001"&&(B="",L="H",O=2),A._dmap[B]!=null&&(w=E+A._dmap[B],A._addNtimes(M,w-C,$),C=w,B="",$=1-$);B.endsWith("000000000001")&&(G>=0&&A._writeBits(M,f,u*8+G*H),m&&(p==1&&(z=(o[k>>>3]>>>7-(k&7)&1)==1),p==2&&(z=(o[k>>>3]>>>(k&7)&1)==1),k++),B="",$=0,G++,C=0,T=A._makeDiff(M),M=[])}M.length==d&&A._writeBits(M,f,u*8+G*H)},a.decode._addNtimes=function(o,s,h){for(var f=0;f<s;f++)o.push(h)},a.decode._writeBits=function(o,s,h){for(var f=0;f<o.length;f++)s[h+f>>>3]|=o[f]<<7-(h+f&7)},a.decode._decodeLZW=a.decode._decodeLZW=function(){var o,s,h,f,u=0,d=0,p=0,m=0,A=function(){var w=o>>>3,E=s[w]<<16|s[w+1]<<8|s[w+2],S=E>>>24-(o&7)-d&(1<<d)-1;return o+=d,S},k=new Uint32Array(4096*4),I=0,B=function(w){if(w!=I){I=w,p=1<<w,m=p+1;for(var E=0;E<m+1;E++)k[4*E]=k[4*E+3]=E,k[4*E+1]=65535,k[4*E+2]=1}},M=function(w){d=w+1,u=m+1},T=function(w){for(var E=w<<2,S=k[E+2],$=f+S-1;E!=65535;)h[$--]=k[E],E=k[E+1];f+=S},U=function(w,E){var S=u<<2,$=w<<2;k[S]=k[(E<<2)+3],k[S+1]=$,k[S+2]=k[$+2]+1,k[S+3]=k[$+3],u++,u+1==1<<d&&d!=12&&d++},C=function(w,E,S,$,G,L){o=E<<3,s=w,h=$,f=G;var O=E+S<<3,z=0,H=0;for(B(L),M(L);o<O&&(z=A())!=m;){if(z==p){if(M(L),z=A(),z==m)break;T(z)}else z<u?(T(z),U(H,z)):(U(H,H),T(u-1));H=z}return f};return C}(),a.tags={},a._types=function(){var o=new Array(250);o.fill(0),o=o.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var s={33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7};return{basic:{main:o,rest:s},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}(),a._readIFD=function(o,s,h,f,u,d){var p=o.readUshort(s,h);h+=2;var m={};d.debug&&n("   ".repeat(u),f.length-1,">>>----------------");for(var A=0;A<p;A++){var k=o.readUshort(s,h);h+=2;var I=o.readUshort(s,h);h+=2;var B=o.readUint(s,h);h+=4;var M=o.readUint(s,h);h+=4;var T=[];if(I==1||I==7){var U=B<5?h-4:M;U+B>s.buffer.byteLength&&(B=s.buffer.byteLength-U),T=new Uint8Array(s.buffer,U,B)}if(I==2){var C=B<5?h-4:M,w=s[C],E=Math.max(0,Math.min(B-1,s.length-C));w<128||E==0?T.push(o.readASCII(s,C,E)):T=new Uint8Array(s.buffer,C,E)}if(I==3)for(var S=0;S<B;S++)T.push(o.readUshort(s,(B<3?h-4:M)+2*S));if(I==4||I==13)for(var S=0;S<B;S++)T.push(o.readUint(s,(B<2?h-4:M)+4*S));if(I==5||I==10)for(var $=I==5?o.readUint:o.readInt,S=0;S<B;S++)T.push([$(s,M+S*8),$(s,M+S*8+4)]);if(I==8)for(var S=0;S<B;S++)T.push(o.readShort(s,(B<3?h-4:M)+2*S));if(I==9)for(var S=0;S<B;S++)T.push(o.readInt(s,(B<2?h-4:M)+4*S));if(I==11)for(var S=0;S<B;S++)T.push(o.readFloat(s,M+S*4));if(I==12)for(var S=0;S<B;S++)T.push(o.readDouble(s,M+S*8));if(B!=0&&T.length==0){if(n(k,"unknown TIFF tag type: ",I,"num:",B),A==0)return;continue}if(d.debug&&n("   ".repeat(u),k,I,a.tags[k],T),m["t"+k]=T,!(k==330&&m.t272&&m.t272[0]=="DSLR-A100")){if(k==330||k==34665||k==34853||k==50740&&o.readUshort(s,o.readUint(T,0))<300||k==61440){for(var G=k==50740?[o.readUint(T,0)]:T,L=[],S=0;S<G.length;S++)a._readIFD(o,s,G[S],L,u+1,d);k==330&&(m.subIFD=L),k==34665&&(m.exifIFD=L[0]),k==34853&&(m.gpsiIFD=L[0]),k==50740&&(m.dngPrvt=L[0]),k==61440&&(m.fujiIFD=L[0])}}if(k==37500&&d.parseMN){var O=T;if(o.readASCII(O,0,5)=="Nikon")m.makerNote=a.decode(O.slice(10).buffer)[0];else if(o.readASCII(O,0,5)=="OLYMP"||o.readASCII(O,0,9)=="OM SYSTEM"){var z=[8208,8224,8240,8256,8272],H=[];a._readIFD(o,O,O[1]==77?16:O[5]==85?12:8,H,u+1,d);for(var Q=m.makerNote=H.pop(),S=0;S<z.length;S++){var K="t"+z[S];Q[K]!=null&&(a._readIFD(o,O,Q[K][0],H,u+1,d),Q[K]=H.pop())}Q.t12288&&(a._readIFD(o,Q.t12288,0,H,u+1,d),Q.t12288=H.pop())}else if(o.readUshort(s,M)<300&&o.readUshort(s,M+4)<=12){var H=[];a._readIFD(o,s,M,H,u+1,d),m.makerNote=H[0]}}}return f.push(m),d.debug&&n("   ".repeat(u),"<<<---------------"),h},a._writeIFD=function(o,s,h,f,u){var d=Object.keys(u),p=d.length;u.exifIFD&&p--,u.gpsiIFD&&p--,o.writeUshort(h,f,p),f+=2;for(var m=f+p*12+4,A=0;A<d.length;A++){var k=d[A];if(!(k=="t34665"||k=="t34853")){k=="exifIFD"&&(k="t34665"),k=="gpsiIFD"&&(k="t34853");var I=parseInt(k.slice(1)),B=s.main[I];if(B==null&&(B=s.rest[I]),B==null||B==0)throw new Error("unknown type of tag: "+I);var M=u[k];if(I==34665){var T=a._writeIFD(o,s,h,m,u.exifIFD);M=[m],m=T[1]}if(I==34853){var T=a._writeIFD(o,a._types.gps,h,m,u.gpsiIFD);M=[m],m=T[1]}B==2&&(M=M[0]+"\0");var U=M.length;o.writeUshort(h,f,I),f+=2,o.writeUshort(h,f,B),f+=2,o.writeUint(h,f,U),f+=4;var C=[-1,1,1,2,4,8,0,1,0,4,8,0,8][B]*U,w=f;if(C>4&&(o.writeUint(h,f,m),w=m),B==1||B==7)for(var E=0;E<U;E++)h[w+E]=M[E];else if(B==2)o.writeASCII(h,w,M);else if(B==3)for(var E=0;E<U;E++)o.writeUshort(h,w+2*E,M[E]);else if(B==4)for(var E=0;E<U;E++)o.writeUint(h,w+4*E,M[E]);else if(B==5||B==10)for(var S=B==5?o.writeUint:o.writeInt,E=0;E<U;E++){var $=M[E],G=$[0],L=$[1];if(G==null)throw"e";S(h,w+8*E,G),S(h,w+8*E+4,L)}else if(B==9)for(var E=0;E<U;E++)o.writeInt(h,w+4*E,M[E]);else if(B==12)for(var E=0;E<U;E++)o.writeDouble(h,w+8*E,M[E]);else throw B;C>4&&(C+=C&1,m+=C),f+=4}}return[f,m]},a.toRGBA8=function(o,s){function h(Be){return Be<.0031308?12.92*Be:1.055*Math.pow(Be,1/2.4)-.055}var f=o.width,u=o.height,d=f*u,p=o.data,m=new Uint8Array(d*4),A=o.t262?o.t262[0]:2,k=o.t258?Math.min(32,o.t258[0]):1;o.t262==null&&k==1&&(A=0);var I=o.t277?o.t277[0]:o.t258?o.t258.length:[1,1,3,1,1,4,3][A],B=o.t339?o.t339[0]:null;if(A==1&&k==32&&B!=3)throw"e";var M=Math.ceil(I*k*f/8);if(A==0){s=1/256;for(var T=0;T<u;T++){var U=T*M,C=T*f;if(k==1)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+(w>>3)]>>7-(w&7)&1;m[E]=m[E+1]=m[E+2]=(1-S)*255,m[E+3]=255}if(k==4)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+(w>>1)]>>4-4*(w&1)&15;m[E]=m[E+1]=m[E+2]=(15-S)*17,m[E+3]=255}if(k==8)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+w];m[E]=m[E+1]=m[E+2]=255-S,m[E+3]=255}if(k==16)for(var w=0;w<f;w++){var E=C+w<<2,$=U+2*w,S=p[$+1]<<8|p[$];m[E]=m[E+1]=m[E+2]=Math.min(255,255-~~(S*s)),m[E+3]=255}}}else if(A==1){s==null&&(s=1/256);for(var G=p.length&3?null:new Float32Array(p.buffer),T=0;T<u;T++){var U=T*M,C=T*f;if(k==1)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+(w>>3)]>>7-(w&7)&1;m[E]=m[E+1]=m[E+2]=S*255,m[E+3]=255}if(k==2)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+(w>>2)]>>6-2*(w&3)&3;m[E]=m[E+1]=m[E+2]=S*85,m[E+3]=255}if(k==8)for(var w=0;w<f;w++){var E=C+w<<2,S=p[U+w*I];m[E]=m[E+1]=m[E+2]=S,m[E+3]=255}if(k==16)for(var w=0;w<f;w++){var E=C+w<<2,$=U+2*w,S=p[$+1]<<8|p[$];m[E]=m[E+1]=m[E+2]=Math.min(255,~~(S*s)),m[E+3]=255}if(k==32)for(var w=0;w<f;w++){var E=C+w<<2,$=(U>>>2)+w,S=G[$];m[E]=m[E+1]=m[E+2]=~~(.5+255*S),m[E+3]=255}}}else if(A==2)if(k==8){if(I==1)for(var w=0;w<d;w++)m[4*w]=m[4*w+1]=m[4*w+2]=p[w],m[4*w+3]=255;if(I==3)for(var w=0;w<d;w++){var E=w<<2,L=w*3;m[E]=p[L],m[E+1]=p[L+1],m[E+2]=p[L+2],m[E+3]=255}if(I>=4)for(var w=0;w<d;w++){var E=w<<2,L=w*I;m[E]=p[L],m[E+1]=p[L+1],m[E+2]=p[L+2],m[E+3]=p[L+3]}}else if(k==16){if(I==4)for(var w=0;w<d;w++){var E=w<<2,L=w*8+1;m[E]=p[L],m[E+1]=p[L+2],m[E+2]=p[L+4],m[E+3]=p[L+6]}if(I==3)for(var w=0;w<d;w++){var E=w<<2,L=w*6+1;m[E]=p[L],m[E+1]=p[L+2],m[E+2]=p[L+4],m[E+3]=255}}else if(k==32){for(var O=new Float32Array(p.buffer),z=0,w=0;w<O.length;w++)z=Math.min(z,O[w]);if(z<0)for(var w=0;w<p.length;w+=4){var H=p[w];p[w]=p[w+3],p[w+3]=H,H=p[w+1],p[w+1]=p[w+2],p[w+2]=H}for(var Q=[],w=0;w<65536;w++)Q.push(h(w/65535));for(var w=0;w<O.length;w++){var K=Math.max(0,Math.min(1,O[w]));O[w]=Q[~~(.5+K*65535)]}if(I==3)for(var w=0;w<d;w++){var E=w<<2,L=w*3;m[E]=~~(.5+O[L]*255),m[E+1]=~~(.5+O[L+1]*255),m[E+2]=~~(.5+O[L+2]*255),m[E+3]=255}else if(I==4)for(var w=0;w<d;w++){var E=w<<2,L=w*4;m[E]=~~(.5+O[L]*255),m[E+1]=~~(.5+O[L+1]*255),m[E+2]=~~(.5+O[L+2]*255),m[E+3]=~~(.5+O[L+3]*255)}else throw I}else throw k;else if(A==3)for(var te=o.t320,X=1<<k,J=k==8&&I>1&&o.t338&&o.t338[0]!=0,T=0;T<u;T++)for(var ie=0;ie<f;ie++){var w=T*f+ie,E=w<<2,de=0,me=T*M;if(k==1)de=p[me+(ie>>>3)]>>>7-(ie&7)&1;else if(k==2)de=p[me+(ie>>>2)]>>>6-2*(ie&3)&3;else if(k==4)de=p[me+(ie>>>1)]>>>4-4*(ie&1)&15;else if(k==8)de=p[me+ie*I];else throw k;m[E]=te[de]>>8,m[E+1]=te[X+de]>>8,m[E+2]=te[X+X+de]>>8,m[E+3]=J?p[me+ie*I+1]:255}else if(A==5)for(var _e=I>4?1:0,w=0;w<d;w++){var E=w<<2,q=w*I;if(window.UDOC){var V=p[q],j=p[q+1],ne=p[q+2],se=p[q+3],xe=UDOC.C.cmykToRgb([V*(1/255),j*(1/255),ne*(1/255),se*(1/255)]);m[E]=~~(.5+255*xe[0]),m[E+1]=~~(.5+255*xe[1]),m[E+2]=~~(.5+255*xe[2])}else{var V=255-p[q],j=255-p[q+1],ne=255-p[q+2],se=(255-p[q+3])*(1/255);m[E]=~~(V*se+.5),m[E+1]=~~(j*se+.5),m[E+2]=~~(ne*se+.5)}m[E+3]=255*(1-_e)+p[q+4]*_e}else if(A==6&&o.t278)for(var Me=o.t278[0],T=0;T<u;T+=Me)for(var w=T*f,ve=Me*f,he=0;he<ve;he++){var E=4*(w+he),q=3*w+4*(he>>>1),ne=p[q+(he&1)],oe=p[q+2]-128,be=p[q+3]-128,we=ne+((be>>2)+(be>>3)+(be>>5)),R=ne-((oe>>2)+(oe>>4)+(oe>>5))-((be>>1)+(be>>3)+(be>>4)+(be>>5)),v=ne+(oe+(oe>>1)+(oe>>2)+(oe>>6));m[E]=Math.max(0,Math.min(255,we)),m[E+1]=Math.max(0,Math.min(255,R)),m[E+2]=Math.max(0,Math.min(255,v)),m[E+3]=255}else if(A==32845)for(var T=0;T<u;T++)for(var ie=0;ie<f;ie++){var q=(T*f+ie)*6,E=(T*f+ie)*4,b=p[q+1]<<8|p[q],b=Math.pow(2,(b+.5)/256-64),P=(p[q+3]+.5)/410,W=(p[q+5]+.5)/410,re=9*P/(6*P-16*W+12),ae=4*W/(6*P-16*W+12),Ee=b,Ce=re*Ee/ae,ne=Ee,Pe=(1-re-ae)*Ee/ae,we=2.69*Ce-1.276*ne-.414*Pe,R=-1.022*Ce+1.978*ne+.044*Pe,v=.061*Ce-.224*ne+1.163*Pe;m[E]=h(Math.min(we,1))*255,m[E+1]=h(Math.min(R,1))*255,m[E+2]=h(Math.min(v,1))*255,m[E+3]=255}else n("Unknown Photometric interpretation: "+A);return m},a.replaceIMG=function(o){o==null&&(o=document.getElementsByTagName("img"));for(var s=["tif","tiff","dng","cr2","nef"],h=0;h<o.length;h++){var f=o[h],u=f.getAttribute("src");if(u!=null){var d=u.split(".").pop().toLowerCase();if(s.indexOf(d)!=-1){var p=new XMLHttpRequest;a._xhrs.push(p),a._imgs.push(f),p.open("GET",u),p.responseType="arraybuffer",p.onload=a._imgLoaded,p.send()}}}},a._xhrs=[],a._imgs=[],a._imgLoaded=function(o){var s=a._xhrs.indexOf(o.target),h=a._imgs[s];a._xhrs.splice(s,1),a._imgs.splice(s,1),h.setAttribute("src",a.bufferToURI(o.target.response))},a.bufferToURI=function(o){var s=a.decode(o),h=s,f=0,u=h[0];s[0].subIFD&&(h=h.concat(s[0].subIFD));for(var d=0;d<h.length;d++){var p=h[d];if(!(p.t258==null||p.t258.length<3)){var m=p.t256*p.t257;m>f&&(f=m,u=p)}}a.decodeImage(o,u,s);var A=a.toRGBA8(u),k=u.width,I=u.height,B=document.createElement("canvas");B.width=k,B.height=I;var M=B.getContext("2d"),T=new ImageData(new Uint8ClampedArray(A.buffer),k,I);return M.putImageData(T,0,0),B.toDataURL()},a._binBE={nextZero:function(o,s){for(;o[s]!=0;)s++;return s},readUshort:function(o,s){return o[s]<<8|o[s+1]},readShort:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+1],h[1]=o[s+0],a._binBE.i16[0]},readInt:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+3],h[1]=o[s+2],h[2]=o[s+1],h[3]=o[s+0],a._binBE.i32[0]},readUint:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+3],h[1]=o[s+2],h[2]=o[s+1],h[3]=o[s+0],a._binBE.ui32[0]},readASCII:function(o,s,h){for(var f="",u=0;u<h;u++)f+=String.fromCharCode(o[s+u]);return f},readFloat:function(o,s){for(var h=a._binBE.ui8,f=0;f<4;f++)h[f]=o[s+3-f];return a._binBE.fl32[0]},readDouble:function(o,s){for(var h=a._binBE.ui8,f=0;f<8;f++)h[f]=o[s+7-f];return a._binBE.fl64[0]},writeUshort:function(o,s,h){o[s]=h>>8&255,o[s+1]=h&255},writeInt:function(o,s,h){var f=a._binBE.ui8;a._binBE.i32[0]=h,o[s+3]=f[0],o[s+2]=f[1],o[s+1]=f[2],o[s+0]=f[3]},writeUint:function(o,s,h){o[s]=h>>24&255,o[s+1]=h>>16&255,o[s+2]=h>>8&255,o[s+3]=h>>0&255},writeASCII:function(o,s,h){for(var f=0;f<h.length;f++)o[s+f]=h.charCodeAt(f)},writeDouble:function(o,s,h){a._binBE.fl64[0]=h;for(var f=0;f<8;f++)o[s+f]=a._binBE.ui8[7-f]}},a._binBE.ui8=new Uint8Array(8),a._binBE.i16=new Int16Array(a._binBE.ui8.buffer),a._binBE.i32=new Int32Array(a._binBE.ui8.buffer),a._binBE.ui32=new Uint32Array(a._binBE.ui8.buffer),a._binBE.fl32=new Float32Array(a._binBE.ui8.buffer),a._binBE.fl64=new Float64Array(a._binBE.ui8.buffer),a._binLE={nextZero:a._binBE.nextZero,readUshort:function(o,s){return o[s+1]<<8|o[s]},readShort:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+0],h[1]=o[s+1],a._binBE.i16[0]},readInt:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+0],h[1]=o[s+1],h[2]=o[s+2],h[3]=o[s+3],a._binBE.i32[0]},readUint:function(o,s){var h=a._binBE.ui8;return h[0]=o[s+0],h[1]=o[s+1],h[2]=o[s+2],h[3]=o[s+3],a._binBE.ui32[0]},readASCII:a._binBE.readASCII,readFloat:function(o,s){for(var h=a._binBE.ui8,f=0;f<4;f++)h[f]=o[s+f];return a._binBE.fl32[0]},readDouble:function(o,s){for(var h=a._binBE.ui8,f=0;f<8;f++)h[f]=o[s+f];return a._binBE.fl64[0]},writeUshort:function(o,s,h){o[s]=h&255,o[s+1]=h>>8&255},writeInt:function(o,s,h){var f=a._binBE.ui8;a._binBE.i32[0]=h,o[s+0]=f[0],o[s+1]=f[1],o[s+2]=f[2],o[s+3]=f[3]},writeUint:function(o,s,h){o[s]=h>>>0&255,o[s+1]=h>>>8&255,o[s+2]=h>>>16&255,o[s+3]=h>>>24&255},writeASCII:a._binBE.writeASCII},a._copyTile=function(o,s,h,f,u,d,p,m){for(var A=Math.min(s,u-p),k=Math.min(h,d-m),I=0;I<k;I++)for(var B=(m+I)*u+p,M=I*s,T=0;T<A;T++)f[B+T]=o[M+T]},a.LosslessJpegDecode=function(){var o,s;function h(){return o[s++]}function f(){return o[s++]<<8|o[s++]}function u(w){for(var E=h(),S=[0,0,0,255],$=[],G=8,L=0;L<16;L++)$[L]=h();for(var L=0;L<16;L++)for(var O=0;O<$[L];O++){var z=d(S,0,L+1,1);S[z+3]=h()}var H=new Uint8Array(1<<G);w[E]=[new Uint8Array(S),H];for(var L=0;L<1<<G;L++){for(var Q=G,K=L,te=0,X=0;S[te+3]==255&&Q!=0;)X=K>>--Q&1,te=S[te+X];H[L]=te}}function d(w,E,S,$){if(w[E+3]!=255)return 0;if(S==0)return E;for(var G=0;G<2;G++){w[E+G]==0&&(w[E+G]=w.length,w.push(0,0,$,255));var L=d(w,w[E+G],S-1,$+1);if(L!=0)return L}return 0}function p(w){for(var E=w.b,S=w.f;E<25&&w.a<w.d;){var $=w.data[w.a++];$==255&&!w.c&&w.a++,S=S<<8|$,E+=8}if(E<0)throw"e";w.b=E,w.f=S}function m(w,E){return E.b<w&&p(E),E.f>>(E.b-=w)&65535>>16-w}function A(w,E){var S=w[0],$=0,G=255,L=0;E.b<16&&p(E);var O=E.f>>E.b-8&255;for($=w[1][O],G=S[$+3],E.b-=S[$+2];G==255;)L=E.f>>--E.b&1,$=S[$+L],G=S[$+3];return G}function k(w,E){return w<32768>>16-E&&(w+=-(1<<E)+1),w}function I(w,E){var S=A(w,E);if(S==0)return 0;if(S==16)return-32768;var $=m(S,E);return k($,S)}function B(w,E,S,$,G,L){for(var O=0,z=0;z<L;z++){for(var H=z*E,Q=0;Q<E;Q+=G){O++;for(var K=0;K<G;K++)w[H+Q+K]=I($[K],S)}if(S.e!=0&&O%S.e==0&&z!=0){for(var te=S.a,X=S.data;X[te]!=255||!(208<=X[te+1]&&X[te+1]<=215);)te--;S.a=te+2,S.f=0,S.b=0}}}function M(w,E){return k(m(w,E),w)}function T(w,E,S,$,G){for(var L=o.length-s,O=0;O<L;O+=4){var z=o[s+O];o[s+O]=o[s+O+3],o[s+O+3]=z;var z=o[s+O+1];o[s+O+1]=o[s+O+2],o[s+O+2]=z}for(var H=0;H<G;H++)for(var Q=32768,K=32768,te=0;te<E;te+=2){var X=A($,S),J=A($,S);X!=0&&(Q+=M(X,S)),J!=0&&(K+=M(J,S)),w[H*E+te]=Q&65535,w[H*E+te+1]=K&65535}}function U(w){if(o=w,s=0,f()!=65496)throw"e";for(var E=[],S=0,$=0,G=0,L=[],O=[],z=[],H=0,Q=0,K=0;;){var te=f();if(te==65535){s--;continue}var X=f();if(te==65475){$=h(),Q=f(),K=f(),H=h();for(var J=0;J<H;J++){var ie=h(),de=h(),me=h();if(me!=0)throw"e";E[ie]=[J,de>>4,de&15]}}else if(te==65476)for(var _e=s+X-2;s<_e;)u(O);else if(te==65498){s++;for(var J=0;J<H;J++){var q=h(),V=E[q];z[V[0]]=O[h()>>>4],L[V[0]]=V.slice(1)}S=h(),s+=2;break}else te==65501?G=f():s+=X-2}var j=$>8?Uint16Array:Uint8Array,ne=new j(Q*K*H),se={b:0,f:0,c:S==8,a:s,data:o,d:o.length,e:G};if(se.c)T(ne,K*H,se,z[0],Q);else{for(var xe=[],Me=0,ve=0,J=0;J<H;J++){var he=L[J],oe=he[0],be=he[1];oe>Me&&(Me=oe),be>ve&&(ve=be),xe.push(oe*be)}if(Me!=1||ve!=1){if(H!=3||xe[1]!=1||xe[2]!=1||Me!=2||ve!=1&&ve!=2)throw"e";for(var we=[],R=0,J=0;J<H;J++){for(var v=0;v<xe[J];v++)we.push(z[J]);R+=xe[J]}var b=K/Me,P=Q/ve,W=b*P;B(ne,b*R,se,we,R,P),C(ne,S,b,P,R-2,R,R,$);var re=new Uint16Array(W*xe[0]);if(Me==2&&ve==2){for(var J=0;J<W;J++)re[4*J]=ne[6*J],re[4*J+1]=ne[6*J+1],re[4*J+2]=ne[6*J+2],re[4*J+3]=ne[6*J+3];C(re,S,b*4,P,0,1,1,$);for(var J=0;J<W;J++)ne[6*J]=re[4*J],ne[6*J+1]=re[4*J+1],ne[6*J+2]=re[4*J+2],ne[6*J+3]=re[4*J+3]}if(Me==2&&ve==1){for(var J=0;J<W;J++)re[2*J]=ne[4*J],re[2*J+1]=ne[4*J+1];C(re,S,b*2,P,0,1,1,$);for(var J=0;J<W;J++)ne[4*J]=re[2*J],ne[4*J+1]=re[2*J+1]}for(var ae=ne.slice(0),be=0;be<Q;be++)if(ve==2)for(var oe=0;oe<K;oe++){var Ee=(be*K+oe)*H,Ce=((be>>>1)*b+(oe>>>1))*R,Pe=(be&1)*2+(oe&1);ne[Ee]=ae[Ce+Pe],ne[Ee+1]=ae[Ce+4],ne[Ee+2]=ae[Ce+5]}else for(var oe=0;oe<K;oe++){var Ee=(be*K+oe)*H,Ce=(be*b+(oe>>>1))*R,Pe=oe&1;ne[Ee]=ae[Ce+Pe],ne[Ee+1]=ae[Ce+2],ne[Ee+2]=ae[Ce+3]}}else if(B(ne,K*H,se,z,H,Q),G==0)C(ne,S,K,Q,0,H,H,$);else for(var Be=Math.floor(G/K),be=0;be<Q;be+=Be){var Se=ne.slice(be*K*H,(be+Be)*K*H);C(Se,S,K,Be,0,H,H,$),ne.set(Se,be*K*H)}}return ne}function C(w,E,S,$,G,L,O,z){for(var H=S*O,Q=G;Q<L;Q++)w[Q]+=1<<z-1;for(var K=O;K<H;K+=O)for(var Q=G;Q<L;Q++)w[K+Q]+=w[K+Q-O];for(var te=1;te<$;te++){for(var X=te*H,Q=G;Q<L;Q++)w[X+Q]+=w[X+Q-H];for(var K=O;K<H;K+=O)for(var Q=G;Q<L;Q++){var J=X+K+Q,ie=J-H,de=w[J-O],me=0;if(E==0)me=0;else if(E==1)me=de;else if(E==2)me=w[ie];else if(E==3)me=w[ie-O];else if(E==4)me=de+(w[ie]-w[ie-O]);else if(E==5)me=de+(w[ie]-w[ie-O]>>>1);else if(E==6)me=w[ie]+(de-w[ie-O]>>>1);else if(E==7)me=de+w[ie]>>>1;else throw E;w[J]+=me}}}return U}(),function(){var o=0,s=1,h=2,f=3,u=4,d=5,p=6,m=7,A=8,k=9,I=10,B=11,M=12,T=13,U=14,C=15,w=16,E=17,S=18;function $(q){var V=a._binBE.readUshort,j={b:V(q,0),i:q[2],C:q[3],u:q[4],q:V(q,5),k:V(q,7),e:V(q,9),l:V(q,11),s:q[13],d:V(q,14)};if(j.b!=18771||j.i>1||j.q<6||j.q%6||j.e<768||j.e%24||j.l!=768||j.k<j.l||j.k%j.l||j.k-j.e>=j.l||j.s>16||j.s!=j.k/j.l||j.s!=Math.ceil(j.e/j.l)||j.d!=j.q/6||j.u!=12&&j.u!=14&&j.u!=16||j.C!=16&&j.C!=0)throw"Invalid data";if(j.i==0)throw"Not implemented. We need this file!";return j.h=j.C==16,j.m=(j.h?j.l*2/3:j.l>>>1)|0,j.A=j.m+2,j.f=64,j.g=(1<<j.u)-1,j.n=4*j.u,j}function G(q,V){var j=new Array(V.s),ne=4*V.s,se=16+ne;ne&12&&(se+=16-(ne&12));for(var xe=0,Me=16;xe<V.s;Me+=4){var ve=a._binBE.readUint(q,Me);j[xe]=q.slice(se,se+ve),j[xe].j=0,j[xe].a=0,se+=ve,xe++}if(se!=q.length)throw"Invalid data";return j}function L(q,V){for(var j=-V[4],ne=0;j<=V[4];ne++,j++)q[ne]=j<=-V[3]?-4:j<=-V[2]?-3:j<=-V[1]?-2:j<-V[0]?-1:j<=V[0]?0:j<V[1]?1:j<V[2]?2:j<V[3]?3:4}function O(q,V,j){var ne=[V,3*V+18,5*V+67,7*V+276,j];q.o=V,q.w=(ne[4]+2*V)/(2*V+1)+1|0,q.v=Math.ceil(Math.log2(q.w)),q.t=9,L(q.c,ne)}function z(q){var V={c:new Int8Array(2<<q.u)};return O(V,0,q.g),V}function H(q){for(var V=[[],[],[]],j=Math.max(2,q.w+32>>>6),ne=0;ne<3;ne++)for(var se=0;se<41;se++)V[ne][se]=[j,1];return V}function Q(q){for(var V=-1,j=0;!j;V++)j=q[q.j]>>>7-q.a&1,q.a++,q.a&=7,q.a||q.j++;return V}function K(q,V){var j=0,ne=8-q.a;if(q.j,q.a,V){if(V>=ne)do j<<=ne,V-=ne,j|=q[q.j]&(1<<ne)-1,q.j++,ne=8;while(V>=8);V&&(j<<=V,ne-=V,j|=q[q.j]>>>ne&(1<<V)-1),q.a=8-ne}return j}function te(q,V){var j=0;if(V<q)for(;j<=14&&V<<++j<q;);return j}function X(q,V,j,ne,se,xe,Me,ve){ve==null&&(ve=0);var he=xe+1,oe=he%2,be=0,we,R,v=ne[se],b=ne[se-1],P=ne[se-2][he],W=b[he-1],re=b[he],ae=b[he+1],Ee=v[he-1],Ce=v[he+1],Pe=Math.abs,Be,Se,ke,Ie;if(oe&&(Be=Pe(ae-re),Se=Pe(P-re),ke=Pe(W-re)),oe){if(Ie=Be>ke&&Se<Be?P+W:Be<ke&&Se<ke?P+ae:ae+W,Ie=Ie+2*re>>>2,ve){v[he]=Ie;return}we=V.t*V.c[q.g+re-P]+V.c[q.g+W-re]}else Ie=re>W&&re>ae||re<W&&re<ae?Ce+Ee+2*re>>>2:Ee+Ce>>>1,we=V.t*V.c[q.g+re-W]+V.c[q.g+W-Ee];R=Pe(we);var Le=Q(j);if(Le<q.n-V.v-1){var N=te(Me[R][0],Me[R][1]);be=K(j,N)+(Le<<N)}else be=K(j,V.v)+1;be=be&1?-1-(be>>>1):be>>>1,Me[R][0]+=Pe(be),Me[R][1]==q.f&&(Me[R][0]>>>=1,Me[R][1]>>>=1),Me[R][1]++,Ie=we<0?Ie-be:Ie+be,q.i&&(Ie<0?Ie+=V.w:Ie>q.g&&(Ie-=V.w)),v[he]=Ie>=0?Math.min(Ie,q.g):0}function J(q,V,j){for(var ne=q[0].length,se=V;se<=j;se++)q[se][0]=q[se-1][1],q[se][ne-1]=q[se-1][ne-2]}function ie(q){J(q,m,M),J(q,h,u),J(q,C,E)}function de(q,V,j,ne,se,xe,Me,ve,he,oe,be,we,R){for(var v=0,b=1,P=se<T&&se>u;b<q.m;)v<q.m&&(X(q,V,j,ne,se,v,Me[he],q.h&&(P&&oe||!P&&(be||(v&we)==R))),X(q,V,j,ne,xe,v,Me[he],q.h&&(!P&&oe||P&&(be||(v&we)==R))),v+=2),v>8&&(X(q,V,j,ne,se,b,ve[he]),X(q,V,j,ne,xe,b,ve[he]),b+=2);ie(ne)}function me(q,V,j,ne,se,xe){de(q,V,j,ne,h,m,se,xe,0,0,1,0,8),de(q,V,j,ne,A,C,se,xe,1,0,1,0,8),de(q,V,j,ne,f,k,se,xe,2,1,0,3,0),de(q,V,j,ne,I,w,se,xe,0,0,0,3,2),de(q,V,j,ne,u,B,se,xe,1,0,0,3,2),de(q,V,j,ne,M,E,se,xe,2,1,0,3,0)}function _e(q,V,j,ne,se,xe){var Me=xe.length,ve=q.l;se+1==q.s&&(ve=q.e-se*q.l);for(var he=6*q.e*ne+se*q.l,oe=0;oe<6;oe++){for(var be=0;be<ve;be++){var we=xe[oe%Me][be%Me],R;we==0?R=h+(oe>>>1):we==2?R=C+(oe>>>1):R=m+oe;var v=q.h?(be*2/3&2147483646|be%3&1)+(be%3>>>1):be>>>1;V[he+be]=j[R][v+1]}he+=q.e}}a._decompressRAF=function(q,V){var j=$(q),ne=G(q,j),se=z(j),xe=new Int16Array(j.e*j.q);V==null&&(V=j.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var Me=[[o,f],[s,u],[d,B],[p,M],[T,w],[U,E]],ve=[],he=0;he<S;he++)ve[he]=new Uint16Array(j.A);for(var oe=0;oe<j.s;oe++){for(var be=H(se),we=H(se),he=0;he<S;he++)for(var R=0;R<j.A;R++)ve[he][R]=0;for(var v=0;v<j.d;v++){me(j,se,ne[oe],ve,be,we);for(var he=0;he<6;he++)for(var R=0;R<j.A;R++)ve[Me[he][0]][R]=ve[Me[he][1]][R];_e(j,xe,ve,v,oe,V);for(var he=h;he<S;he++)if([d,p,T,U].indexOf(he)==-1)for(var R=0;R<j.A;R++)ve[he][R]=0;ie(ve)}}return xe}}()})(t,r)})()})(UTIF);var UTIFExports=UTIF.exports;const utif=getDefaultExportFromCjs(UTIFExports),MIME_TYPE$1="image/tiff",tiff=()=>({mime:{[MIME_TYPE$1]:["tiff","tif"]},constants:{MIME_TIFF:MIME_TYPE$1},decoders:{[MIME_TYPE$1]:e=>{const t=utif.decode(e),r=t[0];t.forEach(a=>{utif.decodeImage(e,a)});const n=utif.toRGBA8(r);return{data:Buffer.from(n),width:r.t256[0],height:r.t257[0]}}},encoders:{[MIME_TYPE$1]:e=>{const t=utif.encodeImage(e.bitmap.data,e.bitmap.width,e.bitmap.height);return Buffer.from(t)}}});var omggif={},GifReader_1,GifWriter_1;function GifWriter(e,t,r,l){var a=0,l=l===void 0?{}:l,o=l.loop===void 0?null:l.loop,s=l.palette===void 0?null:l.palette;if(t<=0||r<=0||t>65535||r>65535)throw new Error("Width/Height invalid.");function h(I){var B=I.length;if(B<2||B>256||B&B-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return B}e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var f=0,u=0;if(s!==null){for(var d=h(s);d>>=1;)++f;if(d=1<<f,--f,l.background!==void 0){if(u=l.background,u>=d)throw new Error("Background index out of range.");if(u===0)throw new Error("Background index explicitly passed as 0.")}}if(e[a++]=t&255,e[a++]=t>>8&255,e[a++]=r&255,e[a++]=r>>8&255,e[a++]=(s!==null?128:0)|f,e[a++]=u,e[a++]=0,s!==null)for(var p=0,m=s.length;p<m;++p){var A=s[p];e[a++]=A>>16&255,e[a++]=A>>8&255,e[a++]=A&255}if(o!==null){if(o<0||o>65535)throw new Error("Loop count invalid.");e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=o&255,e[a++]=o>>8&255,e[a++]=0}var k=!1;this.addFrame=function(I,B,M,T,U,C){if(k===!0&&(--a,k=!1),C=C===void 0?{}:C,I<0||B<0||I>65535||B>65535)throw new Error("x/y invalid.");if(M<=0||T<=0||M>65535||T>65535)throw new Error("Width/Height invalid.");if(U.length<M*T)throw new Error("Not enough pixels for the frame size.");var w=!0,E=C.palette;if(E==null&&(w=!1,E=s),E==null)throw new Error("Must supply either a local or global palette.");for(var S=h(E),$=0;S>>=1;)++$;S=1<<$;var G=C.delay===void 0?0:C.delay,L=C.disposal===void 0?0:C.disposal;if(L<0||L>3)throw new Error("Disposal out of range.");var O=!1,z=0;if(C.transparent!==void 0&&C.transparent!==null&&(O=!0,z=C.transparent,z<0||z>=S))throw new Error("Transparent color index.");if((L!==0||O||G!==0)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=L<<2|(O===!0?1:0),e[a++]=G&255,e[a++]=G>>8&255,e[a++]=z,e[a++]=0),e[a++]=44,e[a++]=I&255,e[a++]=I>>8&255,e[a++]=B&255,e[a++]=B>>8&255,e[a++]=M&255,e[a++]=M>>8&255,e[a++]=T&255,e[a++]=T>>8&255,e[a++]=w===!0?128|$-1:0,w===!0)for(var H=0,Q=E.length;H<Q;++H){var K=E[H];e[a++]=K>>16&255,e[a++]=K>>8&255,e[a++]=K&255}return a=GifWriterOutputLZWCodeStream(e,a,$<2?2:$,U),a},this.end=function(){return k===!1&&(e[a++]=59,k=!0),a},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(I){e=I},this.getOutputBufferPosition=function(){return a},this.setOutputBufferPosition=function(I){a=I}}function GifWriterOutputLZWCodeStream(e,t,r,n){e[t++]=r;var a=t++,l=1<<r,o=l-1,s=l+1,h=s+1,f=r+1,u=0,d=0;function p(C){for(;u>=C;)e[t++]=d&255,d>>=8,u-=8,t===a+256&&(e[a]=255,a=t++)}function m(C){d|=C<<u,u+=f,p(8)}var A=n[0]&o,k={};m(l);for(var I=1,B=n.length;I<B;++I){var M=n[I]&o,T=A<<8|M,U=k[T];if(U===void 0){for(d|=A<<u,u+=f;u>=8;)e[t++]=d&255,d>>=8,u-=8,t===a+256&&(e[a]=255,a=t++);h===4096?(m(l),h=s+1,f=r+1,k={}):(h>=1<<f&&++f,k[T]=h++),A=M}else A=U}return m(A),m(s),p(1),a+1===t?e[a]=0:(e[a]=t-a-1,e[t++]=0),t}function GifReader(e){var t=0;if(e[t++]!==71||e[t++]!==73||e[t++]!==70||e[t++]!==56||(e[t++]+1&253)!==56||e[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var r=e[t++]|e[t++]<<8,n=e[t++]|e[t++]<<8,a=e[t++],l=a>>7,o=a&7,s=1<<o+1;e[t++],e[t++];var h=null,f=null;l&&(h=t,f=s,t+=s*3);var u=!0,d=[],p=0,m=null,A=0,k=null;for(this.width=r,this.height=n;u&&t<e.length;)switch(e[t++]){case 33:switch(e[t++]){case 255:if(e[t]!==11||e[t+1]==78&&e[t+2]==69&&e[t+3]==84&&e[t+4]==83&&e[t+5]==67&&e[t+6]==65&&e[t+7]==80&&e[t+8]==69&&e[t+9]==50&&e[t+10]==46&&e[t+11]==48&&e[t+12]==3&&e[t+13]==1&&e[t+16]==0)t+=14,k=e[t++]|e[t++]<<8,t++;else for(t+=12;;){var I=e[t++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;t+=I}break;case 249:if(e[t++]!==4||e[t+4]!==0)throw new Error("Invalid graphics extension block.");var B=e[t++];p=e[t++]|e[t++]<<8,m=e[t++],B&1||(m=null),A=B>>2&7,t++;break;case 254:for(;;){var I=e[t++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;t+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[t-1].toString(16))}break;case 44:var M=e[t++]|e[t++]<<8,T=e[t++]|e[t++]<<8,U=e[t++]|e[t++]<<8,C=e[t++]|e[t++]<<8,w=e[t++],E=w>>7,S=w>>6&1,$=w&7,G=1<<$+1,L=h,O=f,z=!1;if(E){var z=!0;L=t,O=G,t+=G*3}var H=t;for(t++;;){var I=e[t++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;t+=I}d.push({x:M,y:T,width:U,height:C,has_local_palette:z,palette_offset:L,palette_size:O,data_offset:H,data_length:t-H,transparent_index:m,interlaced:!!S,delay:p,disposal:A});break;case 59:u=!1;break;default:throw new Error("Unknown gif block: 0x"+e[t-1].toString(16))}this.numFrames=function(){return d.length},this.loopCount=function(){return k},this.frameInfo=function(Q){if(Q<0||Q>=d.length)throw new Error("Frame index out of range.");return d[Q]},this.decodeAndBlitFrameBGRA=function(Q,K){var te=this.frameInfo(Q),X=te.width*te.height,J=new Uint8Array(X);GifReaderLZWOutputIndexStream(e,te.data_offset,J,X);var ie=te.palette_offset,de=te.transparent_index;de===null&&(de=256);var me=te.width,_e=r-me,q=me,V=(te.y*r+te.x)*4,j=((te.y+te.height)*r+te.x)*4,ne=V,se=_e*4;te.interlaced===!0&&(se+=r*4*7);for(var xe=8,Me=0,ve=J.length;Me<ve;++Me){var he=J[Me];if(q===0&&(ne+=se,q=me,ne>=j&&(se=_e*4+r*4*(xe-1),ne=V+(me+_e)*(xe<<1),xe>>=1)),he===de)ne+=4;else{var oe=e[ie+he*3],be=e[ie+he*3+1],we=e[ie+he*3+2];K[ne++]=we,K[ne++]=be,K[ne++]=oe,K[ne++]=255}--q}},this.decodeAndBlitFrameRGBA=function(Q,K){var te=this.frameInfo(Q),X=te.width*te.height,J=new Uint8Array(X);GifReaderLZWOutputIndexStream(e,te.data_offset,J,X);var ie=te.palette_offset,de=te.transparent_index;de===null&&(de=256);var me=te.width,_e=r-me,q=me,V=(te.y*r+te.x)*4,j=((te.y+te.height)*r+te.x)*4,ne=V,se=_e*4;te.interlaced===!0&&(se+=r*4*7);for(var xe=8,Me=0,ve=J.length;Me<ve;++Me){var he=J[Me];if(q===0&&(ne+=se,q=me,ne>=j&&(se=_e*4+r*4*(xe-1),ne=V+(me+_e)*(xe<<1),xe>>=1)),he===de)ne+=4;else{var oe=e[ie+he*3],be=e[ie+he*3+1],we=e[ie+he*3+2];K[ne++]=oe,K[ne++]=be,K[ne++]=we,K[ne++]=255}--q}}}function GifReaderLZWOutputIndexStream(e,t,r,n){for(var a=e[t++],l=1<<a,o=l+1,s=o+1,h=a+1,f=(1<<h)-1,u=0,d=0,p=0,m=e[t++],A=new Int32Array(4096),k=null;;){for(;u<16&&m!==0;)d|=e[t++]<<u,u+=8,m===1?m=e[t++]:--m;if(u<h)break;var I=d&f;if(d>>=h,u-=h,I===l){s=o+1,h=a+1,f=(1<<h)-1,k=null;continue}else if(I===o)break;for(var B=I<s?I:k,M=0,T=B;T>l;)T=A[T]>>8,++M;var U=T,C=p+M+(B!==I?1:0);if(C>n){console.log("Warning, gif stream longer than expected.");return}r[p++]=U,p+=M;var w=p;for(B!==I&&(r[p++]=U),T=B;M--;)T=A[T],r[--w]=T&255,T>>=8;k!==null&&s<4096&&(A[s++]=k<<8|U,s>=f+1&&h<12&&(++h,f=f<<1|1)),k=I}return p!==n&&console.log("Warning, gif stream shorter than expected."),r}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch(e){}let BitmapImage$2=class Ke{constructor(...t){if(t.length===0)throw new Error("constructor requires parameters");const r=t[0];if(r!==null&&typeof r=="object")if(r instanceof Ke){const n=r.bitmap;this.bitmap={width:n.width,height:n.height,data:new Buffer(n.width*n.height*4)},n.data.copy(this.bitmap.data)}else if(r.width&&r.height&&r.data)this.bitmap=r;else throw new Error("unrecognized constructor parameters");else if(typeof r=="number"&&typeof t[1]=="number"){const n=r,a=t[1],l=t[2];this.bitmap={width:n,height:a},Buffer.isBuffer(l)?this.bitmap.data=l:(this.bitmap.data=new Buffer(n*a*4),typeof l=="number"&&this.fillRGBA(l))}else throw new Error("unrecognized constructor parameters")}blit(t,r,n,a,l,o,s){if(a+o>this.bitmap.width)throw new Error("copy exceeds width of source bitmap");if(r+o>t.bitmap.width)throw new Error("copy exceeds width of target bitmap");if(l+s>this.bitmap.height)throw new Error("copy exceeds height of source bitmap");if(n+s>t.bitmap.height)throw new Erro("copy exceeds height of target bitmap");const h=this.bitmap.data,f=t.bitmap.data,u=this.bitmap.width*4,d=t.bitmap.width*4,p=o*4;let m=l*u+a*4,A=n*d+r*4;for(;--s>=0;)h.copy(f,A,m,m+p),m+=u,A+=d;return this}fillRGBA(t){const r=this.bitmap.data,n=this.bitmap.height*4;let a=0;for(;a<n;)r.writeUInt32BE(t,a),a+=4;for(;a<r.length;)r.copy(r,a,0,n),a+=n;return this}getRGBA(t,r){const n=(r*this.bitmap.width+t)*4;return this.bitmap.data.readUInt32BE(n)}getRGBASet(){const t=new Set,r=this.bitmap.data;for(let n=0;n<r.length;n+=4)t.add(r.readUInt32BE(n,!0));return t}greyscale(){const t=this.bitmap.data;return this.scan(0,0,this.bitmap.width,this.bitmap.height,(r,n,a)=>{const l=Math.round(.299*t[a]+.587*t[a+1]+.114*t[a+2]);t[a]=l,t[a+1]=l,t[a+2]=l}),this}reframe(t,r,n,a,l){const o=t<0?0:t,s=r<0?0:r,h=n+o>this.bitmap.width?this.bitmap.width-o:n,f=a+s>this.bitmap.height?this.bitmap.height-s:a,u=t<0?-t:0,d=r<0?-r:0;let p;if(l===void 0){if(o!==t||s!=r||h!==n||f!==a)throw new GifError("fillRGBA required for this reframing");p=new Ke(n,a)}else p=new Ke(n,a,l);return this.blit(p,u,d,o,s,h,f),this.bitmap=p.bitmap,this}scale(t){if(t===1)return;if(!Number.isInteger(t)||t<1)throw new Error("the scale must be an integer >= 1");const r=this.bitmap.width,n=this.bitmap.height,a=r*t*4,l=this.bitmap.data,o=new Buffer(n*a*t);let s=0,h,f=0;for(let u=0;u<n;++u){h=f;for(let d=0;d<r;++d){const p=l.readUInt32BE(s,!0);for(let m=0;m<t;++m)o.writeUInt32BE(p,f),f+=4;s+=4}for(let d=1;d<t;++d)o.copy(o,f,h,f),f+=a,h+=a}return this.bitmap={width:r*t,height:n*t,data:o},this}scanAllCoords(t){const r=this.bitmap.width,n=this.bitmap.data.length;let a=0,l=0;for(let o=0;o<n;o+=4)t(a,l,o),++a===r&&(a=0,++l)}scanAllIndexes(t){const r=this.bitmap.data.length;for(let n=0;n<r;n+=4)t(n)}};var bitmapimage=BitmapImage$2,gif$1={};let Gif$1=class{constructor(t,r,n){this.width=n.width,this.height=n.height,this.loops=n.loops,this.usesTransparency=n.usesTransparency,this.colorScope=n.colorScope,this.frames=r,this.buffer=t}};Gif$1.GlobalColorsPreferred=0;Gif$1.GlobalColorsOnly=1;Gif$1.LocalColorsOnly=2;let GifError$2=class extends Error{constructor(t){super(t),t instanceof Error&&(this.stack="Gif"+t.stack)}};gif$1.Gif=Gif$1;gif$1.GifError=GifError$2;var gifcodec={},gifutil={},__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__markAsModule=e=>__defProp(e,"__esModule",{value:!0}),__export=(e,t)=>{for(var r in t)__defProp(e,r,{get:t[r],enumerable:!0})},__reExport=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of __getOwnPropNames(t))!__hasOwnProp.call(e,a)&&r&&__defProp(e,a,{get:()=>t[a],enumerable:!(n=__getOwnPropDesc(t,a))||n.enumerable});return e},__toCommonJS=(e=>(t,r)=>e&&e.get(t)||(r=__reExport(__markAsModule({}),t,1),e&&e.set(t,r),r))(typeof WeakMap<"u"?new WeakMap:0),__publicField=(e,t,r)=>(__defNormalProp(e,typeof t!="symbol"?t+"":t,r),r),src_exports={};__export(src_exports,{applyPalette:()=>applyPalette,applyPaletteSync:()=>applyPaletteSync,buildPalette:()=>buildPalette,buildPaletteSync:()=>buildPaletteSync,constants:()=>constants_exports,conversion:()=>conversion_exports,distance:()=>distance_exports,image:()=>image_exports,palette:()=>palette_exports,quality:()=>quality_exports,utils:()=>utils_exports});var constants_exports={};__export(constants_exports,{bt709:()=>bt709_exports});var bt709_exports={};__export(bt709_exports,{Y:()=>Y,x:()=>x,y:()=>y});var Y=(e=>(e[e.RED=.2126]="RED",e[e.GREEN=.7152]="GREEN",e[e.BLUE=.0722]="BLUE",e[e.WHITE=1]="WHITE",e))(Y||{}),x=(e=>(e[e.RED=.64]="RED",e[e.GREEN=.3]="GREEN",e[e.BLUE=.15]="BLUE",e[e.WHITE=.3127]="WHITE",e))(x||{}),y=(e=>(e[e.RED=.33]="RED",e[e.GREEN=.6]="GREEN",e[e.BLUE=.06]="BLUE",e[e.WHITE=.329]="WHITE",e))(y||{}),conversion_exports={};__export(conversion_exports,{lab2rgb:()=>lab2rgb,lab2xyz:()=>lab2xyz,rgb2hsl:()=>rgb2hsl,rgb2lab:()=>rgb2lab,rgb2xyz:()=>rgb2xyz,xyz2lab:()=>xyz2lab,xyz2rgb:()=>xyz2rgb});function correctGamma(e){return e>.04045?((e+.055)/1.055)**2.4:e/12.92}function rgb2xyz(e,t,r){return e=correctGamma(e/255),t=correctGamma(t/255),r=correctGamma(r/255),{x:e*.4124+t*.3576+r*.1805,y:e*.2126+t*.7152+r*.0722,z:e*.0193+t*.1192+r*.9505}}var arithmetic_exports={};__export(arithmetic_exports,{degrees2radians:()=>degrees2radians,inRange0to255:()=>inRange0to255,inRange0to255Rounded:()=>inRange0to255Rounded,intInRange:()=>intInRange,max3:()=>max3,min3:()=>min3,stableSort:()=>stableSort});function degrees2radians(e){return e*(Math.PI/180)}function max3(e,t,r){let n=e;return n<t&&(n=t),n<r&&(n=r),n}function min3(e,t,r){let n=e;return n>t&&(n=t),n>r&&(n=r),n}function intInRange(e,t,r){return e>r&&(e=r),e<t&&(e=t),e|0}function inRange0to255Rounded(e){return e=Math.round(e),e>255?e=255:e<0&&(e=0),e}function inRange0to255(e){return e>255?e=255:e<0&&(e=0),e}function stableSort(e,t){const r=typeof e[0];let n;if(r==="number"||r==="string"){const a=Object.create(null);for(let l=0,o=e.length;l<o;l++){const s=e[l];a[s]||a[s]===0||(a[s]=l)}n=e.sort((l,o)=>t(l,o)||a[l]-a[o])}else{const a=e.slice(0);n=e.sort((l,o)=>t(l,o)||a.indexOf(l)-a.indexOf(o))}return n}function rgb2hsl(e,t,r){const n=min3(e,t,r),a=max3(e,t,r),l=a-n,o=(n+a)/510;let s=0;o>0&&o<1&&(s=l/(o<.5?a+n:510-a-n));let h=0;return l>0&&(a===e?h=(t-r)/l:a===t?h=2+(r-e)/l:h=4+(e-t)/l,h*=60,h<0&&(h+=360)),{h,s,l:o}}var refX=.95047,refY=1,refZ=1.08883;function pivot(e){return e>.008856?e**(1/3):7.787*e+16/116}function xyz2lab(e,t,r){if(e=pivot(e/refX),t=pivot(t/refY),r=pivot(r/refZ),116*t-16<0)throw new Error("xxx");return{L:Math.max(0,116*t-16),a:500*(e-t),b:200*(t-r)}}function rgb2lab(e,t,r){const n=rgb2xyz(e,t,r);return xyz2lab(n.x,n.y,n.z)}var refX2=.95047,refY2=1,refZ2=1.08883;function pivot2(e){return e>.206893034?e**3:(e-16/116)/7.787}function lab2xyz(e,t,r){const n=(e+16)/116,a=t/500+n,l=n-r/200;return{x:refX2*pivot2(a),y:refY2*pivot2(n),z:refZ2*pivot2(l)}}function correctGamma2(e){return e>.0031308?1.055*e**(1/2.4)-.055:12.92*e}function xyz2rgb(e,t,r){const n=correctGamma2(e*3.2406+t*-1.5372+r*-.4986),a=correctGamma2(e*-.9689+t*1.8758+r*.0415),l=correctGamma2(e*.0557+t*-.204+r*1.057);return{r:inRange0to255Rounded(n*255),g:inRange0to255Rounded(a*255),b:inRange0to255Rounded(l*255)}}function lab2rgb(e,t,r){const n=lab2xyz(e,t,r);return xyz2rgb(n.x,n.y,n.z)}var distance_exports={};__export(distance_exports,{AbstractDistanceCalculator:()=>AbstractDistanceCalculator,AbstractEuclidean:()=>AbstractEuclidean,AbstractManhattan:()=>AbstractManhattan,CIE94GraphicArts:()=>CIE94GraphicArts,CIE94Textiles:()=>CIE94Textiles,CIEDE2000:()=>CIEDE2000,CMetric:()=>CMetric,Euclidean:()=>Euclidean,EuclideanBT709:()=>EuclideanBT709,EuclideanBT709NoAlpha:()=>EuclideanBT709NoAlpha,Manhattan:()=>Manhattan,ManhattanBT709:()=>ManhattanBT709,ManhattanNommyde:()=>ManhattanNommyde,PNGQuant:()=>PNGQuant});var AbstractDistanceCalculator=class{constructor(){__publicField(this,"_maxDistance"),__publicField(this,"_whitePoint"),this._setDefaults(),this.setWhitePoint(255,255,255,255)}setWhitePoint(e,t,r,n){this._whitePoint={r:e>0?255/e:0,g:t>0?255/t:0,b:r>0?255/r:0,a:n>0?255/n:0},this._maxDistance=this.calculateRaw(e,t,r,n,0,0,0,0)}calculateNormalized(e,t){return this.calculateRaw(e.r,e.g,e.b,e.a,t.r,t.g,t.b,t.a)/this._maxDistance}},AbstractCIE94=class extends AbstractDistanceCalculator{calculateRaw(e,t,r,n,a,l,o,s){const h=rgb2lab(inRange0to255(e*this._whitePoint.r),inRange0to255(t*this._whitePoint.g),inRange0to255(r*this._whitePoint.b)),f=rgb2lab(inRange0to255(a*this._whitePoint.r),inRange0to255(l*this._whitePoint.g),inRange0to255(o*this._whitePoint.b)),u=h.L-f.L,d=h.a-f.a,p=h.b-f.b,m=Math.sqrt(h.a*h.a+h.b*h.b),A=Math.sqrt(f.a*f.a+f.b*f.b),k=m-A;let I=d*d+p*p-k*k;I=I<0?0:Math.sqrt(I);const B=(s-n)*this._whitePoint.a*this._kA;return Math.sqrt((u/this._Kl)**2+(k/(1+this._K1*m))**2+(I/(1+this._K2*m))**2+B**2)}},CIE94Textiles=class extends AbstractCIE94{_setDefaults(){this._Kl=2,this._K1=.048,this._K2=.014,this._kA=.25*50/255}},CIE94GraphicArts=class extends AbstractCIE94{_setDefaults(){this._Kl=1,this._K1=.045,this._K2=.015,this._kA=.25*100/255}},_CIEDE2000=class extends AbstractDistanceCalculator{_setDefaults(){}static _calculatehp(e,t){const r=Math.atan2(e,t);return r>=0?r:r+_CIEDE2000._deg360InRad}static _calculateRT(e,t){const r=t**7,n=2*Math.sqrt(r/(r+_CIEDE2000._pow25to7)),a=_CIEDE2000._deg30InRad*Math.exp(-(((e-_CIEDE2000._deg275InRad)/_CIEDE2000._deg25InRad)**2));return-Math.sin(2*a)*n}static _calculateT(e){return 1-.17*Math.cos(e-_CIEDE2000._deg30InRad)+.24*Math.cos(e*2)+.32*Math.cos(e*3+_CIEDE2000._deg6InRad)-.2*Math.cos(e*4-_CIEDE2000._deg63InRad)}static _calculate_ahp(e,t,r,n){const a=r+n;return e===0?a:t<=_CIEDE2000._deg180InRad?a/2:a<_CIEDE2000._deg360InRad?(a+_CIEDE2000._deg360InRad)/2:(a-_CIEDE2000._deg360InRad)/2}static _calculate_dHp(e,t,r,n){let a;return e===0?a=0:t<=_CIEDE2000._deg180InRad?a=r-n:r<=n?a=r-n+_CIEDE2000._deg360InRad:a=r-n-_CIEDE2000._deg360InRad,2*Math.sqrt(e)*Math.sin(a/2)}calculateRaw(e,t,r,n,a,l,o,s){const h=rgb2lab(inRange0to255(e*this._whitePoint.r),inRange0to255(t*this._whitePoint.g),inRange0to255(r*this._whitePoint.b)),f=rgb2lab(inRange0to255(a*this._whitePoint.r),inRange0to255(l*this._whitePoint.g),inRange0to255(o*this._whitePoint.b)),u=(s-n)*this._whitePoint.a*_CIEDE2000._kA,d=this.calculateRawInLab(h,f);return Math.sqrt(d+u*u)}calculateRawInLab(e,t){const r=e.L,n=e.a,a=e.b,l=t.L,o=t.a,s=t.b,h=Math.sqrt(n*n+a*a),f=Math.sqrt(o*o+s*s),u=((h+f)/2)**7,d=.5*(1-Math.sqrt(u/(u+_CIEDE2000._pow25to7))),p=(1+d)*n,m=(1+d)*o,A=Math.sqrt(p*p+a*a),k=Math.sqrt(m*m+s*s),I=A*k,B=_CIEDE2000._calculatehp(a,p),M=_CIEDE2000._calculatehp(s,m),T=Math.abs(B-M),U=l-r,C=k-A,w=_CIEDE2000._calculate_dHp(I,T,M,B),E=_CIEDE2000._calculate_ahp(I,T,B,M),S=_CIEDE2000._calculateT(E),$=(A+k)/2,G=((r+l)/2-50)**2,L=1+.015*G/Math.sqrt(20+G),O=1+.045*$,z=1+.015*S*$,H=_CIEDE2000._calculateRT(E,$),Q=U/L,K=C/O,te=w/z;return Q**2+K**2+te**2+H*K*te}},CIEDE2000=_CIEDE2000;__publicField(CIEDE2000,"_kA",.25*100/255);__publicField(CIEDE2000,"_pow25to7",25**7);__publicField(CIEDE2000,"_deg360InRad",degrees2radians(360));__publicField(CIEDE2000,"_deg180InRad",degrees2radians(180));__publicField(CIEDE2000,"_deg30InRad",degrees2radians(30));__publicField(CIEDE2000,"_deg6InRad",degrees2radians(6));__publicField(CIEDE2000,"_deg63InRad",degrees2radians(63));__publicField(CIEDE2000,"_deg275InRad",degrees2radians(275));__publicField(CIEDE2000,"_deg25InRad",degrees2radians(25));var CMetric=class extends AbstractDistanceCalculator{calculateRaw(e,t,r,n,a,l,o,s){const h=(e+a)/2*this._whitePoint.r,f=(e-a)*this._whitePoint.r,u=(t-l)*this._whitePoint.g,d=(r-o)*this._whitePoint.b,p=((512+h)*f*f>>8)+4*u*u+((767-h)*d*d>>8),m=(s-n)*this._whitePoint.a;return Math.sqrt(p+m*m)}_setDefaults(){}},AbstractEuclidean=class extends AbstractDistanceCalculator{calculateRaw(e,t,r,n,a,l,o,s){const h=a-e,f=l-t,u=o-r,d=s-n;return Math.sqrt(this._kR*h*h+this._kG*f*f+this._kB*u*u+this._kA*d*d)}},Euclidean=class extends AbstractEuclidean{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},EuclideanBT709=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},EuclideanBT709NoAlpha=class extends AbstractEuclidean{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=0}},AbstractManhattan=class extends AbstractDistanceCalculator{calculateRaw(e,t,r,n,a,l,o,s){let h=a-e,f=l-t,u=o-r,d=s-n;return h<0&&(h=0-h),f<0&&(f=0-f),u<0&&(u=0-u),d<0&&(d=0-d),this._kR*h+this._kG*f+this._kB*u+this._kA*d}},Manhattan=class extends AbstractManhattan{_setDefaults(){this._kR=1,this._kG=1,this._kB=1,this._kA=1}},ManhattanNommyde=class extends AbstractManhattan{_setDefaults(){this._kR=.4984,this._kG=.8625,this._kB=.2979,this._kA=1}},ManhattanBT709=class extends AbstractManhattan{_setDefaults(){this._kR=.2126,this._kG=.7152,this._kB=.0722,this._kA=1}},PNGQuant=class extends AbstractDistanceCalculator{calculateRaw(e,t,r,n,a,l,o,s){const h=(s-n)*this._whitePoint.a;return this._colordifferenceCh(e*this._whitePoint.r,a*this._whitePoint.r,h)+this._colordifferenceCh(t*this._whitePoint.g,l*this._whitePoint.g,h)+this._colordifferenceCh(r*this._whitePoint.b,o*this._whitePoint.b,h)}_colordifferenceCh(e,t,r){const n=e-t,a=n+r;return n*n+a*a}_setDefaults(){}},palette_exports={};__export(palette_exports,{AbstractPaletteQuantizer:()=>AbstractPaletteQuantizer,ColorHistogram:()=>ColorHistogram,NeuQuant:()=>NeuQuant,NeuQuantFloat:()=>NeuQuantFloat,RGBQuant:()=>RGBQuant,WuColorCube:()=>WuColorCube,WuQuant:()=>WuQuant});var AbstractPaletteQuantizer=class{quantizeSync(){for(const e of this.quantize())if(e.palette)return e.palette;throw new Error("unreachable")}},Point=class{constructor(){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),__publicField(this,"uint32"),__publicField(this,"rgba"),this.uint32=-1>>>0,this.r=this.g=this.b=this.a=0,this.rgba=new Array(4),this.rgba[0]=0,this.rgba[1]=0,this.rgba[2]=0,this.rgba[3]=0}static createByQuadruplet(e){const t=new Point;return t.r=e[0]|0,t.g=e[1]|0,t.b=e[2]|0,t.a=e[3]|0,t._loadUINT32(),t._loadQuadruplet(),t}static createByRGBA(e,t,r,n){const a=new Point;return a.r=e|0,a.g=t|0,a.b=r|0,a.a=n|0,a._loadUINT32(),a._loadQuadruplet(),a}static createByUint32(e){const t=new Point;return t.uint32=e>>>0,t._loadRGBA(),t._loadQuadruplet(),t}from(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this.uint32=e.uint32,this.rgba[0]=e.r,this.rgba[1]=e.g,this.rgba[2]=e.b,this.rgba[3]=e.a}getLuminosity(e){let t=this.r,r=this.g,n=this.b;return e&&(t=Math.min(255,255-this.a+this.a*t/255),r=Math.min(255,255-this.a+this.a*r/255),n=Math.min(255,255-this.a+this.a*n/255)),t*.2126+r*.7152+n*.0722}_loadUINT32(){this.uint32=(this.a<<24|this.b<<16|this.g<<8|this.r)>>>0}_loadRGBA(){this.r=this.uint32&255,this.g=this.uint32>>>8&255,this.b=this.uint32>>>16&255,this.a=this.uint32>>>24&255}_loadQuadruplet(){this.rgba[0]=this.r,this.rgba[1]=this.g,this.rgba[2]=this.b,this.rgba[3]=this.a}},PointContainer=class{constructor(){__publicField(this,"_pointArray"),__publicField(this,"_width"),__publicField(this,"_height"),this._width=0,this._height=0,this._pointArray=[]}getWidth(){return this._width}getHeight(){return this._height}setWidth(e){this._width=e}setHeight(e){this._height=e}getPointArray(){return this._pointArray}clone(){const e=new PointContainer;e._width=this._width,e._height=this._height;for(let t=0,r=this._pointArray.length;t<r;t++)e._pointArray[t]=Point.createByUint32(this._pointArray[t].uint32|0);return e}toUint32Array(){const e=this._pointArray.length,t=new Uint32Array(e);for(let r=0;r<e;r++)t[r]=this._pointArray[r].uint32;return t}toUint8Array(){return new Uint8Array(this.toUint32Array().buffer)}static fromHTMLImageElement(e){const t=e.naturalWidth,r=e.naturalHeight,n=document.createElement("canvas");return n.width=t,n.height=r,n.getContext("2d").drawImage(e,0,0,t,r,0,0,t,r),PointContainer.fromHTMLCanvasElement(n)}static fromHTMLCanvasElement(e){const t=e.width,r=e.height,a=e.getContext("2d").getImageData(0,0,t,r);return PointContainer.fromImageData(a)}static fromImageData(e){const t=e.width,r=e.height;return PointContainer.fromUint8Array(e.data,t,r)}static fromUint8Array(e,t,r){switch(Object.prototype.toString.call(e)){case"[object Uint8ClampedArray]":case"[object Uint8Array]":break;default:e=new Uint8Array(e)}const n=new Uint32Array(e.buffer);return PointContainer.fromUint32Array(n,t,r)}static fromUint32Array(e,t,r){const n=new PointContainer;n._width=t,n._height=r;for(let a=0,l=e.length;a<l;a++)n._pointArray[a]=Point.createByUint32(e[a]|0);return n}static fromBuffer(e,t,r){const n=new Uint32Array(e.buffer,e.byteOffset,e.byteLength/Uint32Array.BYTES_PER_ELEMENT);return PointContainer.fromUint32Array(n,t,r)}},hueGroups=10;function hueGroup(e,t){const n=360/t,a=n/2;for(let l=1,o=n-a;l<t;l++,o+=n)if(e>=o&&e<o+n)return l;return 0}var Palette=class{constructor(){__publicField(this,"_pointContainer"),__publicField(this,"_pointArray",[]),__publicField(this,"_i32idx",{}),this._pointContainer=new PointContainer,this._pointContainer.setHeight(1),this._pointArray=this._pointContainer.getPointArray()}add(e){this._pointArray.push(e),this._pointContainer.setWidth(this._pointArray.length)}has(e){for(let t=this._pointArray.length-1;t>=0;t--)if(e.uint32===this._pointArray[t].uint32)return!0;return!1}getNearestColor(e,t){return this._pointArray[this._getNearestIndex(e,t)|0]}getPointContainer(){return this._pointContainer}_nearestPointFromCache(e){return typeof this._i32idx[e]=="number"?this._i32idx[e]:-1}_getNearestIndex(e,t){let r=this._nearestPointFromCache(""+t.uint32);if(r>=0)return r;let n=Number.MAX_VALUE;r=0;for(let a=0,l=this._pointArray.length;a<l;a++){const o=this._pointArray[a],s=e.calculateRaw(t.r,t.g,t.b,t.a,o.r,o.g,o.b,o.a);s<n&&(n=s,r=a)}return this._i32idx[t.uint32]=r,r}sort(){this._i32idx={},this._pointArray.sort((e,t)=>{const r=rgb2hsl(e.r,e.g,e.b),n=rgb2hsl(t.r,t.g,t.b),a=e.r===e.g&&e.g===e.b?0:1+hueGroup(r.h,hueGroups),o=(t.r===t.g&&t.g===t.b?0:1+hueGroup(n.h,hueGroups))-a;if(o)return-o;const s=e.getLuminosity(!0),h=t.getLuminosity(!0);if(h-s!==0)return h-s;const f=(n.s*100|0)-(r.s*100|0);return f?-f:0})}},utils_exports={};__export(utils_exports,{HueStatistics:()=>HueStatistics,Palette:()=>Palette,Point:()=>Point,PointContainer:()=>PointContainer,ProgressTracker:()=>ProgressTracker,arithmetic:()=>arithmetic_exports});var HueGroup=class{constructor(){__publicField(this,"num",0),__publicField(this,"cols",[])}},HueStatistics=class{constructor(e,t){__publicField(this,"_numGroups"),__publicField(this,"_minCols"),__publicField(this,"_stats"),__publicField(this,"_groupsFull"),this._numGroups=e,this._minCols=t,this._stats=[];for(let r=0;r<=e;r++)this._stats[r]=new HueGroup;this._groupsFull=0}check(e){this._groupsFull===this._numGroups+1&&(this.check=()=>{});const t=e&255,r=e>>>8&255,n=e>>>16&255,a=t===r&&r===n?0:1+hueGroup(rgb2hsl(t,r,n).h,this._numGroups),l=this._stats[a],o=this._minCols;l.num++,!(l.num>o)&&(l.num===o&&this._groupsFull++,l.num<=o&&this._stats[a].cols.push(e))}injectIntoDictionary(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach(r=>{e[r]?e[r]++:e[r]=1})}injectIntoArray(e){for(let t=0;t<=this._numGroups;t++)this._stats[t].num<=this._minCols&&this._stats[t].cols.forEach(r=>{e.indexOf(r)===-1&&e.push(r)})}},_ProgressTracker=class{constructor(e,t){__publicField(this,"progress"),__publicField(this,"_step"),__publicField(this,"_range"),__publicField(this,"_last"),__publicField(this,"_progressRange"),this._range=e,this._progressRange=t,this._step=Math.max(1,this._range/(_ProgressTracker.steps+1)|0),this._last=-this._step,this.progress=0}shouldNotify(e){return e-this._last>=this._step?(this._last=e,this.progress=Math.min(this._progressRange*this._last/this._range,this._progressRange),!0):!1}},ProgressTracker=_ProgressTracker;__publicField(ProgressTracker,"steps",100);var networkBiasShift=3,Neuron=class{constructor(e){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift,this.g>>networkBiasShift,this.b>>networkBiasShift,this.a>>networkBiasShift)}subtract(e,t,r,n){this.r-=e|0,this.g-=t|0,this.b-=r|0,this.a-=n|0}},_NeuQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift,255<<networkBiasShift)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new Neuron((e<<networkBiasShift+8)/this._networkSize|0),this._freq[e]=_NeuQuant._initialBias/this._networkSize|0,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuant._minpicturebytes&&(e=1);const r=30+(e-1)/3|0,n=t/e|0;let a=n/_NeuQuant._nCycles|0,l=_NeuQuant._initAlpha,o=(this._networkSize>>3)*_NeuQuant._radiusBias,s=o>>_NeuQuant._radiusBiasShift;s<=1&&(s=0);for(let u=0;u<s;u++)this._radPower[u]=l*((s*s-u*u)*_NeuQuant._radBias/(s*s))>>>0;let h;t<_NeuQuant._minpicturebytes?h=1:t%_NeuQuant._prime1!==0?h=_NeuQuant._prime1:t%_NeuQuant._prime2!==0?h=_NeuQuant._prime2:t%_NeuQuant._prime3!==0?h=_NeuQuant._prime3:h=_NeuQuant._prime4;const f=new ProgressTracker(n,99);for(let u=0,d=0;u<n;){f.shouldNotify(u)&&(yield{progress:f.progress});const p=this._pointArray[d],m=p.b<<networkBiasShift,A=p.g<<networkBiasShift,k=p.r<<networkBiasShift,I=p.a<<networkBiasShift,B=this._contest(m,A,k,I);if(this._alterSingle(l,B,m,A,k,I),s!==0&&this._alterNeighbour(s,B,m,A,k,I),d+=h,d>=t&&(d-=t),u++,a===0&&(a=1),u%a===0){l-=l/r|0,o-=o/_NeuQuant._radiusDecrease|0,s=o>>_NeuQuant._radiusBiasShift,s<=1&&(s=0);for(let M=0;M<s;M++)this._radPower[M]=l*((s*s-M*M)*_NeuQuant._radBias/(s*s))>>>0}}}_buildPalette(){const e=new Palette;return this._network.forEach(t=>{e.add(t.toPoint())}),e.sort(),e}_alterNeighbour(e,t,r,n,a,l){let o=t-e;o<-1&&(o=-1);let s=t+e;s>this._networkSize&&(s=this._networkSize);let h=t+1,f=t-1,u=1;for(;h<s||f>o;){const d=this._radPower[u++]/_NeuQuant._alphaRadBias;if(h<s){const p=this._network[h++];p.subtract(d*(p.r-a),d*(p.g-n),d*(p.b-r),d*(p.a-l))}if(f>o){const p=this._network[f--];p.subtract(d*(p.r-a),d*(p.g-n),d*(p.b-r),d*(p.a-l))}}}_alterSingle(e,t,r,n,a,l){e/=_NeuQuant._initAlpha;const o=this._network[t];o.subtract(e*(o.r-a),e*(o.g-n),e*(o.b-r),e*(o.a-l))}_contest(e,t,r,n){const a=1020<<networkBiasShift;let l=~(1<<31),o=l,s=-1,h=s;for(let f=0;f<this._networkSize;f++){const u=this._network[f],d=this._distance.calculateNormalized(u,{r,g:t,b:e,a:n})*a|0;d<l&&(l=d,s=f);const p=d-(this._bias[f]>>_NeuQuant._initialBiasShift-networkBiasShift);p<o&&(o=p,h=f);const m=this._freq[f]>>_NeuQuant._betaShift;this._freq[f]-=m,this._bias[f]+=m<<_NeuQuant._gammaShift}return this._freq[s]+=_NeuQuant._beta,this._bias[s]-=_NeuQuant._betaGamma,h}},NeuQuant=_NeuQuant;__publicField(NeuQuant,"_prime1",499);__publicField(NeuQuant,"_prime2",491);__publicField(NeuQuant,"_prime3",487);__publicField(NeuQuant,"_prime4",503);__publicField(NeuQuant,"_minpicturebytes",_NeuQuant._prime4);__publicField(NeuQuant,"_nCycles",100);__publicField(NeuQuant,"_initialBiasShift",16);__publicField(NeuQuant,"_initialBias",1<<_NeuQuant._initialBiasShift);__publicField(NeuQuant,"_gammaShift",10);__publicField(NeuQuant,"_betaShift",10);__publicField(NeuQuant,"_beta",_NeuQuant._initialBias>>_NeuQuant._betaShift);__publicField(NeuQuant,"_betaGamma",_NeuQuant._initialBias<<_NeuQuant._gammaShift-_NeuQuant._betaShift);__publicField(NeuQuant,"_radiusBiasShift",6);__publicField(NeuQuant,"_radiusBias",1<<_NeuQuant._radiusBiasShift);__publicField(NeuQuant,"_radiusDecrease",30);__publicField(NeuQuant,"_alphaBiasShift",10);__publicField(NeuQuant,"_initAlpha",1<<_NeuQuant._alphaBiasShift);__publicField(NeuQuant,"_radBiasShift",8);__publicField(NeuQuant,"_radBias",1<<_NeuQuant._radBiasShift);__publicField(NeuQuant,"_alphaRadBiasShift",_NeuQuant._alphaBiasShift+_NeuQuant._radBiasShift);__publicField(NeuQuant,"_alphaRadBias",1<<_NeuQuant._alphaRadBiasShift);var networkBiasShift2=3,NeuronFloat=class{constructor(e){__publicField(this,"r"),__publicField(this,"g"),__publicField(this,"b"),__publicField(this,"a"),this.r=this.g=this.b=this.a=e}toPoint(){return Point.createByRGBA(this.r>>networkBiasShift2,this.g>>networkBiasShift2,this.b>>networkBiasShift2,this.a>>networkBiasShift2)}subtract(e,t,r,n){this.r-=e,this.g-=t,this.b-=r,this.a-=n}},_NeuQuantFloat=class extends AbstractPaletteQuantizer{constructor(e,t=256){super(),__publicField(this,"_pointArray"),__publicField(this,"_networkSize"),__publicField(this,"_network"),__publicField(this,"_sampleFactor"),__publicField(this,"_radPower"),__publicField(this,"_freq"),__publicField(this,"_bias"),__publicField(this,"_distance"),this._distance=e,this._pointArray=[],this._sampleFactor=1,this._networkSize=t,this._distance.setWhitePoint(255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2,255<<networkBiasShift2)}sample(e){this._pointArray=this._pointArray.concat(e.getPointArray())}*quantize(){this._init(),yield*this._learn(),yield{palette:this._buildPalette(),progress:100}}_init(){this._freq=[],this._bias=[],this._radPower=[],this._network=[];for(let e=0;e<this._networkSize;e++)this._network[e]=new NeuronFloat((e<<networkBiasShift2+8)/this._networkSize),this._freq[e]=_NeuQuantFloat._initialBias/this._networkSize,this._bias[e]=0}*_learn(){let e=this._sampleFactor;const t=this._pointArray.length;t<_NeuQuantFloat._minpicturebytes&&(e=1);const r=30+(e-1)/3,n=t/e;let a=n/_NeuQuantFloat._nCycles|0,l=_NeuQuantFloat._initAlpha,o=(this._networkSize>>3)*_NeuQuantFloat._radiusBias,s=o>>_NeuQuantFloat._radiusBiasShift;s<=1&&(s=0);for(let u=0;u<s;u++)this._radPower[u]=l*((s*s-u*u)*_NeuQuantFloat._radBias/(s*s));let h;t<_NeuQuantFloat._minpicturebytes?h=1:t%_NeuQuantFloat._prime1!==0?h=_NeuQuantFloat._prime1:t%_NeuQuantFloat._prime2!==0?h=_NeuQuantFloat._prime2:t%_NeuQuantFloat._prime3!==0?h=_NeuQuantFloat._prime3:h=_NeuQuantFloat._prime4;const f=new ProgressTracker(n,99);for(let u=0,d=0;u<n;){f.shouldNotify(u)&&(yield{progress:f.progress});const p=this._pointArray[d],m=p.b<<networkBiasShift2,A=p.g<<networkBiasShift2,k=p.r<<networkBiasShift2,I=p.a<<networkBiasShift2,B=this._contest(m,A,k,I);if(this._alterSingle(l,B,m,A,k,I),s!==0&&this._alterNeighbour(s,B,m,A,k,I),d+=h,d>=t&&(d-=t),u++,a===0&&(a=1),u%a===0){l-=l/r,o-=o/_NeuQuantFloat._radiusDecrease,s=o>>_NeuQuantFloat._radiusBiasShift,s<=1&&(s=0);for(let M=0;M<s;M++)this._radPower[M]=l*((s*s-M*M)*_NeuQuantFloat._radBias/(s*s))}}}_buildPalette(){const e=new Palette;return this._network.forEach(t=>{e.add(t.toPoint())}),e.sort(),e}_alterNeighbour(e,t,r,n,a,l){let o=t-e;o<-1&&(o=-1);let s=t+e;s>this._networkSize&&(s=this._networkSize);let h=t+1,f=t-1,u=1;for(;h<s||f>o;){const d=this._radPower[u++]/_NeuQuantFloat._alphaRadBias;if(h<s){const p=this._network[h++];p.subtract(d*(p.r-a),d*(p.g-n),d*(p.b-r),d*(p.a-l))}if(f>o){const p=this._network[f--];p.subtract(d*(p.r-a),d*(p.g-n),d*(p.b-r),d*(p.a-l))}}}_alterSingle(e,t,r,n,a,l){e/=_NeuQuantFloat._initAlpha;const o=this._network[t];o.subtract(e*(o.r-a),e*(o.g-n),e*(o.b-r),e*(o.a-l))}_contest(e,t,r,n){const a=1020<<networkBiasShift2;let l=~(1<<31),o=l,s=-1,h=s;for(let f=0;f<this._networkSize;f++){const u=this._network[f],d=this._distance.calculateNormalized(u,{r,g:t,b:e,a:n})*a;d<l&&(l=d,s=f);const p=d-(this._bias[f]>>_NeuQuantFloat._initialBiasShift-networkBiasShift2);p<o&&(o=p,h=f);const m=this._freq[f]>>_NeuQuantFloat._betaShift;this._freq[f]-=m,this._bias[f]+=m<<_NeuQuantFloat._gammaShift}return this._freq[s]+=_NeuQuantFloat._beta,this._bias[s]-=_NeuQuantFloat._betaGamma,h}},NeuQuantFloat=_NeuQuantFloat;__publicField(NeuQuantFloat,"_prime1",499);__publicField(NeuQuantFloat,"_prime2",491);__publicField(NeuQuantFloat,"_prime3",487);__publicField(NeuQuantFloat,"_prime4",503);__publicField(NeuQuantFloat,"_minpicturebytes",_NeuQuantFloat._prime4);__publicField(NeuQuantFloat,"_nCycles",100);__publicField(NeuQuantFloat,"_initialBiasShift",16);__publicField(NeuQuantFloat,"_initialBias",1<<_NeuQuantFloat._initialBiasShift);__publicField(NeuQuantFloat,"_gammaShift",10);__publicField(NeuQuantFloat,"_betaShift",10);__publicField(NeuQuantFloat,"_beta",_NeuQuantFloat._initialBias>>_NeuQuantFloat._betaShift);__publicField(NeuQuantFloat,"_betaGamma",_NeuQuantFloat._initialBias<<_NeuQuantFloat._gammaShift-_NeuQuantFloat._betaShift);__publicField(NeuQuantFloat,"_radiusBiasShift",6);__publicField(NeuQuantFloat,"_radiusBias",1<<_NeuQuantFloat._radiusBiasShift);__publicField(NeuQuantFloat,"_radiusDecrease",30);__publicField(NeuQuantFloat,"_alphaBiasShift",10);__publicField(NeuQuantFloat,"_initAlpha",1<<_NeuQuantFloat._alphaBiasShift);__publicField(NeuQuantFloat,"_radBiasShift",8);__publicField(NeuQuantFloat,"_radBias",1<<_NeuQuantFloat._radBiasShift);__publicField(NeuQuantFloat,"_alphaRadBiasShift",_NeuQuantFloat._alphaBiasShift+_NeuQuantFloat._radBiasShift);__publicField(NeuQuantFloat,"_alphaRadBias",1<<_NeuQuantFloat._alphaRadBiasShift);var _ColorHistogram=class{constructor(e,t){__publicField(this,"_method"),__publicField(this,"_hueStats"),__publicField(this,"_histogram"),__publicField(this,"_initColors"),__publicField(this,"_minHueCols"),this._method=e,this._minHueCols=t<<2,this._initColors=t<<2,this._hueStats=new HueStatistics(_ColorHistogram._hueGroups,this._minHueCols),this._histogram=Object.create(null)}sample(e){switch(this._method){case 1:this._colorStats1D(e);break;case 2:this._colorStats2D(e);break}}getImportanceSortedColorsIDXI32(){const e=stableSort(Object.keys(this._histogram),(r,n)=>this._histogram[n]-this._histogram[r]);if(e.length===0)return[];let t;switch(this._method){case 1:const r=Math.min(e.length,this._initColors),n=e[r-1],a=this._histogram[n];t=e.slice(0,r);let l=r;const o=e.length;for(;l<o&&this._histogram[e[l]]===a;)t.push(e[l++]);this._hueStats.injectIntoArray(t);break;case 2:t=e;break;default:throw new Error("Incorrect method")}return t.map(r=>+r)}_colorStats1D(e){const t=this._histogram,r=e.getPointArray(),n=r.length;for(let a=0;a<n;a++){const l=r[a].uint32;this._hueStats.check(l),l in t?t[l]++:t[l]=1}}_colorStats2D(e){const t=e.getWidth(),r=e.getHeight(),n=e.getPointArray(),a=_ColorHistogram._boxSize[0],l=_ColorHistogram._boxSize[1],o=a*l,s=this._makeBoxes(t,r,a,l),h=this._histogram;s.forEach(f=>{let u=Math.round(f.w*f.h/o)*_ColorHistogram._boxPixels;u<2&&(u=2);const d={};this._iterateBox(f,t,p=>{const m=n[p].uint32;this._hueStats.check(m),m in h?h[m]++:m in d?++d[m]>=u&&(h[m]=d[m]):d[m]=1})}),this._hueStats.injectIntoDictionary(h)}_iterateBox(e,t,r){const n=e,a=n.y*t+n.x,l=(n.y+n.h-1)*t+(n.x+n.w-1),o=t-n.w+1;let s=0,h=a;do r.call(this,h),h+=++s%n.w===0?o:1;while(h<=l)}_makeBoxes(e,t,r,n){const a=e%r,l=t%n,o=e-a,s=t-l,h=[];for(let f=0;f<t;f+=n)for(let u=0;u<e;u+=r)h.push({x:u,y:f,w:u===o?a:r,h:f===s?l:n});return h}},ColorHistogram=_ColorHistogram;__publicField(ColorHistogram,"_boxSize",[64,64]);__publicField(ColorHistogram,"_boxPixels",2);__publicField(ColorHistogram,"_hueGroups",10);var RemovedColor=class{constructor(e,t,r){__publicField(this,"index"),__publicField(this,"color"),__publicField(this,"distance"),this.index=e,this.color=t,this.distance=r}},RGBQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256,r=2){super(),__publicField(this,"_colors"),__publicField(this,"_initialDistance"),__publicField(this,"_distanceIncrement"),__publicField(this,"_histogram"),__publicField(this,"_distance"),this._distance=e,this._colors=t,this._histogram=new ColorHistogram(r,t),this._initialDistance=.01,this._distanceIncrement=.005}sample(e){this._histogram.sample(e)}*quantize(){const e=this._histogram.getImportanceSortedColorsIDXI32();if(e.length===0)throw new Error("No colors in image");yield*this._buildPalette(e)}*_buildPalette(e){const t=new Palette,r=t.getPointContainer().getPointArray(),n=new Array(e.length);for(let u=0;u<e.length;u++)r.push(Point.createByUint32(e[u])),n[u]=1;const a=r.length,l=[];let o=a,s=this._initialDistance;const h=new ProgressTracker(o-this._colors,99);for(;o>this._colors;){l.length=0;for(let u=0;u<a;u++){if(h.shouldNotify(a-o)&&(yield{progress:h.progress}),n[u]===0)continue;const d=r[u];for(let p=u+1;p<a;p++){if(n[p]===0)continue;const m=r[p],A=this._distance.calculateNormalized(d,m);A<s&&(l.push(new RemovedColor(p,m,A)),n[p]=0,o--)}}s+=o>this._colors*3?this._initialDistance:this._distanceIncrement}if(o<this._colors){stableSort(l,(d,p)=>p.distance-d.distance);let u=0;for(;o<this._colors&&u<l.length;){const d=l[u];n[d.index]=1,o++,u++}}let f=r.length;for(let u=f-1;u>=0;u--)n[u]===0&&(u!==f-1&&(r[u]=r[f-1]),--f);r.length=f,t.sort(),yield{palette:t,progress:100}}};function createArray1D(e){const t=[];for(let r=0;r<e;r++)t[r]=0;return t}function createArray4D(e,t,r,n){const a=new Array(e);for(let l=0;l<e;l++){a[l]=new Array(t);for(let o=0;o<t;o++){a[l][o]=new Array(r);for(let s=0;s<r;s++){a[l][o][s]=new Array(n);for(let h=0;h<n;h++)a[l][o][s][h]=0}}}return a}function createArray3D(e,t,r){const n=new Array(e);for(let a=0;a<e;a++){n[a]=new Array(t);for(let l=0;l<t;l++){n[a][l]=new Array(r);for(let o=0;o<r;o++)n[a][l][o]=0}}return n}function fillArray3D(e,t,r,n,a){for(let l=0;l<t;l++){e[l]=[];for(let o=0;o<r;o++){e[l][o]=[];for(let s=0;s<n;s++)e[l][o][s]=a}}}function fillArray1D(e,t,r){for(let n=0;n<t;n++)e[n]=r}var WuColorCube=class{constructor(){__publicField(this,"redMinimum"),__publicField(this,"redMaximum"),__publicField(this,"greenMinimum"),__publicField(this,"greenMaximum"),__publicField(this,"blueMinimum"),__publicField(this,"blueMaximum"),__publicField(this,"volume"),__publicField(this,"alphaMinimum"),__publicField(this,"alphaMaximum")}},_WuQuant=class extends AbstractPaletteQuantizer{constructor(e,t=256,r=5){super(),__publicField(this,"_reds"),__publicField(this,"_greens"),__publicField(this,"_blues"),__publicField(this,"_alphas"),__publicField(this,"_sums"),__publicField(this,"_weights"),__publicField(this,"_momentsRed"),__publicField(this,"_momentsGreen"),__publicField(this,"_momentsBlue"),__publicField(this,"_momentsAlpha"),__publicField(this,"_moments"),__publicField(this,"_table"),__publicField(this,"_pixels"),__publicField(this,"_cubes"),__publicField(this,"_colors"),__publicField(this,"_significantBitsPerChannel"),__publicField(this,"_maxSideIndex"),__publicField(this,"_alphaMaxSideIndex"),__publicField(this,"_sideSize"),__publicField(this,"_alphaSideSize"),__publicField(this,"_distance"),this._distance=e,this._setQuality(r),this._initialize(t)}sample(e){const t=e.getPointArray();for(let r=0,n=t.length;r<n;r++)this._addColor(t[r]);this._pixels=this._pixels.concat(t)}*quantize(){yield*this._preparePalette();const e=new Palette;for(let t=0;t<this._colors;t++)if(this._sums[t]>0){const r=this._sums[t],n=this._reds[t]/r,a=this._greens[t]/r,l=this._blues[t]/r,o=this._alphas[t]/r,s=Point.createByRGBA(n|0,a|0,l|0,o|0);e.add(s)}e.sort(),yield{palette:e,progress:100}}*_preparePalette(){yield*this._calculateMoments();let e=0;const t=createArray1D(this._colors);for(let o=1;o<this._colors;++o){this._cut(this._cubes[e],this._cubes[o])?(t[e]=this._cubes[e].volume>1?this._calculateVariance(this._cubes[e]):0,t[o]=this._cubes[o].volume>1?this._calculateVariance(this._cubes[o]):0):(t[e]=0,o--),e=0;let s=t[0];for(let h=1;h<=o;++h)t[h]>s&&(s=t[h],e=h);if(s<=0){this._colors=o+1;break}}const r=[],n=[],a=[],l=[];for(let o=0;o<this._colors;++o){const s=_WuQuant._volume(this._cubes[o],this._weights);s>0?(r[o]=_WuQuant._volume(this._cubes[o],this._momentsRed)/s|0,n[o]=_WuQuant._volume(this._cubes[o],this._momentsGreen)/s|0,a[o]=_WuQuant._volume(this._cubes[o],this._momentsBlue)/s|0,l[o]=_WuQuant._volume(this._cubes[o],this._momentsAlpha)/s|0):(r[o]=0,n[o]=0,a[o]=0,l[o]=0)}this._reds=createArray1D(this._colors+1),this._greens=createArray1D(this._colors+1),this._blues=createArray1D(this._colors+1),this._alphas=createArray1D(this._colors+1),this._sums=createArray1D(this._colors+1);for(let o=0,s=this._pixels.length;o<s;o++){const h=this._pixels[o];let u=-1,d=Number.MAX_VALUE;for(let p=0;p<this._colors;p++){const m=r[p],A=n[p],k=a[p],I=l[p],B=this._distance.calculateRaw(m,A,k,I,h.r,h.g,h.b,h.a);B<d&&(d=B,u=p)}this._reds[u]+=h.r,this._greens[u]+=h.g,this._blues[u]+=h.b,this._alphas[u]+=h.a,this._sums[u]++}}_addColor(e){const t=8-this._significantBitsPerChannel,r=(e.r>>t)+1,n=(e.g>>t)+1,a=(e.b>>t)+1,l=(e.a>>t)+1;this._weights[l][r][n][a]++,this._momentsRed[l][r][n][a]+=e.r,this._momentsGreen[l][r][n][a]+=e.g,this._momentsBlue[l][r][n][a]+=e.b,this._momentsAlpha[l][r][n][a]+=e.a,this._moments[l][r][n][a]+=this._table[e.r]+this._table[e.g]+this._table[e.b]+this._table[e.a]}*_calculateMoments(){const e=[],t=[],r=[],n=[],a=[],l=[],o=createArray3D(this._sideSize,this._sideSize,this._sideSize),s=createArray3D(this._sideSize,this._sideSize,this._sideSize),h=createArray3D(this._sideSize,this._sideSize,this._sideSize),f=createArray3D(this._sideSize,this._sideSize,this._sideSize),u=createArray3D(this._sideSize,this._sideSize,this._sideSize),d=createArray3D(this._sideSize,this._sideSize,this._sideSize);let p=0;const m=new ProgressTracker(this._alphaMaxSideIndex*this._maxSideIndex,99);for(let A=1;A<=this._alphaMaxSideIndex;++A){fillArray3D(o,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(s,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(h,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(f,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(u,this._sideSize,this._sideSize,this._sideSize,0),fillArray3D(d,this._sideSize,this._sideSize,this._sideSize,0);for(let k=1;k<=this._maxSideIndex;++k,++p){m.shouldNotify(p)&&(yield{progress:m.progress}),fillArray1D(e,this._sideSize,0),fillArray1D(t,this._sideSize,0),fillArray1D(r,this._sideSize,0),fillArray1D(n,this._sideSize,0),fillArray1D(a,this._sideSize,0),fillArray1D(l,this._sideSize,0);for(let I=1;I<=this._maxSideIndex;++I){let B=0,M=0,T=0,U=0,C=0,w=0;for(let E=1;E<=this._maxSideIndex;++E)B+=this._weights[A][k][I][E],M+=this._momentsRed[A][k][I][E],T+=this._momentsGreen[A][k][I][E],U+=this._momentsBlue[A][k][I][E],C+=this._momentsAlpha[A][k][I][E],w+=this._moments[A][k][I][E],e[E]+=B,t[E]+=M,r[E]+=T,n[E]+=U,a[E]+=C,l[E]+=w,o[k][I][E]=o[k-1][I][E]+e[E],s[k][I][E]=s[k-1][I][E]+t[E],h[k][I][E]=h[k-1][I][E]+r[E],f[k][I][E]=f[k-1][I][E]+n[E],u[k][I][E]=u[k-1][I][E]+a[E],d[k][I][E]=d[k-1][I][E]+l[E],this._weights[A][k][I][E]=this._weights[A-1][k][I][E]+o[k][I][E],this._momentsRed[A][k][I][E]=this._momentsRed[A-1][k][I][E]+s[k][I][E],this._momentsGreen[A][k][I][E]=this._momentsGreen[A-1][k][I][E]+h[k][I][E],this._momentsBlue[A][k][I][E]=this._momentsBlue[A-1][k][I][E]+f[k][I][E],this._momentsAlpha[A][k][I][E]=this._momentsAlpha[A-1][k][I][E]+u[k][I][E],this._moments[A][k][I][E]=this._moments[A-1][k][I][E]+d[k][I][E]}}}}static _volumeFloat(e,t){return t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMaximum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(t[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]-t[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+t[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-t[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]+t[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-t[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum])}static _volume(e,t){return _WuQuant._volumeFloat(e,t)|0}static _top(e,t,r,n){let a;switch(t){case _WuQuant._alpha:a=n[r][e.redMaximum][e.greenMaximum][e.blueMaximum]-n[r][e.redMaximum][e.greenMinimum][e.blueMaximum]-n[r][e.redMinimum][e.greenMaximum][e.blueMaximum]+n[r][e.redMinimum][e.greenMinimum][e.blueMaximum]-(n[r][e.redMaximum][e.greenMaximum][e.blueMinimum]-n[r][e.redMaximum][e.greenMinimum][e.blueMinimum]-n[r][e.redMinimum][e.greenMaximum][e.blueMinimum]+n[r][e.redMinimum][e.greenMinimum][e.blueMinimum]);break;case _WuQuant._red:a=n[e.alphaMaximum][r][e.greenMaximum][e.blueMaximum]-n[e.alphaMaximum][r][e.greenMinimum][e.blueMaximum]-n[e.alphaMinimum][r][e.greenMaximum][e.blueMaximum]+n[e.alphaMinimum][r][e.greenMinimum][e.blueMaximum]-(n[e.alphaMaximum][r][e.greenMaximum][e.blueMinimum]-n[e.alphaMaximum][r][e.greenMinimum][e.blueMinimum]-n[e.alphaMinimum][r][e.greenMaximum][e.blueMinimum]+n[e.alphaMinimum][r][e.greenMinimum][e.blueMinimum]);break;case _WuQuant._green:a=n[e.alphaMaximum][e.redMaximum][r][e.blueMaximum]-n[e.alphaMaximum][e.redMinimum][r][e.blueMaximum]-n[e.alphaMinimum][e.redMaximum][r][e.blueMaximum]+n[e.alphaMinimum][e.redMinimum][r][e.blueMaximum]-(n[e.alphaMaximum][e.redMaximum][r][e.blueMinimum]-n[e.alphaMaximum][e.redMinimum][r][e.blueMinimum]-n[e.alphaMinimum][e.redMaximum][r][e.blueMinimum]+n[e.alphaMinimum][e.redMinimum][r][e.blueMinimum]);break;case _WuQuant._blue:a=n[e.alphaMaximum][e.redMaximum][e.greenMaximum][r]-n[e.alphaMaximum][e.redMaximum][e.greenMinimum][r]-n[e.alphaMaximum][e.redMinimum][e.greenMaximum][r]+n[e.alphaMaximum][e.redMinimum][e.greenMinimum][r]-(n[e.alphaMinimum][e.redMaximum][e.greenMaximum][r]-n[e.alphaMinimum][e.redMaximum][e.greenMinimum][r]-n[e.alphaMinimum][e.redMinimum][e.greenMaximum][r]+n[e.alphaMinimum][e.redMinimum][e.greenMinimum][r]);break;default:throw new Error("impossible")}return a|0}static _bottom(e,t,r){switch(t){case _WuQuant._alpha:return-r[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMaximum]+r[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]+r[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-r[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+r[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+r[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._red:return-r[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMaximum]+r[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+r[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMaximum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-r[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]+r[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+r[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._green:return-r[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMaximum]+r[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMaximum]+r[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMaximum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMaximum]-(-r[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+r[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]+r[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);case _WuQuant._blue:return-r[e.alphaMaximum][e.redMaximum][e.greenMaximum][e.blueMinimum]+r[e.alphaMaximum][e.redMaximum][e.greenMinimum][e.blueMinimum]+r[e.alphaMaximum][e.redMinimum][e.greenMaximum][e.blueMinimum]-r[e.alphaMaximum][e.redMinimum][e.greenMinimum][e.blueMinimum]-(-r[e.alphaMinimum][e.redMaximum][e.greenMaximum][e.blueMinimum]+r[e.alphaMinimum][e.redMaximum][e.greenMinimum][e.blueMinimum]+r[e.alphaMinimum][e.redMinimum][e.greenMaximum][e.blueMinimum]-r[e.alphaMinimum][e.redMinimum][e.greenMinimum][e.blueMinimum]);default:return 0}}_calculateVariance(e){const t=_WuQuant._volume(e,this._momentsRed),r=_WuQuant._volume(e,this._momentsGreen),n=_WuQuant._volume(e,this._momentsBlue),a=_WuQuant._volume(e,this._momentsAlpha),l=_WuQuant._volumeFloat(e,this._moments),o=_WuQuant._volume(e,this._weights),s=t*t+r*r+n*n+a*a;return l-s/o}_maximize(e,t,r,n,a,l,o,s,h){const f=_WuQuant._bottom(e,t,this._momentsRed)|0,u=_WuQuant._bottom(e,t,this._momentsGreen)|0,d=_WuQuant._bottom(e,t,this._momentsBlue)|0,p=_WuQuant._bottom(e,t,this._momentsAlpha)|0,m=_WuQuant._bottom(e,t,this._weights)|0;let A=0,k=-1;for(let I=r;I<n;++I){let B=f+_WuQuant._top(e,t,I,this._momentsRed),M=u+_WuQuant._top(e,t,I,this._momentsGreen),T=d+_WuQuant._top(e,t,I,this._momentsBlue),U=p+_WuQuant._top(e,t,I,this._momentsAlpha),C=m+_WuQuant._top(e,t,I,this._weights);if(C!==0){let w=B*B+M*M+T*T+U*U,E=w/C;B=a-B,M=l-M,T=o-T,U=s-U,C=h-C,C!==0&&(w=B*B+M*M+T*T+U*U,E+=w/C,E>A&&(A=E,k=I))}}return{max:A,position:k}}_cut(e,t){let r;const n=_WuQuant._volume(e,this._momentsRed),a=_WuQuant._volume(e,this._momentsGreen),l=_WuQuant._volume(e,this._momentsBlue),o=_WuQuant._volume(e,this._momentsAlpha),s=_WuQuant._volume(e,this._weights),h=this._maximize(e,_WuQuant._red,e.redMinimum+1,e.redMaximum,n,a,l,o,s),f=this._maximize(e,_WuQuant._green,e.greenMinimum+1,e.greenMaximum,n,a,l,o,s),u=this._maximize(e,_WuQuant._blue,e.blueMinimum+1,e.blueMaximum,n,a,l,o,s),d=this._maximize(e,_WuQuant._alpha,e.alphaMinimum+1,e.alphaMaximum,n,a,l,o,s);if(d.max>=h.max&&d.max>=f.max&&d.max>=u.max){if(r=_WuQuant._alpha,d.position<0)return!1}else h.max>=d.max&&h.max>=f.max&&h.max>=u.max?r=_WuQuant._red:f.max>=d.max&&f.max>=h.max&&f.max>=u.max?r=_WuQuant._green:r=_WuQuant._blue;switch(t.redMaximum=e.redMaximum,t.greenMaximum=e.greenMaximum,t.blueMaximum=e.blueMaximum,t.alphaMaximum=e.alphaMaximum,r){case _WuQuant._red:t.redMinimum=e.redMaximum=h.position,t.greenMinimum=e.greenMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._green:t.greenMinimum=e.greenMaximum=f.position,t.redMinimum=e.redMinimum,t.blueMinimum=e.blueMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._blue:t.blueMinimum=e.blueMaximum=u.position,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum,t.alphaMinimum=e.alphaMinimum;break;case _WuQuant._alpha:t.alphaMinimum=e.alphaMaximum=d.position,t.blueMinimum=e.blueMinimum,t.redMinimum=e.redMinimum,t.greenMinimum=e.greenMinimum;break}return e.volume=(e.redMaximum-e.redMinimum)*(e.greenMaximum-e.greenMinimum)*(e.blueMaximum-e.blueMinimum)*(e.alphaMaximum-e.alphaMinimum),t.volume=(t.redMaximum-t.redMinimum)*(t.greenMaximum-t.greenMinimum)*(t.blueMaximum-t.blueMinimum)*(t.alphaMaximum-t.alphaMinimum),!0}_initialize(e){this._colors=e,this._cubes=[];for(let t=0;t<e;t++)this._cubes[t]=new WuColorCube;this._cubes[0].redMinimum=0,this._cubes[0].greenMinimum=0,this._cubes[0].blueMinimum=0,this._cubes[0].alphaMinimum=0,this._cubes[0].redMaximum=this._maxSideIndex,this._cubes[0].greenMaximum=this._maxSideIndex,this._cubes[0].blueMaximum=this._maxSideIndex,this._cubes[0].alphaMaximum=this._alphaMaxSideIndex,this._weights=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsRed=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsGreen=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsBlue=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._momentsAlpha=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._moments=createArray4D(this._alphaSideSize,this._sideSize,this._sideSize,this._sideSize),this._table=[];for(let t=0;t<256;++t)this._table[t]=t*t;this._pixels=[]}_setQuality(e=5){this._significantBitsPerChannel=e,this._maxSideIndex=1<<this._significantBitsPerChannel,this._alphaMaxSideIndex=this._maxSideIndex,this._sideSize=this._maxSideIndex+1,this._alphaSideSize=this._alphaMaxSideIndex+1}},WuQuant=_WuQuant;__publicField(WuQuant,"_alpha",3);__publicField(WuQuant,"_red",2);__publicField(WuQuant,"_green",1);__publicField(WuQuant,"_blue",0);var image_exports={};__export(image_exports,{AbstractImageQuantizer:()=>AbstractImageQuantizer,ErrorDiffusionArray:()=>ErrorDiffusionArray,ErrorDiffusionArrayKernel:()=>ErrorDiffusionArrayKernel,ErrorDiffusionRiemersma:()=>ErrorDiffusionRiemersma,NearestColor:()=>NearestColor});var AbstractImageQuantizer=class{quantizeSync(e,t){for(const r of this.quantize(e,t))if(r.pointContainer)return r.pointContainer;throw new Error("unreachable")}},NearestColor=class extends AbstractImageQuantizer{constructor(e){super(),__publicField(this,"_distance"),this._distance=e}*quantize(e,t){const r=e.getPointArray(),n=e.getWidth(),a=e.getHeight(),l=new ProgressTracker(a,99);for(let o=0;o<a;o++){l.shouldNotify(o)&&(yield{progress:l.progress});for(let s=0,h=o*n;s<n;s++,h++){const f=r[h];f.from(t.getNearestColor(this._distance,f))}}yield{pointContainer:e,progress:100}}},ErrorDiffusionArrayKernel=(e=>(e[e.FloydSteinberg=0]="FloydSteinberg",e[e.FalseFloydSteinberg=1]="FalseFloydSteinberg",e[e.Stucki=2]="Stucki",e[e.Atkinson=3]="Atkinson",e[e.Jarvis=4]="Jarvis",e[e.Burkes=5]="Burkes",e[e.Sierra=6]="Sierra",e[e.TwoSierra=7]="TwoSierra",e[e.SierraLite=8]="SierraLite",e))(ErrorDiffusionArrayKernel||{}),ErrorDiffusionArray=class extends AbstractImageQuantizer{constructor(e,t,r=!0,n=0,a=!1){super(),__publicField(this,"_minColorDistance"),__publicField(this,"_serpentine"),__publicField(this,"_kernel"),__publicField(this,"_calculateErrorLikeGIMP"),__publicField(this,"_distance"),this._setKernel(t),this._distance=e,this._minColorDistance=n,this._serpentine=r,this._calculateErrorLikeGIMP=a}*quantize(e,t){const r=e.getPointArray(),n=new Point,a=e.getWidth(),l=e.getHeight(),o=[];let s=1,h=1;for(const u of this._kernel){const d=u[2]+1;h<d&&(h=d)}for(let u=0;u<h;u++)this._fillErrorLine(o[u]=[],a);const f=new ProgressTracker(l,99);for(let u=0;u<l;u++){f.shouldNotify(u)&&(yield{progress:f.progress}),this._serpentine&&(s*=-1);const d=u*a,p=s===1?0:a-1,m=s===1?a:-1;this._fillErrorLine(o[0],a),o.push(o.shift());const A=o[0];for(let k=p,I=d+p;k!==m;k+=s,I+=s){const B=r[I],M=A[k];n.from(B);const T=Point.createByRGBA(inRange0to255Rounded(B.r+M[0]),inRange0to255Rounded(B.g+M[1]),inRange0to255Rounded(B.b+M[2]),inRange0to255Rounded(B.a+M[3])),U=t.getNearestColor(this._distance,T);if(B.from(U),this._minColorDistance&&this._distance.calculateNormalized(n,U)<this._minColorDistance)continue;let C,w,E,S;this._calculateErrorLikeGIMP?(C=T.r-U.r,w=T.g-U.g,E=T.b-U.b,S=T.a-U.a):(C=n.r-U.r,w=n.g-U.g,E=n.b-U.b,S=n.a-U.a);const $=s===1?0:this._kernel.length-1,G=s===1?this._kernel.length:-1;for(let L=$;L!==G;L+=s){const O=this._kernel[L][1]*s,z=this._kernel[L][2];if(O+k>=0&&O+k<a&&z+u>=0&&z+u<l){const H=this._kernel[L][0],Q=o[z][O+k];Q[0]+=C*H,Q[1]+=w*H,Q[2]+=E*H,Q[3]+=S*H}}}}yield{pointContainer:e,progress:100}}_fillErrorLine(e,t){e.length>t&&(e.length=t);const r=e.length;for(let n=0;n<r;n++){const a=e[n];a[0]=a[1]=a[2]=a[3]=0}for(let n=r;n<t;n++)e[n]=[0,0,0,0]}_setKernel(e){switch(e){case 0:this._kernel=[[7/16,1,0],[3/16,-1,1],[5/16,0,1],[1/16,1,1]];break;case 1:this._kernel=[[3/8,1,0],[3/8,0,1],[2/8,1,1]];break;case 2:this._kernel=[[8/42,1,0],[4/42,2,0],[2/42,-2,1],[4/42,-1,1],[8/42,0,1],[4/42,1,1],[2/42,2,1],[1/42,-2,2],[2/42,-1,2],[4/42,0,2],[2/42,1,2],[1/42,2,2]];break;case 3:this._kernel=[[1/8,1,0],[1/8,2,0],[1/8,-1,1],[1/8,0,1],[1/8,1,1],[1/8,0,2]];break;case 4:this._kernel=[[7/48,1,0],[5/48,2,0],[3/48,-2,1],[5/48,-1,1],[7/48,0,1],[5/48,1,1],[3/48,2,1],[1/48,-2,2],[3/48,-1,2],[5/48,0,2],[3/48,1,2],[1/48,2,2]];break;case 5:this._kernel=[[8/32,1,0],[4/32,2,0],[2/32,-2,1],[4/32,-1,1],[8/32,0,1],[4/32,1,1],[2/32,2,1]];break;case 6:this._kernel=[[5/32,1,0],[3/32,2,0],[2/32,-2,1],[4/32,-1,1],[5/32,0,1],[4/32,1,1],[2/32,2,1],[2/32,-1,2],[3/32,0,2],[2/32,1,2]];break;case 7:this._kernel=[[4/16,1,0],[3/16,2,0],[1/16,-2,1],[2/16,-1,1],[3/16,0,1],[2/16,1,1],[1/16,2,1]];break;case 8:this._kernel=[[2/4,1,0],[1/4,-1,1],[1/4,0,1]];break;default:throw new Error(`ErrorDiffusionArray: unknown kernel = ${e}`)}}};function*hilbertCurve(e,t,r){const n=Math.max(e,t),a=Math.floor(Math.log(n)/Math.log(2)+1),l=new ProgressTracker(e*t,99),o={width:e,height:t,level:a,callback:r,tracker:l,index:0,x:0,y:0};yield*walkHilbert(o,1),visit(o,0)}function*walkHilbert(e,t){if(!(e.level<1)){switch(e.tracker.shouldNotify(e.index)&&(yield{progress:e.tracker.progress}),e.level--,t){case 2:yield*walkHilbert(e,1),visit(e,3),yield*walkHilbert(e,2),visit(e,4),yield*walkHilbert(e,2),visit(e,2),yield*walkHilbert(e,4);break;case 3:yield*walkHilbert(e,4),visit(e,2),yield*walkHilbert(e,3),visit(e,1),yield*walkHilbert(e,3),visit(e,3),yield*walkHilbert(e,1);break;case 1:yield*walkHilbert(e,2),visit(e,4),yield*walkHilbert(e,1),visit(e,3),yield*walkHilbert(e,1),visit(e,1),yield*walkHilbert(e,3);break;case 4:yield*walkHilbert(e,3),visit(e,1),yield*walkHilbert(e,4),visit(e,2),yield*walkHilbert(e,4),visit(e,4),yield*walkHilbert(e,2);break}e.level++}}function visit(e,t){switch(e.x>=0&&e.x<e.width&&e.y>=0&&e.y<e.height&&(e.callback(e.x,e.y),e.index++),t){case 2:e.x--;break;case 3:e.x++;break;case 1:e.y--;break;case 4:e.y++;break}}var ErrorDiffusionRiemersma=class extends AbstractImageQuantizer{constructor(e,t=16,r=1){super(),__publicField(this,"_distance"),__publicField(this,"_weights"),__publicField(this,"_errorQueueSize"),this._distance=e,this._errorQueueSize=t,this._weights=ErrorDiffusionRiemersma._createWeights(r,t)}*quantize(e,t){const r=e.getPointArray(),n=e.getWidth(),a=e.getHeight(),l=[];let o=0;for(let s=0;s<this._errorQueueSize;s++)l[s]={r:0,g:0,b:0,a:0};yield*hilbertCurve(n,a,(s,h)=>{const f=r[s+h*n];let{r:u,g:d,b:p,a:m}=f;for(let B=0;B<this._errorQueueSize;B++){const M=this._weights[B],T=l[(B+o)%this._errorQueueSize];u+=T.r*M,d+=T.g*M,p+=T.b*M,m+=T.a*M}const A=Point.createByRGBA(inRange0to255Rounded(u),inRange0to255Rounded(d),inRange0to255Rounded(p),inRange0to255Rounded(m)),k=t.getNearestColor(this._distance,A);o=(o+1)%this._errorQueueSize;const I=(o+this._errorQueueSize-1)%this._errorQueueSize;l[I].r=f.r-k.r,l[I].g=f.g-k.g,l[I].b=f.b-k.b,l[I].a=f.a-k.a,f.from(k)}),yield{pointContainer:e,progress:100}}static _createWeights(e,t){const r=[],n=Math.exp(Math.log(t)/(t-1));for(let a=0,l=1;a<t;a++)r[a]=(l+.5|0)/t*e,l*=n;return r}},quality_exports={};__export(quality_exports,{ssim:()=>ssim});var K1=.01,K2=.03;function ssim(e,t){if(e.getHeight()!==t.getHeight()||e.getWidth()!==t.getWidth())throw new Error("Images have different sizes!");const n=(1<<8)-1,a=(K1*n)**2,l=(K2*n)**2;let o=0,s=0;return iterate(e,t,(h,f,u,d)=>{let p=0,m=0,A=0;for(let T=0;T<h.length;T++)m+=(h[T]-u)**2,A+=(f[T]-d)**2,p+=(h[T]-u)*(f[T]-d);const k=h.length-1;m/=k,A/=k,p/=k;const I=(2*u*d+a)*(2*p+l),B=(u**2+d**2+a)*(m+A+l),M=I/B;s+=M,o++}),s/o}function iterate(e,t,r){const a=e.getWidth(),l=e.getHeight();for(let o=0;o<l;o+=8)for(let s=0;s<a;s+=8){const h=Math.min(8,a-s),f=Math.min(8,l-o),u=calculateLumaValuesForWindow(e,s,o,h,f),d=calculateLumaValuesForWindow(t,s,o,h,f),p=calculateAverageLuma(u),m=calculateAverageLuma(d);r(u,d,p,m)}}function calculateLumaValuesForWindow(e,t,r,n,a){const l=e.getPointArray(),o=[];let s=0;for(let h=r;h<r+a;h++){const f=h*e.getWidth();for(let u=t;u<t+n;u++){const d=l[f+u];o[s]=d.r*.2126+d.g*.7152+d.b*.0722,s++}}return o}function calculateAverageLuma(e){let t=0;for(const r of e)t+=r;return t/e.length}var setImmediateImpl=typeof setImmediate=="function"?setImmediate:typeof process<"u"&&typeof(process==null?void 0:process.nextTick)=="function"?e=>process.nextTick(e):e=>setTimeout(e,0);function buildPaletteSync(e,{colorDistanceFormula:t,paletteQuantization:r,colors:n}={}){const a=colorDistanceFormulaToColorDistance(t),l=paletteQuantizationToPaletteQuantizer(a,r,n);return e.forEach(o=>l.sample(o)),l.quantizeSync()}async function buildPalette(e,{colorDistanceFormula:t,paletteQuantization:r,colors:n,onProgress:a}={}){return new Promise((l,o)=>{const s=colorDistanceFormulaToColorDistance(t),h=paletteQuantizationToPaletteQuantizer(s,r,n);e.forEach(p=>h.sample(p));let f;const u=h.quantize(),d=()=>{try{const p=u.next();p.done?l(f):(p.value.palette&&(f=p.value.palette),a&&a(p.value.progress),setImmediateImpl(d))}catch(p){o(p)}};setImmediateImpl(d)})}function applyPaletteSync(e,t,{colorDistanceFormula:r,imageQuantization:n}={}){const a=colorDistanceFormulaToColorDistance(r);return imageQuantizationToImageQuantizer(a,n).quantizeSync(e,t)}async function applyPalette(e,t,{colorDistanceFormula:r,imageQuantization:n,onProgress:a}={}){return new Promise((l,o)=>{const s=colorDistanceFormulaToColorDistance(r),h=imageQuantizationToImageQuantizer(s,n);let f;const u=h.quantize(e,t),d=()=>{try{const p=u.next();p.done?l(f):(p.value.pointContainer&&(f=p.value.pointContainer),a&&a(p.value.progress),setImmediateImpl(d))}catch(p){o(p)}};setImmediateImpl(d)})}function colorDistanceFormulaToColorDistance(e="euclidean-bt709"){switch(e){case"cie94-graphic-arts":return new CIE94GraphicArts;case"cie94-textiles":return new CIE94Textiles;case"ciede2000":return new CIEDE2000;case"color-metric":return new CMetric;case"euclidean":return new Euclidean;case"euclidean-bt709":return new EuclideanBT709;case"euclidean-bt709-noalpha":return new EuclideanBT709NoAlpha;case"manhattan":return new Manhattan;case"manhattan-bt709":return new ManhattanBT709;case"manhattan-nommyde":return new ManhattanNommyde;case"pngquant":return new PNGQuant;default:throw new Error(`Unknown colorDistanceFormula ${e}`)}}function imageQuantizationToImageQuantizer(e,t="floyd-steinberg"){switch(t){case"nearest":return new NearestColor(e);case"riemersma":return new ErrorDiffusionRiemersma(e);case"floyd-steinberg":return new ErrorDiffusionArray(e,0);case"false-floyd-steinberg":return new ErrorDiffusionArray(e,1);case"stucki":return new ErrorDiffusionArray(e,2);case"atkinson":return new ErrorDiffusionArray(e,3);case"jarvis":return new ErrorDiffusionArray(e,4);case"burkes":return new ErrorDiffusionArray(e,5);case"sierra":return new ErrorDiffusionArray(e,6);case"two-sierra":return new ErrorDiffusionArray(e,7);case"sierra-lite":return new ErrorDiffusionArray(e,8);default:throw new Error(`Unknown imageQuantization ${t}`)}}function paletteQuantizationToPaletteQuantizer(e,t="wuquant",r=256){switch(t){case"neuquant":return new NeuQuant(e,r);case"rgbquant":return new RGBQuant(e,r);case"wuquant":return new WuQuant(e,r);case"neuquant-float":return new NeuQuantFloat(e,r);default:throw new Error(`Unknown paletteQuantization ${t}`)}}var imageQ=__toCommonJS(src_exports),gifframe={};const BitmapImage$1=bitmapimage;let GifFrame$1=class et extends BitmapImage$1{constructor(...t){if(super(...t),t[0]instanceof et){const r=t[0];this.xOffset=r.xOffset,this.yOffset=r.yOffset,this.disposalMethod=r.disposalMethod,this.delayCentisecs=r.delayCentisecs,this.interlaced=r.interlaced}else{const r=t[t.length-1];let n={};typeof r=="object"&&!(r instanceof BitmapImage$1)&&(n=r),this.xOffset=n.xOffset||0,this.yOffset=n.yOffset||0,this.disposalMethod=n.disposalMethod!==void 0?n.disposalMethod:et.DisposeToBackgroundColor,this.delayCentisecs=n.delayCentisecs||8,this.interlaced=n.interlaced||!1}}getPalette(){const t=new Set,r=this.bitmap.data;let n=0,a=!1;for(;n<r.length;){if(r[n+3]===0)a=!0;else{const h=r.readUInt32BE(n,!0)>>8&16777215;t.add(h)}n+=4}const l=new Array(t.size),o=t.values();for(n=0;n<l.length;++n)l[n]=o.next().value;l.sort((h,f)=>h-f);let s=l.length;return a&&++s,{colors:l,usesTransparency:a,indexCount:s}}};GifFrame$1.DisposeToAnything=0;GifFrame$1.DisposeNothing=1;GifFrame$1.DisposeToBackgroundColor=2;GifFrame$1.DisposeToPrevious=3;gifframe.GifFrame=GifFrame$1;var hasRequiredGifutil;function requireGifutil(){return hasRequiredGifutil||(hasRequiredGifutil=1,function(e){const t=require$$0,r=imageQ,n=bitmapimage,{GifFrame:a}=gifframe,{GifError:l}=gif$1,{GifCodec:o}=requireGifcodec(),s=[".jpg",".jpeg",".png",".bmp"],h=new o;e.cloneFrames=function(p){let m=[];return p.forEach(A=>{m.push(new a(A))}),m},e.getColorInfo=function(p,m){let A=!1;const k=[];for(let U=0;U<p.length;++U){let C=p[U].getPalette();if(C.usesTransparency&&(A=!0),C.indexCount>256)throw new l(`Frame ${U} uses more than 256 color indexes`);k.push(C)}if(m===0)return{usesTransparency:A,palettes:k};const I=new Set;k.forEach(U=>{U.colors.forEach(C=>{I.add(C)})});let B=I.size;if(A&&++B,m&&B>m)return{usesTransparency:A,palettes:k};const M=new Array(I.size),T=I.values();for(let U=0;U<M.length;++U)M[U]=T.next().value;return M.sort((U,C)=>U-C),{colors:M,indexCount:B,usesTransparency:A,palettes:k}},e.copyAsJimp=function(p,m){return e.shareAsJimp(p,new n(m))},e.getMaxDimensions=function(p){let m=0,A=0;return p.forEach(k=>{const I=k.xOffset+k.bitmap.width;I>m&&(m=I);const B=k.yOffset+k.bitmap.height;B>A&&(A=B)}),{maxWidth:m,maxHeight:A}},e.quantizeDekker=function(p,m,A){m=m||256,f(p,"NeuQuantFloat",m,0,A)},e.quantizeSorokin=function(p,m,A,k){m=m||256,A=A||"min-pop";let I;switch(A){case"min-pop":I=2;break;case"top-pop":I=1;break;default:throw new Error(`Invalid quantizeSorokin histogram '${A}'`)}f(p,"RGBQuant",m,I,k)},e.quantizeWu=function(p,m,A,k){if(m=m||256,A=A||5,A<1||A>8)throw new Error("Invalid quantization quality");f(p,"WuQuant",m,A,k)},e.read=function(p,m){return m=m||h,Buffer.isBuffer(p)?m.decodeGif(p):u(p).then(A=>m.decodeGif(A))},e.shareAsJimp=function(p,m){const A=new p(m.bitmap.width,m.bitmap.height,0);return A.bitmap.data=m.bitmap.data,A},e.write=function(p,m,A,k){k=k||h;const I=p.match(/\.[a-zA-Z]+$/);if(I!==null&&s.includes(I[0].toLowerCase()))throw new Error(`GIF '${p}' has an unexpected suffix`);return k.encodeGif(m,A).then(B=>d(p,B.buffer).then(()=>B))};function f(p,m,A,k,I){const B=Array.isArray(p)?p:[p],M=["FloydSteinberg","FalseFloydSteinberg","Stucki","Atkinson","Jarvis","Burkes","Sierra","TwoSierra","SierraLite"];if(I){if(M.indexOf(I.ditherAlgorithm)<0)throw new Error(`Invalid ditherAlgorithm '${I.ditherAlgorithm}'`);I.serpentine===void 0&&(I.serpentine=!0),I.minimumColorDistanceToDither===void 0&&(I.minimumColorDistanceToDither=0),I.calculateErrorLikeGIMP===void 0&&(I.calculateErrorLikeGIMP=!1)}const T=new r.distance.Euclidean,U=new r.palette[m](T,A,k);let C;I?C=new r.image.ErrorDiffusionArray(T,r.image.ErrorDiffusionArrayKernel[I.ditherAlgorithm],I.serpentine,I.minimumColorDistanceToDither,I.calculateErrorLikeGIMP):C=new r.image.NearestColor(T);const w=[];B.forEach(S=>{const $=S.bitmap.data,G=new ArrayBuffer($.length),L=new Uint32Array(G);for(let z=0,H=0;z<$.length;z+=4,++H)L[H]=$.readUInt32LE(z,!0);const O=r.utils.PointContainer.fromUint32Array(L,S.bitmap.width,S.bitmap.height);U.sample(O),w.push(O)});const E=U.quantizeSync();for(let S=0;S<B.length;++S){const $=B[S].bitmap.data,L=C.quantizeSync(w[S],E).toUint32Array();for(let O=0,z=0;O<$.length;O+=4,++z)$.writeUInt32LE(L[z],O)}}function u(p){return new Promise((m,A)=>{t.readFile(p,(k,I)=>k?A(k):m(I))})}function d(p,m){return new Promise((A,k)=>{t.writeFile(p,m,I=>I?k(I):A())})}}(gifutil)),gifutil}var hasRequiredGifcodec;function requireGifcodec(){if(hasRequiredGifcodec)return gifcodec;hasRequiredGifcodec=1;const e=omggif,{Gif:t,GifError:r}=gif$1;function n(){const B=requireGifutil();return n=function(){return B},B}const{GifFrame:a}=gifframe,l=200,o=100;class s{constructor(M={}){this._transparentRGB=null,typeof M.transparentRGB=="number"&&M.transparentRGB!==0&&(this._transparentRGBA=M.transparentRGB*256),this._testInitialBufferSize=0}decodeGif(M){try{let T;try{T=new e.GifReader(M)}catch(E){throw new r(E)}const U=T.numFrames(),C=[],w={width:T.width,height:T.height,loops:T.loopCount()};w.usesTransparency=!1;for(let E=0;E<U;++E){const S=this._decodeFrame(T,E,w.usesTransparency);C.push(S.frame),S.usesTransparency&&(w.usesTransparency=!0)}return Promise.resolve(new t(M,C,w))}catch(T){return Promise.reject(T)}}encodeGif(M,T={}){try{if(M===null||M.length===0)throw new r("there are no frames");const U=n().getMaxDimensions(M);return T=Object.assign({},T),T.width=U.maxWidth,T.height=U.maxHeight,T.loops===void 0&&(T.loops=0),T.colorScope=T.colorScope||t.GlobalColorsPreferred,Promise.resolve(this._encodeGif(M,T))}catch(U){return Promise.reject(U)}}_decodeFrame(M,T,U){let C,w;try{if(C=M.frameInfo(T),w=new Buffer(M.width*M.height*4),M.decodeAndBlitFrameRGBA(T,w),C.width!==M.width||C.height!==M.height){if(C.y&&(w=w.slice(C.y*M.width*4)),M.width>C.width)for(let $=0;$<C.height;++$)w.copy(w,$*C.width*4,(C.x+$*M.width)*4,(C.x+$*M.width)*4+C.width*4);w=w.slice(0,C.width*C.height*4)}}catch($){throw new r($)}let E=!1;if(this._transparentRGBA===null){if(!U)for(let $=3;$<w.length;$+=4)w[$]===0&&(E=!0,$=w.length)}else for(let $=3;$<w.length;$+=4)w[$]===0&&(w.writeUInt32BE(this._transparentRGBA,$-3),E=!0);return{frame:new a(C.width,C.height,w,{xOffset:C.x,yOffset:C.y,disposalMethod:C.disposal,interlaced:C.interlaced,delayCentisecs:C.delay}),usesTransparency:E}}_encodeGif(M,T){let U;if(T.colorScope===t.LocalColorsOnly)U=n().getColorInfo(M,0);else if(U=n().getColorInfo(M,256),!U.colors){if(T.colorScope===t.GlobalColorsOnly)throw new r("Too many color indexes for global color table");T.colorScope=t.LocalColorsOnly}T.usesTransparency=U.usesTransparency;const C=U.palettes;return T.colorScope===t.LocalColorsOnly?d(M,T,2e3,C):u(M,T,2e3,U)}_getSizeEstimateGlobal(M,T){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let U=l+3*256;const C=k(M);return T.forEach(w=>{U+=m(w,C)}),U}_getSizeEstimateLocal(M,T){if(this._testInitialBufferSize>0)return this._testInitialBufferSize;let U=l;for(let C=0;C<T.length;++C){const w=M[C],E=k(w);U+=m(T[C],E)}return U}}gifcodec.GifCodec=s;function h(B,M){const T=B.indexOf(M);return T===-1?null:T}function f(B,M){for(var T=0,U=B.length-1,C;T<=U;)if(C=Math.floor((T+U)/2),B[C]>M)U=C-1;else if(B[C]<M)T=C+1;else return C;return null}function u(B,M,T,U){const C={colors:U.colors.slice(),usesTransparency:U.usesTransparency};p(C);const w={palette:C.colors,loop:M.loops};let E=new Buffer(T),S;try{S=new e.GifWriter(E,M.width,M.height,w)}catch($){throw new r($)}for(let $=0;$<B.length;++$)E=I(S,$,B[$],U,!1);return new t(E.slice(0,S.end()),B,M)}function d(B,M,T,U){const C={loop:M.loops};let w=new Buffer(T),E;try{E=new e.GifWriter(w,M.width,M.height,C)}catch(S){throw new r(S)}for(let S=0;S<B.length;++S)w=I(E,S,B[S],U[S],!0);return new t(w.slice(0,E.end()),B,M)}function p(B){const M=B.colors;B.usesTransparency&&M.push(0);const T=M.length;let U=2;for(;T>U;)U<<=1;M.length=U,M.fill(0,T)}function m(B,M){let T=B.bitmap.width*B.bitmap.height;return T=Math.ceil(T*M/8),T+=Math.ceil(T/255),o+T+3*256}function A(B,M,T){const U=T.colors,C=U.length<=8?h:f,w=M.bitmap.data,E=new Buffer(w.length/4);let S=U.length,$=0,G=0;for(;$<w.length;){if(w[$+3]!==0){const L=w.readUInt32BE($,!0)>>8&16777215;E[G]=C(U,L)}else E[G]=S;$+=4,++G}if(T.usesTransparency){if(S===256)throw new r(`Frame ${B} already has 256 colorsand so can't use transparency`)}else S=null;return{buffer:E,transparentIndex:S}}function k(B){let M=B.indexCount,T=0;for(--M;M;)++T,M>>=1;return T>0?T:1}function I(B,M,T,U,C){if(T.interlaced)throw new r("writing interlaced GIFs is not supported");const w=A(M,T,U),E={delay:T.delayCentisecs,disposal:T.disposalMethod,transparent:w.transparentIndex};C&&(p(U),E.palette=U.colors);try{let S=B.getOutputBuffer(),$=B.getOutputBufferPosition(),G,L=!0;for(;L;)if(G=B.addFrame(T.xOffset,T.yOffset,T.bitmap.width,T.bitmap.height,w.buffer,E),L=!1,G>=S.length-1){const O=new Buffer(S.length*1.5);S.copy(O),B.setOutputBuffer(O),B.setOutputBufferPosition($),S=O,L=!0}return S}catch(S){throw new r(S)}}return gifcodec}const BitmapImage=bitmapimage,{Gif,GifError:GifError$1}=gif$1,{GifCodec}=requireGifcodec(),{GifFrame}=gifframe,GifUtil=requireGifutil();var src={BitmapImage,Gif,GifCodec,GifFrame,GifUtil,GifError:GifError$1};const MIME_TYPE="image/gif",gif=()=>({mime:{[MIME_TYPE]:["gif"]},constants:{MIME_GIF:MIME_TYPE},decoders:{[MIME_TYPE]:e=>{const t=new omggif.GifReader(e),r=Buffer.alloc(t.width*t.height*4);return t.decodeAndBlitFrameRGBA(0,r),{data:r,width:t.width,height:t.height}}},encoders:{[MIME_TYPE]:e=>{const t=new src.BitmapImage(e.bitmap);src.GifUtil.quantizeDekker(t,256);const r=new src.GifFrame(t);return new src.GifCodec().encodeGif([r],{}).then(a=>a.buffer)}}}),types=()=>mergeDeep_1(jpeg(),png(),bmp(),tiff(),gif()),blit=()=>({blit(e,t,r,n,a,l,o,s){if(!(e instanceof this.constructor))return throwError.call(this,"The source must be a Jimp image",s);if(typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",s);if(typeof n=="function")s=n,n=0,a=0,l=e.bitmap.width,o=e.bitmap.height;else if(typeof n==typeof a&&typeof a==typeof l&&typeof l==typeof o)n=n||0,a=a||0,l=l||e.bitmap.width,o=o||e.bitmap.height;else return throwError.call(this,"srcx, srcy, srcw, srch must be numbers",s);t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a),l=Math.round(l),o=Math.round(o);const h=this.bitmap.width,f=this.bitmap.height,u=this;return e.scanQuiet(n,a,l,o,function(d,p,m){const A=t+d-n,k=r+p-a;if(A>=0&&k>=0&&h-A>0&&f-k>0){const I=u.getPixelIndex(A,k),B={r:this.bitmap.data[m],g:this.bitmap.data[m+1],b:this.bitmap.data[m+2],a:this.bitmap.data[m+3]},M={r:u.bitmap.data[I],g:u.bitmap.data[I+1],b:u.bitmap.data[I+2],a:u.bitmap.data[I+3]};u.bitmap.data[I]=(B.a*(B.r-M.r)-M.r+255>>8)+M.r,u.bitmap.data[I+1]=(B.a*(B.g-M.g)-M.g+255>>8)+M.g,u.bitmap.data[I+2]=(B.a*(B.b-M.b)-M.b+255>>8)+M.b,u.bitmap.data[I+3]=this.constructor.limit255(M.a+B.a)}}),isNodePattern(s)&&s.call(this,null,this),this}}),mulTable=[1,57,41,21,203,34,97,73,227,91,149,62,105,45,39,137,241,107,3,173,39,71,65,238,219,101,187,87,81,151,141,133,249,117,221,209,197,187,177,169,5,153,73,139,133,127,243,233,223,107,103,99,191,23,177,171,165,159,77,149,9,139,135,131,253,245,119,231,224,109,211,103,25,195,189,23,45,175,171,83,81,79,155,151,147,9,141,137,67,131,129,251,123,30,235,115,113,221,217,53,13,51,50,49,193,189,185,91,179,175,43,169,83,163,5,79,155,19,75,147,145,143,35,69,17,67,33,65,255,251,247,243,239,59,29,229,113,111,219,27,213,105,207,51,201,199,49,193,191,47,93,183,181,179,11,87,43,85,167,165,163,161,159,157,155,77,19,75,37,73,145,143,141,35,138,137,135,67,33,131,129,255,63,250,247,61,121,239,237,117,29,229,227,225,111,55,109,216,213,211,209,207,205,203,201,199,197,195,193,48,190,47,93,185,183,181,179,178,176,175,173,171,85,21,167,165,41,163,161,5,79,157,78,154,153,19,75,149,74,147,73,144,143,71,141,140,139,137,17,135,134,133,66,131,65,129,1],shgTable=[0,9,10,10,14,12,14,14,16,15,16,15,16,15,15,17,18,17,12,18,16,17,17,19,19,18,19,18,18,19,19,19,20,19,20,20,20,20,20,20,15,20,19,20,20,20,21,21,21,20,20,20,21,18,21,21,21,21,20,21,17,21,21,21,22,22,21,22,22,21,22,21,19,22,22,19,20,22,22,21,21,21,22,22,22,18,22,22,21,22,22,23,22,20,23,22,22,23,23,21,19,21,21,21,23,23,23,22,23,23,21,23,22,23,18,22,23,20,22,23,23,23,21,22,20,22,21,22,24,24,24,24,24,22,21,24,23,23,24,21,24,23,24,22,24,24,22,24,24,22,23,24,24,24,20,23,22,23,24,24,24,24,24,24,24,23,21,23,22,23,24,24,24,22,24,24,24,23,22,24,24,25,23,25,25,23,24,25,25,24,22,25,25,25,24,23,24,25,25,25,25,25,25,25,25,25,25,25,25,23,25,23,24,25,25,25,25,25,25,25,25,25,24,22,25,25,23,25,25,20,24,25,24,25,25,22,24,25,24,25,24,25,25,24,25,25,25,25,22,25,25,25,24,25,24,25,18],blur=()=>({blur(e,t){if(typeof e!="number")return throwError.call(this,"r must be a number",t);if(e<1)return throwError.call(this,"r must be greater than 0",t);let r,n,a,l,o,s,h,f,u,d,p,m,A,k;const I=this.bitmap.width-1,B=this.bitmap.height-1,M=e+1,T=mulTable[e],U=shgTable[e],C=[],w=[],E=[],S=[],$=[],G=[];let L=2;for(;L-- >0;){for(m=0,A=0,s=0;s<this.bitmap.height;s++){for(r=this.bitmap.data[A]*M,n=this.bitmap.data[A+1]*M,a=this.bitmap.data[A+2]*M,l=this.bitmap.data[A+3]*M,h=1;h<=e;h++)f=A+((h>I?I:h)<<2),r+=this.bitmap.data[f++],n+=this.bitmap.data[f++],a+=this.bitmap.data[f++],l+=this.bitmap.data[f];for(o=0;o<this.bitmap.width;o++)C[m]=r,w[m]=n,E[m]=a,S[m]=l,s===0&&($[o]=((f=o+M)<I?f:I)<<2,G[o]=(f=o-e)>0?f<<2:0),u=A+$[o],d=A+G[o],r+=this.bitmap.data[u++]-this.bitmap.data[d++],n+=this.bitmap.data[u++]-this.bitmap.data[d++],a+=this.bitmap.data[u++]-this.bitmap.data[d++],l+=this.bitmap.data[u]-this.bitmap.data[d],m++;A+=this.bitmap.width<<2}for(o=0;o<this.bitmap.width;o++){for(p=o,r=C[p]*M,n=w[p]*M,a=E[p]*M,l=S[p]*M,h=1;h<=e;h++)p+=h>B?0:this.bitmap.width,r+=C[p],n+=w[p],a+=E[p],l+=S[p];for(m=o<<2,s=0;s<this.bitmap.height;s++)k=l*T>>>U,this.bitmap.data[m+3]=k,k>255&&(this.bitmap.data[m+3]=255),k>0?(k=255/k,this.bitmap.data[m]=(r*T>>>U)*k,this.bitmap.data[m+1]=(n*T>>>U)*k,this.bitmap.data[m+2]=(a*T>>>U)*k):(this.bitmap.data[m+2]=0,this.bitmap.data[m+1]=0,this.bitmap.data[m]=0),o===0&&($[s]=((f=s+M)<B?f:B)*this.bitmap.width,G[s]=(f=s-e)>0?f*this.bitmap.width:0),u=o+$[s],d=o+G[s],r+=C[u]-C[d],n+=w[u]-w[d],a+=E[u]-E[d],l+=S[u]-S[d],m+=this.bitmap.width<<2}}return isNodePattern(t)&&t.call(this,null,this),this}}),circle=()=>({circle(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;typeof e=="function"&&(t=e,e={});const r=e.radius||(this.bitmap.width>this.bitmap.height?this.bitmap.height:this.bitmap.width)/2,n={x:typeof e.x=="number"?e.x:this.bitmap.width/2,y:typeof e.y=="number"?e.y:this.bitmap.height/2};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(a,l,o){const s=Math.sqrt(Math.pow(a-n.x,2)+Math.pow(l-n.y,2));r-s<=0?this.bitmap.data[o+3]=0:r-s<1&&(this.bitmap.data[o+3]=255*(r-s))}),isNodePattern(t)&&t.call(this,null,this),this}});function applyKernel(e,t,r,n){const a=[0,0,0],l=(t.length-1)/2;for(let o=0;o<t.length;o+=1)for(let s=0;s<t[o].length;s+=1){const h=e.getPixelIndex(r+o-l,n+s-l);a[0]+=e.bitmap.data[h]*t[o][s],a[1]+=e.bitmap.data[h+1]*t[o][s],a[2]+=e.bitmap.data[h+2]*t[o][s]}return a}const isDef=e=>typeof e<"u"&&e!==null;function greyscale(e){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(t,r,n){const a=parseInt(.2126*this.bitmap.data[n]+.7152*this.bitmap.data[n+1]+.0722*this.bitmap.data[n+2],10);this.bitmap.data[n]=a,this.bitmap.data[n+1]=a,this.bitmap.data[n+2]=a}),isNodePattern(e)&&e.call(this,null,this),this}function mix(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:50;return{r:(t.r-e.r)*(r/100)+e.r,g:(t.g-e.g)*(r/100)+e.g,b:(t.b-e.b)*(r/100)+e.b}}function colorFn(e,t){return!e||!Array.isArray(e)?throwError.call(this,"actions must be an array",t):(e=e.map(r=>((r.apply==="xor"||r.apply==="mix")&&(r.params[0]=tinycolor(r.params[0]).toRgb()),r)),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,(r,n,a)=>{let l={r:this.bitmap.data[a],g:this.bitmap.data[a+1],b:this.bitmap.data[a+2]};const o=(s,h)=>this.constructor.limit255(l[s]+h);e.forEach(s=>{if(s.apply==="mix")l=mix(l,s.params[0],s.params[1]);else if(s.apply==="tint")l=mix(l,{r:255,g:255,b:255},s.params[0]);else if(s.apply==="shade")l=mix(l,{r:0,g:0,b:0},s.params[0]);else if(s.apply==="xor")l={r:l.r^s.params[0].r,g:l.g^s.params[0].g,b:l.b^s.params[0].b};else if(s.apply==="red")l.r=o("r",s.params[0]);else if(s.apply==="green")l.g=o("g",s.params[0]);else if(s.apply==="blue")l.b=o("b",s.params[0]);else{if(s.apply==="hue"&&(s.apply="spin"),l=tinycolor(l),!l[s.apply])return throwError.call(this,"action "+s.apply+" not supported",t);l=l[s.apply](...s.params).toRgb()}}),this.bitmap.data[a]=l.r,this.bitmap.data[a+1]=l.g,this.bitmap.data[a+2]=l.b}),isNodePattern(t)&&t.call(this,null,this),this)}const color=()=>({brightness(e,t){return typeof e!="number"?throwError.call(this,"val must be numbers",t):e<-1||e>1?throwError.call(this,"val must be a number between -1 and +1",t):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(r,n,a){e<0?(this.bitmap.data[a]*=1+e,this.bitmap.data[a+1]*=1+e,this.bitmap.data[a+2]*=1+e):(this.bitmap.data[a]+=(255-this.bitmap.data[a])*e,this.bitmap.data[a+1]+=(255-this.bitmap.data[a+1])*e,this.bitmap.data[a+2]+=(255-this.bitmap.data[a+2])*e)}),isNodePattern(t)&&t.call(this,null,this),this)},contrast(e,t){if(typeof e!="number")return throwError.call(this,"val must be numbers",t);if(e<-1||e>1)return throwError.call(this,"val must be a number between -1 and +1",t);const r=(e+1)/(1-e);function n(a){return a=Math.floor(r*(a-127)+127),a<0?0:a>255?255:a}return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(a,l,o){this.bitmap.data[o]=n(this.bitmap.data[o]),this.bitmap.data[o+1]=n(this.bitmap.data[o+1]),this.bitmap.data[o+2]=n(this.bitmap.data[o+2])}),isNodePattern(t)&&t.call(this,null,this),this},posterize(e,t){return typeof e!="number"?throwError.call(this,"n must be numbers",t):(e<2&&(e=2),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(r,n,a){this.bitmap.data[a]=Math.floor(this.bitmap.data[a]/255*(e-1))/(e-1)*255,this.bitmap.data[a+1]=Math.floor(this.bitmap.data[a+1]/255*(e-1))/(e-1)*255,this.bitmap.data[a+2]=Math.floor(this.bitmap.data[a+2]/255*(e-1))/(e-1)*255}),isNodePattern(t)&&t.call(this,null,this),this)},greyscale,grayscale:greyscale,opacity(e,t){return typeof e!="number"?throwError.call(this,"f must be a number",t):e<0||e>1?throwError.call(this,"f must be a number from 0 to 1",t):(this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(r,n,a){const l=this.bitmap.data[a+3]*e;this.bitmap.data[a+3]=l}),isNodePattern(t)&&t.call(this,null,this),this)},sepia(e){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(t,r,n){let a=this.bitmap.data[n],l=this.bitmap.data[n+1],o=this.bitmap.data[n+2];a=a*.393+l*.769+o*.189,l=a*.349+l*.686+o*.168,o=a*.272+l*.534+o*.131,this.bitmap.data[n]=a<255?a:255,this.bitmap.data[n+1]=l<255?l:255,this.bitmap.data[n+2]=o<255?o:255}),isNodePattern(e)&&e.call(this,null,this),this},fade(e,t){return typeof e!="number"?throwError.call(this,"f must be a number",t):e<0||e>1?throwError.call(this,"f must be a number from 0 to 1",t):(this.opacity(1-e),isNodePattern(t)&&t.call(this,null,this),this)},convolution(e,t,r){typeof t=="function"&&typeof r>"u"&&(r=t,t=null),t||(t=this.constructor.EDGE_EXTEND);const n=Buffer.from(this.bitmap.data),a=e.length,l=e[0].length,o=Math.floor(a/2),s=Math.floor(l/2),h=-o,f=-s;let u,d,p,m,A,k,I,B,M,T;return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(U,C,w){m=0,p=0,d=0;for(let E=h;E<=o;E++)for(let S=f;S<=s;S++)B=U+S,M=C+E,u=e[E+o][S+s],T=this.getPixelIndex(B,M,t),T===-1?(I=0,k=0,A=0):(A=this.bitmap.data[T+0],k=this.bitmap.data[T+1],I=this.bitmap.data[T+2]),d+=u*A,p+=u*k,m+=u*I;d<0&&(d=0),p<0&&(p=0),m<0&&(m=0),d>255&&(d=255),p>255&&(p=255),m>255&&(m=255),n[w+0]=d,n[w+1]=p,n[w+2]=m}),this.bitmap.data=n,isNodePattern(r)&&r.call(this,null,this),this},opaque(e){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(t,r,n){this.bitmap.data[n+3]=255}),isNodePattern(e)&&e.call(this,null,this),this},pixelate(e,t,r,n,a,l){if(typeof t=="function")l=t,a=null,n=null,r=null,t=null;else{if(typeof e!="number")return throwError.call(this,"size must be a number",l);if(isDef(t)&&typeof t!="number")return throwError.call(this,"x must be a number",l);if(isDef(r)&&typeof r!="number")return throwError.call(this,"y must be a number",l);if(isDef(n)&&typeof n!="number")return throwError.call(this,"w must be a number",l);if(isDef(a)&&typeof a!="number")return throwError.call(this,"h must be a number",l)}const o=[[1/16,2/16,1/16],[2/16,4/16,2/16],[1/16,2/16,1/16]];t=t||0,r=r||0,n=isDef(n)?n:this.bitmap.width-t,a=isDef(a)?a:this.bitmap.height-r;const s=this.cloneQuiet();return this.scanQuiet(t,r,n,a,function(h,f,u){h=e*Math.floor(h/e),f=e*Math.floor(f/e);const d=applyKernel(s,o,h,f);this.bitmap.data[u]=d[0],this.bitmap.data[u+1]=d[1],this.bitmap.data[u+2]=d[2]}),isNodePattern(l)&&l.call(this,null,this),this},convolute(e,t,r,n,a,l){if(!Array.isArray(e))return throwError.call(this,"the kernel must be an array",l);if(typeof t=="function")l=t,t=null,r=null,n=null,a=null;else{if(isDef(t)&&typeof t!="number")return throwError.call(this,"x must be a number",l);if(isDef(r)&&typeof r!="number")return throwError.call(this,"y must be a number",l);if(isDef(n)&&typeof n!="number")return throwError.call(this,"w must be a number",l);if(isDef(a)&&typeof a!="number")return throwError.call(this,"h must be a number",l)}t=isDef(t)?t:0,r=isDef(r)?r:0,n=isDef(n)?n:this.bitmap.width-t,a=isDef(a)?a:this.bitmap.height-r;const o=this.cloneQuiet();return this.scanQuiet(t,r,n,a,function(s,h,f){const u=applyKernel(o,e,s,h);this.bitmap.data[f]=this.constructor.limit255(u[0]),this.bitmap.data[f+1]=this.constructor.limit255(u[1]),this.bitmap.data[f+2]=this.constructor.limit255(u[2])}),isNodePattern(l)&&l.call(this,null,this),this},color:colorFn,colour:colorFn}),contain=()=>({contain(e,t,r,n,a){if(typeof e!="number"||typeof t!="number")return throwError.call(this,"w and h must be numbers",a);typeof r=="string"&&(typeof n=="function"&&typeof a>"u"&&(a=n),n=r,r=null),typeof r=="function"&&(typeof a>"u"&&(a=r),n=null,r=null),typeof n=="function"&&typeof a>"u"&&(a=n,n=null),r=r||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;const l=r&7,o=r>>3;if(!(l!==0&&!(l&l-1)||o!==0&&!(o&o-1)))return throwError.call(this,"only use one flag per alignment direction",a);const s=l>>1,h=o>>1,f=e/t>this.bitmap.width/this.bitmap.height?t/this.bitmap.height:e/this.bitmap.width,u=this.cloneQuiet().scale(f,n);return this.resize(e,t,n),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(d,p,m){this.bitmap.data.writeUInt32BE(this._background,m)}),this.blit(u,(this.bitmap.width-u.bitmap.width)/2*s,(this.bitmap.height-u.bitmap.height)/2*h),isNodePattern(a)&&a.call(this,null,this),this}}),cover=()=>({cover(e,t,r,n,a){if(typeof e!="number"||typeof t!="number")return throwError.call(this,"w and h must be numbers",a);r&&typeof r=="function"&&typeof a>"u"?(a=r,r=null,n=null):typeof n=="function"&&typeof a>"u"&&(a=n,n=null),r=r||this.constructor.HORIZONTAL_ALIGN_CENTER|this.constructor.VERTICAL_ALIGN_MIDDLE;const l=r&7,o=r>>3;if(!(l!==0&&!(l&l-1)||o!==0&&!(o&o-1)))return throwError.call(this,"only use one flag per alignment direction",a);const s=l>>1,h=o>>1,f=e/t>this.bitmap.width/this.bitmap.height?e/this.bitmap.width:t/this.bitmap.height;return this.scale(f,n),this.crop((this.bitmap.width-e)/2*s,(this.bitmap.height-t)/2*h,e,t),isNodePattern(a)&&a.call(this,null,this),this}});function pluginCrop(e){return e("crop",function(t,r,n,a,l){if(typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",l);if(typeof n!="number"||typeof a!="number")return throwError.call(this,"w and h must be numbers",l);if(t=Math.round(t),r=Math.round(r),n=Math.round(n),a=Math.round(a),t===0&&n===this.bitmap.width){const o=n*r+t<<2,s=o+(a*n<<2);this.bitmap.data=this.bitmap.data.slice(o,s)}else{const o=Buffer.allocUnsafe(n*a*4);let s=0;this.scanQuiet(t,r,n,a,function(h,f,u){const d=this.bitmap.data.readUInt32BE(u,!0);o.writeUInt32BE(d,s,!0),s+=4}),this.bitmap.data=o}return this.bitmap.width=n,this.bitmap.height=a,isNodePattern(l)&&l.call(this,null,this),this}),{class:{autocrop(){const t=this.bitmap.width,r=this.bitmap.height,n=1;let a,l=0,o=2e-4,s=!0,h=!1,f={north:!1,south:!1,east:!1,west:!1};for(var u=arguments.length,d=new Array(u),p=0;p<u;p++)d[p]=arguments[p];for(let w=0,E=d.length;w<E;w++)if(typeof d[w]=="number"&&(o=d[w]),typeof d[w]=="boolean"&&(s=d[w]),typeof d[w]=="function"&&(a=d[w]),typeof d[w]=="object"){const S=d[w];typeof S.tolerance<"u"&&({tolerance:o}=S),typeof S.cropOnlyFrames<"u"&&({cropOnlyFrames:s}=S),typeof S.cropSymmetric<"u"&&({cropSymmetric:h}=S),typeof S.leaveBorder<"u"&&({leaveBorder:l}=S),typeof S.ignoreSides<"u"&&({ignoreSides:f}=S)}let m=this.getPixelColor(0,0);const A=this.constructor.intToRGBA(m);let k=0,I=0,B=0,M=0;if(m=this.getPixelColor(0,0),!f.north)e:for(let w=0;w<r-n;w++){for(let E=0;E<t;E++){const S=this.getPixelColor(E,w),$=this.constructor.intToRGBA(S);if(this.constructor.colorDiff(A,$)>o)break e}k++}if(m=this.getPixelColor(t,0),!f.west)e:for(let w=0;w<t-n;w++){for(let E=0+k;E<r;E++){const S=this.getPixelColor(w,E),$=this.constructor.intToRGBA(S);if(this.constructor.colorDiff(A,$)>o)break e}M++}if(m=this.getPixelColor(0,r),!f.south)e:for(let w=r-1;w>=k+n;w--){for(let E=t-I-1;E>=0;E--){const S=this.getPixelColor(E,w),$=this.constructor.intToRGBA(S);if(this.constructor.colorDiff(A,$)>o)break e}B++}if(m=this.getPixelColor(t,r),!f.east)e:for(let w=t-1;w>=0+M+n;w--){for(let E=r-1;E>=0+k;E--){const S=this.getPixelColor(w,E),$=this.constructor.intToRGBA(S);if(this.constructor.colorDiff(A,$)>o)break e}I++}let T=!1;if(M-=l,I-=l,k-=l,B-=l,h){const w=Math.min(I,M),E=Math.min(k,B);M=w,I=w,k=E,B=E}M=M>=0?M:0,I=I>=0?I:0,k=k>=0?k:0,B=B>=0?B:0;const U=t-(M+I),C=r-(B+k);return s?T=I!==0&&k!==0&&M!==0&&B!==0:T=I!==0||k!==0||M!==0||B!==0,T&&this.crop(M,k,U,C),isNodePattern(a)&&a.call(this,null,this),this}}}}const displace=()=>({displace(e,t,r){if(typeof e!="object"||e.constructor!==this.constructor)return throwError.call(this,"The source must be a Jimp image",r);if(typeof t!="number")return throwError.call(this,"factor must be a number",r);const n=this.cloneQuiet();return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(a,l,o){let s=e.bitmap.data[o]/256*t;s=Math.round(s);const h=this.getPixelIndex(a+s,l);this.bitmap.data[h]=n.bitmap.data[o],this.bitmap.data[h+1]=n.bitmap.data[o+1],this.bitmap.data[h+2]=n.bitmap.data[o+2]}),isNodePattern(r)&&r.call(this,null,this),this}});function dither(e){const t=[1,9,3,11,13,5,15,7,4,12,2,10,16,8,14,6];return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(r,n,a){const l=((n&3)<<2)+r%4,o=t[l];this.bitmap.data[a]=Math.min(this.bitmap.data[a]+o,255),this.bitmap.data[a+1]=Math.min(this.bitmap.data[a+1]+o,255),this.bitmap.data[a+2]=Math.min(this.bitmap.data[a+2]+o,255)}),isNodePattern(e)&&e.call(this,null,this),this}const dither$1=()=>({dither565:dither,dither16:dither}),fisheye=()=>({fisheye(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{r:2.5},t=arguments.length>1?arguments[1]:void 0;typeof e=="function"&&(t=e,e={r:2.5});const r=this.cloneQuiet(),{width:n,height:a}=r.bitmap;return r.scanQuiet(0,0,n,a,(l,o)=>{const s=l/n,h=o/a,f=Math.sqrt(Math.pow(s-.5,2)+Math.pow(h-.5,2)),u=2*Math.pow(f,e.r),d=(s-.5)/f,p=(h-.5)/f,m=Math.round((u*d+.5)*n),A=Math.round((u*p+.5)*a),k=r.getPixelColor(m,A);this.setPixelColor(k,l,o)}),this.setPixelColor(r.getPixelColor(n/2,a/2),n/2,a/2),isNodePattern(t)&&t.call(this,null,this),this}});function flipFn(e,t,r){if(typeof e!="boolean"||typeof t!="boolean")return throwError.call(this,"horizontal and vertical must be Booleans",r);const n=Buffer.alloc(this.bitmap.data.length);return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(a,l,o){const s=e?this.bitmap.width-1-a:a,h=t?this.bitmap.height-1-l:l,f=this.bitmap.width*h+s<<2,u=this.bitmap.data.readUInt32BE(o);n.writeUInt32BE(u,f)}),this.bitmap.data=Buffer.from(n),isNodePattern(r)&&r.call(this,null,this),this}const flip=()=>({flip:flipFn,mirror:flipFn}),gaussian=()=>({gaussian(e,t){if(typeof e!="number")return throwError.call(this,"r must be a number",t);if(e<1)return throwError.call(this,"r must be greater than 0",t);const r=Math.ceil(e*2.57),n=r*2+1,a=e*e*2,l=a*Math.PI,o=[];for(let s=0;s<n;s++){o[s]=[];for(let h=0;h<n;h++){const f=(h-r)**2+(s-r)**2;o[s][h]=Math.exp(-f/a)/l}}for(let s=0;s<this.bitmap.height;s++)for(let h=0;h<this.bitmap.width;h++){let f=0,u=0,d=0,p=0,m=0;for(let A=0;A<n;A++){for(let I=0;I<n;I++){const B=Math.min(this.bitmap.width-1,Math.max(0,I+h-r)),M=Math.min(this.bitmap.height-1,Math.max(0,A+s-r)),T=o[A][I],U=M*this.bitmap.width+B<<2;f+=this.bitmap.data[U]*T,u+=this.bitmap.data[U+1]*T,d+=this.bitmap.data[U+2]*T,p+=this.bitmap.data[U+3]*T,m+=T}const k=s*this.bitmap.width+h<<2;this.bitmap.data[k]=Math.round(f/m),this.bitmap.data[k+1]=Math.round(u/m),this.bitmap.data[k+2]=Math.round(d/m),this.bitmap.data[k+3]=Math.round(p/m)}}return isNodePattern(t)&&t.call(this,null,this),this}}),invert=()=>({invert(e){return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(t,r,n){this.bitmap.data[n]=255-this.bitmap.data[n],this.bitmap.data[n+1]=255-this.bitmap.data[n+1],this.bitmap.data[n+2]=255-this.bitmap.data[n+2]}),isNodePattern(e)&&e.call(this,null,this),this}}),mask=()=>({mask(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;if(!(e instanceof this.constructor))return throwError.call(this,"The source must be a Jimp image",n);if(typeof t!="number"||typeof r!="number")return throwError.call(this,"x and y must be numbers",n);t=Math.round(t),r=Math.round(r);const a=this.bitmap.width,l=this.bitmap.height,o=this;return e.scanQuiet(0,0,e.bitmap.width,e.bitmap.height,function(s,h,f){const u=t+s,d=r+h;if(u>=0&&d>=0&&u<a&&d<l){const p=o.getPixelIndex(u,d),{data:m}=this.bitmap,A=(m[f+0]+m[f+1]+m[f+2])/3;o.bitmap.data[p+3]*=A/255}}),isNodePattern(n)&&n.call(this,null,this),this}});function histogram(){const e={r:new Array(256).fill(0),g:new Array(256).fill(0),b:new Array(256).fill(0)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(t,r,n){e.r[this.bitmap.data[n+0]]++,e.g[this.bitmap.data[n+1]]++,e.b[this.bitmap.data[n+2]]++}),e}const normalize=function(e,t,r){return(e-t)*255/(r-t)},getBounds=function(e){return[e.findIndex(t=>t>0),255-e.slice().reverse().findIndex(t=>t>0)]},normalize$1=()=>({normalize(e){const t=histogram.call(this),r={r:getBounds(t.r),g:getBounds(t.g),b:getBounds(t.b)};return this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(n,a,l){const o=this.bitmap.data[l+0],s=this.bitmap.data[l+1],h=this.bitmap.data[l+2];this.bitmap.data[l+0]=normalize(o,r.r[0],r.r[1]),this.bitmap.data[l+1]=normalize(s,r.g[0],r.g[1]),this.bitmap.data[l+2]=normalize(h,r.b[0],r.b[1])}),isNodePattern(e)&&e.call(this,null,this),this}});var xhr$1={exports:{}},win;typeof window<"u"?win=window:typeof commonjsGlobal<"u"?win=commonjsGlobal:typeof self<"u"?win=self:win={};var window_1=win,isFunction_1=isFunction$1,toString=Object.prototype.toString;function isFunction$1(e){if(!e)return!1;var t=toString.call(e);return t==="[object Function]"||typeof e=="function"&&t!=="[object RegExp]"||typeof window<"u"&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}var trim=function(e){return e.replace(/^\s+|\s+$/g,"")},isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},parseHeaders$1=function(e){if(!e)return{};for(var t={},r=trim(e).split(`
`),n=0;n<r.length;n++){var a=r[n],l=a.indexOf(":"),o=trim(a.slice(0,l)).toLowerCase(),s=trim(a.slice(l+1));typeof t[o]>"u"?t[o]=s:isArray(t[o])?t[o].push(s):t[o]=[t[o],s]}return t},immutable=extend,hasOwnProperty=Object.prototype.hasOwnProperty;function extend(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}var window$1=window_1,isFunction=isFunction_1,parseHeaders=parseHeaders$1,xtend$1=immutable;xhr$1.exports=createXHR;xhr$1.exports.default=createXHR;createXHR.XMLHttpRequest=window$1.XMLHttpRequest||noop$1;createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window$1.XDomainRequest;forEachArray(["get","put","post","patch","head","delete"],function(e){createXHR[e==="delete"?"del":e]=function(t,r,n){return r=initParams(t,r,n),r.method=e.toUpperCase(),_createXHR(r)}});function forEachArray(e,t){for(var r=0;r<e.length;r++)t(e[r])}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function initParams(e,t,r){var n=e;return isFunction(t)?(r=t,typeof e=="string"&&(n={uri:e})):n=xtend$1(t,{uri:e}),n.callback=r,n}function createXHR(e,t,r){return t=initParams(e,t,r),_createXHR(t)}function _createXHR(e){if(typeof e.callback>"u")throw new Error("callback argument missing");var t=!1,r=function(T,U,C){t||(t=!0,e.callback(T,U,C))};function n(){s.readyState===4&&setTimeout(o,0)}function a(){var M=void 0;if(s.response?M=s.response:M=s.responseText||getXml(s),k)try{M=JSON.parse(M)}catch{}return M}function l(M){return clearTimeout(I),M instanceof Error||(M=new Error(""+(M||"Unknown XMLHttpRequest Error"))),M.statusCode=0,r(M,B)}function o(){if(!f){var M;clearTimeout(I),e.useXDR&&s.status===void 0?M=200:M=s.status===1223?204:s.status;var T=B,U=null;return M!==0?(T={body:a(),statusCode:M,method:d,headers:{},url:u,rawRequest:s},s.getAllResponseHeaders&&(T.headers=parseHeaders(s.getAllResponseHeaders()))):U=new Error("Internal XMLHttpRequest Error"),r(U,T,T.body)}}var s=e.xhr||null;s||(e.cors||e.useXDR?s=new createXHR.XDomainRequest:s=new createXHR.XMLHttpRequest);var h,f,u=s.url=e.uri||e.url,d=s.method=e.method||"GET",p=e.body||e.data,m=s.headers=e.headers||{},A=!!e.sync,k=!1,I,B={body:void 0,headers:{},statusCode:0,method:d,url:u,rawRequest:s};if("json"in e&&e.json!==!1&&(k=!0,m.accept||m.Accept||(m.Accept="application/json"),d!=="GET"&&d!=="HEAD"&&(m["content-type"]||m["Content-Type"]||(m["Content-Type"]="application/json"),p=JSON.stringify(e.json===!0?p:e.json))),s.onreadystatechange=n,s.onload=o,s.onerror=l,s.onprogress=function(){},s.onabort=function(){f=!0},s.ontimeout=l,s.open(d,u,!A,e.username,e.password),A||(s.withCredentials=!!e.withCredentials),!A&&e.timeout>0&&(I=setTimeout(function(){if(!f){f=!0,s.abort("timeout");var M=new Error("XMLHttpRequest timeout");M.code="ETIMEDOUT",l(M)}},e.timeout)),s.setRequestHeader)for(h in m)m.hasOwnProperty(h)&&s.setRequestHeader(h,m[h]);else if(e.headers&&!isEmpty(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(s.responseType=e.responseType),"beforeSend"in e&&typeof e.beforeSend=="function"&&e.beforeSend(s),s.send(p||null),s}function getXml(e){try{if(e.responseType==="document")return e.responseXML;var t=e.responseXML&&e.responseXML.documentElement.nodeName==="parsererror";if(e.responseType===""&&!t)return e.responseXML}catch{}return null}function noop$1(){}var xhrExports=xhr$1.exports,parseBmfontAscii=function e(t){if(!t)throw new Error("no data provided");t=t.toString().trim();var r={pages:[],chars:[],kernings:[]},n=t.split(/\r\n?|\n/g);if(n.length===0)throw new Error("no data in BMFont file");for(var a=0;a<n.length;a++){var l=splitLine(n[a],a);if(l)if(l.key==="page"){if(typeof l.data.id!="number")throw new Error("malformed file at line "+a+" -- needs page id=N");if(typeof l.data.file!="string")throw new Error("malformed file at line "+a+' -- needs page file="path"');r.pages[l.data.id]=l.data.file}else l.key==="chars"||l.key==="kernings"||(l.key==="char"?r.chars.push(l.data):l.key==="kerning"?r.kernings.push(l.data):r[l.key]=l.data)}return r};function splitLine(e,t){if(e=e.replace(/\t+/g," ").trim(),!e)return null;var r=e.indexOf(" ");if(r===-1)throw new Error("no named row at line "+t);var n=e.substring(0,r);e=e.substring(r+1),e=e.replace(/letter=[\'\"]\S+[\'\"]/gi,""),e=e.split("="),e=e.map(function(h){return h.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var a=[],l=0;l<e.length;l++){var o=e[l];l===0?a.push({key:o[0],data:""}):l===e.length-1?a[a.length-1].data=parseData(o[0]):(a[a.length-1].data=parseData(o[0]),a.push({key:o[1],data:""}))}var s={key:n,data:{}};return a.forEach(function(h){s.data[h.key]=h.data}),s}function parseData(e){return!e||e.length===0?"":e.indexOf('"')===0||e.indexOf("'")===0?e.substring(1,e.length-1):e.indexOf(",")!==-1?parseIntList$1(e):parseInt(e,10)}function parseIntList$1(e){return e.split(",").map(function(t){return parseInt(t,10)})}var GLYPH_DESIGNER_ERROR="chasrset",parseAttribs=function e(t){t=Object.assign({},t),GLYPH_DESIGNER_ERROR in t&&(t.charset=t[GLYPH_DESIGNER_ERROR],delete t[GLYPH_DESIGNER_ERROR]);for(var r in t)r==="face"||r==="charset"||(r==="padding"||r==="spacing"?t[r]=parseIntList(t[r]):t[r]=parseInt(t[r],10));return t};function parseIntList(e){return e.split(",").map(function(t){return parseInt(t,10)})}var xmlParseFromString=function e(){return typeof self.DOMParser<"u"?function(t){var r=new self.DOMParser;return r.parseFromString(t,"application/xml")}:typeof self.ActiveXObject<"u"&&new self.ActiveXObject("Microsoft.XMLDOM")?function(t){var r=new self.ActiveXObject("Microsoft.XMLDOM");return r.async="false",r.loadXML(t),r}:function(t){var r=document.createElement("div");return r.innerHTML=t,r}}(),parseAttributes=parseAttribs,parseFromString=xmlParseFromString,NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"},browser$1=function e(t){t=t.toString();var r=parseFromString(t),n={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(u){var d=r.getElementsByTagName(u)[0];d&&(n[u]=parseAttributes(getAttribs(d)))});var a=r.getElementsByTagName("pages")[0];if(!a)throw new Error("malformed file -- no <pages> element");for(var l=a.getElementsByTagName("page"),o=0;o<l.length;o++){var s=l[o],h=parseInt(s.getAttribute("id"),10),f=s.getAttribute("file");if(isNaN(h))throw new Error('malformed file -- page "id" attribute is NaN');if(!f)throw new Error('malformed file -- needs page "file" attribute');n.pages[parseInt(h,10)]=f}return["chars","kernings"].forEach(function(u){var d=r.getElementsByTagName(u)[0];if(d)for(var p=u.substring(0,u.length-1),m=d.getElementsByTagName(p),A=0;A<m.length;A++){var k=m[A];n[u].push(parseAttributes(getAttribs(k)))}}),n};function getAttribs(e){var t=getAttribList(e);return t.reduce(function(r,n){var a=mapName(n.nodeName);return r[a]=n.nodeValue,r},{})}function getAttribList(e){for(var t=[],r=0;r<e.attributes.length;r++)t.push(e.attributes[r]);return t}function mapName(e){return NAME_MAP[e.toLowerCase()]||e}var HEADER$1=[66,77,70],parseBmfontBinary=function e(t){if(t.length<6)throw new Error("invalid buffer length for BMFont");var r=HEADER$1.every(function(s,h){return t.readUInt8(h)===s});if(!r)throw new Error("BMFont missing BMF byte header");var n=3,a=t.readUInt8(n++);if(a>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var l={kernings:[],chars:[]},o=0;o<5;o++)n+=readBlock(l,t,n);return l};function readBlock(e,t,r){if(r>t.length-1)return 0;var n=t.readUInt8(r++),a=t.readInt32LE(r);switch(r+=4,n){case 1:e.info=readInfo(t,r);break;case 2:e.common=readCommon(t,r);break;case 3:e.pages=readPages(t,r,a);break;case 4:e.chars=readChars(t,r,a);break;case 5:e.kernings=readKernings(t,r,a);break}return 5+a}function readInfo(e,t){var r={};r.size=e.readInt16LE(t);var n=e.readUInt8(t+2);return r.smooth=n>>7&1,r.unicode=n>>6&1,r.italic=n>>5&1,r.bold=n>>4&1,n>>3&1&&(r.fixedHeight=1),r.charset=e.readUInt8(t+3)||"",r.stretchH=e.readUInt16LE(t+4),r.aa=e.readUInt8(t+6),r.padding=[e.readInt8(t+7),e.readInt8(t+8),e.readInt8(t+9),e.readInt8(t+10)],r.spacing=[e.readInt8(t+11),e.readInt8(t+12)],r.outline=e.readUInt8(t+13),r.face=readStringNT(e,t+14),r}function readCommon(e,t){var r={};return r.lineHeight=e.readUInt16LE(t),r.base=e.readUInt16LE(t+2),r.scaleW=e.readUInt16LE(t+4),r.scaleH=e.readUInt16LE(t+6),r.pages=e.readUInt16LE(t+8),e.readUInt8(t+10),r.packed=0,r.alphaChnl=e.readUInt8(t+11),r.redChnl=e.readUInt8(t+12),r.greenChnl=e.readUInt8(t+13),r.blueChnl=e.readUInt8(t+14),r}function readPages(e,t,r){for(var n=[],a=readNameNT(e,t),l=a.length+1,o=r/l,s=0;s<o;s++)n[s]=e.slice(t,t+a.length).toString("utf8"),t+=l;return n}function readChars(e,t,r){for(var n=[],a=r/20,l=0;l<a;l++){var o={},s=l*20;o.id=e.readUInt32LE(t+0+s),o.x=e.readUInt16LE(t+4+s),o.y=e.readUInt16LE(t+6+s),o.width=e.readUInt16LE(t+8+s),o.height=e.readUInt16LE(t+10+s),o.xoffset=e.readInt16LE(t+12+s),o.yoffset=e.readInt16LE(t+14+s),o.xadvance=e.readInt16LE(t+16+s),o.page=e.readUInt8(t+18+s),o.chnl=e.readUInt8(t+19+s),n[l]=o}return n}function readKernings(e,t,r){for(var n=[],a=r/10,l=0;l<a;l++){var o={},s=l*10;o.first=e.readUInt32LE(t+0+s),o.second=e.readUInt32LE(t+4+s),o.amount=e.readInt16LE(t+8+s),n[l]=o}return n}function readNameNT(e,t){for(var r=t;r<e.length&&e[r]!==0;r++);return e.slice(t,r)}function readStringNT(e,t){return readNameNT(e,t).toString("utf8")}var Buffer$1=buffer.Buffer,bufferEqual=function(e,t){if(Buffer$1.isBuffer(e)&&Buffer$1.isBuffer(t)){if(typeof e.equals=="function")return e.equals(t);if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},equal=bufferEqual,HEADER=Buffer.from([66,77,70,3]),isBinary=function(e){return typeof e=="string"?e.substring(0,3)==="BMF":e.length>4&&equal(e.slice(0,4),HEADER)},xhr=xhrExports,noop=function(){},parseASCII=parseBmfontAscii,parseXML=browser$1,readBinary=parseBmfontBinary,isBinaryFormat=isBinary,xtend=immutable,xml2=function e(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}(),browser=function(e,t){t=typeof t=="function"?t:noop,typeof e=="string"?e={uri:e}:e||(e={});var r=e.binary;r&&(e=getBinaryOpts(e)),xhr(e,function(n,a,l){if(n)return t(n);if(!/^2/.test(a.statusCode))return t(new Error("http status code: "+a.statusCode));if(!l)return t(new Error("no body result"));var o=!1;if(isArrayBuffer(l)){var s=new Uint8Array(l);l=Buffer.from(s,"binary")}isBinaryFormat(l)&&(o=!0,typeof l=="string"&&(l=Buffer.from(l,"binary"))),o||(Buffer.isBuffer(l)&&(l=l.toString(e.encoding)),l=l.trim());var h;try{var f=a.headers["content-type"];o?h=readBinary(l):/json/.test(f)||l.charAt(0)==="{"?h=JSON.parse(l):/xml/.test(f)||l.charAt(0)==="<"?h=parseXML(l):h=parseASCII(l)}catch(u){t(new Error("error parsing font "+u.message)),t=noop}t(null,h)})};function isArrayBuffer(e){var t=Object.prototype.toString;return t.call(e)==="[object ArrayBuffer]"}function getBinaryOpts(e){if(xml2)return xtend(e,{responseType:"arraybuffer"});if(typeof self.XMLHttpRequest>"u")throw new Error("your browser does not support XHR loading");var t=new self.XMLHttpRequest;return t.overrideMimeType("text/plain; charset=x-user-defined"),xtend({xhr:t},e)}const bMFont=getDefaultExportFromCjs(browser);function measureText(e,t){let r=0;for(let n=0;n<t.length;n++)if(e.chars[t[n]]){const a=e.kernings[t[n]]&&e.kernings[t[n]][t[n+1]]?e.kernings[t[n]][t[n+1]]:0;r+=(e.chars[t[n]].xadvance||0)+a}return r}function splitLines(e,t,r){const n=t.replace(/[\r\n]+/g,` 
`).split(" "),a=[];let l=[],o=0;return n.forEach(s=>{const h=[...l,s].join(" "),f=measureText(e,h);f<=r&&!s.includes(`
`)?(f>o&&(o=f),l.push(s)):(a.push(l),l=[s.replace(`
`,"")])}),a.push(l),{lines:a,longestLine:o}}function measureTextHeight(e,t,r){const{lines:n}=splitLines(e,t,r);return n.length*e.common.lineHeight}var define_process_env_default={};function xOffsetBasedOnAlignment(e,t,r,n,a){return a===e.HORIZONTAL_ALIGN_LEFT?0:a===e.HORIZONTAL_ALIGN_CENTER?(n-measureText(t,r))/2:n-measureText(t,r)}function drawCharacter(e,t,r,n,a){if(a.width>0&&a.height>0){const l=t.pages[a.page];e.blit(l,r+a.xoffset,n+a.yoffset,a.x,a.y,a.width,a.height)}return e}function printText(e,t,r,n,a){for(let l=0;l<n.length;l++){let o;e.chars[n[l]]?o=n[l]:/\s/.test(n[l])?o="":o="?";const s=e.chars[o]||{},h=e.kernings[o];drawCharacter(this,e,t,r,s||{});const f=h&&h[n[l+1]]?h[n[l+1]]:0;t+=f+(s.xadvance||a)}}function loadPages(e,t,r){const n=r.map(a=>e.read(t+"/"+a));return Promise.all(n)}const dir=define_process_env_default.DIRNAME||`${__dirname}/../`,print=()=>({constants:{measureText,measureTextHeight,FONT_SANS_8_BLACK:Path.join(dir,"fonts/open-sans/open-sans-8-black/open-sans-8-black.fnt"),FONT_SANS_10_BLACK:Path.join(dir,"fonts/open-sans/open-sans-10-black/open-sans-10-black.fnt"),FONT_SANS_12_BLACK:Path.join(dir,"fonts/open-sans/open-sans-12-black/open-sans-12-black.fnt"),FONT_SANS_14_BLACK:Path.join(dir,"fonts/open-sans/open-sans-14-black/open-sans-14-black.fnt"),FONT_SANS_16_BLACK:Path.join(dir,"fonts/open-sans/open-sans-16-black/open-sans-16-black.fnt"),FONT_SANS_32_BLACK:Path.join(dir,"fonts/open-sans/open-sans-32-black/open-sans-32-black.fnt"),FONT_SANS_64_BLACK:Path.join(dir,"fonts/open-sans/open-sans-64-black/open-sans-64-black.fnt"),FONT_SANS_128_BLACK:Path.join(dir,"fonts/open-sans/open-sans-128-black/open-sans-128-black.fnt"),FONT_SANS_8_WHITE:Path.join(dir,"fonts/open-sans/open-sans-8-white/open-sans-8-white.fnt"),FONT_SANS_16_WHITE:Path.join(dir,"fonts/open-sans/open-sans-16-white/open-sans-16-white.fnt"),FONT_SANS_32_WHITE:Path.join(dir,"fonts/open-sans/open-sans-32-white/open-sans-32-white.fnt"),FONT_SANS_64_WHITE:Path.join(dir,"fonts/open-sans/open-sans-64-white/open-sans-64-white.fnt"),FONT_SANS_128_WHITE:Path.join(dir,"fonts/open-sans/open-sans-128-white/open-sans-128-white.fnt"),loadFont(e,t){return typeof e!="string"?throwError.call(this,"file must be a string",t):new Promise((r,n)=>{t=t||function(a,l){a?n(a):r(l)},bMFont(e,(a,l)=>{const o={},s={};if(a)return throwError.call(this,a,t);for(let h=0;h<l.chars.length;h++)o[String.fromCharCode(l.chars[h].id)]=l.chars[h];for(let h=0;h<l.kernings.length;h++){const f=String.fromCharCode(l.kernings[h].first);s[f]=s[f]||{},s[f][String.fromCharCode(l.kernings[h].second)]=l.kernings[h].amount}loadPages(this,Path.dirname(e),l.pages).then(h=>{t(null,{chars:o,kernings:s,pages:h,common:l.common,info:l.info})})})})}},class:{print(e,t,r,n,a,l,o){if(typeof a=="function"&&typeof o>"u"&&(o=a,a=1/0),typeof a>"u"&&(a=1/0),typeof l=="function"&&typeof o>"u"&&(o=l,l=1/0),typeof l>"u"&&(l=1/0),typeof e!="object")return throwError.call(this,"font must be a Jimp loadFont",o);if(typeof t!="number"||typeof r!="number"||typeof a!="number")return throwError.call(this,"x, y and maxWidth must be numbers",o);if(typeof a!="number")return throwError.call(this,"maxWidth must be a number",o);if(typeof l!="number")return throwError.call(this,"maxHeight must be a number",o);let s,h;typeof n=="object"&&n.text!==null&&n.text!==void 0?(s=n.alignmentX||this.constructor.HORIZONTAL_ALIGN_LEFT,h=n.alignmentY||this.constructor.VERTICAL_ALIGN_TOP,{text:n}=n):(s=this.constructor.HORIZONTAL_ALIGN_LEFT,h=this.constructor.VERTICAL_ALIGN_TOP,n=n.toString()),l!==1/0&&h===this.constructor.VERTICAL_ALIGN_BOTTOM?r+=l-measureTextHeight(e,n,a):l!==1/0&&h===this.constructor.VERTICAL_ALIGN_MIDDLE&&(r+=l/2-measureTextHeight(e,n,a)/2);const f=Object.entries(e.chars)[0][1].xadvance,{lines:u,longestLine:d}=splitLines(e,n,a);return u.forEach(p=>{const m=p.join(" "),A=xOffsetBasedOnAlignment(this.constructor,e,m,a,s);printText.call(this,e,t+A,r,m,f),r+=e.common.lineHeight}),isNodePattern(o)&&o.call(this,null,this,{x:t+d,y:r}),this}}});function Resize(e,t,r,n,a,l,o){this.widthOriginal=Math.abs(Math.floor(e)||0),this.heightOriginal=Math.abs(Math.floor(t)||0),this.targetWidth=Math.abs(Math.floor(r)||0),this.targetHeight=Math.abs(Math.floor(n)||0),this.colorChannels=a?4:3,this.interpolationPass=!!l,this.resizeCallback=typeof o=="function"?o:function(){},this.targetWidthMultipliedByChannels=this.targetWidth*this.colorChannels,this.originalWidthMultipliedByChannels=this.widthOriginal*this.colorChannels,this.originalHeightMultipliedByChannels=this.heightOriginal*this.colorChannels,this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal,this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight,this.initialize()}Resize.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0)this.configurePasses();else throw new Error("Invalid settings specified for the resizer.")};Resize.prototype.configurePasses=function(){this.widthOriginal===this.targetWidth?this.resizeWidth=this.bypassResizer:(this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth,this.ratioWeightWidthPass<1&&this.interpolationPass?(this.initializeFirstPassBuffers(!0),this.resizeWidth=this.colorChannels===4?this.resizeWidthInterpolatedRGBA:this.resizeWidthInterpolatedRGB):(this.initializeFirstPassBuffers(!1),this.resizeWidth=this.colorChannels===4?this.resizeWidthRGBA:this.resizeWidthRGB)),this.heightOriginal===this.targetHeight?this.resizeHeight=this.bypassResizer:(this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight,this.ratioWeightHeightPass<1&&this.interpolationPass?(this.initializeSecondPassBuffers(!0),this.resizeHeight=this.resizeHeightInterpolated):(this.initializeSecondPassBuffers(!1),this.resizeHeight=this.colorChannels===4?this.resizeHeightRGBA:this.resizeHeightRGB))};Resize.prototype._resizeWidthInterpolatedRGBChannels=function(e,t){const r=t?4:3,n=this.ratioWeightWidthPass,a=this.widthBuffer;let l=0,o=0,s=0,h=0,f=0,u;for(u=0;l<1/3;u+=r,l+=n)for(o=u,s=0;o<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,o+=this.targetWidthMultipliedByChannels)a[o]=e[s],a[o+1]=e[s+1],a[o+2]=e[s+2],t&&(a[o+3]=e[s+3]);l-=1/3;let d;for(d=this.widthOriginal-1;l<d;u+=r,l+=n)for(f=l%1,h=1-f,o=u,s=Math.floor(l)*r;o<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,o+=this.targetWidthMultipliedByChannels)a[o+0]=e[s+0]*h+e[s+r+0]*f,a[o+1]=e[s+1]*h+e[s+r+1]*f,a[o+2]=e[s+2]*h+e[s+r+2]*f,t&&(a[o+3]=e[s+3]*h+e[s+r+3]*f);for(d=this.originalWidthMultipliedByChannels-r;u<this.targetWidthMultipliedByChannels;u+=r)for(o=u,s=d;o<this.widthPassResultSize;s+=this.originalWidthMultipliedByChannels,o+=this.targetWidthMultipliedByChannels)a[o]=e[s],a[o+1]=e[s+1],a[o+2]=e[s+2],t&&(a[o+3]=e[s+3]);return a};Resize.prototype._resizeWidthRGBChannels=function(e,t){const r=t?4:3,n=this.ratioWeightWidthPass,a=1/n,l=this.originalWidthMultipliedByChannels-r+1,o=this.targetWidthMultipliedByChannels-r+1,s=this.outputWidthWorkBench,h=this.widthBuffer,f=this.outputWidthWorkBenchOpaquePixelsCount;let u=0,d=0,p=0,m=0,A=0,k=0,I=0,B=1,M=0,T=0,U=0,C=0;do{for(A=0;A<this.originalHeightMultipliedByChannels;)s[A++]=0,s[A++]=0,s[A++]=0,t&&(s[A++]=0,f[A/r-1]=0);u=n;do{for(d=1+p-m,B=Math.min(u,d),A=0,k=p;A<this.originalHeightMultipliedByChannels;k+=l)M=e[k],T=e[++k],U=e[++k],C=t?e[++k]:255,s[A++]+=(C?M:0)*B,s[A++]+=(C?T:0)*B,s[A++]+=(C?U:0)*B,t&&(s[A++]+=C*B,f[A/r-1]+=C?B:0);if(u>=d)p+=r,m=p,u-=d;else{m+=u;break}}while(u>0&&p<this.originalWidthMultipliedByChannels);for(A=0,k=I;A<this.originalHeightMultipliedByChannels;k+=o)u=t?f[A/r]:1,B=t?u?1/u:0:a,h[k]=s[A++]*B,h[++k]=s[A++]*B,h[++k]=s[A++]*B,t&&(h[++k]=s[A++]*a);I+=r}while(I<this.targetWidthMultipliedByChannels);return h};Resize.prototype._resizeHeightRGBChannels=function(e,t){const r=this.ratioWeightHeightPass,n=1/r,a=this.outputHeightWorkBench,l=this.heightBuffer,o=this.outputHeightWorkBenchOpaquePixelsCount;let s=0,h=0,f=0,u=0,d=0,p=0,m=0,A=1,k=0,I=0,B=0,M=0;do{for(d=0;d<this.targetWidthMultipliedByChannels;)a[d++]=0,a[d++]=0,a[d++]=0,t&&(a[d++]=0,o[d/4-1]=0);s=r;do{for(h=1+f-u,A=Math.min(s,h),m=f,d=0;d<this.targetWidthMultipliedByChannels;)k=e[m++],I=e[m++],B=e[m++],M=t?e[m++]:255,a[d++]+=(M?k:0)*A,a[d++]+=(M?I:0)*A,a[d++]+=(M?B:0)*A,t&&(a[d++]+=M*A,o[d/4-1]+=M?A:0);if(s>=h)f=m,u=f,s-=h;else{u+=s;break}}while(s>0&&f<this.widthPassResultSize);for(d=0;d<this.targetWidthMultipliedByChannels;)s=t?o[d/4]:1,A=t?s?1/s:0:n,l[p++]=Math.round(a[d++]*A),l[p++]=Math.round(a[d++]*A),l[p++]=Math.round(a[d++]*A),t&&(l[p++]=Math.round(a[d++]*n))}while(p<this.finalResultSize);return l};Resize.prototype.resizeWidthInterpolatedRGB=function(e){return this._resizeWidthInterpolatedRGBChannels(e,!1)};Resize.prototype.resizeWidthInterpolatedRGBA=function(e){return this._resizeWidthInterpolatedRGBChannels(e,!0)};Resize.prototype.resizeWidthRGB=function(e){return this._resizeWidthRGBChannels(e,!1)};Resize.prototype.resizeWidthRGBA=function(e){return this._resizeWidthRGBChannels(e,!0)};Resize.prototype.resizeHeightInterpolated=function(e){const t=this.ratioWeightHeightPass,r=this.heightBuffer;let n=0,a=0,l=0,o=0,s=0,h=0,f=0,u;for(;n<1/3;n+=t)for(l=0;l<this.targetWidthMultipliedByChannels;)r[a++]=Math.round(e[l++]);for(n-=1/3,u=this.heightOriginal-1;n<u;n+=t)for(f=n%1,h=1-f,o=Math.floor(n)*this.targetWidthMultipliedByChannels,s=o+this.targetWidthMultipliedByChannels,l=0;l<this.targetWidthMultipliedByChannels;++l)r[a++]=Math.round(e[o++]*h+e[s++]*f);for(;a<this.finalResultSize;)for(l=0,o=u*this.targetWidthMultipliedByChannels;l<this.targetWidthMultipliedByChannels;++l)r[a++]=Math.round(e[o++]);return r};Resize.prototype.resizeHeightRGB=function(e){return this._resizeHeightRGBChannels(e,!1)};Resize.prototype.resizeHeightRGBA=function(e){return this._resizeHeightRGBChannels(e,!0)};Resize.prototype.resize=function(e){this.resizeCallback(this.resizeHeight(this.resizeWidth(e)))};Resize.prototype.bypassResizer=function(e){return e};Resize.prototype.initializeFirstPassBuffers=function(e){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize),e||(this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels),this.colorChannels>3&&(this.outputWidthWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.heightOriginal)))};Resize.prototype.initializeSecondPassBuffers=function(e){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize),e||(this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels),this.colorChannels>3&&(this.outputHeightWorkBenchOpaquePixelsCount=this.generateFloat64Buffer(this.targetWidth)))};Resize.prototype.generateFloatBuffer=function(e){try{return new Float32Array(e)}catch{return[]}};Resize.prototype.generateFloat64Buffer=function(e){try{return new Float64Array(e)}catch{return[]}};Resize.prototype.generateUint8Buffer=function(e){try{return new Uint8Array(e)}catch{return[]}};const operations={nearestNeighbor(e,t){const r=e.width,n=e.height,a=t.width,l=t.height,o=e.data,s=t.data;for(let h=0;h<l;h++)for(let f=0;f<a;f++){let u=(h*a+f)*4;const d=Math.floor(h*n/l),p=Math.floor(f*r/a);let m=(d*r+p)*4;s[u++]=o[m++],s[u++]=o[m++],s[u++]=o[m++],s[u++]=o[m++]}},bilinearInterpolation(e,t){const r=e.width,n=e.height,a=t.width,l=t.height,o=e.data,s=t.data,h=function(u,d,p,m,A){return d===m?p:Math.round((u-d)*A+(m-u)*p)},f=function(u,d,p,m,A,k,I,B){let M=(I*r+m)*4+d,T=(I*r+A)*4+d;const U=h(p,m,o[M],A,o[T]);if(B===I)s[u+d]=U;else{M=(B*r+m)*4+d,T=(B*r+A)*4+d;const C=h(p,m,o[M],A,o[T]);s[u+d]=h(k,I,U,B,C)}};for(let u=0;u<l;u++)for(let d=0;d<a;d++){const p=(u*a+d)*4,m=d*r/a,A=Math.floor(m),k=Math.min(Math.ceil(m),r-1),I=u*n/l,B=Math.floor(I),M=Math.min(Math.ceil(I),n-1);f(p,0,m,A,k,I,B,M),f(p,1,m,A,k,I,B,M),f(p,2,m,A,k,I,B,M),f(p,3,m,A,k,I,B,M)}},_interpolate2D(e,t,r,n){const a=e.data,l=t.data,o=e.width,s=e.height,h=t.width,f=t.height,u=Math.max(1,Math.floor(o/h)),d=h*u,p=Math.max(1,Math.floor(s/f)),m=f*p,A=Buffer.alloc(d*s*4);for(let B=0;B<s;B++)for(let M=0;M<d;M++){const T=M*(o-1)/d,U=Math.floor(T),C=T-U,w=(B*o+U)*4,E=(B*d+M)*4;for(let S=0;S<4;S++){const $=w+S,G=U>0?a[$-4]:2*a[$]-a[$+4],L=a[$],O=a[$+4],z=U<o-2?a[$+8]:2*a[$+4]-a[$];A[E+S]=n(G,L,O,z,C)}}const k=Buffer.alloc(d*m*4);for(let B=0;B<m;B++)for(let M=0;M<d;M++){const T=B*(s-1)/m,U=Math.floor(T),C=T-U,w=(U*d+M)*4,E=(B*d+M)*4;for(let S=0;S<4;S++){const $=w+S,G=U>0?A[$-d*4]:2*A[$]-A[$+d*4],L=A[$],O=A[$+d*4],z=U<s-2?A[$+d*8]:2*A[$+d*4]-A[$];k[E+S]=n(G,L,O,z,C)}}const I=u*p;if(I>1)for(let B=0;B<f;B++)for(let M=0;M<h;M++){let T=0,U=0,C=0,w=0,E=0;for(let $=0;$<p;$++){const G=B*p+$;for(let L=0;L<u;L++){const O=M*u+L,z=(G*d+O)*4,H=k[z+3];H&&(T+=k[z],U+=k[z+1],C+=k[z+2],E++),w+=H}}const S=(B*h+M)*4;l[S]=E?Math.round(T/E):0,l[S+1]=E?Math.round(U/E):0,l[S+2]=E?Math.round(C/E):0,l[S+3]=Math.round(w/I)}else t.data=k},bicubicInterpolation(e,t,r){const n=function(a,l,o,s,h){const f=s-o-a+l,u=a-l-f,d=o-a,p=l;return Math.max(0,Math.min(255,f*(h*h*h)+u*(h*h)+d*h+p))};return this._interpolate2D(e,t,r,n)},hermiteInterpolation(e,t,r){const n=function(a,l,o,s,h){const f=l,u=.5*(o-a),d=a-2.5*l+2*o-.5*s,p=.5*(s-a)+1.5*(l-o);return Math.max(0,Math.min(255,Math.round(((p*h+d)*h+u)*h+f)))};return this._interpolate2D(e,t,r,n)},bezierInterpolation(e,t,r){const n=function(a,l,o,s,h){const f=l+(o-a)/4,u=o-(s-l)/4,d=1-h,p=l*d*d*d,m=3*f*d*d*h,A=3*u*d*h*h,k=o*h*h*h;return Math.max(0,Math.min(255,Math.round(p+m+A+k)))};return this._interpolate2D(e,t,r,n)}},resize=()=>({constants:{RESIZE_NEAREST_NEIGHBOR:"nearestNeighbor",RESIZE_BILINEAR:"bilinearInterpolation",RESIZE_BICUBIC:"bicubicInterpolation",RESIZE_HERMITE:"hermiteInterpolation",RESIZE_BEZIER:"bezierInterpolation"},class:{resize(e,t,r,n){if(typeof e!="number"||typeof t!="number")return throwError.call(this,"w and h must be numbers",n);if(typeof r=="function"&&typeof n>"u"&&(n=r,r=null),e===this.constructor.AUTO&&t===this.constructor.AUTO)return throwError.call(this,"w and h cannot both be set to auto",n);if(e===this.constructor.AUTO&&(e=this.bitmap.width*(t/this.bitmap.height)),t===this.constructor.AUTO&&(t=this.bitmap.height*(e/this.bitmap.width)),e<0||t<0)return throwError.call(this,"w and h must be positive numbers",n);if(e=Math.round(e)||1,t=Math.round(t)||1,typeof operations[r]=="function"){const a={data:Buffer.alloc(e*t*4),width:e,height:t};operations[r](this.bitmap,a),this.bitmap=a}else{const a=this;new Resize(this.bitmap.width,this.bitmap.height,e,t,!0,!0,o=>{a.bitmap.data=Buffer.from(o),a.bitmap.width=e,a.bitmap.height=t}).resize(this.bitmap.data)}return isNodePattern(n)&&n.call(this,null,this),this}}});function matrixRotate(e){if(Math.abs(e)%90!==0)throw new Error("Unsupported matrix rotation degree");if(e%=360,Math.abs(e)===0)return;const t=this.bitmap.width,r=this.bitmap.height;let n;switch(e){case 90:case-270:n=90;break;case 180:case-180:n=180;break;case 270:case-90:n=-90;break;default:throw new Error("Unsupported matrix rotation degree")}const a=n===180?t:r,l=n===180?r:t,o=Buffer.alloc(this.bitmap.data.length);function s(u,d){return function(p,m){return m*u+p<<2}}const h=s(t),f=s(a);for(let u=0;u<t;u++)for(let d=0;d<r;d++){const p=h(u,d),m=this.bitmap.data.readUInt32BE(p);let A;switch(n){case 90:A=f(d,t-u-1);break;case-90:A=f(r-d-1,u);break;case 180:A=f(t-u-1,r-d-1);break;default:throw new Error("Unsupported matrix rotation angle")}o.writeUInt32BE(m,A)}this.bitmap.data=o,this.bitmap.width=a,this.bitmap.height=l}function advancedRotate(e,t){e%=360;const r=e*Math.PI/180,n=Math.cos(r),a=Math.sin(r);let l=this.bitmap.width,o=this.bitmap.height;if(t===!0||typeof t=="string"){l=Math.ceil(Math.abs(this.bitmap.width*n)+Math.abs(this.bitmap.height*a))+1,o=Math.ceil(Math.abs(this.bitmap.width*a)+Math.abs(this.bitmap.height*n))+1,l%2!==0&&l++,o%2!==0&&o++;const m=this.cloneQuiet();this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,function(k,I,B){this.bitmap.data.writeUInt32BE(this._background,B)});const A=Math.max(l,o,this.bitmap.width,this.bitmap.height);this.resize(A,A,t),this.blit(m,this.bitmap.width/2-m.bitmap.width/2,this.bitmap.height/2-m.bitmap.height/2)}const s=this.bitmap.width,h=this.bitmap.height,f=Buffer.alloc(this.bitmap.data.length);function u(m,A){return function(k,I){return{x:k+m,y:I+A}}}const d=u(-(s/2),-(h/2)),p=u(s/2+.5,h/2+.5);for(let m=1;m<=h;m++)for(let A=1;A<=s;A++){const k=d(A,m),I=p(n*k.x-a*k.y,n*k.y+a*k.x),B=s*(m-1)+A-1<<2;if(I.x>=0&&I.x<s&&I.y>=0&&I.y<h){const M=(s*(I.y|0)+I.x|0)<<2,T=this.bitmap.data.readUInt32BE(M);f.writeUInt32BE(T,B)}else f.writeUInt32BE(this._background,B)}if(this.bitmap.data=f,t===!0||typeof t=="string"){const m=s/2-l/2,A=h/2-o/2;this.crop(m,A,l,o)}}const rotate=()=>({rotate(e,t,r){return(typeof t>"u"||t===null)&&(t=!0),typeof t=="function"&&typeof r>"u"&&(r=t,t=!0),typeof e!="number"?throwError.call(this,"deg must be a number",r):typeof t!="boolean"&&typeof t!="string"?throwError.call(this,"mode must be a boolean or a string",r):(e%90===0&&(t||this.bitmap.width===this.bitmap.height||e%180===0)?matrixRotate.call(this,e):advancedRotate.call(this,e,t,r),isNodePattern(r)&&r.call(this,null,this),this)}}),scale=()=>({scale(e,t,r){if(typeof e!="number")return throwError.call(this,"f must be a number",r);if(e<0)return throwError.call(this,"f must be a positive number",r);typeof t=="function"&&typeof r>"u"&&(r=t,t=null);const n=this.bitmap.width*e,a=this.bitmap.height*e;return this.resize(n,a,t),isNodePattern(r)&&r.call(this,null,this),this},scaleToFit(e,t,r,n){if(typeof e!="number"||typeof t!="number")return throwError.call(this,"w and h must be numbers",n);typeof r=="function"&&typeof n>"u"&&(n=r,r=null);const a=e/t>this.bitmap.width/this.bitmap.height?t/this.bitmap.height:e/this.bitmap.width;return this.scale(a,r),isNodePattern(n)&&n.call(this,null,this),this}}),shadow=()=>({shadow(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;typeof e=="function"&&(t=e,e={});const{opacity:r=.7,size:n=1.1,x:a=-25,y:l=25,blur:o=5}=e,s=this.clone(),h=this.clone();return h.scan(0,0,h.bitmap.width,h.bitmap.height,(f,u,d)=>{h.bitmap.data[d]=0,h.bitmap.data[d+1]=0,h.bitmap.data[d+2]=0,h.bitmap.data[d+3]=h.constructor.limit255(h.bitmap.data[d+3]*r),this.bitmap.data[d]=0,this.bitmap.data[d+1]=0,this.bitmap.data[d+2]=0,this.bitmap.data[d+3]=0}),h.resize(h.bitmap.width*n,h.bitmap.height*n).blur(o),this.composite(h,a,l),this.composite(s,0,0),isNodePattern(t)&&t.call(this,null,this),this}}),threshold=()=>({threshold(e,t){let{max:r,replace:n=255,autoGreyscale:a=!0}=e;return typeof r!="number"?throwError.call(this,"max must be a number",t):typeof n!="number"?throwError.call(this,"replace must be a number",t):typeof a!="boolean"?throwError.call(this,"autoGreyscale must be a boolean",t):(r=this.constructor.limit255(r),n=this.constructor.limit255(n),a&&this.greyscale(),this.scanQuiet(0,0,this.bitmap.width,this.bitmap.height,(l,o,s)=>{const h=this.bitmap.data[s]<r?this.bitmap.data[s]:n;this.bitmap.data[s]=h,this.bitmap.data[s+1]=h,this.bitmap.data[s+2]=h}),isNodePattern(t)&&t.call(this,null,this),this)}}),plugins=[blit,blur,circle,color,contain,cover,pluginCrop,displace,dither$1,fisheye,flip,gaussian,invert,mask,normalize$1,print,resize,rotate,scale,shadow,threshold],plugins$1=e=>{const t=plugins.map(r=>{let n=r(e)||{};return!n.class&&!n.constants&&(n={class:n}),n});return mergeDeep_1(...t)},index=configure({types:[types],plugins:[plugins$1]});export{index as default};
